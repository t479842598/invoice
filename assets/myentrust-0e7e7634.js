import{ai as g,aT as f,aF as J,c as K,a as b,W as l,bD as n,bF as Q,H as T,aX as d,aY as Z,o as y,bi as w,U as _,b9 as V,I as U}from"./_@vue-5ba92de9.js";const ee={class:"roadui_page"},te=["onClick"],le={class:"roadui_pagerdiv"},oe={__name:"myentrust",props:{query:{type:String,default:()=>""}},setup(B){const z=g("ajax"),s=g("utils"),x=g("qs"),E=g("ElSelectflow"),D=g("index_openmenu"),k=B,h=f(!1),i=f(!1),u=f({status:s.query("status",k.query)||"0"}),v=f([]),I=f([]),S=f({prop:"receivetime",order:"descending"}),o=f(s.getPager(S.value));J(()=>{p(!1)});const M=a=>{o.value.size=a,p(!1)},P=a=>{o.value.number=a,p(!1)},Y=a=>{o.value.order=s.getOrder(a),p(!1)},p=a=>{a&&(o.value.number=1),h.value=!0,i.value=!0,u.value.size=o.value.size,u.value.number=o.value.number,u.value.order=o.value.order,u.value.date1=s.length(v.value)>0?v.value[0]:"",u.value.date2=s.length(v.value)>1?v.value[1]:"",z.post("/Flow/GetEntrustList",x.stringify(u.value)).then(e=>{I.value=e.data.rows,o.value.total=e.data.total,i.value=!1,h.value=!1}).catch(()=>{i.value=!1,h.value=!1})},$=a=>{let e="/flow/run/index?flowid="+a.flowId+"&stepid="+a.stepId+"&taskid="+a.id+"&groupid="+a.groupId+"&instanceid="+a.instanceId+"&display=1",r=0;s.query("isiframe",k.query)==1&&(e+="&nroadflow-token="+s.query("nroadflow-token",k.query),r=1);const m={title:a.title,id:"task_"+a.id,url:e,ico:"Edit",openMode:r,width:1e3,height:620};D(m)},j=a=>{const e={id:"task_process_"+s.createGuid(!1),title:a.title,url:"/flow/run/process?flowid="+a.flowId+"&groupid="+a.groupId+"&status="+u.value.status,openMode:1,width:"1150px",customClass:"el-dialog__padding",center:!1};D(e)},F=a=>{s.confirm("您确定要收回该任务吗？",()=>{i.value=!0,z.post("/Flow/TakeBackEntrustTask",x.stringify({taskId:a.id})).then(e=>{let r=e.msg;if(s.length(r)===0)if(e.success)r="收回成功，请在待办事项中查看该任务！";else switch(e.code){case 1:r="未找到该任务！";break;case 2:r="该任务已处理，不能收回！";break;case 3:r="未找到当前人员！";break;default:r="收回失败！";break}s.msg(r,e.success),i.value=!1,e.success&&p(!1)}).catch(()=>{})})};return(a,e)=>{const r=d("el-input"),m=d("el-form-item"),H=d("el-date-picker"),q=d("el-radio-button"),G=d("el-radio-group"),C=d("el-button"),O=d("el-form"),R=d("el-tag"),c=d("el-table-column"),L=d("el-space"),W=d("el-table"),X=d("el-pagination"),A=Z("loading");return y(),K("div",ee,[b("div",null,[l(O,{inline:!0},{default:n(()=>[l(m,{label:"标题"},{default:n(()=>[l(r,{modelValue:u.value.title,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value.title=t),style:{width:"130px"},clearable:""},null,8,["modelValue"])]),_:1}),l(m,{label:"流程"},{default:n(()=>[l(w(E),{modelValue:u.value.flowId,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value.flowId=t),"auth-type":7,style:{width:"160px"}},null,8,["modelValue"])]),_:1}),l(m,{label:"委托时间"},{default:n(()=>[l(H,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=t=>v.value=t),style:{width:"210px"},type:"daterange","value-format":"YYYY-MM-DD","unlink-panels":"","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:w(s).dateShortucts},null,8,["modelValue","shortcuts"])]),_:1}),l(m,{label:"流程状态"},{default:n(()=>[l(G,{modelValue:u.value.status,"onUpdate:modelValue":e[3]||(e[3]=t=>u.value.status=t),onChange:e[4]||(e[4]=t=>p(!0))},{default:n(()=>[l(q,{label:"0"},{default:n(()=>[_("进行中")]),_:1}),l(q,{label:"1"},{default:n(()=>[_("已结束")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(m,null,{default:n(()=>[l(C,{type:"primary",disabled:i.value,onClick:e[5]||(e[5]=t=>p(!0))},{default:n(()=>[_("查询")]),_:1},8,["disabled"])]),_:1})]),_:1})]),b("div",null,[Q((y(),T(W,{data:I.value,stripe:o.value.tableStripe,border:o.value.tableBorder,style:{width:"100%"},"highlight-current-row":o.value.tableHighlightCurrentRow,"default-sort":S.value,onSortChange:Y},{default:n(()=>[l(c,{prop:"title",label:"标题",sortable:"custom"},{default:n(t=>[t.row.taskType>0?(y(),T(R,{key:0,effect:"dark",style:{"margin-right":"8px","border-width":"0"},color:w(s).getTaskTypeColor(t.row.taskType)},{default:n(()=>[_(V(w(s).getTaskTypeTitle(t.row.taskType)),1)]),_:2},1032,["color"])):U("",!0),b("a",{class:"roaduia",href:"javascript:;",onClick:N=>$(t.row)},V(t.row.title),9,te)]),_:1}),l(c,{prop:"flowName",label:"流程",width:"160",sortable:"custom"}),l(c,{prop:"stepName",label:"步骤",width:"150",sortable:"custom"}),l(c,{prop:"senderName",label:"发送人",width:"100"}),l(c,{prop:"receiverName",label:"委托接收人",width:"100"}),l(c,{prop:"receiveTime",label:"委托时间",width:"150",sortable:"custom"}),l(c,{prop:"handleType",label:"状态",width:"100",sortable:"custom"},{default:n(t=>[b("span",null,V(w(s).getTaskHadleTitle(t.row.handleType)),1)]),_:1}),l(c,{width:"156"},{default:n(t=>[l(L,null,{default:n(()=>[t.row.handleType<2?(y(),T(C,{key:0,type:"primary",size:"small",disabled:i.value,onClick:N=>F(t.row)},{default:n(()=>[_("收回")]),_:2},1032,["disabled","onClick"])):U("",!0),l(C,{type:"info",size:"small",disabled:i.value,onClick:N=>j(t.row)},{default:n(()=>[_("过程")]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[A,h.value]]),b("div",le,[l(X,{currentPage:o.value.number,"onUpdate:currentPage":e[6]||(e[6]=t=>o.value.number=t),"page-size":o.value.size,"onUpdate:pageSize":e[7]||(e[7]=t=>o.value.size=t),"page-sizes":o.value.sizes,background:o.value.background,layout:o.value.layout,total:o.value.total,disabled:i.value,onSizeChange:M,onCurrentChange:P},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])])])])}}};export{oe as default};
