import{ai as F,aT as d,aF as se,c as y,bF as M,H as T,bD as s,a as O,W as t,aX as m,aY as ue,o as i,U as p,b9 as A,F as S,aV as D,bv as ne,I as re}from"./_@vue-5ba92de9.js";const de=O("span",null,"操作",-1),ie={style:{margin:"15px auto 0 auto","text-align":"center"}},pe={style:{"margin-left":"12px"}},ve={style:{"margin-left":"12px"}},me={key:0,style:{"margin-left":"12px"}},ge={__name:"export",props:{query:{type:String,default:()=>""}},setup(H){const c=F("ajax"),r=F("utils"),U=F("qs"),B=F("program_attr_fields"),z=H,V=r.query("programid",z.query),P=d([]),n=d(!1),x=d(!1);let b=[];const E=d({prop:"sort",order:"ascending"}),h=d(r.getPager(E.value)),$=d(B.value),_=d([]),N=d([]),G=d([]);se(()=>{X()});const J=o=>{b=o},W=o=>{h.value.order=r.getOrder(o),w(!1)},X=()=>{const o=[{id:"programdesigner_showtype",key:"showType",children:!1,valueField:"value"},{id:"programdesigner_algin",key:"align",children:!1,valueField:"value"},{id:"programdesigner_exportdatatype",key:"dataType",children:!1,valueField:"value"}];c.post("/Dictionary/GetMultipleOptions",U.stringify({json:JSON.stringify(o)})).then(e=>{_.value=e.data.showType,G.value=e.data.align,N.value=e.data.dataType;for(let u=0;u<_.value.length;u++)if(_.value[u].value=="100"){_.value.splice(u,1);break}w(!1)}).catch(()=>{})},w=o=>{o&&(h.value.number=1),x.value=!0,n.value=!0,c.post("/Program/GetExportList?programid="+V).then(e=>{P.value=e.data,n.value=!1,x.value=!1}).catch(()=>{n.value=!1,x.value=!1})},a=d({}),f=d(!1),j=d(""),L=d(null),Y={},R=o=>{$.value.length===0?c.post("/Program/GetFieldOptions?programid="+V).then(e=>{$.value=e.data,B.value=e.data,I(o)}).catch(()=>{}):I(o)},I=o=>{r.isDef(o)?c.post("/Program/GetExport?fieldid="+o.id).then(e=>{a.value=e.data,a.value.showType=a.value.showType+"",a.value.dataType=a.value.dataType+"",a.value.width=a.value.width<=0?"":a.value.width,j.value="编辑 - "+e.data.field,f.value=!0}).catch(()=>{}):(a.value={programId:V,showType:"0",dataType:"0",align:"left",sort:r.getArrayMax(P.value,"sort")+5},j.value="添加",f.value=!0)},K=async o=>{o&&await o.validate(e=>{e&&(n.value=!0,c.post("/Program/SaveExport",U.stringify(a.value)).then(u=>{let v=u.msg;r.length(v)===0&&(v=u.success?"保存成功！":"保存失败！"),r.msg(v,u.success),n.value=!1,u.success&&(w(!1),f.value=!1,a.value={})}).catch(()=>{n.value=!1}))})},Q=()=>{if(b.length===0){r.msg("您没有选择要删除的导出字段！",!1);return}r.confirm("您确定要删除所选导出字段吗？",()=>{n.value=!0,c.post("/Program/DeleteExport",U.stringify({ids:r.getArrayValues(b,"id").join(",")})).then(o=>{n.value=!1,r.msg(o.success?"删除成功！":"删除失败！",o.success),b=[],w(!1)}).catch(()=>{})})},Z=()=>{r.confirm("复制将清除现有导出字段设置，确定要复制吗？",()=>{n.value=!0,c.post("/Program/CopyListToExport?programid="+V).then(o=>{n.value=!1;let e="";switch(o.code){case 0:e="复制成功！";break;case 1:e="id参数错误！";break;case 2:e="没有要复制的列表字段！";break}r.msg(e,o.success),b=[],w(!0)}).catch(()=>{})})};return(o,e)=>{const u=m("el-table-column"),v=m("el-button"),ee=m("el-table"),k=m("el-option"),C=m("el-select"),g=m("el-form-item"),q=m("el-input"),le=m("el-input-number"),ae=m("el-form"),te=m("el-dialog"),oe=ue("loading");return i(),y("div",null,[M((i(),T(ee,{data:P.value,stripe:h.value.tableStripe,border:h.value.tableBorder,style:{width:"100%"},"highlight-current-row":h.value.tableHighlightCurrentRow,"default-sort":E.value,onSortChange:W,onSelectionChange:J},{default:s(()=>[t(u,{type:"selection",width:"45"}),t(u,{prop:"field",label:"字段名称"}),t(u,{prop:"showTitle",label:"显示名称"}),t(u,{prop:"showType",label:"显示方式",width:"160"},{default:s(l=>[p(A(l.row.showTypeTitle),1)]),_:1}),t(u,{prop:"align",label:"对齐方式",width:"110"},{default:s(l=>[p(A(l.row.alignTitle),1)]),_:1}),t(u,{prop:"sort",label:"排序",width:"80"}),t(u,{width:"80"},{header:s(()=>[de]),default:s(l=>[t(v,{size:"small",disabled:n.value,type:"primary",onClick:ce=>R(l.row)},{default:s(()=>[p("编辑")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[oe,x.value]]),O("div",ie,[t(v,{disabled:n.value,type:"primary",onClick:e[0]||(e[0]=l=>Z())},{default:s(()=>[p("复制列表字段")]),_:1},8,["disabled"]),t(v,{disabled:n.value,type:"primary",onClick:e[1]||(e[1]=l=>R(null))},{default:s(()=>[p("添加")]),_:1},8,["disabled"]),t(v,{disabled:n.value,type:"danger",onClick:e[2]||(e[2]=l=>Q())},{default:s(()=>[p("删除所选")]),_:1},8,["disabled"])]),t(te,{modelValue:f.value,"onUpdate:modelValue":e[13]||(e[13]=l=>f.value=l),title:j.value,"align-center":"","destroy-on-close":"",width:"650px",draggable:"","close-on-click-modal":!1},{default:s(()=>[t(ae,{model:a.value,ref_key:"ruleFormRef",ref:L,rules:Y,"label-width":"80px"},{default:s(()=>[t(g,{label:"字段",prop:"field"},{default:s(()=>[t(C,{modelValue:a.value.field,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.field=l),clearable:"",filterable:"",style:{width:"100%"}},{default:s(()=>[(i(!0),y(S,null,D($.value,l=>(i(),T(k,{key:l.value,label:l.title,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"显示名称",prop:"showTitle"},{default:s(()=>[t(q,{modelValue:a.value.showTitle,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.showTitle=l),clearable:""},null,8,["modelValue"])]),_:1}),t(g,{label:"数据类型",prop:"dataType"},{default:s(()=>[t(C,{modelValue:a.value.dataType,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.dataType=l),style:{width:"210px"},clearable:""},{default:s(()=>[(i(!0),y(S,null,D(N.value,l=>(i(),T(k,{key:l.value,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),M(O("span",pe,[p(" 格式"),t(q,{modelValue:a.value.showFormat,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.showFormat=l),style:{width:"260px","margin-left":"12px"},clearable:""},null,8,["modelValue"])],512),[[ne,a.value.dataType==2||a.value.dataType==3]])]),_:1}),t(g,{label:"显示方式",prop:"showType"},{default:s(()=>[t(C,{modelValue:a.value.showType,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.showType=l),clearable:"",style:{width:"210px"}},{default:s(()=>[(i(!0),y(S,null,D(_.value,l=>(i(),T(k,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),O("span",ve,[p(" 对齐 "),t(C,{modelValue:a.value.align,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.align=l),style:{width:"120px","margin-left":"12px"},clearable:""},{default:s(()=>[(i(!0),y(S,null,D(G.value,l=>(i(),T(k,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1}),t(g,{label:"显示顺序",prop:"sort"},{default:s(()=>[t(le,{step:5,modelValue:a.value.sort,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.sort=l),style:{width:"110px"},"controls-position":"right"},null,8,["modelValue"]),a.value.showType==10?(i(),y("span",me,[p(" 自定义"),t(q,{modelValue:a.value.customString,"onUpdate:modelValue":e[10]||(e[10]=l=>a.value.customString=l),style:{width:"354px","margin-left":"12px"},clearable:"",placeholder:"自定义字符串"},null,8,["modelValue"])])):re("",!0)]),_:1}),t(g,null,{default:s(()=>[t(v,{disabled:n.value,onClick:e[11]||(e[11]=l=>K(L.value)),type:"primary"},{default:s(()=>[p("保存")]),_:1},8,["disabled"]),t(v,{disabled:n.value,onClick:e[12]||(e[12]=l=>f.value=!1)},{default:s(()=>[p("关闭")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{ge as default};
