import{d as ua,ai as U,aT as c,aF as sa,by as al,c as Y,W as o,bD as n,a as r,bF as x,H as E,b9 as g,A as ra,aX as _,aY as ia,aP as da,aM as ca,o as h,U as m,I as L,bv as N,F as J,aV as Te,bG as pa,P as va,a8 as fa}from"./_@vue-5ba92de9.js";import{cD as ga,cE as ue}from"./__vendor-5e6ac033.js";import{E as se,a as ma}from"./_element-plus-8c7ce171.js";import{_ as ha}from"./index-823f4b27.js";import"./_@element-plus-ad4c9002.js";import"./_@popperjs-c75af06c.js";import"./_crypto-js-0812dcff.js";import"./_pdfjs-dist-c04561eb.js";import"./_@microsoft-43c4e133.js";import"./_vue-codemirror-50da885a.js";function ba(z,xe="json"){const W=z.name.split("."),X=W.length>1?W[W.length-1]:"unknown";if(!["xlsx","xls"].some(B=>B===X)){se.error("格式错误！请重新选择");return}const v=new FileReader;return v.readAsArrayBuffer(z),new Promise((B,Ne)=>{v.onloadend=function(D){const re=D.target.result,ee=ga(re,{type:"buffer"}),$=ee.Sheets[ee.SheetNames[0]];for(let P=0;P<=9;P++)delete $[ue.encode_cell({r:0,c:P})];for(let P=0;P<=9;P++)delete $[ue.encode_cell({r:1,c:P})];for(let P=0;P<=9;P++)delete $[ue.encode_cell({r:2,c:P})];let y="";switch(xe.toLowerCase()){case"html":y=ue.sheet_to_html($);break;case"json":y=ue.sheet_to_json($);break;default:se.error("输出类型错误，只能取值为 html 或者 json")}B(y)},v.onerror=D=>Ne(D)})}const R=z=>(da("data-v-3ee00e7f"),z=z(),ca(),z),_a={style:{height:"86.7vh",overflow:"hidden","overflow-y":"scroll"},class:"topdiv"},ya={border:"1",cellpadding:"1",cellspacing:"1",style:{"line-height":"50px","border-color":"#99938f","border-width":"1px",color:"#6f4946",width:"100%","margin-bottom":"0"},class:"table maintable"},wa={class:"type",colspan:"4",height:"50",style:{"padding-left":"5px","font-weight":"bold",color:"#6f4946"}},Ta={colspan:"4",height:"50",class:"type",style:{"padding-left":"5px","font-weight":"bold",color:"#6f4946"}},xa={style:{height:"100px !important"}},Na=R(()=>r("td",{width:"26",class:"center vertical-text",style:{"font-weight":"bolder"}},"购买方",-1)),ka={colspan:"3",width:"250",style:{padding:"15px 10px 0px 10px"}},Pa={style:{display:"inline-block",width:"40px"}},Ca=R(()=>r("td",{width:"26",class:"center vertical-text",style:{"font-weight":"bolder"}},"销售方",-1)),Sa={colspan:"3",width:"250",style:{padding:"15px 10px 0px 10px"}},Va={class:"black"},Ea={class:"black"},Ma={class:"black"},Ba={class:"black"},Aa={class:"black"},La={class:"black"},Ia={key:2,style:{color:"red"}},Fa={key:3},Ua={border:"1",cellpadding:"1",cellspacing:"1",style:{"line-height":"50px","border-color":"#99938f","border-width":"1px",color:"#6f4946",width:"100%","margin-bottom":"0"},class:"table remarkTable"},Ya={colspan:"8",height:"40",class:"amountshow"},za={style:{display:"flex","justify-content":"space-around"}},Ra={style:{height:"100px !important"}},Da=R(()=>r("td",{width:"26",class:"center vertical-text",style:{"font-weight":"bolder"}},"备注",-1)),$a={colspan:"3",width:"270",style:{padding:"0"}},ja=R(()=>r("td",{width:"26",class:"center vertical-text",style:{"font-weight":"bolder"}},"交付到",-1)),Ka={colspan:"3",width:"250",style:{padding:"15px 10px 0px 10px !important"}},Oa={class:"roadui_pagerdiv"},Za={class:"roadui_pagerdiv"},Ja={style:{width:"auto",height:"80px",padding:"30px 30px 50px 20px"}},Ga={style:{"background-color":"#F9FAFD",width:"100%",height:"100%",padding:"20px 0 0 20px"}},Qa=R(()=>r("div",{style:{"font-weight":"400","font-size":"12px"}},"商品税额（含税）",-1)),Ha={style:{"font-size":"35px",display:"inline-block","margin-right":"5px"}},qa={style:{"font-weight":"400","font-size":"12px"}},Wa={class:"btn-footer",style:{"text-align":"right","margin-top":"45px"}},Xa={style:{margin:"auto",width:"80%"}},et=R(()=>r("span",null,"正在开票中",-1)),lt={style:{"margin-top":"10px",margin:"10px auto",display:"flex","justify-content":"space-around"}},at={class:"successfa"},tt=R(()=>r("div",{style:{display:"inline-flex","align-items":"center","font-size":"14px"}}," 已开票 ",-1)),ot={class:"errorfa"},nt=R(()=>r("div",{style:{display:"inline-flex","align-items":"center","font-size":"14px"}}," 开票失败 ",-1)),ut=ua({__name:"HandEditNew",props:{query:{type:String,default:()=>""},modelValue:{type:Boolean,default:!1},id:{type:String,default:"0"},serialNo:{type:String,default:""},buyerTaxNo:{type:String,default:""},buyerName:{type:String,default:""},invoiceTotalPrice:{type:String,default:""},invoiceTotalTax:{type:String,default:""},billcode:{type:String,default:""}},emits:["update:id","update:serialNo","update:buyerTaxNo","update:buyerName","update:invoiceTotalPrice","update:invoiceTotalTax","update:billcode"],setup(z,{expose:xe,emit:W}){const{proxy:X}=fa(),M=U("ajax"),v=U("utils"),B=U("qs"),Ne=U("config"),D=U("index_openmenu"),re=U("index_removetab"),ee=U("index_refreshtab");U("index_dialogshow"),U("index_regcomponent");const $=U("index_userinfo"),y=c(""),P=c(!1);localStorage.getItem("sobInfo")!=""&&(y.value=JSON.parse(localStorage.getItem("sobInfo")));const G=c({prop:"goodsLineNo",order:"ascending"}),Ee=c(v.getPager(G.value)),C=c(v.getPager(G.value)),S=c(v.getPager(G.value)),f=c([]),I=c([]),tl=c([]),ke=c(!1),ie=c(""),de=c(!1),Me=c(),Be=c([]),ol=c(),ce=c(!1),pe=c(!1),Ae=c(0);let Le=c(null),Ie=c(null);const nl=c(),Q=c(!1),Pe=c(),w=c([]),Ce=c(0),Fe=c(0),Ue=c(0),ve=c([]),ul=()=>{if(f.value.length===0){v.msg("请选择要添加折扣的数据","warning",!1);return}else if(f.value.some(e=>e.goodsTotalPrice==="")){v.msg("价税合计不能为空","error",!1);return}else if(f.value.some(e=>e.invoiceLineNature==="1")||f.value.some(e=>e.invoiceLineNature==="2")){v.msg("选中的数据中包含【折扣行】请重新选择","error",!1);return}else if(f.value.length>1){f.value.sort((t,d)=>t.goodsLineNo-d.goodsLineNo);let e=f.value[0].goodsLineNo;if(f.value[f.value.length-1].goodsLineNo,!f.value.every((t,d)=>t.goodsLineNo===e+d)){v.msg("选中的行数据不连续，请确保选择的是连续的行","error",!1);return}ve.value=f.value;for(let t=0;t<ve.value.length;t++)ve.value[t].折扣=""}Ce.value=f.value.reduce((e,a)=>e+Number(a.goodsTotalPrice),0).toFixed(2),Fe.value=f.value.reduce((e,a)=>e+Number(a.goodsTotalTax),0).toFixed(2),Ue.value=f.value.length,f.value.forEach(e=>{M.post("/Flow/GetLongId").then(a=>{ie.value=a.data;let t={id:ie.value,discountid:e.id,goodsCode:e.goodsCode,goodsName:e.goodsName,goodsTaxRate:e.goodsTaxRate,goodsTotalTax:"",goodsTotalPrice:"",invoiceLineNature:"1"};w.value.push(t)})}),b.value.折扣比例="";for(let e=0;e<f.value.length;e++)f.value[e].折扣="";w.value=[],Q.value=!0},sl=e=>e.id,b=c({折扣方式:"按金额折扣",折扣录入方式:"批量折扣录入",折扣比例:""}),rl=c({折扣比例:[{required:!0,message:"请输入折扣比例",trigger:"blur"}]}),il=e=>{if(e==null||e<0||e==null)return"";[{折扣方式:"按金额折扣",录入方式:"批量折扣录入",action:()=>{f.value.forEach(t=>{w.value.forEach(d=>{d.discountid===t.id&&(d.goodsTotalPrice=(-(t.goodsTotalPrice/Ce.value)*e).toFixed(2),d.goodsTotalTax=(-(t.goodsTotalTax/Fe.value)*e).toFixed(2))})})}},{折扣方式:"按比例折扣",录入方式:"批量折扣录入",action:()=>{f.value.forEach(t=>{w.value.forEach(d=>{d.discountid===t.id&&(d.goodsTotalPrice=(-t.goodsTotalPrice*e/100).toFixed(2),d.goodsTotalTax=(-t.goodsTotalTax*e/100).toFixed(2))})})}}].forEach(t=>{t.折扣方式===b.value.折扣方式&&t.录入方式===b.value.折扣录入方式&&t.action()})},dl=e=>{if(e.折扣==null||e.折扣<0||e.折扣==null||e.折扣==0)return"";[{折扣方式:"按金额折扣",录入方式:"逐条折扣录入",action:()=>{f.value.forEach(t=>{w.value.forEach(d=>{d.discountid===e.id&&(d.goodsTotalPrice=(-e.折扣).toFixed(2),d.goodsTotalTax=(-e.折扣).toFixed(2))})})}},{折扣方式:"按比例折扣",录入方式:"逐条折扣录入",action:()=>{const t=w.value.find(d=>d.discountid===e.id);t&&(t.goodsTotalPrice=(-e.goodsTotalPrice*e.折扣/100).toFixed(2),t.goodsTotalTax=(t.goodsTotalPrice*e.折扣/100).toFixed(2))}}].forEach(t=>{t.折扣方式===b.value.折扣方式&&t.录入方式===b.value.折扣录入方式&&t.action()})},cl=e=>{Q.value=!1,e.value.resetFields()},pl=async e=>{if(e){if(b.value.折扣比例==0||b.value.折扣比例<0||b.value.折扣比例==""||b.value.折扣比例==null||b.value.折扣比例==null)return se.error("请输入正确的折扣比例");await e.validate((a,t)=>{if(a){for(let d=0;d<w.value.length;d++)for(let i=d+1;i<w.value.length;i++)w.value[d].discountid===w.value[i].discountid&&(w.value.splice(i,1),i--);for(let d=0;d<w.value.length;d++){let i=-1;for(let p=0;p<s.value.length;p++)if(w.value[d].discountid===s.value[p].id){i=p;break}if(i!=-1){s.value[i].invoiceLineNature="2",s.value.splice(i+1,0,w.value[d]),s.value[i+1].invoiceLineNature="1",s.value[i+1].goodsLineNo=s.value[i].goodsLineNo+1;for(let p=0;p<s.value.length;p++)s.value[p].goodsLineNo=p+1}}w.value=[],f.value=[],X.$refs.multipleTableRef.clearSelection(),Q.value=!1}})}},vl=e=>{for(let a=0;a<e.length;a++){if(e[a].折扣==""||e[a].折扣==null||e[a].折扣==null)return se.error("第"+(a+1)+"行折扣比例输入不正确");if(e[a].折扣==0||e[a].折扣<0)return se.error("第"+(a+1)+"行折扣比例不能为0，为负数")}for(let a=0;a<w.value.length;a++){let t=-1;for(let d=0;d<s.value.length;d++)if(w.value[a].discountid===s.value[d].id){t=d;break}if(t!=-1){s.value[t].invoiceLineNature="2",s.value.splice(t+1,0,w.value[a]),s.value[t+1].invoiceLineNature="1",s.value[t+1].goodsLineNo=s.value[t].goodsLineNo+1;for(let d=0;d<s.value.length;d++)s.value[d].goodsLineNo=d+1}}w.value=[],f.value=[],X.$refs.multipleTableRef.clearSelection(),Q.value=!1},fl=c([{id:"01",label:"全电专用发票"},{id:"02",label:"全电普通发票"}]),j=c({customername:""}),K=c({projectname:""}),gl=(e,a)=>{Le.value=e.id,Ie.value=a.id},Ye=(e,a)=>{Le.value=null,Ie.value=null},ml=W,hl=z;function le(e){return ra({get:()=>hl[e],set:a=>{ml(`update:${e}`,a)}})}const fe=le("id");le("serialNo"),le("buyerTaxNo"),le("buyerName"),le("billcode"),sa(()=>{Fl(fe.value),Ml(),Re()});const ae=c(),k=c(!1),Se=c(!1),ge=c({Id:"",invoicedepartname:"",taxno:""}),O=c(0),te=c(0),me=c(0),bl=()=>{M.post("/Invoice/Save?srcorgid="+y.value.id,B.stringify({invoiceJSON:JSON.stringify(l.value),invoicedetailsJSON:JSON.stringify(s.value)})).then(e=>{e.success?(ce.value=!0,ge.value.invoicedepartname=y.value.accountname,ge.value.taxno=y.value.taxno,ge.value.Id=l.value.id,wl()):v.msg(e.msg,"error",!1)}).catch(()=>{})};al(O,e=>{te.value=Math.floor((O.value+me.value)/Number(f.value.length)*100),O.value>0,te.value===100&&setTimeout(()=>{ce.value=!1},800)});const s=c([]);function _l(e,a){if(e===0){v.msg("已经是第一行了","warning",!1);return}else if(a.invoiceLineNature=="1"||a.invoiceLineNature=="2"){v.msg("该行是折扣行，不能上移","warning",!1);return}else if(s.value[e-1].invoiceLineNature=="1"||s.value[e+1].invoiceLineNature=="2"){v.msg("上一行是折扣行，不能上移","warning",!1);return}const t=s.value[e-1];s.value[e-1]=s.value[e],s.value[e]=t,s.value.forEach((d,i)=>{d.goodsLineNo=i+1}),v.notify("","操作成功","success")}function yl(e,a){if(e===s.value.length-1){v.msg("已经是最后一行了","warning",!1);return}else if(a.invoiceLineNature=="1"||a.invoiceLineNature=="2"){v.msg("该行是折扣行，不能下移移","warning",!1);return}else if(s.value[e+1].invoiceLineNature=="1"||s.value[e+1].invoiceLineNature=="2"){v.msg("下一行是折扣行，不能下移","warning",!1);return}const t=s.value[e+1];s.value[e+1]=s.value[e],s.value[e]=t,s.value.forEach((d,i)=>{d.goodsLineNo=i+1}),v.notify("","操作成功","success")}const wl=async()=>{const e=await M.post("/Invoice/OpenInvoice?srcorgid="+y.value.id,B.stringify(ge.value));e.code==0?(O.value++,v.notify("第"+O.value+"张",e.msg,"success"),re(),D({appIco:"",children:[],closable:!0,componentId:"492732716728389",height:0,ico:"Tickets",icoColor:"",id:"492732716728389",openMode:0,parentId:"485253976780869",scopedSlots:{icon:"custom"},title:"已开票查询",title_en:"Menus",title_tw:"菜單",url:"/Invoice/Completedlist",width:0})):(me.value++,v.notify("",e.msg,"error"))},Tl=()=>{te.value=0,O.value=0,me.value=0,f.value=[],ee()},l=c({invoiceTypeCode:"",serialNo:"",buyerName:"",buyerTaxNo:"",buyerEmail:"",buyerAddress:"",buyerBankName:"",buyerBankNumber:"",buyerPhone:"",sellerName:"",sellerid:"",sellerTaxNo:"",sellerAddress:"",sellerPhone:"",sellerBankName:"",sellerBankNumber:"",remarks:"",invoiceTotalPriceTax:0,invoiceTotalTax:0,buyerNaturalPerson:"N"});function xl(e,a){if(e=="")a([]);else{let t=[];M.post("/Customer/GetAllCustomer?srcorgid="+y.value.id,{}).then(d=>{d.success&&(t=d.data.customer,t=t.filter(i=>i.customername.toLowerCase().indexOf(e.toLowerCase())>-1),a(t))}).catch(()=>{})}}function Nl(e){l.value.buyerTaxNo=e.buyerTaxno,l.value.buyerAddress=e.Address,l.value.buyerPhone=e.Phone,l.value.buyerBankName=e.BankName,l.value.buyerEmail=e.Email,l.value.buyerAddress=e.Address,l.value.buyerBankName=e.BankName,l.value.buyerBankNumber=e.Account}function kl(){document.activeElement.blur(),l.value.buyerTaxNo="",l.value.buyerAddress="",l.value.buyerPhone="",l.value.buyerBankName="",l.value.buyerBankNumber="",l.value.buyerEmail=""}const Pl=()=>{v.showFileName(D,{name:"手工开票模板"},Ne.SERVER_WEBADDRESS)},Cl={buyerName:[{required:!0,message:"请输入购方名称",trigger:"blur"}]},Sl=c([{prop:"id",align:"center",show:!1,useTemplate:!1},{prop:"goodsCode",label:"商品编号",show:!0,useTemplate:!0,align:"left",width:"180"},{prop:"goodsName",label:"商品名称",show:!0,useTemplate:!0,align:"left",width:"180",useTag:!0},{prop:"goodsSpecification",label:"规格型号",show:!0,useTemplate:!0,align:"left",width:"130"},{prop:"goodsUnit",label:"单位",show:!0,align:"left",useTemplate:!0,width:"100"},{prop:"goodsQuantity",label:"数量",show:!0,align:"left",useTemplate:!0,width:"90"},{prop:"goodsPrice",label:"单价",show:!0,align:"left",useTemplate:!1,width:"130"},{prop:"goodsTotalPrice",label:"价税合计",show:!0,align:"left",useTemplate:!0,width:"120"},{prop:"notaxamount",label:"无税金额",show:!0,align:"left",useTemplate:!1,width:"120"},{prop:"goodsTotalTax",label:"税额",show:!0,useTemplate:!1,align:"left",width:"120"},{prop:"goodsTaxRate",label:"税率(%)",show:!0,align:"left",useTemplate:!0,width:"120"},{prop:"invoiceLineNature",label:"发票行性质",show:!1,align:"left",useTemplate:!0,width:"200"},{prop:"discountRate",label:"折扣率",show:!1,align:"left",useTemplate:!0,width:"200"},{prop:"discountAmount",label:"折扣额",show:!1,align:"left",useTemplate:!0,width:"200"}]),Vl=c([{prop:"id",align:"center",show:!1,useTemplate:!1},{prop:"customername",label:"购买方名称",show:!0,align:"center",useTemplate:!1,width:"240"},{prop:"customercode",label:"购买方编号",show:!1,align:"center",useTemplate:!1,width:"200"},{prop:"Taxno",label:"税号",show:!0,align:"center",useTemplate:!1,width:"180"},{prop:"Phone",label:"电话",show:!0,align:"center",useTemplate:!1,width:"140"},{prop:"Email",label:"邮箱",show:!0,align:"center",useTemplate:!1,width:"140"},{prop:"Address",label:"地址",show:!0,align:"center",useTemplate:!1,width:"200"},{prop:"BankName",label:"开户行",show:!0,align:"center",useTemplate:!1,width:"170"},{prop:"Account",label:"银行账号",show:!0,align:"center",useTemplate:!1,width:"200"},{prop:"BankAccount",label:"银行账号",show:!0,align:"center",useTemplate:!1,width:"200"},{prop:"AddressPhone",label:"地址电话",show:!0,align:"center",useTemplate:!1,width:"200"},{label:"操作",show:!0,align:"center",useTemplate:!0,width:"100",fixed:"right"}]),El=c([{prop:"id",align:"center",show:!1,useTemplate:!1},{prop:"goodsLineNo",label:"序号",align:"center",useTemplate:!1,show:!1,width:"60"},{prop:"goodsCode",label:"商品编号",show:!0,useTemplate:!1,align:"center",width:"150"},{prop:"goodsName",label:"商品名称",show:!0,useTemplate:!1,align:"center",width:"200"},{prop:"spec",label:"规格型号",show:!0,useTemplate:!1,align:"center",width:"160"},{prop:"unitname",label:"单位",show:!0,align:"center",useTemplate:!1,width:"100"},{prop:"taxrate",label:"税率(%)",show:!0,align:"center",useTemplate:!1,minWidth:"150%"},{prop:"goodsQuantity",label:"数量",show:!1,align:"center",useTemplate:!1,width:"120"},{prop:"goodsPrice",label:"单价",show:!1,align:"center",useTemplate:!1,width:"120"},{prop:"goodsTotalPrice",label:"价税合计",show:!1,align:"right",useTemplate:!1,width:"120"},{prop:"notaxamount",label:"无税金额",show:!1,align:"right",useTemplate:!1,width:"120"},{prop:"goodsTotalTax",label:"税额",show:!1,useTemplate:!1,align:"center",width:"120"},{prop:"priceTaxMark",label:"发票行性质",show:!1,align:"center",useTemplate:!1,width:"200"},{prop:"preferentialMarkFlag",label:"",show:!1,align:"center",useTemplate:!1,width:"200"},{prop:"vatSpecialManagement",label:"",show:!1,align:"center",useTemplate:!1,width:"200"},{prop:"freeTaxMark ",label:"",show:!1,align:"center",useTemplate:!1,width:"200"}]),Ml=async()=>{try{const e=await M.post("user/GetUserInvoiceDepartByUser",B.stringify({userid:$.value.userId}));e.success&&(tl.value=e.data,ol.value=e.data[0].id)}catch{}};function ze(){H()}function Bl(){he()}function Al(){ve.value=[],b.value={折扣方式:"按金额折扣",折扣录入方式:"批量折扣录入",折扣比例:""}}const he=()=>{K.value.size=S.value.size,K.value.number=S.value.number,M.post("/invoiceproduct/GetAllProduct?srcorgid="+y.value.id,B.stringify(K.value)).then(e=>{e.success&&(Be.value=e.data.product,S.value.total=e.data.total)}).catch(()=>{})},H=()=>{j.value.size=C.value.size,j.value.number=C.value.number,M.post("/Customer/GetList?srcorgid="+y.value.id,B.stringify(j.value)).then(e=>{e.success&&(Me.value=e.data.rows,C.value.total=e.data.total)}).catch(()=>{})},Re=async()=>{try{const e=await M.post("/Systemset/Get?srcorgid="+y.value.id,{});systemInfo.value=e.data.invoicesystemset,l.value.invoiceTypeCode=e.data.invoicesystemset.默认发票类型,l.value.buyershow=e.data.invoicesystemset.是否默认选中购买方,l.value.sellershow=e.data.invoicesystemset.是否默认选中销售方,Ge(),He(),qe(),Qe()}catch{}};function Ll(){j.value.customername="",H()}function Il(){K.value.goodsName="",H()}const Fl=async e=>{Se.value=!0;try{const a=await M.post("/Invoice/GetInvoiceApply",B.stringify({id:e,type:"手工开票"}));l.value=a.data.invoicemain,fe.value=a.data.invoicemain.id,s.value=a.data.invoicedetail,l.value.sellerName=y.value.accountname,l.value.sellerTaxNo=y.value.taxno,l.value.sellerid=y.value.id,l.value.sellerAddress=y.value.address,l.value.sellerPhone=y.value.phone,l.value.sellerBankName=y.value.openbank,l.value.sellerBankNumber=y.value.bankaccount,Re()}catch{}finally{Se.value=!1}},Ul=()=>{if(l.value.buyerName==""){v.msg("购方名称不能为空","warning",!1);return}M.post("/Invoice/Save?srcorgid="+y.value.id,B.stringify({invoiceJSON:JSON.stringify(l.value),invoicedetailsJSON:JSON.stringify(s.value)})).then(e=>{e.success?(v.msg(e.msg,"success",!1),re(),D({id:"492732745289797",title:"开票任务列表",closable:!0,componentId:"492732745289797",height:0,ico:"Tickets",icoColor:"",openMode:0,parentId:"485253976780869",scopedSlots:{icon:"custom"},title_en:"Menus",title_tw:"菜單",url:"/Invoice/tasklist",width:0})):v.msg(e.msg,"error",!1)}).catch(()=>{})},Yl=e=>{I.value=JSON.parse(JSON.stringify(e))},zl=()=>{if(I.value.length===0){v.msg("请选择要添加的行","warning",!1);return}for(let e=0;e<I.value.length;e++)M.post("/Flow/GetLongId").then(a=>{ie.value=a.data;const t={goodsLineNo:s.value.length+1,id:ie.value,mainid:fe.value,goodsCode:I.value[e].goodsCode,goodsName:I.value[e].goodsName,goodsSpecification:I.value[e].spec,goodsUnit:I.value[e].unitname,goodsQuantity:"",goodsPrice:"0",goodsTotalPrice:"",goodsTaxRate:I.value[e].taxrate,goodsTotalTax:"",invoiceLineNature:Ae.value,discountRate:"0",discountAmount:"0",priceTaxMark:"1",preferentialMarkFlag:I.value[e].preferentialMarkFlag,vatSpecialManagement:I.value[e].vatSpecialManagement};s.value.push(t)}).catch(()=>{});pe.value=!1},Rl=()=>{de.value=!0},Dl=()=>{Ae.value=0,pe.value=!0};function $l(){const e=f.value;if(e.length===0){v.msg("请选择要删除的行","warning",!1);return}for(let a=0;a<e.length;a++)if(e[a].invoiceLineNature==1){for(let t=0;t<s.value.length;t++)if(s.value[t].id==e[a].discountid){const d=s.value.indexOf(e[a]);s.value.splice(d,1),s.value[t].invoiceLineNature="0"}}else if(e[a].invoiceLineNature==2)for(let t=0;t<s.value.length;t++)s.value[t].discountid==e[a].id&&(s.value.splice(t,1),s.value.splice(a,1));else{const t=s.value.indexOf(e[a]);s.value.splice(t,1)}X.$refs.multipleTableRef.clearSelection();for(let a=0;a<s.value.length;a++)s.value[a].goodsLineNo=a+1}const De=e=>{f.value=e,f.value.length>0?P.value=!0:P.value=!1};function be({row:e,column:a,rowIndex:t,columnIndex:d}){return{color:"#000",textAlign:"center"}}function jl({row:e}){if(e.goodsTotalPrice===0)return{backgroundColor:"yellow"}}const Kl=e=>{C.value.size=e,H()},Ol=e=>{C.value.number=e,H()},Zl=e=>{S.value.size=e,he()},Jl=e=>{S.value.number=e,he()};al(()=>s.value,e=>{let a=0,t=0,d=0;const i=c(0);e.forEach(p=>{if(a+=Number(p.goodsTotalPrice),t+=Number(p.goodsTotalTax),p.goodsQuantity==""||p.goodsQuantity==null)p.goodsPrice=0;else{let q=(Number(p.goodsTotalPrice)/Number(p.goodsQuantity)).toFixed(8);p.goodsPrice=isNaN(q)?0:q}const Z=1+Number(p.goodsTaxRate/100);i.value=(Number(p.goodsTotalPrice)/Number(Z)).toFixed(2),p.goodsTotalTax=(Number(p.goodsTotalPrice)-i.value).toFixed(2),p.notaxamount=i.value,d+=Number(p.notaxamount)}),l.value.invoiceTotalPriceTax=Number(a.toFixed(2)),l.value.invoiceTotalTax=Number(t.toFixed(2)),l.value.invoiceTotal=Number(d.toFixed(2))},{deep:!0});const Gl=e=>{de.value=!1,l.value.buyerName=e.customername,l.value.buyerTaxNo=e.Taxno,l.value.buyerEmail=e.Email,l.value.buyerAddress=e.Address,l.value.buyerBankName=e.BankName,l.value.buyerBankNumber=e.Account,l.value.buyerPhone=e.Phone},Ql=e=>e<34?"#409eff":e<60?"#e6a23c":"#67c23a",Ve=c(),Hl=e=>{Ve.value.clearFiles();const a=e[0];Ve.value.handleStart(a)},ql=e=>{ba(e.raw).then(a=>{s.value.length=0,a.forEach(t=>{t.__EMPTY_8!=0&&t.__EMPTY_8!=""&&t.__EMPTY_8!=null?(s.value.push({goodsLineNo:s.value.length+1,goodsName:t.__EMPTY,projectname:t.__EMPTY,goodsCode:t.__EMPTY_1,goodsSpecification:t.__EMPTY_2,goodsUnit:t.__EMPTY_3,goodsQuantity:t.__EMPTY_4,goodsPrice:t.__EMPTY_5,goodsTotalPrice:t.__EMPTY_6,goodsTaxRate:t.__EMPTY_7*100,goodsDiscountAmount:t.__EMPTY_8,vatSpecialManagement:t.__EMPTY_9,freeTaxMark:t.__EMPTY_9=="免税"?"3":t.__EMPTY_9=="不征税"?"2":"",preferentialMarkFlag:t.__EMPTY_9!=""||t.__EMPTY_9!=null?"1":"0",invoiceLineNature:"2",priceTaxMark:1}),s.value.push({goodsLineNo:s.value.length+1,goodsName:t.__EMPTY,projectname:t.__EMPTY,goodsCode:t.__EMPTY_1,goodsSpecification:"",goodsUnit:"",goodsQuantity:"",goodsPrice:"",goodsTotalPrice:-t.__EMPTY_8,goodsTaxRate:t.__EMPTY_7*100,goodsDiscountAmount:"",vatSpecialManagement:"",freeTaxMark:"",preferentialMarkFlag:"0",invoiceLineNature:"1",priceTaxMark:1})):s.value.push({goodsLineNo:s.value.length+1,goodsName:t.__EMPTY,projectname:t.__EMPTY,goodsCode:t.__EMPTY_1,goodsSpecification:t.__EMPTY_2,goodsUnit:t.__EMPTY_3,goodsQuantity:t.__EMPTY_4,goodsPrice:t.__EMPTY_5,goodsTotalPrice:t.__EMPTY_6,goodsTaxRate:t.__EMPTY_7*100,goodsDiscountAmount:t.__EMPTY_8,vatSpecialManagement:t.__EMPTY_9,freeTaxMark:t.__EMPTY_9=="免税"?"3":t.__EMPTY_9=="不征税"?"2":"",preferentialMarkFlag:t.__EMPTY_9!=""||t.__EMPTY_9!=null?"1":"0",invoiceLineNature:0,priceTaxMark:1})})})};function Wl(e){return e.type!=="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"&&e.type!=="application/vnd.ms-excel"?(v.msg("要导入的文件必须是excel格式文件!",!1),!1):!0}function Xl(){ma.confirm("确定要作废吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{M.post("/Invoice/DeleteAll",B.stringify({id:fe.value,type:"手工开票"})).then(e=>{const a=e.success?"success":"error";v.msg(e.msg,a,!1),e.success&&ee()}).catch(()=>{})}).catch(()=>{})}let $e="",je="",Ke="",Oe="",Ze="",Je="";function Ge(){let e=l.value.remarks;l.value.buyerBankName==null&&(l.value.buyerBankName=""),l.value.buyerBankNumber==null&&(l.value.buyerBankNumber=""),l.value.buyershow==!0&&l.value.buyerBankName!=""&&l.value.buyerBankNumber!=""&&(l.value.buyerBankName,l.value.buyerBankNumber,e!=null?l.value.remarks="购买方开户银行:"+l.value.buyerBankName+"        银行账号:"+l.value.buyerBankNumber+` 
`+e:l.value.remarks="购买方开户银行:"+l.value.buyerBankName+"        银行账号:"+l.value.buyerBankNumber+` 
`)}function Qe(){let e=l.value.remarks;$e=l.value.buyerAddress,je=l.value.buyerPhone,l.value.buyerAddress==null&&(l.value.buyerAddress=""),l.value.buyerPhone==null&&(l.value.buyerPhone=""),l.value.buyerAddshow==!0&&l.value.buyerAddress!=""&&l.value.buyerPhone!=""?e!=null?l.value.remarks="购买方地址:"+l.value.buyerAddress+";      电话:"+l.value.buyerPhone+`;
`+e:l.value.remarks="购买方地址:"+l.value.buyerAddress+";      电话:"+l.value.buyerPhone+`;
`:l.value.remarks=l.value.remarks.replace("购买方地址:"+$e+";      电话:"+je+`;
`,"")}function He(){l.value.sellershow==!0?(Ke=l.value.sellerBankName,Oe=l.value.sellerBankNumber,l.value.remarks!=null?l.value.remarks+="销售方开户银行:"+l.value.sellerBankName+";       银行账号:"+l.value.sellerBankNumber+`;
`:l.value.remarks="销售方开户银行:"+l.value.sellerBankName+";       银行账号:"+l.value.sellerBankNumber+`;
`):l.value.remarks=l.value.remarks.replace("销售方开户银行:"+Ke+";       银行账号:"+Oe+`;
`,"")}function qe(){l.value.sellerAddshow==!0?(Ze=l.value.sellerAddress,Je=l.value.sellerPhone,l.value.remarks!=null?l.value.remarks+="销售方地址:"+l.value.sellerAddress+";      电话:"+l.value.sellerPhone+`;
`:l.value.remarks="销售方地址:"+l.value.sellerAddress+";      电话:"+l.value.sellerPhone+`;
`):l.value.remarks=l.value.remarks.replace("销售方地址:"+Ze+";      电话:"+Je+`;
`,"")}return xe({open:ze,headerCellStyle:be}),(e,a)=>{const t=_("el-button"),d=_("el-upload"),i=_("el-form-item"),p=_("el-form"),Z=_("el-radio"),q=_("el-radio-group"),ea=_("el-autocomplete"),V=_("el-col"),oe=_("el-checkbox"),ne=_("el-row"),A=_("el-input"),F=_("el-table-column"),We=_("el-dropdown-item"),la=_("el-dropdown-menu"),aa=_("el-dropdown"),ta=_("el-tag"),_e=_("el-table"),Xe=_("el-pagination"),ye=_("el-dialog"),el=_("el-input-number"),oa=_("el-progress"),ll=_("el-statistic"),na=ia("loading");return h(),Y("div",_a,[o(p,{inline:"",style:{display:"flex","justify-content":"space-between"}},{default:n(()=>[ke.value?L("",!0):(h(),E(i,{key:0},{default:n(()=>[o(t,{type:"primary",icon:"Plus",onClick:Dl},{default:n(()=>[m("增行")]),_:1}),o(t,{type:"primary",onClick:ul},{default:n(()=>[m("添加折扣行")]),_:1}),o(t,{type:"danger",disabled:!P.value,onClick:$l},{default:n(()=>[m("删除行")]),_:1},8,["disabled"]),o(d,{ref_key:"upload",ref:Ve,limit:1,style:{"margin-left":"15px","margin-bottom":"2px"},"on-change":ql,"on-exceed":Hl,accept:".xlsx,.xls","auto-upload":!1,"before-upload":Wl,"show-file-list":!1},{trigger:n(()=>[o(t,{icon:"Upload",type:"warning"},{default:n(()=>[m("导入Excel数据")]),_:1})]),_:1},512),o(t,{type:"primary",link:"",onClick:a[0]||(a[0]=u=>Pl())},{default:n(()=>[m("下载导入模板")]),_:1})]),_:1})),ke.value?L("",!0):(h(),E(i,{key:1,style:{float:"right"}},{default:n(()=>[o(t,{type:"primary",icon:"DocumentAdd",onClick:a[1]||(a[1]=u=>Ul())},{default:n(()=>[m("暂存")]),_:1}),o(t,{type:"primary",icon:"DocumentCopy",onClick:bl},{default:n(()=>[m("立即开票")]),_:1}),e.isnew==!1?(h(),E(t,{key:0,icon:"Delete",type:"danger",onClick:Xl},{default:n(()=>[m("作废")]),_:1})):L("",!0)]),_:1}))]),_:1}),r("table",ya,[r("tbody",null,[r("tr",null,[r("td",wa,[o(p,{model:l.value,ref_key:"ruleFormRef",ref:ae},{default:n(()=>[o(i,{style:{margin:"auto"},label:"发票类型:",prop:"invoiceTypeCode"},{default:n(()=>[x(o(q,{modelValue:l.value.invoiceTypeCode,"onUpdate:modelValue":a[2]||(a[2]=u=>l.value.invoiceTypeCode=u)},{default:n(()=>[(h(!0),Y(J,null,Te(fl.value,u=>(h(),E(Z,{label:u.id},{default:n(()=>[m(g(u.label),1)]),_:2},1032,["label"]))),256))]),_:1},8,["modelValue"]),[[N,!k.value]]),x(r("span",null,g(l.value.invoiceTypeName),513),[[N,k.value]])]),_:1})]),_:1},8,["model"])]),r("td",Ta,[o(i,{style:{margin:"auto"},label:"开票流水号:"},{default:n(()=>[r("span",null,g(l.value.serialNo),1)]),_:1})])]),r("tr",xa,[Na,r("td",ka,[o(p,{model:l.value,ref_key:"ruleFormRef",ref:ae,"label-width":"100px"},{default:n(()=>[o(ne,{gutter:20},{default:n(()=>[o(V,{span:13.5,style:{"padding-right":"0"}},{default:n(()=>[o(i,{label:"名称",prop:"buyerName"},{default:n(()=>[o(ea,{style:{width:"250px"},"trigger-on-focus":"true","fetch-suggestions":xl,modelValue:l.value.buyerName,"onUpdate:modelValue":a[3]||(a[3]=u=>l.value.buyerName=u),onSelect:Nl,clearable:"",onClear:a[4]||(a[4]=u=>kl())},null,8,["modelValue"]),o(t,{style:{display:"inline-block"},class:"selectBtn",type:"default",icon:"Operation",onClick:Rl})]),_:1})]),_:1}),o(V,{span:2,style:{"line-height":"30px"}},{default:n(()=>[x(r("div",Pa," (个人) ",512),[[N,l.value.buyerNaturalPerson=="Y"]])]),_:1}),o(V,{span:5,style:{"line-height":"30px"}},{default:n(()=>[o(oe,{"true-label":"Y","false-label":"N",modelValue:l.value.buyerNaturalPerson,"onUpdate:modelValue":a[5]||(a[5]=u=>l.value.buyerNaturalPerson=u),label:"是否开票给自然人"},null,8,["modelValue"])]),_:1})]),_:1}),o(i,{label:"纳税人识别号",prop:"buyerTaxNo"},{default:n(()=>[x(o(A,{modelValue:l.value.buyerTaxNo,"onUpdate:modelValue":a[6]||(a[6]=u=>l.value.buyerTaxNo=u)},null,8,["modelValue"]),[[N,!k.value]]),x(r("span",null,g(l.value.buyerTaxNo),513),[[N,k.value]])]),_:1}),o(ne,{gutter:20},{default:n(()=>[o(V,{span:11},{default:n(()=>[o(i,{label:"地址",prop:"buyerAddress"},{default:n(()=>[x(o(A,{modelValue:l.value.buyerAddress,"onUpdate:modelValue":a[7]||(a[7]=u=>l.value.buyerAddress=u)},null,8,["modelValue"]),[[N,!k.value]]),x(r("span",null,g(l.value.buyerAddress),513),[[N,k.value]])]),_:1})]),_:1}),o(V,{span:11},{default:n(()=>[o(i,{label:"电话",prop:"buyerPhone"},{default:n(()=>[x(o(A,{modelValue:l.value.buyerPhone,"onUpdate:modelValue":a[8]||(a[8]=u=>l.value.buyerPhone=u)},null,8,["modelValue"]),[[N,!k.value]]),x(r("span",null,g(l.value.buyerPhone),513),[[N,k.value]])]),_:1})]),_:1}),o(V,{span:2,class:"show"},{default:n(()=>[o(i,{prop:"show"},{default:n(()=>[o(oe,{style:{"font-size":"12px"},onChange:a[9]||(a[9]=u=>Qe()),modelValue:l.value.buyerAddshow,"onUpdate:modelValue":a[10]||(a[10]=u=>l.value.buyerAddshow=u),label:"展示"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(ne,{gutter:20},{default:n(()=>[o(V,{span:11},{default:n(()=>[o(i,{label:"开户银行",prop:"buyerBankName"},{default:n(()=>[x(o(A,{modelValue:l.value.buyerBankName,"onUpdate:modelValue":a[11]||(a[11]=u=>l.value.buyerBankName=u)},null,8,["modelValue"]),[[N,!k.value]]),x(r("span",null,g(l.value.buyerBankName),513),[[N,k.value]])]),_:1})]),_:1}),o(V,{span:11},{default:n(()=>[o(i,{label:"银行账号",prop:"buyerBankNumber"},{default:n(()=>[x(o(A,{modelValue:l.value.buyerBankNumber,"onUpdate:modelValue":a[12]||(a[12]=u=>l.value.buyerBankNumber=u)},null,8,["modelValue"]),[[N,!k.value]]),x(r("span",null,g(l.value.buyerBankNumber),513),[[N,k.value]])]),_:1})]),_:1}),o(V,{span:2,class:"show"},{default:n(()=>[o(i,{prop:"show"},{default:n(()=>[o(oe,{style:{"font-size":"12px"},onChange:a[13]||(a[13]=u=>Ge()),modelValue:l.value.buyershow,"onUpdate:modelValue":a[14]||(a[14]=u=>l.value.buyershow=u),label:"展示"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),Ca,r("td",Sa,[o(p,{model:l.value,ref_key:"ruleFormRef",ref:ae,"label-width":"110px"},{default:n(()=>[o(i,{label:"名称",prop:"sellerid"},{default:n(()=>[r("span",Va,g(l.value.sellerName),1)]),_:1}),o(i,{label:"纳税人识别号",prop:"sellerTaxNo"},{default:n(()=>[r("span",Ea,g(l.value.sellerTaxNo),1)]),_:1}),o(ne,{gutter:20},{default:n(()=>[o(V,{span:11},{default:n(()=>[o(i,{label:"地址",prop:"sellerAddress"},{default:n(()=>[r("span",Ma,g(l.value.sellerAddress),1)]),_:1})]),_:1}),o(V,{span:11},{default:n(()=>[o(i,{label:"电话",prop:"sellerPhone"},{default:n(()=>[r("span",Ba,g(l.value.sellerPhone),1)]),_:1})]),_:1}),o(V,{span:2,class:"show"},{default:n(()=>[o(i,{prop:"sellershow"},{default:n(()=>[o(oe,{style:{"font-size":"12px"},onChange:a[15]||(a[15]=u=>qe()),modelValue:l.value.sellerAddshow,"onUpdate:modelValue":a[16]||(a[16]=u=>l.value.sellerAddshow=u),label:"展示"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(ne,{gutter:20},{default:n(()=>[o(V,{span:11},{default:n(()=>[o(i,{label:"开户银行",prop:"sellerBankName"},{default:n(()=>[r("span",Aa,g(l.value.sellerBankName),1)]),_:1})]),_:1}),o(V,{span:11},{default:n(()=>[o(i,{label:"银行账号",class:"colschange",prop:"sellerBankNumber"},{default:n(()=>[r("span",La,g(l.value.sellerBankNumber),1)]),_:1})]),_:1}),o(V,{span:2,class:"show"},{default:n(()=>[o(i,{prop:"sellershow"},{default:n(()=>[o(oe,{style:{"font-size":"12px"},onChange:a[17]||(a[17]=u=>He()),modelValue:l.value.sellershow,"onUpdate:modelValue":a[18]||(a[18]=u=>l.value.sellershow=u),label:"展示"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])])]),r("div",null,[x((h(),E(_e,{class:"eltable","row-key":sl,ref_key:"multipleTableRef",ref:nl,data:s.value,height:"370",stripe:Ee.value.tableStripe,"highlight-current-row":Ee.value.tableHighlightCurrentRow,style:{width:"100%",color:"#000"},"header-cell-style":be,"default-sort":G.value,onSelectionChange:De,"row-style":jl,onRowClick:gl},{default:n(()=>[o(F,{type:"selection",width:"55",align:"center","reserve-selection":!0}),o(F,{label:"",width:"25"},{default:n(u=>[o(aa,{placement:"bottom-start",size:"small","hide-on-click":!0},{dropdown:n(()=>[o(la,null,{default:n(()=>[o(We,{icon:"CaretTop",onClick:T=>_l(u.$index,u.row)},{default:n(()=>[m("上移")]),_:2},1032,["onClick"]),o(We,{icon:"CaretBottom",divided:"",onClick:T=>yl(u.$index,u.row)},{default:n(()=>[m("下移")]),_:2},1032,["onClick"])]),_:2},1024)]),default:n(()=>[o(t,{type:"primary",size:"small",icon:"DCaret"})]),_:2},1024)]),_:1}),o(F,{prop:"goodsLineNo",label:"序号",width:"55",align:"center"}),(h(!0),Y(J,null,Te(Sl.value,u=>(h(),Y(J,null,[u.show?(h(),E(F,{key:0,fit:"","show-overflow-tooltip":"",prop:u.prop,"min-width":u.width,label:u.label,align:u.align,sortable:""},{default:n(T=>[T.row.invoiceLineNature=="1"&&u.useTag?(h(),E(ta,{key:0,type:"danger",effect:"dark"},{default:n(()=>[m("折扣")]),_:1})):L("",!0),u.useTemplate&&!ke.value&&T.row.invoiceLineNature!="1"&&T.row.invoiceLineNature!="2"?(h(),E(A,{key:1,modelValue:T.row[u.prop],"onUpdate:modelValue":we=>T.row[u.prop]=we,onBlur:we=>Ye(T.row,T.column),onKeyup:pa(we=>Ye(T.row,T.column),["enter"])},null,8,["modelValue","onUpdate:modelValue","onBlur","onKeyup"])):T.row.invoiceLineNature=="1"?(h(),Y("span",Ia,g(T.row[u.prop]),1)):(h(),Y("span",Fa,g(T.row[u.prop]),1))]),_:2},1032,["prop","min-width","label","align"])):L("",!0)],64))),256))]),_:1},8,["data","stripe","highlight-current-row","default-sort"])),[[na,Se.value]])]),r("table",Ua,[r("tbody",null,[r("tr",null,[r("td",Ya,[r("div",za,[r("span",null,"价税合计:"+g(l.value.invoiceTotalPriceTax),1),r("span",null,"无税金额:"+g(l.value.invoiceTotal),1),r("span",null,"税额:"+g(l.value.invoiceTotalTax),1)])])]),r("tr",Ra,[Da,r("td",$a,[o(p,{style:{height:"100%"},model:l.value,ref_key:"ruleFormRef",ref:ae},{default:n(()=>[o(i,{style:{margin:"0px 0px 0px !important",padding:"0 !important"},prop:"remarks"},{default:n(()=>[o(A,{type:"textarea",modelValue:l.value.remarks,"onUpdate:modelValue":a[19]||(a[19]=u=>l.value.remarks=u)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),ja,r("td",Ka,[o(p,{model:l.value,rules:Cl,ref_key:"ruleFormRef",ref:ae},{default:n(()=>[o(i,{label:"手机号码:",prop:"phone"},{default:n(()=>[x(o(A,{placeholder:"请输入手机号码",modelValue:l.value.phone,"onUpdate:modelValue":a[20]||(a[20]=u=>l.value.phone=u)},null,8,["modelValue"]),[[N,!k.value]]),x(r("span",null,g(l.value.phone),513),[[N,k.value]])]),_:1}),o(i,{label:"邮箱地址:",prop:"buyerEmail"},{default:n(()=>[x(o(A,{placeholder:"请输入邮箱地址",modelValue:l.value.buyerEmail,"onUpdate:modelValue":a[21]||(a[21]=u=>l.value.buyerEmail=u)},null,8,["modelValue"]),[[N,!k.value]]),x(r("span",null,g(l.value.buyerEmail),513),[[N,k.value]])]),_:1})]),_:1},8,["model"])])])])]),o(ye,{title:"选择购买方",style:{"min-height":"637px"},modelValue:de.value,"onUpdate:modelValue":a[25]||(a[25]=u=>de.value=u),"align-center":"",onOpen:ze,onClose:Ll,"destroy-on-close":"",width:"1200px",draggable:"","close-on-click-modal":!1},{default:n(()=>[o(p,{inline:!0,model:j.value,class:"inline"},{default:n(()=>[o(i,null,{default:n(()=>[o(A,{placeholder:"请输入购买方名称",style:{"min-width":"300px"},modelValue:j.value.customername,"onUpdate:modelValue":a[22]||(a[22]=u=>j.value.customername=u),clearable:""},null,8,["modelValue"])]),_:1}),o(i,null,{default:n(()=>[o(t,{type:"primary",onClick:H},{default:n(()=>[m("查询")]),_:1})]),_:1})]),_:1},8,["model"]),o(_e,{class:"eltable",data:Me.value,stripe:C.value.tableStripe,border:"","highlight-current-row":C.value.tableHighlightCurrentRow,"max-height":"460",style:{color:"#000"},"header-cell-style":be,"default-sort":G.value,onSelectionChange:De},{default:n(()=>[(h(!0),Y(J,null,Te(Vl.value,u=>(h(),Y(J,null,[u.show?(h(),E(F,{key:0,prop:u.prop,fixed:u.fixed,label:u.label,align:u.align,width:u.width},va({_:2},[u.useTemplate?{name:"default",fn:n(T=>[o(t,{type:"primary",size:"small",onClick:we=>Gl(T.row)},{default:n(()=>[m("选择")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["prop","fixed","label","align","width"])):L("",!0)],64))),256))]),_:1},8,["data","stripe","highlight-current-row","default-sort"]),r("div",Oa,[o(Xe,{currentPage:C.value.number,"onUpdate:currentPage":a[23]||(a[23]=u=>C.value.number=u),"page-size":C.value.size,"onUpdate:pageSize":a[24]||(a[24]=u=>C.value.size=u),"page-sizes":C.value.sizes,background:C.value.background,layout:C.value.layout,total:C.value.total,onSizeChange:Kl,onCurrentChange:Ol},null,8,["currentPage","page-size","page-sizes","background","layout","total"])])]),_:1},8,["modelValue"]),o(ye,{title:"选择产品",style:{height:"637px"},modelValue:pe.value,"onUpdate:modelValue":a[29]||(a[29]=u=>pe.value=u),"align-center":"",onOpen:Bl,onClose:Il,"destroy-on-close":"",width:"1200px",draggable:"","close-on-click-modal":!1},{default:n(()=>[o(p,{inline:!0,model:K.value,class:"inline"},{default:n(()=>[o(i,null,{default:n(()=>[o(A,{placeholder:"请输入商品名称",modelValue:K.value.productname,"onUpdate:modelValue":a[26]||(a[26]=u=>K.value.productname=u),style:{width:"250px"},clearable:""},null,8,["modelValue"])]),_:1}),o(i,null,{default:n(()=>[o(t,{type:"primary",onClick:he},{default:n(()=>[m("查询")]),_:1}),o(t,{type:"primary",onClick:zl},{default:n(()=>[m("选择商品")]),_:1})]),_:1})]),_:1},8,["model"]),o(_e,{class:"eltable",data:Be.value,stripe:S.value.tableStripe,border:"","highlight-current-row":S.value.tableHighlightCurrentRow,height:"460",style:{color:"#000"},"header-cell-style":be,"default-sort":G.value,onSelectionChange:Yl},{default:n(()=>[o(F,{type:"selection",width:"55",align:"center"}),(h(!0),Y(J,null,Te(El.value,u=>(h(),Y(J,null,[u.show?(h(),E(F,{key:0,prop:u.prop,fixed:u.fixed,label:u.label,align:u.align,"min-width":u.width},null,8,["prop","fixed","label","align","min-width"])):L("",!0)],64))),256))]),_:1},8,["data","stripe","highlight-current-row","default-sort"]),r("div",Za,[o(Xe,{currentPage:S.value.number,"onUpdate:currentPage":a[27]||(a[27]=u=>S.value.number=u),"page-size":S.value.size,"onUpdate:pageSize":a[28]||(a[28]=u=>S.value.size=u),"page-sizes":S.value.sizes,background:S.value.background,layout:S.value.layout,total:S.value.total,onSizeChange:Zl,onCurrentChange:Jl},null,8,["currentPage","page-size","page-sizes","background","layout","total"])])]),_:1},8,["modelValue"]),o(ye,{title:"添加折扣",style:{height:"auto"},class:"AddZK",modelValue:Q.value,"onUpdate:modelValue":a[36]||(a[36]=u=>Q.value=u),onClose:Al,"align-center":"","destroy-on-close":"",width:"550px","close-on-click-modal":!1},{default:n(()=>[r("div",Ja,[r("div",Ga,[Qa,r("div",Ha,g(Ce.value),1),r("span",qa,"共"+g(Ue.value)+"行",1)])]),o(p,{ref_key:"ZKFormRef",ref:Pe,rules:rl.value,model:b.value,"label-position":"top","label-width":"80px"},{default:n(()=>[o(i,{label:"折扣方式"},{default:n(()=>[o(q,{modelValue:b.value.折扣方式,"onUpdate:modelValue":a[30]||(a[30]=u=>b.value.折扣方式=u)},{default:n(()=>[o(Z,{label:"按金额折扣"},{default:n(()=>[m("按金额折扣")]),_:1}),o(Z,{label:"按比例折扣"},{default:n(()=>[m("按比例折扣")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"折扣录入方式"},{default:n(()=>[o(q,{modelValue:b.value.折扣录入方式,"onUpdate:modelValue":a[31]||(a[31]=u=>b.value.折扣录入方式=u)},{default:n(()=>[o(Z,{label:"批量折扣录入"},{default:n(()=>[m("批量折扣录入")]),_:1}),o(Z,{label:"逐条折扣录入"},{default:n(()=>[m("逐条折扣录入")]),_:1})]),_:1},8,["modelValue"])]),_:1}),b.value.折扣录入方式=="批量折扣录入"?(h(),E(i,{key:0,prop:"折扣比例",label:"折扣比例(%）（含税）"},{default:n(()=>[o(el,{modelValue:b.value.折扣比例,"onUpdate:modelValue":a[32]||(a[32]=u=>b.value.折扣比例=u),controls:!1,style:{width:"100%"},onInput:il,placeholder:"必填项"},null,8,["modelValue"])]),_:1})):L("",!0),b.value.折扣录入方式=="逐条折扣录入"?(h(),E(i,{key:1,label:"折扣金额 (含税）"},{default:n(()=>[o(_e,{data:f.value,style:{width:"100%"},"max-height":"185px",size:"small","table-layout":"fixed"},{default:n(()=>[o(F,{prop:"goodsName",label:"项目名称",fit:"","show-overflow-tooltip":""}),o(F,{prop:"goodsTotalPrice",label:"金额",width:"100px"}),o(F,{prop:"折扣",label:"折扣比例(%)",width:"100px"},{default:n(u=>[o(el,{modelValue:u.row.折扣,"onUpdate:modelValue":T=>u.row.折扣=T,onChange:T=>dl(u.row),controls:!1,style:{width:"100%"},placeholder:"必填项"},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})]),_:1},8,["data"])]),_:1})):L("",!0)]),_:1},8,["rules","model"]),r("div",Wa,[o(t,{onClick:a[33]||(a[33]=u=>cl(Pe.value))},{default:n(()=>[m("取消")]),_:1}),b.value.折扣录入方式=="批量折扣录入"?(h(),E(t,{key:0,type:"primary",onClick:a[34]||(a[34]=u=>pl(Pe.value))},{default:n(()=>[m("确定")]),_:1})):L("",!0),b.value.折扣录入方式=="逐条折扣录入"?(h(),E(t,{key:1,type:"primary",onClick:a[35]||(a[35]=u=>vl(f.value))},{default:n(()=>[m("确定")]),_:1})):L("",!0)])]),_:1},8,["modelValue"]),o(ye,{modelValue:ce.value,"onUpdate:modelValue":a[37]||(a[37]=u=>ce.value=u),top:"5vh",title:"完成进度","align-center":"",onClosed:Tl,"destroy-on-close":"",width:"600px",draggable:"","close-on-click-modal":!1},{default:n(()=>[o(p,{style:{width:"100%"}},{default:n(()=>[r("div",Xa,[o(oa,{"text-inside":!0,"stroke-width":18,color:Ql,percentage:te.value,striped:"","striped-flow":""},{default:n(()=>[et,r("span",null,g(te.value)+"%",1)]),_:1},8,["percentage"]),r("div",lt,[r("div",at,[o(ll,{value:O.value},{title:n(()=>[tt]),suffix:n(()=>[m("/"+g(f.value.length)+"张",1)]),_:1},8,["value"])]),r("div",ot,[o(ll,{value:me.value},{title:n(()=>[nt]),suffix:n(()=>[m("张")]),_:1},8,["value"])])])])]),_:1})]),_:1},8,["modelValue"])])}}});const ht=ha(ut,[["__scopeId","data-v-3ee00e7f"]]);export{ht as default};
