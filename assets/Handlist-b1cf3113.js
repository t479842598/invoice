import{a as Re,_ as Be}from"./index-823f4b27.js";import{M as Ae,R as He}from"./_@element-plus-ad4c9002.js";import{d as Me,ai as c,aT as t,aF as Ye,b5 as $e,bF as se,c as U,W as o,bD as n,a as d,au as Oe,b9 as Y,H as $,aX as u,aY as je,aP as Le,aM as qe,aN as O,o as f,U as b,bi as j,I as L,F as q,aV as ue,P as Ge,Y as We}from"./_@vue-5ba92de9.js";import"./__vendor-5e6ac033.js";import"./_crypto-js-0812dcff.js";import"./_element-plus-8c7ce171.js";import"./_@popperjs-c75af06c.js";import"./_pdfjs-dist-c04561eb.js";import"./_@microsoft-43c4e133.js";import"./_vue-codemirror-50da885a.js";const Je=y=>(Le("data-v-f68144e1"),y=y(),qe(),y),Qe={class:"table-container"},Xe={class:"table-text"},Ke={border:"0",class:"table",width:"900"},Ze={width:"300",align:"center"},ea={width:"300",align:"center"},aa={width:"300",align:"left"},la={class:"roadui_pagerdiv"},ta=Je(()=>d("div",null,[d("h3",{class:"before"},"发票明细")],-1)),oa={class:"table-container"},na={class:"roadui_pagerdiv"},ia=Me({__name:"Handlist",setup(y){const E=We(()=>Re(()=>import("./HandEdit-13869ca0.js"),["./HandEdit-13869ca0.js","./_@vue-5ba92de9.js","./excel-1d8df660.js","./__vendor-5e6ac033.js","./__vendor-693c365c.css","./_element-plus-8c7ce171.js","./_@element-plus-ad4c9002.js","./_@popperjs-c75af06c.js","./_element-plus-7d03f811.css","./index-823f4b27.js","./_crypto-js-0812dcff.js","./_pdfjs-dist-c04561eb.js","./_@microsoft-43c4e133.js","./_vue-codemirror-50da885a.js","./index-2ccff9e2.css","./HandEdit-7d8d49aa.css"],import.meta.url)),G=c("ajax"),x=c("utils"),de=c("config"),W=c("qs"),ce=c("index_openmenu");c("index_removetab"),c("index_refreshtab"),c("index_userinfo");const J=t("");localStorage.getItem("sobInfo")!=""&&(J.value=JSON.parse(localStorage.getItem("sobInfo"))),c("view_dialogshow");const Q=t({prop:"invoiceDate",order:"ascending"}),i=t(x.getPager(Q.value)),ve=t({prop:"goodsCode",order:"ascending"}),s=t(x.getPager(ve.value)),k=t(!1),F=t(!1),C=t(!1),R=t(0),T=t(!1),v=t(0),p=t(0),S=t(""),z=t(""),B=t(""),D=t(!1),pe=t();t(!1),t(""),t(""),t(""),t(""),t("");const V=t(!1),N=t(!1),P=t(""),r=t({serino:"",customername:"",invoiceDate:"",status:""}),ge=t([]);Ye(async()=>{await _()});const A=t([]),X=t([]);async function _(){try{r.value.size=i.value.size,r.value.number=i.value.number,r.value.order=i.value.order,r.value.data1=r.value.invoiceDate[0],r.value.data2=r.value.invoiceDate[1],r.value.type="";const a=await G.post("/Invoice/GetInvoiceApplyList?srcorgid="+J.value.id,W.stringify(r.value));if(a.data.total==0?(k.value=!0,F.value=!0):(k.value=!1,F.value=!1),a.data.rows.length>0){A.value=a.data.rows,R.value=a.data.total,S.value=a.data.rows[0].id,i.value.total=a.data.total,v.value=0,p.value=0;for(let e=0;e<a.data.rows.length;e++)v.value=Number((v.value+Number(a.data.rows[e].invoiceTotalPriceTax)).toFixed(2)),p.value=Number((p.value+Number(a.data.rows[e].invoiceTotalTax)).toFixed(2));w()}else{A.value=a.data.rows,R.value=a.data.total,S.value="0",i.value.total=a.data.total;for(let e=0;e<a.data.rows.length;e++)v.value=Number((v.value+Number(a.data.rows[e].invoiceTotalPriceTax)).toFixed(2)),p.value=Number((p.value+Number(a.data.rows[e].invoiceTotalTax)).toFixed(2));w()}}catch{k.value=!1}finally{}}const H=t(""),K=$e(null),h=t(!1),me=t([{prop:"serialNo",label:"开票流水号",align:"center",width:"200"},{prop:"buyerName",label:"客户名称",align:"center",width:"250"},{prop:"buyerTaxNo",label:"税号",align:"center",width:"200"},{prop:"invoiceTotalPriceTax",label:"含税金额",align:"right",width:"110"},{prop:"invoiceTotalTax",label:"税额",align:"center",width:"110"},{label:"操作",align:"center",template:!0}]),fe=t([{prop:"id",align:"center",show:!1},{label:"序号",align:"center",show:!0,width:"60"},{prop:"goodsCode",label:"商品编号",show:!0,align:"center",width:"200"},{prop:"goodsName",label:"商品名称",show:!0,align:"center",width:"160"},{prop:"goodsSpecification",label:"规格型号",show:!0,align:"center",width:"180"},{prop:"goodsUnit",label:"单位",show:!0,align:"center",width:"100"},{prop:"goodsQuantity",label:"数量",show:!0,align:"center",width:"120"},{prop:"goodsPrice",label:"单价",show:!0,align:"center",width:"120"},{prop:"goodsTotalPrice",label:"价税合计",show:!0,align:"right",width:"120"},{prop:"goodsTaxRate",label:"税率/征收率",show:!0,align:"center",width:"200"},{prop:"goodsTotalTax",label:"税额",show:!0,align:"center"}]),be=async()=>{z.value="0",B.value="",D.value=!0,T.value=!0,P.value="0",K.value=E,H.value="新增",h.value=!0},_e=a=>{P.value=a.flowtaskid,z.value=a.id,D.value=!1,T.value=!1,K.value=E,H.value="修改",h.value=!0},we=(a,e)=>{a!=null&&(S.value=a.id,i.value.number=1,w())},Z=t({}),w=async()=>{C.value=!0,Z.value={id:S.value,size:s.value.size,number:s.value.number,order:s.value.order};try{const a=await G.post("/Invoice/GetInvoiceDetailMain",W.stringify(Z.value));X.value=a.data.rows,s.value.total=a.data.total}catch(a){x.msg(a.message,"error",!1)}finally{C.value=!1}},he=()=>{x.showFileName(ce,{name:"手工开票模板"},de.SERVER_WEBADDRESS)},ye=a=>{ge.value=Array.from(new Set(a.map(e=>e.id)))},xe=a=>{i.value.size=a,_()},ke=a=>{i.value.number=a,_()},Ce=a=>{s.value.size=a,w()},Te=a=>{s.value.number=a,w()},Se=()=>{V.value=!0},ze=()=>{p.value=0,v.value=0,i.value.number=1,_(),V.value=!1},ee=()=>{p.value=0,v.value=0,r.value={serino:"",customername:"",invoiceDate:"",status:""},_()};function ae({row:a,column:e,rowIndex:g,columnIndex:m}){return{color:"#000",textAlign:"center"}}function De({row:a}){if(a.goodsTotalPrice===0)return{backgroundColor:"yellow"}}function Ve({row:a}){if(a.isedit==1)return{backgroundColor:"#ec5353"}}return O("getTableData",_),O("postSaleDetail",w),O("dialogShow",h),(a,e)=>{const g=u("el-button"),m=u("el-form-item"),le=u("el-form"),I=u("el-table-column"),te=u("el-table"),oe=u("el-pagination"),Ne=u("FullScreen"),Pe=u("el-icon"),ne=u("el-dialog"),ie=u("el-input"),Ie=u("el-date-picker"),M=u("el-option"),Ue=u("el-select"),re=je("loading");return se((f(),U("div",null,[o(le,{ref:"formbutton",inline:""},{default:n(()=>[o(m,null,{default:n(()=>[o(g,{type:"primary",onClick:be},{default:n(()=>[b("申请开票")]),_:1})]),_:1}),o(m,null,{default:n(()=>[o(g,{type:"primary",onClick:Se,icon:j(Ae)},{default:n(()=>[b("查询")]),_:1},8,["icon"]),o(g,{type:"success",onClick:ee,icon:j(He)},{default:n(()=>[b("刷新")]),_:1},8,["icon"]),o(g,{type:"primary",link:"",onClick:e[0]||(e[0]=l=>he())},{default:n(()=>[b("下载导入模板")]),_:1})]),_:1})]),_:1},512),d("div",Qe,[o(te,Oe({data:A.value,stripe:i.value.tableStripe,border:"","highlight-current-row":i.value.tableHighlightCurrentRow,"max-height":"300",style:{width:"100%",color:"#000"},"header-cell-style":ae},a.$attrs,{onCurrentChange:we,onSelectionChange:ye,"row-style":Ve}),{default:n(()=>[L("",!0),L("",!0),o(I,{type:"selection",width:"55",align:"center"}),o(I,{type:"index",label:"序号",align:"center",width:"60"}),(f(!0),U(q,null,ue(me.value,(l,Ee)=>(f(),$(I,{key:Ee,prop:l.prop,label:l.label,align:l.align,width:l.width},Ge({_:2},[l.template?{name:"default",fn:n(Fe=>[o(g,{type:"primary",size:"small",onClick:ra=>_e(Fe.row)},{default:n(()=>[b("修改")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["prop","label","align","width"]))),128))]),_:1},16,["data","stripe","highlight-current-row"])]),d("div",Xe,[d("table",Ke,[d("tr",null,[d("td",Ze," 发票张数："+Y(R.value)+"张 ",1),d("td",ea," 价税合计："+Y(v.value)+"元 ",1),d("td",aa," 合计税额："+Y(p.value)+"元 ",1)])])]),d("div",la,[o(oe,{currentPage:i.value.number,"onUpdate:currentPage":e[1]||(e[1]=l=>i.value.number=l),"page-size":i.value.size,"onUpdate:pageSize":e[2]||(e[2]=l=>i.value.size=l),"page-sizes":i.value.sizes,background:i.value.background,layout:i.value.layout,total:i.value.total,disabled:k.value,onSizeChange:xe,onCurrentChange:ke},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])]),ta,d("div",oa,[se((f(),$(te,{data:X.value,stripe:s.value.tableStripe,border:"","highlight-current-row":s.value.tableHighlightCurrentRow,"max-height":"300",style:{width:"100%",color:"#000"},"header-cell-style":ae,"default-sort":Q.value,"row-style":De},{default:n(()=>[(f(!0),U(q,null,ue(fe.value,l=>(f(),U(q,null,[l.show?(f(),$(I,{key:0,prop:l.prop,label:l.label,align:l.align,width:l.width},null,8,["prop","label","align","width"])):L("",!0)],64))),256))]),_:1},8,["data","stripe","highlight-current-row","default-sort"])),[[re,C.value]])]),d("div",na,[o(oe,{currentPage:s.value.number,"onUpdate:currentPage":e[3]||(e[3]=l=>s.value.number=l),"page-size":s.value.size,"onUpdate:pageSize":e[4]||(e[4]=l=>s.value.size=l),"page-sizes":s.value.sizes,background:s.value.background,layout:s.value.layout,total:s.value.total,onSizeChange:Ce,onCurrentChange:Te,disabled:F.value},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])]),o(ne,{modelValue:h.value,"onUpdate:modelValue":e[11]||(e[11]=l=>h.value=l),fullscreen:N.value,style:{"padding-bottom":"10px",position:"relative"},title:H.value,"align-center":"","destroy-on-close":"",width:"1200px",draggable:"","close-on-click-modal":!1,onClose:e[12]||(e[12]=l=>N.value=!1)},{default:n(()=>[o(j(E),{ref_key:"EditRef",ref:pe,id:z.value,"onUpdate:id":e[5]||(e[5]=l=>z.value=l),isnew:T.value,"onUpdate:isnew":e[6]||(e[6]=l=>T.value=l),buyerTaxNo:B.value,"onUpdate:buyerTaxNo":e[7]||(e[7]=l=>B.value=l),new:D.value,"onUpdate:new":e[8]||(e[8]=l=>D.value=l),flowtaskid:P.value,"onUpdate:flowtaskid":e[9]||(e[9]=l=>P.value=l)},null,8,["id","isnew","buyerTaxNo","new","flowtaskid"]),o(Pe,{onClick:e[10]||(e[10]=l=>N.value=!N.value),style:{position:"absolute",right:"45px",top:"24px",cursor:"pointer","font-size":"14px"}},{default:n(()=>[o(Ne)]),_:1})]),_:1},8,["modelValue","fullscreen","title"]),o(ne,{modelValue:V.value,"onUpdate:modelValue":e[17]||(e[17]=l=>V.value=l),title:"查询","align-center":"","destroy-on-close":"",width:"800px",draggable:"","close-on-click-modal":!1},{default:n(()=>[o(le,{inline:!0,model:r.value,class:"inline","label-width":"100px"},{default:n(()=>[o(m,{label:"开票流水号"},{default:n(()=>[o(ie,{modelValue:r.value.serino,"onUpdate:modelValue":e[13]||(e[13]=l=>r.value.serino=l)},null,8,["modelValue"])]),_:1}),o(m,{label:"客户名称"},{default:n(()=>[o(ie,{modelValue:r.value.customername,"onUpdate:modelValue":e[14]||(e[14]=l=>r.value.customername=l)},null,8,["modelValue"])]),_:1}),o(m,{label:"开票日期"},{default:n(()=>[o(Ie,{modelValue:r.value.invoiceDate,"onUpdate:modelValue":e[15]||(e[15]=l=>r.value.invoiceDate=l),type:"daterange","value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"])]),_:1}),o(m,{label:"开票状态"},{default:n(()=>[o(Ue,{modelValue:r.value.status,"onUpdate:modelValue":e[16]||(e[16]=l=>r.value.status=l),clearable:""},{default:n(()=>[o(M,{label:"待开票",value:"待开票"}),o(M,{label:"已开票待返回电子版",value:"已开票待返回电子版"}),o(M,{label:"开票完成",value:"开票完成"})]),_:1},8,["modelValue"])]),_:1}),o(m,{style:{"margin-left":"30px"}},{default:n(()=>[o(g,{type:"primary",onClick:ze},{default:n(()=>[b("查询")]),_:1}),o(g,{type:"success",onClick:ee},{default:n(()=>[b("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])),[[re,C.value]])}}});const _a=Be(ia,[["__scopeId","data-v-f68144e1"]]);export{_a as default};
