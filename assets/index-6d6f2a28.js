import{ai as S,aT as v,A as B,c as fe,W as s,bD as l,bi as x,aX as r,aY as pe,o as d,a as k,H as p,aZ as me,b9 as I,bI as ge,U as m,I as D,bF as ve}from"./_@vue-5ba92de9.js";import{p as U,_ as _e}from"./_splitpanes-c98d9122.js";const he={style:{height:"inherit"}},ye={class:"roadui_treenode"},be=k("span",null,"操作",-1),ke={class:"roadui_pagerdiv"},we=k("span",{class:"dialog-footer"},null,-1),Se={__name:"index",setup(Ce){const b=S("ajax"),a=S("utils"),z=S("qs"),F=S("config"),P=S("index_openmenu"),j=v([]),T=v([]),$={children:"children",label:"title",isLeaf:"isLeaf"},G=e=>{if(u.value.type=e.id,e.id===a.emptyLong+""){u.value.status=1,c(!0);return}u.value.status=0,c(!1)},W=(e,t)=>{if(e.level===0)b.post("/Dictionary/GetTreeJson?root=system_applibrary_formtype").then(f=>{const w={id:a.emptyLong+"",parentId:"0",title:"已删除表单",ico:"Delete",titleEn:"",titleTw:"",isLeaf:!0};f.data.push(w),j.value=f.data,a.length(f.data)>0&&T.value.push(f.data[0].id),c(!1)}).catch(()=>{});else{if(a.length(e.data.children)>0){t(e.data.children);return}b.post("/Dictionary/GetTreeChildsJson?parentid="+e.data.id).then(f=>{t(f.data)}).catch(()=>{})}},u=v({status:0,type:""}),E=v(!1),o=v(!1),N=v([]);let _=[];const R=v({prop:"createtime",order:"ascending"}),i=v(a.getPager(R.value)),q=B(()=>e=>{switch(e){case 0:return"设计中";case 1:return"已发布";case 2:return"已删除";default:return"未知"}}),H=B(()=>e=>{switch(e){case 0:return"";case 1:return"success";default:return"info"}}),J=e=>{_=e},M=e=>{i.value.size=e,c(!1)},O=e=>{i.value.number=e,c(!1)},K=e=>{i.value.order=a.getOrder(e),c(!1)},c=e=>{e&&(i.value.number=1),E.value=!0,o.value=!0,u.value.size=i.value.size,u.value.number=i.value.number,u.value.order=i.value.order,b.post("/Form/GetList",z.stringify(u.value)).then(t=>{N.value=t.data.rows,i.value.total=t.data.total,o.value=!1,E.value=!1}).catch(()=>{o.value=!1})},A=e=>{const t=e===null,f={id:"formdesign_"+(t?a.emptyLong+"":e.id),title:t?"新建表单":"设计表单-"+e.name,ico:"Edit",openMode:0,url:"/form/design?isnew="+(t?"1":"0")+"&typeid="+u.value.type+"&formid="+(t?"":e.id)};P(f)},X=()=>{if(_.length===0){a.msg("您没有选择要删除的表单！",!1);return}a.confirm("您确定要删除所选表单吗？",()=>{o.value=!0,b.post("/Form/DeleteForm",z.stringify({ids:a.getArrayValues(_,"id").join(",")})).then(e=>{a.msg(e.success?"删除成功！":"删除失败！",e.success),o.value=!1,e.success&&(_=[],c(!1))}).catch(()=>{o.value=!1})})},Y=()=>{if(_.length===0){a.msg("您没有选择要彻底删除的表单！",!1);return}a.confirm("您确定要彻底删除所选表单吗？",()=>{o.value=!0,b.post("/Form/ThoroughDeleteForm",z.stringify({ids:a.getArrayValues(_,"id").join(",")})).then(e=>{a.msg(e.success?"彻底删除成功！":"彻底删除失败！",e.success),_=[],c(!1),o.value=!1}).catch(()=>{o.value=!1})})},Z=e=>{a.confirm("您确定要恢复该表单吗？",()=>{o.value=!0,b.post("/Form/RecoveryForm",z.stringify({id:e.id})).then(t=>{t.success?(a.msg("恢复成功！",!0),c(!1)):a.msg("恢复失败！",!1),o.value=!1}).catch(()=>{o.value=!1})})},Q=()=>{let e=a.getArrayValues(_,"id");if(e.length===0){a.msg("您没有选择要导出的表单！",!1);return}const t=F.SERVER_WEBADDRESS+"/Export/FormExport?formid="+e.join(",");window.location.href=t},V=v(!1),ee=()=>{V.value=!0},te=e=>e.type!=="application/json"?(a.msg("要导入的文件必须是json格式文件!",!1),!1):!0,ae=(e,t)=>{if(t.status==="success"){if(e.code!=0){a.msg("文件上传失败！",!1);return}const w=e.data.id;b.post("/Form/ImportForm",z.stringify({files:w})).then(h=>{let y=h.msg;a.length(y)===0&&(h.success?y="导入成功！":h.code==1?y="要导入的文件不存在！":h.code==2?y="要导入的文件不是有效的json格式文件！":y="导入失败！"),a.msg(y,h.success),h.success&&(V.value=!1,c(!1))}).catch(()=>{})}else t.status==="error"&&a.msg("文件上传失败！",!1)};return(e,t)=>{const f=r("document"),w=r("el-icon"),h=r("folder"),y=r("el-tree"),le=r("el-input"),L=r("el-form-item"),g=r("el-button"),se=r("el-form"),C=r("el-table-column"),oe=r("el-tag"),ne=r("el-table"),ie=r("el-pagination"),ue=r("el-upload"),re=r("el-dialog"),de=pe("loading");return d(),fe("div",he,[s(x(_e),{class:"default-theme",style:{height:"inherit"}},{default:l(()=>[s(x(U),{size:16,"min-size":"16","max-size":"50",style:{overflow:"auto",background:"#fff"}},{default:l(()=>[s(y,{data:j.value,props:$,load:W,lazy:"","node-key":"id","highlight-current":"","default-expanded-keys":T.value,"expand-on-click-node":!1,style:{height:"inherit","padding-right":"14px"},onNodeClick:G},{default:l(n=>[k("div",ye,[x(a).length(n.data.ico)>0?(d(),p(me(n.data.ico),{key:0})):n.node.isLeaf?(d(),p(w,{key:1},{default:l(()=>[s(f)]),_:1})):(d(),p(w,{key:2},{default:l(()=>[s(h)]),_:1})),k("span",null,I(n.node.label),1)])]),_:1},8,["data","default-expanded-keys"])]),_:1}),s(x(U),{size:84,style:{background:"#fff",overflow:"auto","padding-left":"5px"}},{default:l(()=>[k("div",null,[s(se,{inline:!0,onSubmit:t[3]||(t[3]=ge(()=>{},["prevent"]))},{default:l(()=>[s(L,{label:"表单名称"},{default:l(()=>[s(le,{modelValue:u.value.name,"onUpdate:modelValue":t[0]||(t[0]=n=>u.value.name=n),clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),s(L,null,{default:l(()=>[s(g,{type:"primary",disabled:o.value,onClick:t[1]||(t[1]=n=>c(!0))},{default:l(()=>[m("查询")]),_:1},8,["disabled"]),u.value.status===0?(d(),p(g,{key:0,type:"primary",disabled:o.value,onClick:t[2]||(t[2]=n=>A(null))},{default:l(()=>[m("新建")]),_:1},8,["disabled"])):D("",!0),u.value.status===0?(d(),p(g,{key:1,type:"danger",disabled:o.value,onClick:X},{default:l(()=>[m("删除")]),_:1},8,["disabled"])):D("",!0),u.value.status===0?(d(),p(g,{key:2,disabled:o.value,onClick:Q},{default:l(()=>[m("导出")]),_:1},8,["disabled"])):D("",!0),u.value.status===0?(d(),p(g,{key:3,disabled:o.value,onClick:ee},{default:l(()=>[m("导入")]),_:1},8,["disabled"])):D("",!0),u.value.status===1?(d(),p(g,{key:4,type:"danger",disabled:o.value,onClick:Y},{default:l(()=>[m("彻底删除")]),_:1},8,["disabled"])):D("",!0)]),_:1})]),_:1})]),k("div",null,[ve((d(),p(ne,{data:N.value,stripe:i.value.tableStripe,border:i.value.tableBorder,style:{width:"100%"},"highlight-current-row":i.value.tableHighlightCurrentRow,"default-sort":R.value,onSortChange:K,onSelectionChange:J},{default:l(()=>[s(C,{type:"selection",width:"45"}),s(C,{prop:"name",label:"表单名称","show-overflow-tooltip":"",sortable:"custom"}),s(C,{prop:"createTime",label:"创建时间",width:"180",sortable:"custom"}),s(C,{prop:"createUserName",label:"创建人",width:"140",sortable:"custom"}),s(C,{prop:"status",label:"状态",width:"100",sortable:"custom"},{default:l(n=>[s(oe,{type:H.value(n.row.status),effect:"dark"},{default:l(()=>[m(I(q.value(n.row.status)),1)]),_:2},1032,["type"])]),_:1}),s(C,{width:"90"},{header:l(()=>[be]),default:l(n=>[u.value.status===0?(d(),p(g,{key:0,size:"small",disabled:o.value,type:"primary",onClick:ce=>A(n.row)},{default:l(()=>[m("编辑")]),_:2},1032,["disabled","onClick"])):(d(),p(g,{key:1,size:"small",disabled:o.value,type:"primary",onClick:ce=>Z(n.row)},{default:l(()=>[m("恢复")]),_:2},1032,["disabled","onClick"]))]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[de,E.value]])]),k("div",ke,[s(ie,{currentPage:i.value.number,"onUpdate:currentPage":t[4]||(t[4]=n=>i.value.number=n),"page-size":i.value.size,"onUpdate:pageSize":t[5]||(t[5]=n=>i.value.size=n),"page-sizes":i.value.sizes,background:i.value.background,layout:i.value.layout,total:i.value.total,disabled:o.value,onSizeChange:M,onCurrentChange:O},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])])]),_:1})]),_:1}),s(re,{modelValue:V.value,"onUpdate:modelValue":t[6]||(t[6]=n=>V.value=n),title:"导入",class:"el-dialog__padding1","align-center":"","destroy-on-close":"",width:"350px",draggable:"","close-on-click-modal":!1},{footer:l(()=>[we]),default:l(()=>[s(ue,{action:x(F).SERVER_WEBADDRESS+"/Files/SaveFiles","show-file-list":!1,accept:".json",headers:{"nroadflow-token":x(a).getToken()},"with-credentials":"",data:{filetype:".json",uploadtype:0},"on-success":ae,"before-upload":te},{default:l(()=>[s(g,{type:"primary"},{default:l(()=>[m("选择文件")]),_:1})]),_:1},8,["action","headers","data"])]),_:1},8,["modelValue"])])}}};export{Se as default};
