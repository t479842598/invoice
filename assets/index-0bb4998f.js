import{ai as m,aT as p,aF as F,c as G,a as _,W as n,bD as s,bF as H,H as V,aX as u,aY as I,o as y,bi as w,U as z,b9 as T,I as L}from"./_@vue-5ba92de9.js";const W={class:"roadui_page"},X=["onClick"],A={class:"roadui_pagerdiv"},Z={__name:"index",setup(J){const f=m("ajax"),o=m("utils"),N=m("qs"),M=m("index_openmenu"),r=p(!1),b=p(!1),d=p({}),v=p([]),h=p([]),D=p({prop:"groupid",order:"descending"}),t=p(o.getPager(D.value));F(()=>{i(!1)});const S=e=>{t.value.size=e,i(!1)},R=e=>{t.value.number=e,i(!1)},U=e=>{t.value.order=o.getOrder(e),i(!1)},i=e=>{e&&(t.value.number=1),b.value=!0,r.value=!0,d.value.size=t.value.size,d.value.number=t.value.number,d.value.order=t.value.order,d.value.date1=o.length(v.value)>0?v.value[0]:"",d.value.date2=o.length(v.value)>1?v.value[1]:"",f.post("/Message/GetNoReadList",N.stringify(d.value)).then(a=>{h.value=a.data.rows,t.value.total=a.data.total,r.value=!1,b.value=!1}).catch(()=>{r.value=!1})},B=e=>{f.post("/Message/ToRead?msgid="+e.id).then(()=>{if(o.length(e.url)>0){let a="",g="",c="";switch(e.type){case 1:a=e.sourceTitle||"流程任务",g="message_task_"+e.id,c="Edit";break;default:a=o.length(e.sourceTitle)>0?e.sourceTitle:e.contents,g="message_task_"+o.createGuid(!1),c="";break}const k={title:a,id:g,url:e.url,ico:c,openMode:0};M(k)}i(!1)}).catch(()=>{})},Y=()=>{if(h.value.length===0){o.msg("没有需要标记的消息！",!1);return}r.value=!0,f.post("/Message/TransferRead").then(e=>{o.msg(e.success?"标记成功！":e.code==1?"没有需要标记的消息！":"标记失败！",e.success),i(!1),r.value=!1}).catch(()=>{r.value=!1})};return(e,a)=>{const g=u("el-input"),c=u("el-form-item"),k=u("el-date-picker"),x=u("el-button"),j=u("el-form"),C=u("el-table-column"),P=u("el-tag"),O=u("el-tooltip"),$=u("el-table"),q=u("el-pagination"),E=I("loading");return y(),G("div",W,[_("div",null,[n(j,{inline:!0},{default:s(()=>[n(c,{label:"内容"},{default:s(()=>[n(g,{modelValue:d.value.contents,"onUpdate:modelValue":a[0]||(a[0]=l=>d.value.contents=l),style:{width:"200px"},placeholder:"消息内容",clearable:""},null,8,["modelValue"])]),_:1}),n(c,{label:"日期"},{default:s(()=>[n(k,{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=l=>v.value=l),style:{width:"220px"},type:"daterange","value-format":"YYYY-MM-DD","unlink-panels":"","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:w(o).dateShortucts},null,8,["modelValue","shortcuts"])]),_:1}),n(c,null,{default:s(()=>[n(x,{type:"primary",disabled:r.value,onClick:a[2]||(a[2]=l=>i(!0))},{default:s(()=>[z("查询")]),_:1},8,["disabled"]),n(x,{type:"danger",disabled:r.value,onClick:a[3]||(a[3]=l=>Y())},{default:s(()=>[z("全部标记为已读")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_("div",null,[H((y(),V($,{data:h.value,stripe:t.value.tableStripe,border:t.value.tableBorder,style:{width:"100%"},"highlight-current-row":t.value.tableHighlightCurrentRow,"default-sort":D.value,onSortChange:U},{default:s(()=>[n(C,{prop:"contents",label:"消息内容",sortable:"custom"},{default:s(l=>[_("a",{class:"roaduia",href:"javascript:;",onClick:K=>B(l.row)},T(l.row.contents),9,X)]),_:1}),n(C,{prop:"sendTime",label:"接收时间",sortable:"custom",width:"150"}),n(C,{prop:"senderName",label:"发送人",sortable:"custom",width:"120"},{default:s(l=>[w(o).length(l.row.senderName)>0?(y(),V(O,{key:0,placement:"left",content:l.row.senderOrganize},{default:s(()=>[n(P,null,{default:s(()=>[z(T(l.row.senderName),1)]),_:2},1024)]),_:2},1032,["content"])):L("",!0)]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[E,b.value]]),_("div",A,[n(q,{currentPage:t.value.number,"onUpdate:currentPage":a[4]||(a[4]=l=>t.value.number=l),"page-size":t.value.size,"onUpdate:pageSize":a[5]||(a[5]=l=>t.value.size=l),"page-sizes":t.value.sizes,background:t.value.background,layout:t.value.layout,total:t.value.total,disabled:r.value,onSizeChange:S,onCurrentChange:R},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])])])])}}};export{Z as default};
