import{ai as y,aT as p,aF as se,A as de,c as C,bF as re,H as k,bD as o,a as f,W as a,aX as r,aY as ie,o as c,bi as V,aZ as pe,I as $,U as s,b9 as h,F as A,aV as E}from"./_@vue-5ba92de9.js";const me=f("span",null,"操作",-1),ce={style:{margin:"15px auto 0 auto","text-align":"center"}},ve={key:0,class:"roadui_note"},fe={style:{"margin-left":"12px"}},be={style:{"margin-left":"24px"}},ge={style:{"margin-left":"12px"}},_e={style:{"margin-left":"12px"}},he={__name:"button1",props:{query:{type:String,default:()=>""}},setup(R){const g=y("ajax"),u=y("utils"),I=y("qs"),G=y("ElSelectico"),L=y("ElCodemirror"),H=R,j=u.query("programid",H.query),T=p([]),d=p(!1),w=p(!1);let x=[];const F=p({prop:"sort",order:"ascending"}),_=p(u.getPager(F.value)),D=p([]);se(()=>{X()});const M=de(()=>n=>{switch(n){case 1:return"常规按钮";case 2:return"列表按钮";default:return""}}),z=n=>{x=n},W=n=>{_.value.order=u.getOrder(n),S(!1)},X=()=>{g.post("/Button/GetList").then(n=>{D.value=n.data,S(!1)}).catch(()=>{})},S=n=>{n&&(_.value.number=1),w.value=!0,d.value=!0,g.post("/Program/GetButtonList?programid="+j).then(e=>{T.value=e.data,d.value=!1,w.value=!1}).catch(()=>{d.value=!1,w.value=!1})},t=p({}),b=p(!1),U=p(""),q=p(null),Y={},O=n=>{u.isDef(n)?g.post("/Program/GetButton?buttonid="+n.id).then(e=>{t.value=e.data,t.value.isValidate=e.data.isValidate==1,t.value.showType=e.data.showType+"",t.value.buttonId==0&&delete t.value.buttonId,U.value="编辑 - "+e.data.buttonName,b.value=!0}).catch(()=>{}):(t.value={programId:j,isValidate:!1,type:"",sort:u.getArrayMax(T.value,"sort")+5},U.value="添加",b.value=!0)},Z=n=>{const e=u.getArrayObj(D.value,n,"id");u.isDef(e)&&(t.value.clientScript=e.scripts,t.value.buttonName=e.name,t.value.icon=e.ico,t.value.type=e.type,t.value.note=e.note)},J=async n=>{n&&await n.validate(e=>{e&&(d.value=!0,g.post("/Program/SaveButton",I.stringify(t.value)).then(i=>{let m=i.msg;u.length(m)===0&&(m=i.success?"保存成功！":"保存失败！"),u.msg(m,i.success),d.value=!1,i.success&&(S(!1),b.value=!1,t.value={})}).catch(()=>{d.value=!1}))})},K=()=>{if(x.length===0){u.msg("您没有选择要删除的按钮！",!1);return}u.confirm("您确定要删除所选按钮吗？",()=>{d.value=!0,g.post("/Program/DeleteButton",I.stringify({ids:u.getArrayValues(x,"id").join(",")})).then(n=>{d.value=!1,u.msg(n.success?"删除成功！":"删除失败！",n.success),x=[],S(!1)}).catch(()=>{})})};return(n,e)=>{const i=r("el-table-column"),m=r("el-button"),Q=r("el-table"),ee=r("el-option"),le=r("el-select"),B=r("el-input"),v=r("el-form-item"),N=r("el-radio"),P=r("el-radio-group"),te=r("el-checkbox"),ae=r("el-input-number"),oe=r("el-form"),ne=r("el-dialog"),ue=ie("loading");return c(),C("div",null,[re((c(),k(Q,{data:T.value,stripe:_.value.tableStripe,border:_.value.tableBorder,style:{width:"100%"},"highlight-current-row":_.value.tableHighlightCurrentRow,"default-sort":F.value,onSortChange:W,onSelectionChange:z},{default:o(()=>[a(i,{type:"selection",width:"45"}),a(i,{prop:"buttonName",label:"按钮名称"}),a(i,{prop:"icon",label:"图标",width:"100"},{default:o(l=>[V(u).length(l.row.icon)>0?(c(),k(pe(l.row.icon),{key:0})):$("",!0)]),_:1}),a(i,{prop:"showType",label:"类型",width:"150"},{default:o(l=>[s(h(M.value(l.row.showType)),1)]),_:1}),a(i,{prop:"isValidate",label:"权限验证",width:"150"},{default:o(l=>[s(h(l.row.isValidate==0?"不验证":"验证"),1)]),_:1}),a(i,{prop:"sort",label:"排序",width:"80"}),a(i,{width:"80"},{header:o(()=>[me]),default:o(l=>[a(m,{size:"small",disabled:d.value,type:"primary",onClick:ye=>O(l.row)},{default:o(()=>[s("编辑")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[ue,w.value]]),f("div",ce,[a(m,{disabled:d.value,type:"primary",onClick:e[0]||(e[0]=l=>O(null))},{default:o(()=>[s("添加")]),_:1},8,["disabled"]),a(m,{disabled:d.value,type:"danger",onClick:e[1]||(e[1]=l=>K())},{default:o(()=>[s("删除所选")]),_:1},8,["disabled"])]),a(ne,{modelValue:b.value,"onUpdate:modelValue":e[14]||(e[14]=l=>b.value=l),title:U.value,"align-center":"","destroy-on-close":"",width:"650px",draggable:"","close-on-click-modal":!1},{default:o(()=>[a(oe,{model:t.value,ref_key:"ruleFormRef",ref:q,rules:Y,"label-width":"80px"},{default:o(()=>[a(v,{label:"选择按钮",prop:"buttonId"},{default:o(()=>[a(le,{modelValue:t.value.buttonId,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.buttonId=l),style:{width:"246px"},onChange:Z,clearable:""},{default:o(()=>[(c(!0),C(A,null,E(D.value,l=>(c(),k(ee,{key:l.id,value:l.id,label:l.name},{default:o(()=>[f("span",null,h(l.name),1),V(u).length(l.note)>0?(c(),C("span",ve," - "+h(l.note),1)):$("",!0)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"]),f("span",fe,[s(" 按钮名称"),a(B,{modelValue:t.value.buttonName,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.buttonName=l),style:{width:"200px","margin-left":"12px"},clearable:""},null,8,["modelValue"])])]),_:1}),a(v,{label:"执行脚本",prop:"clientScript"},{default:o(()=>[a(V(L),{modelValue:t.value.clientScript,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.clientScript=l),height:"120px"},null,8,["modelValue"])]),_:1}),a(v,{label:"按钮类型",prop:"type"},{default:o(()=>[a(P,{modelValue:t.value.type,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.type=l)},{default:o(()=>[(c(!0),C(A,null,E(V(u).buttonTypes,l=>(c(),k(N,{label:l.value},{default:o(()=>[s(h(l.label),1)]),_:2},1032,["label"]))),256))]),_:1},8,["modelValue"])]),_:1}),a(v,{label:"显示类型",prop:"showType"},{default:o(()=>[a(P,{modelValue:t.value.showType,"onUpdate:modelValue":e[6]||(e[6]=l=>t.value.showType=l)},{default:o(()=>[a(N,{label:"1"},{default:o(()=>[s("常规按钮")]),_:1}),a(N,{label:"2"},{default:o(()=>[s("列表按钮")]),_:1})]),_:1},8,["modelValue"]),f("span",be,[s(" 图标"),a(V(G),{modelValue:t.value.icon,"onUpdate:modelValue":e[7]||(e[7]=l=>t.value.icon=l),style:{width:"175px","margin-left":"12px"},clearable:""},null,8,["modelValue"])]),f("span",ge,[a(te,{modelValue:t.value.isValidate,"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.isValidate=l)},{default:o(()=>[s("权限验证")]),_:1},8,["modelValue"])])]),_:1}),a(v,{label:"显示判断",prop:"showScript"},{default:o(()=>[a(B,{type:"textarea",rows:2,modelValue:t.value.showScript,"onUpdate:modelValue":e[9]||(e[9]=l=>t.value.showScript=l),placeholder:"判断按钮是否显示的js脚本"},null,8,["modelValue"])]),_:1}),a(v,{label:"备注说明",prop:"note"},{default:o(()=>[a(B,{modelValue:t.value.note,"onUpdate:modelValue":e[10]||(e[10]=l=>t.value.note=l),style:{width:"330px"},clearable:""},null,8,["modelValue"]),f("span",_e,[s(" 显示顺序"),a(ae,{step:5,modelValue:t.value.sort,"onUpdate:modelValue":e[11]||(e[11]=l=>t.value.sort=l),"controls-position":"right",style:{width:"120px","margin-left":"12px"}},null,8,["modelValue"])])]),_:1}),a(v,null,{default:o(()=>[a(m,{disabled:d.value,onClick:e[12]||(e[12]=l=>J(q.value)),type:"primary"},{default:o(()=>[s("保存")]),_:1},8,["disabled"]),a(m,{disabled:d.value,onClick:e[13]||(e[13]=l=>b.value=!1)},{default:o(()=>[s("关闭")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{he as default};
