import{ai as U,aT as r,aF as M,c as N,a as _,W as e,bD as t,bI as H,aX as m,aY as I,o as A,U as c,bF as z,H as L,bi as O}from"./_@vue-5ba92de9.js";const P={class:"roadui_page"},W={style:{height:"calc(100% - 60px)",overflow:"auto"}},X=_("span",null,"操作",-1),J={class:"dialog-footer"},le={__name:"index",setup(Q){const b=U("ajax"),n=U("utils"),V=U("qs"),s=r(!1),h=r(!1),w=r([]),C=r({}),o=r({});let g=[];const K=r({prop:"sort",order:"ascending"}),x=r(n.getPager(K.value)),S=r(null),f=r(!1),k=r(""),q={name:[{required:!0,message:"请输入系统名称",trigger:"blur"}],systemCode:[{required:!0,message:"请输入系统标识",trigger:"blur"}],systemKey:[{required:!0,message:"请输入调用KEY",trigger:"blur"}]};M(()=>{y()});const B=u=>{g=u},y=()=>{h.value=!0,s.value=!0,b.post("/FlowApiSystem/GetList",V.stringify({findname:C.value.name})).then(u=>{w.value=u.data,s.value=!1,h.value=!1}).catch(()=>{s.value=!1})},D=u=>{if(n.isUndef(u)||n.length(u.id)===0){o.value={systemKey:n.createGuid().toUpperCase(),sort:n.getArrayMax(w.value,"sort")+5},k.value="添加",f.value=!0;return}n.length(u.id)>0&&b.post("/FlowApiSystem/Get?systemid="+u.id).then(l=>{l.success?(o.value=l.data,k.value="编辑 - "+l.data.name,f.value=!0):n.msg("获取数据失败！",!1)}).catch(()=>{})},$=async u=>{u&&await u.validate(l=>{if(l){s.value=!0;const p=o.value.id||"";b.post("/FlowApiSystem/Save?systemid="+p,V.stringify(o.value)).then(d=>{let i=d.msg;n.length(i)===0&&(i=d.success?"保存成功！":"保存失败！"),n.msg(i,d.success),s.value=!1,d.success&&(f.value=!1,y()),s.value=!1}).catch(()=>{s.value=!1})}})},j=()=>{if(g.length===0){n.msg("您没有选择要删除的接口系统！",!1);return}n.confirm("您确定要删除所选接口系统吗？",()=>{s.value=!0,b.post("/FlowApiSystem/Delete",V.stringify({ids:n.getArrayValues(g,"id").join(",")})).then(u=>{n.msg(u.success?"删除成功！":"删除失败！",u.success),s.value=!1,u.success&&(g=[],y())}).catch(()=>{s.value=!1})})};return(u,l)=>{const p=m("el-input"),d=m("el-form-item"),i=m("el-button"),F=m("el-form"),v=m("el-table-column"),G=m("el-table"),R=m("el-scrollbar"),T=m("el-input-number"),Y=m("el-dialog"),E=I("loading");return A(),N("div",P,[_("div",null,[e(F,{inline:!0,onSubmit:l[2]||(l[2]=H(()=>{},["prevent"]))},{default:t(()=>[e(d,{label:"名称"},{default:t(()=>[e(p,{modelValue:C.value.name,"onUpdate:modelValue":l[0]||(l[0]=a=>C.value.name=a),placeholder:"系统名称",style:{width:"200px"},clearable:""},null,8,["modelValue"])]),_:1}),e(d,null,{default:t(()=>[e(i,{type:"primary",disabled:s.value,onClick:y},{default:t(()=>[c("查询")]),_:1},8,["disabled"]),e(i,{type:"primary",disabled:s.value,onClick:l[1]||(l[1]=a=>D(null))},{default:t(()=>[c("添加")]),_:1},8,["disabled"]),e(i,{type:"danger",disabled:s.value,onClick:j},{default:t(()=>[c("删除")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_("div",W,[e(R,null,{default:t(()=>[z((A(),L(G,{data:w.value,stripe:x.value.tableStripe,border:x.value.tableBorder,style:{width:"100%"},"highlight-current-row":x.value.tableHighlightCurrentRow,onSelectionChange:B,"default-sort":K.value},{default:t(()=>[e(v,{type:"selection",width:"45"}),e(v,{prop:"name",label:"系统名称",width:"200",sortable:""}),e(v,{prop:"systemCode",label:"系统标识",width:"200",sortable:""}),e(v,{prop:"systemKey",label:"调用KEY",sortable:""}),e(v,{prop:"note",label:"备注",width:"200",sortable:""}),e(v,{prop:"sort",label:"排序",width:"80",sortable:""}),e(v,{width:"90"},{header:t(()=>[X]),default:t(a=>[e(i,{size:"small",disabled:s.value,type:"primary",onClick:Z=>D(a.row)},{default:t(()=>[c("编辑")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[E,h.value]])]),_:1})]),e(Y,{modelValue:f.value,"onUpdate:modelValue":l[11]||(l[11]=a=>f.value=a),title:k.value,"align-center":"","destroy-on-close":"",width:"700px",draggable:"","close-on-click-modal":!1},{footer:t(()=>[_("span",J,[e(i,{disabled:s.value,type:"primary",onClick:l[9]||(l[9]=a=>$(S.value))},{default:t(()=>[c("保存")]),_:1},8,["disabled"]),e(i,{disabled:s.value,onClick:l[10]||(l[10]=a=>f.value=!1)},{default:t(()=>[c("关闭")]),_:1},8,["disabled"])])]),default:t(()=>[e(F,{model:o.value,ref_key:"ruleFormRef",ref:S,rules:q,"label-width":"80px"},{default:t(()=>[e(d,{label:"系统名称",prop:"name"},{default:t(()=>[e(p,{modelValue:o.value.name,"onUpdate:modelValue":l[3]||(l[3]=a=>o.value.name=a),clearable:""},null,8,["modelValue"])]),_:1}),e(d,{label:"系统标识",prop:"systemCode"},{default:t(()=>[e(p,{modelValue:o.value.systemCode,"onUpdate:modelValue":l[4]||(l[4]=a=>o.value.systemCode=a),clearable:""},null,8,["modelValue"])]),_:1}),e(d,{label:"调用KEY",prop:"systemKey"},{default:t(()=>[e(p,{modelValue:o.value.systemKey,"onUpdate:modelValue":l[5]||(l[5]=a=>o.value.systemKey=a),style:{width:"488px","margin-right":"12px"},clearable:""},null,8,["modelValue"]),e(i,{onClick:l[6]||(l[6]=a=>o.value.systemKey=O(n).createGuid().toUpperCase())},{default:t(()=>[c("更新")]),_:1})]),_:1}),e(d,{label:"备注",prop:"note"},{default:t(()=>[e(p,{modelValue:o.value.note,"onUpdate:modelValue":l[7]||(l[7]=a=>o.value.note=a)},null,8,["modelValue"])]),_:1}),e(d,{label:"排序",prop:"sort"},{default:t(()=>[e(T,{modelValue:o.value.sort,"onUpdate:modelValue":l[8]||(l[8]=a=>o.value.sort=a),step:5,min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{le as default};
