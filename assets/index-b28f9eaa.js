import{ai as y,aT as i,aF as ue,c as f,a as S,W as e,bD as t,aX as s,aY as de,o as p,U as m,bF as ne,H as L,I as z,F as se,aV as re,bi as x}from"./_@vue-5ba92de9.js";const ie={class:"roadui_page"},pe={style:{height:"calc(100% - 60px)",overflow:"auto"}},me={key:0},ce={key:1},ve={key:2},be={key:0},fe={key:1},_e={key:2},ge=S("span",null,"操作",-1),ye={class:"dialog-footer"},ke={__name:"index",setup(Ve){const w=y("ajax"),r=y("utils"),C=y("qs"),O=y("ElSelectorg"),P=y("ElSelectico"),F=y("ElCodemirror"),n=i(!1),T=i(!1),D=i([]),V=i({}),o=i({});let k=[];const B=i({prop:"sort",order:"ascending"}),E=i(r.getPager(B.value)),H=i([]),I=i(null),_=i(!1),q=i(""),W=i(!1),X={name:[{required:!0,message:"请输入名称",trigger:"blur"}],title:[{required:!0,message:"请输入显示标题",trigger:"blur"}],type:[{required:!0,message:"请选择类型",trigger:"change"}],datasourceType:[{required:!0,message:"请选择数据来源",trigger:"change"}],datasource:[{required:!0,message:"请输入来源",trigger:"blur"}]};ue(()=>{U()});const Y=d=>{k=d},U=()=>{T.value=!0,n.value=!0,w.post("/HomeSet/GetList",C.stringify(V.value)).then(d=>{D.value=d.data,n.value=!1,T.value=!1}).catch(()=>{n.value=!1})},M=d=>{H.value.length===0?r.getConns().then(l=>{H.value=l,j(d)}):j(d)},j=d=>{if(r.isUndef(d)||r.length(d.id)===0){o.value={id:r.emptyLong,sort:r.getArrayMax(D.value,"sort")+5},q.value="添加",_.value=!0;return}r.length(d.id)>0&&w.post("/HomeSet/Get?setid="+d.id).then(l=>{l.success?(o.value=l.data,q.value="编辑 - "+l.data.name,_.value=!0,N(l.data.type)):r.msg("获取数据失败！",!1)}).catch(()=>{})},N=d=>{},J=async d=>{d&&await d.validate(l=>{if(l){n.value=!0;const c=o.value.id||"";w.post("HomeSet/Save?setid="+c,C.stringify(o.value)).then(u=>{let v=u.msg;r.length(v)===0&&(v=u.success?"保存成功！":"保存失败！"),r.msg(v,u.success),n.value=!1,u.success&&(_.value=!1,U()),n.value=!1}).catch(()=>{n.value=!1})}})},K=()=>{if(k.length===0){r.msg("您没有选择要删除的首页设置！","error");return}r.confirm("您确定要删除所选首页设置吗？",()=>{n.value=!0,w.post("/HomeSet/Delete",C.stringify({ids:r.getArrayValues(k,"id").join(",")})).then(d=>{r.msg(d.success?"删除成功！":"删除失败！",d.success),n.value=!1,d.success&&(k=[],U())}).catch(()=>{n.value=!1})})};return(d,l)=>{const c=s("el-input"),u=s("el-form-item"),v=s("el-option"),Q=s("el-select"),g=s("el-button"),R=s("el-form"),b=s("el-table-column"),Z=s("el-table"),ee=s("el-scrollbar"),h=s("el-radio"),$=s("el-radio-group"),le=s("el-color-picker"),A=s("el-input-number"),G=s("el-tab-pane"),ae=s("el-tabs"),te=s("el-dialog"),oe=de("loading");return p(),f("div",ie,[S("div",null,[e(R,{inline:!0},{default:t(()=>[e(u,{label:"名称/标题"},{default:t(()=>[e(c,{modelValue:V.value.name,"onUpdate:modelValue":l[0]||(l[0]=a=>V.value.name=a),placeholder:"模块名称或标题",style:{width:"200px"},clearable:""},null,8,["modelValue"])]),_:1}),e(u,{label:"类型"},{default:t(()=>[e(Q,{modelValue:V.value.type,"onUpdate:modelValue":l[1]||(l[1]=a=>V.value.type=a),style:{width:"120px"},clearable:""},{default:t(()=>[e(v,{label:"顶部统计",value:"0"}),e(v,{label:"左边模块",value:"1"}),e(v,{label:"右边模块",value:"2"})]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:t(()=>[e(g,{type:"primary",disabled:n.value,onClick:U},{default:t(()=>[m("查询")]),_:1},8,["disabled"]),e(g,{type:"primary",disabled:n.value,onClick:l[2]||(l[2]=a=>M(null))},{default:t(()=>[m("添加")]),_:1},8,["disabled"]),e(g,{type:"danger",disabled:n.value,onClick:K},{default:t(()=>[m("删除")]),_:1},8,["disabled"])]),_:1})]),_:1})]),S("div",pe,[e(ee,null,{default:t(()=>[ne((p(),L(Z,{data:D.value,stripe:E.value.tableStripe,border:E.value.tableBorder,style:{width:"100%"},"highlight-current-row":E.value.tableHighlightCurrentRow,onSelectionChange:Y,"default-sort":B.value},{default:t(()=>[e(b,{type:"selection",width:"45"}),e(b,{prop:"name",width:"250",label:"名称",sortable:""}),e(b,{prop:"title",width:"250",label:"显示标题",sortable:""}),e(b,{prop:"type",width:"120",label:"类型",sortable:""},{default:t(a=>[a.row.type==0?(p(),f("span",me,"顶部统计")):a.row.type==1?(p(),f("span",ce,"左边模块")):a.row.type==2?(p(),f("span",ve,"右边模块")):z("",!0)]),_:1}),e(b,{prop:"dataSourceType",width:"150",label:"数据来源",sortable:""},{default:t(a=>[a.row.dataSourceType==0?(p(),f("span",be,"SQL")):a.row.dataSourceType==1?(p(),f("span",fe,"VUE组件")):(p(),f("span",_e))]),_:1}),e(b,{prop:"note",label:"备注",sortable:""}),e(b,{prop:"sort",label:"排序",width:"90",sortable:""}),e(b,{width:"100"},{header:t(()=>[ge]),default:t(a=>[e(g,{size:"small",disabled:n.value,type:"primary",onClick:he=>M(a.row)},{default:t(()=>[m("编辑")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[oe,T.value]])]),_:1})]),e(te,{modelValue:_.value,"onUpdate:modelValue":l[20]||(l[20]=a=>_.value=a),title:q.value,"destroy-on-close":"",width:"700px",draggable:"","close-on-click-modal":!1},{footer:t(()=>[S("span",ye,[e(g,{disabled:n.value,type:"primary",onClick:l[18]||(l[18]=a=>J(I.value))},{default:t(()=>[m("保存")]),_:1},8,["disabled"]),e(g,{disabled:n.value,onClick:l[19]||(l[19]=a=>_.value=!1)},{default:t(()=>[m("关闭")]),_:1},8,["disabled"])])]),default:t(()=>[e(R,{model:o.value,ref_key:"ruleFormRef",ref:I,rules:X,"label-width":"80px"},{default:t(()=>[e(ae,{style:{"margin-top":"-20px"}},{default:t(()=>[e(G,{name:"0",label:"常规"},{default:t(()=>[e(u,{label:"模块名称",prop:"name"},{default:t(()=>[e(c,{modelValue:o.value.name,"onUpdate:modelValue":l[3]||(l[3]=a=>o.value.name=a),style:{width:"241px","margin-right":"16px"},clearable:""},null,8,["modelValue"]),e(u,{label:"显示标题",prop:"title"},{default:t(()=>[e(c,{modelValue:o.value.title,"onUpdate:modelValue":l[4]||(l[4]=a=>o.value.title=a),style:{width:"242px"},clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{label:"模块类型",prop:"type"},{default:t(()=>[e($,{modelValue:o.value.type,"onUpdate:modelValue":l[5]||(l[5]=a=>o.value.type=a),onChange:N},{default:t(()=>[e(h,{label:0},{default:t(()=>[m("顶部统计")]),_:1}),e(h,{label:1},{default:t(()=>[m("左边模块")]),_:1}),e(h,{label:2},{default:t(()=>[m("右边模块")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"数据来源",prop:"datasourceType"},{default:t(()=>[e($,{modelValue:o.value.datasourceType,"onUpdate:modelValue":l[6]||(l[6]=a=>o.value.datasourceType=a),disabled:W.value},{default:t(()=>[e(h,{label:0},{default:t(()=>[m("SQL")]),_:1}),e(h,{label:1},{default:t(()=>[m("VUE组件")]),_:1})]),_:1},8,["modelValue","disabled"]),o.value.datasourceType=="0"?(p(),L(u,{key:0,label:"数据连接",prop:"connId",style:{"margin-left":"26px"}},{default:t(()=>[e(Q,{modelValue:o.value.connId,"onUpdate:modelValue":l[7]||(l[7]=a=>o.value.connId=a)},{default:t(()=>[(p(!0),f(se,null,re(H.value,a=>(p(),L(v,{key:a.id,label:a.title,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):z("",!0)]),_:1}),e(u,{label:"来源",prop:"datasource"},{default:t(()=>[e(c,{modelValue:o.value.datasource,"onUpdate:modelValue":l[8]||(l[8]=a=>o.value.datasource=a),placeholder:"SQL或VUE组件名称。当模块类型为左边模块或右边模块时，这里的SQL为图表数据来源。",type:"textarea",rows:5,clearable:""},null,8,["modelValue"])]),_:1}),e(u,{label:"使用对象",prop:"useMember"},{default:t(()=>[e(x(O),{modelValue:o.value.useMember,"onUpdate:modelValue":l[9]||(l[9]=a=>o.value.useMember=a),placeholder:"为空表示所有人可使用",clearable:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(u,{label:"链接地址",prop:"linkUrl"},{default:t(()=>[e(c,{modelValue:o.value.linkUrl,"onUpdate:modelValue":l[10]||(l[10]=a=>o.value.linkUrl=a),clearable:""},null,8,["modelValue"])]),_:1}),e(u,{label:"图标",prop:"icon"},{default:t(()=>[e(x(P),{modelValue:o.value.icon,"onUpdate:modelValue":l[11]||(l[11]=a=>o.value.icon=a),style:{width:"360px"},clearable:""},null,8,["modelValue"]),e(u,{label:"颜色",prop:"background"},{default:t(()=>[e(le,{modelValue:o.value.background,"onUpdate:modelValue":l[12]||(l[12]=a=>o.value.background=a)},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{label:"备注",prop:"note"},{default:t(()=>[e(c,{modelValue:o.value.note,"onUpdate:modelValue":l[13]||(l[13]=a=>o.value.note=a),style:{width:"360px"},clearable:""},null,8,["modelValue"]),e(u,{label:"排序",prop:"sort"},{default:t(()=>[e(A,{modelValue:o.value.sort,"onUpdate:modelValue":l[14]||(l[14]=a=>o.value.sort=a),style:{width:"139px"},step:5,min:0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(G,{name:"1",label:"图表"},{default:t(()=>[e(u,{label:"图表高度",prop:"sort"},{default:t(()=>[e(A,{modelValue:o.value.chartsHeight,"onUpdate:modelValue":l[15]||(l[15]=a=>o.value.chartsHeight=a),style:{width:"200px"},min:50,placeholder:"默认300"},null,8,["modelValue"])]),_:1}),e(u,{label:"图表选项",prop:"chart"},{default:t(()=>[e(x(F),{modelValue:o.value.charts,"onUpdate:modelValue":l[16]||(l[16]=a=>o.value.charts=a),style:{height:"247px"},placeholder:"",clearable:""},null,8,["modelValue"])]),_:1}),e(u,{label:"数据脚本",prop:"chart"},{default:t(()=>[e(x(F),{modelValue:o.value.chartsScripts,"onUpdate:modelValue":l[17]||(l[17]=a=>o.value.chartsScripts=a),style:{height:"150px"},placeholder:"替换图表选项中数据的脚本。",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{ke as default};
