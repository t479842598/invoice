import{d as K,ai as i,aT as l,aF as Z,bF as V,c as g,a as n,W as F,bD as j,au as ee,b9 as m,H as _,A as te,aX as w,aY as ae,aP as oe,aM as le,o as s,I as f,F as y,aV as q}from"./_@vue-5ba92de9.js";import{_ as ne}from"./index-823f4b27.js";import"./__vendor-5e6ac033.js";import"./_@element-plus-ad4c9002.js";import"./_crypto-js-0812dcff.js";import"./_element-plus-8c7ce171.js";import"./_@popperjs-c75af06c.js";import"./_pdfjs-dist-c04561eb.js";import"./_@microsoft-43c4e133.js";import"./_vue-codemirror-50da885a.js";const ie=u=>(oe("data-v-f2e462db"),u=u(),le(),u),re={class:"table-container"},se={class:"table-text"},ue={border:"0",class:"table"},ce={width:"65%",align:"center"},de={width:"17.5%"},pe={width:"17.5%"},ge=ie(()=>n("div",null,[n("h3",{class:"before"},"发票明细")],-1)),he={class:"table-container"},ve={class:"roadui_pagerdiv"},be=K({__name:"completeView",props:{query:{type:String,default:()=>""},modelValue:{type:Boolean,default:!1},id:{type:String,default:""}},emits:["update:id"],setup(u,{emit:H}){const x=i("ajax"),C=i("utils");i("config");const T=i("qs");i("index_openmenu"),i("index_removetab"),i("index_refreshtab"),i("index_userinfo");const k=l({prop:"goodsLineNo",order:"ascending"}),t=l(C.getPager(k.value)),S=l(!1),r=l(!1),z=l(0),c=l(0),d=l(0),h=l(""),M=H,R=u;function U(e){return te({get:()=>R[e],set:o=>{M(`update:${e}`,o)}})}const A=U("id");Z(async()=>{await G()});const P=l([]),D=l([]);async function G(){r.value=!0;try{const e=await x.post("/Invoice/Get",T.stringify({ids:A.value}));S.value=!0,e.data.invoicemain.length>0&&(h.value=e.data.invoicemain[0].id,P.value=e.data.invoicemain,z.value=e.data.invoicemain.length),c.value=0,d.value=0;for(let o=0;o<e.data.invoicemain.length;o++)c.value=Number((c.value+Number(e.data.invoicemain[o].invoiceTotalPriceTax)).toFixed(2)),d.value=Number((d.value+Number(e.data.invoicemain[o].invoiceTotalTax)).toFixed(2));e.success&&p()}catch{S.value=!1,r.value=!1}finally{r.value=!1}}const L=l([{prop:"serialNo",label:"开票流水号",align:"center"},{prop:"buyerName",label:"客户名称",align:"center"},{prop:"buyerTaxNo",label:"税号",align:"center"},{prop:"invoiceTotalPriceTax",label:"含税金额",align:"right",width:"110"},{prop:"invoiceTotalTax",label:"税额",align:"center"}]),$=l([{prop:"id",align:"center",show:!1},{prop:"goodsCode",label:"商品编号",show:!0,align:"center",width:"220"},{prop:"goodsName",label:"商品名称",show:!0,align:"center",width:"170"},{prop:"goodsSpecification",label:"规格型号",show:!0,align:"center",width:"180"},{prop:"goodsUnit",label:"单位",show:!0,align:"center",width:"100"},{prop:"goodsQuantity",label:"数量",show:!0,align:"center",width:"120"},{prop:"goodsPrice",label:"单价",show:!0,align:"center",width:"120"},{prop:"goodsTotalPrice",label:"价税合计",show:!0,align:"right",width:"120"},{prop:"notaxamount",label:"无税金额",show:!0,align:"right",width:"120"},{prop:"goodsTaxRate",label:"税率/征收率",show:!0,align:"center",width:"150"},{prop:"goodsTotalTax",label:"税额",show:!0,align:"center"}]),E=(e,o)=>{e!=null&&(h.value=e.id,t.value.number=1,p())},N=l({}),p=async()=>{r.value=!0,N.value={id:h.value,size:t.value.size,number:t.value.number,order:t.value.order};try{const e=await x.post("/Invoice/GetInvoiceDetailMain",T.stringify(N.value));D.value=e.data.rows,t.value.total=e.data.total}catch(e){C.msg(e.message,"error",!1)}finally{r.value=!1}},O=e=>{t.value.size=e,p()},Q=e=>{t.value.number=e,p()};function I({row:e,column:o,rowIndex:v,columnIndex:b}){return{color:"#000",textAlign:"center"}}function W({row:e}){if(e.goodsTotalPrice===0)return{backgroundColor:"yellow"}}function X({row:e}){if(e.isedit==1)return{backgroundColor:"#ec5353"}}return(e,o)=>{const v=w("el-table-column"),b=w("el-table"),Y=w("el-pagination"),B=ae("loading");return V((s(),g("div",null,[n("div",re,[F(b,ee({data:P.value,stripe:t.value.tableStripe,border:"","highlight-current-row":t.value.tableHighlightCurrentRow,style:{width:"100%","max-height":"30vh",color:"#000"},"header-cell-style":I},e.$attrs,{onCurrentChange:E,"row-style":X}),{default:j(()=>[f("",!0),f("",!0),(s(!0),g(y,null,q(L.value,(a,J)=>(s(),_(v,{key:J,prop:a.prop,label:a.label,align:a.align,width:a.width},null,8,["prop","label","align","width"]))),128))]),_:1},16,["data","stripe","highlight-current-row"])]),n("div",se,[n("table",ue,[n("tr",null,[n("td",ce," 发票张数："+m(z.value)+"张 ",1),n("td",de," 价税合计："+m(c.value)+"元 ",1),n("td",pe," 合计税额："+m(d.value)+"元 ",1)])])]),ge,n("div",he,[V((s(),_(b,{data:D.value,stripe:t.value.tableStripe,border:"","highlight-current-row":t.value.tableHighlightCurrentRow,style:{width:"100%",height:"30vh",color:"#000"},"header-cell-style":I,"default-sort":k.value,"row-style":W},{default:j(()=>[(s(!0),g(y,null,q($.value,a=>(s(),g(y,null,[a.show?(s(),_(v,{key:0,prop:a.prop,label:a.label,align:a.align,width:a.width},null,8,["prop","label","align","width"])):f("",!0)],64))),256))]),_:1},8,["data","stripe","highlight-current-row","default-sort"])),[[B,r.value]])]),n("div",ve,[F(Y,{currentPage:t.value.number,"onUpdate:currentPage":o[0]||(o[0]=a=>t.value.number=a),"page-size":t.value.size,"onUpdate:pageSize":o[1]||(o[1]=a=>t.value.size=a),"page-sizes":t.value.sizes,background:t.value.background,layout:t.value.layout,total:t.value.total,onSizeChange:O,onCurrentChange:Q},null,8,["currentPage","page-size","page-sizes","background","layout","total"])])])),[[B,r.value]])}}});const ze=ne(be,[["__scopeId","data-v-f2e462db"]]);export{ze as default};
