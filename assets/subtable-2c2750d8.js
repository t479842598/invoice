import{ai as L,aT as p,aF as re,b5 as me,c as y,a as n,W as a,bD as o,aN as ce,aX as _,o as c,F as U,aV as C,H as T,b9 as g,bi as h,U as V,aZ as pe,bF as ve,bv as be}from"./_@vue-5ba92de9.js";import _e from"./texts-136964a0.js";import fe from"./textareas-0ea6438a.js";import ge from"./number-cc626f02.js";import he from"./selects-a233c0c7.js";import ye from"./cascader-54a87232.js";import Ve from"./selectdiv-c421004c.js";import we from"./radio-780e80dc.js";import xe from"./checkbox-52cba1ac.js";import ke from"./switchs-3bbbed72.js";import Ue from"./datetime-d68dcdf1.js";import Ce from"./dictionary-1ae3ce11.js";import $e from"./organize-2be42744.js";import Te from"./appraise-fc6896cb.js";import Se from"./files-4c804275.js";import De from"./labels-bbb2aae3.js";import Ee from"./hidden-9f9d22c7.js";import"./form-design-8c117009.js";import"./index-823f4b27.js";import"./__vendor-5e6ac033.js";import"./_@element-plus-ad4c9002.js";import"./_crypto-js-0812dcff.js";import"./_element-plus-8c7ce171.js";import"./_@popperjs-c75af06c.js";import"./_pdfjs-dist-c04561eb.js";import"./_@microsoft-43c4e133.js";import"./_vue-codemirror-50da885a.js";import"./_jquery-3a83ed9f.js";const Ae={style:{height:"100%"}},Ne={class:"roadui_formtable",style:{width:"98%",margin:"0 auto"}},ze=n("th",{style:{width:"60px"}},"子表",-1),Fe={class:"roadui_note1"},Oe=n("th",{style:{width:"60px","padding-left":"12px"}},"子表主键",-1),Be={class:"roadui_note1"},Je=n("th",{style:{width:"60px","padding-left":"12px"}},"主表字段",-1),Re={class:"roadui_note1"},je=n("th",{style:{width:"60px","padding-left":"12px"}},"关联字段",-1),Ke={class:"roadui_note1"},qe=n("th",null,"标签",-1),He={style:{"margin-left":"10px"}},Le={style:{"margin-left":"10px"}},Ie=n("th",{style:{"padding-left":"12px"}},"表格大小",-1),Me=n("th",{style:{"padding-left":"12px"}},"表格宽度",-1),Ge=n("span",{style:{margin:"0 12px"}},"高度",-1),Pe=n("th",{style:{"padding-left":"12px"}},"子表id",-1),Qe={class:"roadui_note1"},We={class:"roadui_formtable",style:{width:"98%",margin:"0 auto"}},Xe=n("th",{style:{width:"50px"}},"事件",-1),Ze=n("th",null,"脚本",-1),$l={__name:"subtable",props:{query:{type:String,default:()=>""}},setup(I){const u=L("utils"),M=I,G=u.query("editorname",M.query),k=window.parent.CKEDITOR.instances[G],r=p([]),z=p([]),F=p([]),S=p([]),$=p({}),t=p({}),O=p(400),B=[{value:"texts",label:"输入框"},{value:"textareas",label:"文本域"},{value:"number",label:"数字输入框"},{value:"selects",label:"下拉选择"},{value:"cascader",label:"级联选择"},{value:"selectdiv",label:"弹出选择"},{value:"radio",label:"单选按钮"},{value:"checkbox",label:"复选按钮"},{value:"switchs",label:"开关"},{value:"datetime",label:"日期时间"},{value:"dictionary",label:"数据字典"},{value:"organize",label:"组织架构"},{value:"appraise",label:"评分"},{value:"files",label:"附件"},{value:"labels",label:"标签Label"},{value:"hidden",label:"隐藏域"}];re(()=>{P(),J()});const P=()=>{O.value=document.body.clientHeight-118},J=s=>{if(!u.isUndef(k)){if($.value=k.formAttributeJSON,u.length($.value.dbConn)>0&&u.getConnTables($.value.dbConn).then(l=>{z.value=l,u.length($.value.dbTable)>0&&Q($.value.dbTable)}),s||(s=k.currentSelectEditorElement),s||(t.value={id:"subtable_"+new Date().getTime(),columns:[]},k.formSubtabsJSON.push(t.value),r.value=t.value.columns),s){const l=s.getAttribute("data-id");t.value=u.getArrayObj(k.formSubtabsJSON,l,"id"),u.isUndef(t.value)&&(t.value={id:"subtable_"+new Date().getTime(),columns:[]},k.formSubtabsJSON.push(t.value)),r.value=u.isArray(t.value.columns)?t.value.columns:[],u.length(t.value.table)>0&&R(t.value.table),u.hasKey(t.value,"events")||(t.value.events=[{value:"addRow",title:"添加行",script:""},{value:"deleteRow",title:"删除行",script:""},{value:"summaries",title:"求和",script:""}])}k.currentSelectEditorElementJson=t.value,k.initFunction_subtable=J}},Q=s=>{u.getConnTableFields($.value.dbConn,s).then(l=>{F.value=l})},R=s=>{u.getConnTableFields($.value.dbConn,s).then(l=>{S.value=l})},W=()=>{const s={key:u.createGuid(!1),field:"",name:"",align:"left",width:"",edit:{type:"texts",title:"输入框",set:{events:[{name:"change",script:""}]}},sum:!1};r.value.push(s)},X=s=>{u.removeArrayObj(r.value,s.key,"key")},Z=s=>{u.length(s.name)===0&&(s.name=s.field)},D=p(!1),j=p("设置子表控件"),E=me(null),Y=p(""),v=p({type:"texts",title:"输入框",set:{}});ce("setEditRecord",v);const K={edit_texts:_e,edit_textareas:fe,edit_number:ge,edit_selects:he,edit_cascader:ye,edit_selectdiv:Ve,edit_radio:we,edit_checkbox:xe,edit_switchs:ke,edit_datetime:Ue,edit_dictionary:Ce,edit_organize:$e,edit_appraise:Te,edit_files:Se,edit_labels:De,edit_hidden:Ee},ee=s=>{v.value=s.edit,j.value=s.name,E.value=K["edit_"+(v.value.type||"texts")],D.value=!0},le=s=>{const l=u.getArrayObj(B,s,"value");if(!u.isUndef(l)){switch(v.value.type=s,v.value.title=l.label,v.value.set={},s){case"texts":case"textareas":case"number":case"selects":case"cascader":case"radio":case"checkbox":case"datetime":case"dictionary":case"organize":case"appraise":case"selectdiv":case"files":var d=[{name:"change",script:""}];for(let m=0;m<d.length;m++){var b=u.getArrayObj(v.value.set.events,d[m].name,"name");u.isDef(b)&&(d[m].script=b.script)}v.value.set.events=d;break;case"switchs":var f=[{name:"change",script:""},{name:"click",script:""}];for(let m=0;m<f.length;m++){var w=u.getArrayObj(v.value.set.events,f[m].name,"name");u.isDef(w)&&(f[m].script=w.script)}v.value.set.events=f;break}E.value=K["edit_"+s]}},ae=s=>{if(r.value.length<=1)return;let l=-1;for(let d=0;d<r.value.length;d++)if(r.value[d].key===s.key){l=d;break}l!=0?r.value[l]=r.value.splice(l-1,1,r.value[l])[0]:r.value.push(r.value.shift())},te=s=>{if(r.value.length<=1)return;let l=-1;for(let d=0;d<r.value.length;d++)if(r.value[d].key===s.key){l=d;break}l!=r.value.length-1?r.value[l]=r.value.splice(l+1,1,r.value[l])[0]:r.value.unshift(r.value.splice(l,1)[0])},oe=L("ElCodemirror"),A=p(!1),N=p("addRow"),ne=()=>{A.value=!0};return(s,l)=>{const d=_("el-option"),b=_("el-select"),f=_("el-input"),w=_("el-checkbox"),m=_("el-button"),x=_("el-table-column"),ue=_("ArrowUpBold"),q=_("el-icon"),se=_("ArrowDownBold"),de=_("el-button-group"),ie=_("el-table"),H=_("el-dialog");return c(),y("div",Ae,[n("table",Ne,[n("tr",null,[ze,n("td",null,[a(b,{modelValue:t.value.table,"onUpdate:modelValue":l[0]||(l[0]=e=>t.value.table=e),onChange:R,filterable:"",clearable:""},{default:o(()=>[(c(!0),y(U,null,C(z.value,e=>(c(),T(d,{key:e.key,value:e.key,label:e.key+(h(u).length(e.label)>0?" - "+e.label:"")},{default:o(()=>[n("span",null,g(e.key),1),n("span",Fe,g(h(u).length(e.label)>0?" - "+e.label:""),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),Oe,n("td",null,[a(b,{modelValue:t.value.primaryKey,"onUpdate:modelValue":l[1]||(l[1]=e=>t.value.primaryKey=e),filterable:"",clearable:""},{default:o(()=>[(c(!0),y(U,null,C(S.value,e=>(c(),T(d,{key:e.name,value:e.name,label:e.name+(h(u).length(e.comment)>0?" - "+e.comment:"")},{default:o(()=>[n("span",null,g(e.name),1),n("span",Be,g(h(u).length(e.comment)>0?" - "+e.comment:""),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),Je,n("td",null,[a(b,{modelValue:t.value.primaryTableKey,"onUpdate:modelValue":l[2]||(l[2]=e=>t.value.primaryTableKey=e),filterable:"",clearable:""},{default:o(()=>[(c(!0),y(U,null,C(F.value,e=>(c(),T(d,{key:e.name,value:e.name,label:e.name+(h(u).length(e.comment)>0?" - "+e.comment:"")},{default:o(()=>[n("span",null,g(e.name),1),n("span",Re,g(h(u).length(e.comment)>0?" - "+e.comment:""),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),je,n("td",null,[a(b,{modelValue:t.value.linkField,"onUpdate:modelValue":l[3]||(l[3]=e=>t.value.linkField=e),filterable:"",clearable:""},{default:o(()=>[(c(!0),y(U,null,C(S.value,e=>(c(),T(d,{key:e.name,value:e.name,label:e.name+(h(u).length(e.comment)>0?" - "+e.comment:"")},{default:o(()=>[n("span",null,g(e.name),1),n("span",Ke,g(h(u).length(e.comment)>0?" - "+e.comment:""),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])])]),n("tr",null,[qe,n("td",null,[a(f,{modelValue:t.value.label,"onUpdate:modelValue":l[4]||(l[4]=e=>t.value.label=e),clearable:"",style:{width:"75px"}},null,8,["modelValue"]),n("span",He,[a(w,{modelValue:t.value.rowNumber,"onUpdate:modelValue":l[5]||(l[5]=e=>t.value.rowNumber=e),style:{"vertical-align":"middle"}},{default:o(()=>[V("序号")]),_:1},8,["modelValue"])]),n("span",Le,[a(m,{type:"primary",text:"",bg:"",onClick:l[6]||(l[6]=e=>ne())},{default:o(()=>[V("事件")]),_:1})])]),Ie,n("td",null,[a(b,{modelValue:t.value.size,"onUpdate:modelValue":l[7]||(l[7]=e=>t.value.size=e),clearable:"",style:{width:"72px","vertical-align":"2px"},placeholder:"size"},{default:o(()=>[a(d,{value:"default",label:"默认"}),a(d,{value:"large",label:"大"}),a(d,{value:"small",label:"小"})]),_:1},8,["modelValue"]),a(w,{modelValue:t.value.bordered,"onUpdate:modelValue":l[8]||(l[8]=e=>t.value.bordered=e),style:{margin:"0 0 0 10px"}},{default:o(()=>[V("边框")]),_:1},8,["modelValue"]),a(w,{modelValue:t.value.stripe,"onUpdate:modelValue":l[9]||(l[9]=e=>t.value.stripe=e),style:{"margin-left":"10px"}},{default:o(()=>[V("斑马纹")]),_:1},8,["modelValue"])]),Me,n("td",null,[a(f,{modelValue:t.value.width,"onUpdate:modelValue":l[10]||(l[10]=e=>t.value.width=e),clearable:"",style:{width:"76px"},placeholder:"px或%"},null,8,["modelValue"]),Ge,a(f,{modelValue:t.value.height,"onUpdate:modelValue":l[11]||(l[11]=e=>t.value.height=e),clearable:"",style:{width:"76px"},placeholder:"数字"},null,8,["modelValue"])]),Pe,n("td",null,[a(f,{modelValue:t.value.id,"onUpdate:modelValue":l[12]||(l[12]=e=>t.value.id=e),clearable:"",style:{width:"140px"}},null,8,["modelValue"]),a(w,{modelValue:t.value.pager,"onUpdate:modelValue":l[13]||(l[13]=e=>t.value.pager=e),style:{"margin-left":"10px","vertical-align":"middle"}},{default:o(()=>[V("分页")]),_:1},8,["modelValue"])])])]),n("div",null,[a(ie,{data:r.value,stripe:"",style:{width:"100%"},height:O.value},{default:o(()=>[a(x,{prop:"field",label:"字段"},{default:o(e=>[a(b,{modelValue:e.row.field,"onUpdate:modelValue":i=>e.row.field=i,onChange:i=>Z(e.row),clearable:"",style:{width:"100%"}},{default:o(()=>[(c(!0),y(U,null,C(S.value,i=>(c(),T(d,{key:i.name,value:i.name,label:i.name+(h(u).length(i.comment)>0?" - "+i.comment:"")},{default:o(()=>[n("span",null,g(i.name),1),n("span",Qe,g(h(u).length(i.comment)>0?" - "+i.comment:""),1)]),_:2},1032,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(x,{prop:"name",label:"显示标题",width:"200"},{default:o(e=>[a(f,{modelValue:e.row.name,"onUpdate:modelValue":i=>e.row.name=i,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(x,{prop:"align",label:"对齐",width:"120"},{default:o(e=>[a(b,{modelValue:e.row.align,"onUpdate:modelValue":i=>e.row.align=i,clearable:""},{default:o(()=>[a(d,{value:"left",label:"左对齐"}),a(d,{value:"center",label:"居中"}),a(d,{value:"right",label:"右对齐"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),a(x,{prop:"width",label:"宽度",width:"100"},{default:o(e=>[a(f,{modelValue:e.row.width,"onUpdate:modelValue":i=>e.row.width=i,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(x,{prop:"editMode",label:"编辑控件",width:"160"},{default:o(e=>[a(m,{onClick:i=>ee(e.row)},{default:o(()=>[V(g(e.row.edit.title||"输入框"),1)]),_:2},1032,["onClick"])]),_:1}),a(x,{prop:"sum",label:"合计",width:"60",align:"center"},{default:o(e=>[a(w,{modelValue:e.row.sum,"onUpdate:modelValue":i=>e.row.sum=i},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(x,{prop:"order",label:"排序",width:"60",align:"center"},{default:o(e=>[a(w,{modelValue:e.row.order,"onUpdate:modelValue":i=>e.row.order=i},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(x,{prop:"sort",label:"显示顺序",width:"110"},{default:o(e=>[a(de,null,{default:o(()=>[a(m,{size:"small",onClick:i=>ae(e.row)},{default:o(()=>[a(q,null,{default:o(()=>[a(ue)]),_:1})]),_:2},1032,["onClick"]),a(m,{size:"small",onClick:i=>te(e.row)},{default:o(()=>[a(q,null,{default:o(()=>[a(se)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:1}),a(x,{width:"80"},{header:o(()=>[a(m,{size:"small",type:"primary",onClick:W},{default:o(()=>[V("添加")]),_:1})]),default:o(e=>[a(m,{size:"small",type:"primary",onClick:i=>X(e.row)},{default:o(()=>[V("移出")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","height"])]),a(H,{modelValue:D.value,"onUpdate:modelValue":l[16]||(l[16]=e=>D.value=e),title:j.value,"align-center":"","destroy-on-close":"",width:"96%",class:"el-dialog_formdesign_subtable_margin","close-on-click-modal":!1},{default:o(()=>[V(" 控件类型 "),a(b,{style:{width:"200px",margin:"0 0 0 12px"},onChange:le,modelValue:v.value.type,"onUpdate:modelValue":l[14]||(l[14]=e=>v.value.type=e)},{default:o(()=>[(c(),y(U,null,C(B,e=>a(d,{value:e.value,label:e.label,key:e.value},null,8,["value","label"])),64))]),_:1},8,["modelValue"]),a(m,{style:{"margin-left":"12px"},onClick:l[15]||(l[15]=e=>D.value=!1)},{default:o(()=>[V("关闭")]),_:1}),(c(),T(pe(E.value),{query:Y.value},null,8,["query"]))]),_:1},8,["modelValue","title"]),a(H,{modelValue:A.value,"onUpdate:modelValue":l[18]||(l[18]=e=>A.value=e),title:"事件","align-center":"","destroy-on-close":"",width:"96%",class:"el-dialog_formdesign_subtable_margin","close-on-click-modal":!1},{default:o(()=>[n("table",We,[n("tr",null,[Xe,n("td",null,[a(b,{modelValue:N.value,"onUpdate:modelValue":l[17]||(l[17]=e=>N.value=e)},{default:o(()=>[(c(!0),y(U,null,C(t.value.events,e=>(c(),T(d,{key:e.value,value:e.value,label:e.title},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),n("tr",null,[Ze,n("td",null,[(c(!0),y(U,null,C(t.value.events,e=>ve((c(),y("div",{key:"script_"+e.value},[a(h(oe),{modelValue:e.script,"onUpdate:modelValue":i=>e.script=i,height:"340px",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])])),[[be,N.value==e.value]])),128))])])])]),_:1},8,["modelValue"])])}}};export{$l as default};
