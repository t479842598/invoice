import{C as j,b}from"./index-823f4b27.js";import{ai as n,aT as d,aF as w,Y as h,c as q,H as E,aZ as x,o as g}from"./_@vue-5ba92de9.js";import"./__vendor-5e6ac033.js";import"./_@element-plus-ad4c9002.js";import"./_crypto-js-0812dcff.js";import"./_element-plus-8c7ce171.js";import"./_@popperjs-c75af06c.js";import"./_pdfjs-dist-c04561eb.js";import"./_@microsoft-43c4e133.js";import"./_vue-codemirror-50da885a.js";const V={__name:"preview",props:{query:{type:String,default:()=>""}},setup(S){const v=n("ajax"),t=n("utils"),O=n("qs"),N=n("app"),y=S,i=d(null),a=d("");w(()=>{l()});const l=()=>{const m=t.query("editorname",y.query),e=window.parent.CKEDITOR.instances[m];if(!t.isUndef(e)&&(e.initFunction_preview=l,!(e.roaduiTools.isNew&&t.length(e.formAttributeJSON.id)<=0))){var o=e.formAttributeJSON,u=e.formEventsJSON,p=e.formSubtabsJSON,f=e.getData(),J=e.designjs.compile(f,o,u,p);if(e.designjs.formCompileErrMsg.length>0){for(var s=0;s<e.designjs.formCompileErrMsg.length;s++)t.msg(e.designjs.formCompileErrMsg[s],!1);return}v.post("/Form/Save?1=1"+e.iframeQueryString,O.stringify({attJSON:JSON.stringify(o),eventJSON:JSON.stringify(u),subtableJSON:JSON.stringify(p),defaultValueJSON:JSON.stringify(e.designjs.formDefaultValues),selectOptionsJSON:JSON.stringify(e.designjs.formSelectOptions),fieldsJSON:JSON.stringify(e.designjs.formFields),html:f,runHtml:J})).then(function(c){if(c.success){o.id=c.data;const r="form_preview_"+t.createGuid(!1);a.value="?flowid=100000000000000&formid="+o.id+"&ispreview=1";var C="./roadui-pages/flow/run/index.vue";const _=h({loader:t.systemModules[C],loadingComponent:j,delay:200,errorComponent:b});N.component(r,_),i.value=r}else{let r="保存表单失败！";t.msg(r,!1)}})}};return(m,e)=>(g(),q("div",null,[(g(),E(x(i.value),{query:a.value},null,8,["query"]))]))}};export{V as default};
