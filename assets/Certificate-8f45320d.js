import{_ as be}from"./index-823f4b27.js";import{ai as m,aT as c,aF as _e,c as L,a as r,b9 as he,W as e,bD as o,bF as ye,H as W,A as we,aX as d,aY as Ce,o as B,F as xe,aV as Ve,U as v,I as ke,aP as Se,aM as qe}from"./_@vue-5ba92de9.js";import{E as Ne,a as De}from"./_element-plus-8c7ce171.js";import"./__vendor-5e6ac033.js";import"./_@element-plus-ad4c9002.js";import"./_crypto-js-0812dcff.js";import"./_pdfjs-dist-c04561eb.js";import"./_@microsoft-43c4e133.js";import"./_vue-codemirror-50da885a.js";import"./_@popperjs-c75af06c.js";const k=C=>(Se("data-v-bdffa0d6"),C=C(),qe(),C),Ue={border:"0",cellpadding:"1",cellspacing:"1",style:{"border-color":"#eee","border-width":"1px",color:"#000",width:"100%","margin-bottom":"0"},class:"table"},je={align:"left"},$e={border:"0",cellpadding:"1",cellspacing:"1",style:{"border-color":"#eee","border-width":"1px",color:"#000",width:"100%","margin-bottom":"0"},class:"table"},Ae={style:{"padding-left":"25px"}},Be={style:{"margin-top":"10px"}},Te=k(()=>r("td",{align:"right"}," 制单人： ",-1)),Fe=k(()=>r("td",{align:"right"}," 凭证日期： ",-1)),Ie=k(()=>r("td",{align:"right"}," 凭证类别： ",-1)),ze=k(()=>r("td",{align:"right"}," 单据张数： ",-1)),Ee={style:{"margin-top":"10px"}},Me=k(()=>r("td",{align:"right"},null,-1)),Oe={align:"right"},Pe={__name:"Certificate",props:{query:{type:String,default:()=>""},modelValue:{type:Boolean,default:!1},id:{type:String,default:""},serino:{type:String,default:""},billcodes:{type:String,default:""}},emits:["update:id","update:serino","update:billcodes","update:modelValue"],setup(C,{emit:X}){const x=m("ajax"),b=m("utils"),V=m("qs");m("config"),m("index_openmenu"),m("index_removetab");const Q=m("index_refreshtab");m("index_dialogshow"),m("index_regcomponent");const Z=m("index_userinfo"),S=c({prop:"",order:"ascending"}),_=c(b.getPager(S.value)),T=c(!1),q=c(!1),N=c(!1),D=c(!1),U=c(!1),j=c(""),ee=X,le=C;function F(t){return we({get:()=>le[t],set:l=>{ee(`update:${t}`,l)}})}const O=F("id"),te=F("serino"),ae=F("billcodes");_e(()=>{ie(),oe(),n.value.makername=Z.value.userName,n.value.serino=te.value,n.value.invoiceids=O.value,n.value.billcodes=ae.value});const n=c({serino:"",makername:"",billdate:b.getNowFormatDate(),isignseq:"",pagecount:"",isignseq:"",csign:""}),h=c({code:"",name:"",databasetype:"T3"}),y=c({code:"",name:"",databasetype:"T3"}),I=c([]),oe=async()=>{try{const t=await x.post("Accouch/GetSign",V.stringify({databasetype:"T3"}));t.success&&(I.value=t.data.Sign)}catch{}},ne=async()=>{if(n.value.serino==""){b.confirm("请输入开票流水号");return}if(n.value.makername==""){b.confirm("请输入制单人");return}if(n.value.isignseq==""){b.confirm("请选择凭证类别");return}if(n.value.pagecount==""){b.confirm("请输入单据张数");return}try{const t=await x.post("Accouch/CreateT3Vouch",V.stringify({isignseq:n.value.isignseq,pagecount:n.value.pagecount,csign:n.value.csign,billdate:n.value.billdate,invoiceids:n.value.invoiceids,billcodes:n.value.billcodes,accvouchJSON:JSON.stringify(g.value)}));t.success?(Ne.success(t.msg),Q()):De.alert(t.msg,"提示",{confirmButtonText:"OK",type:"error",callback:l=>{}})}catch{}};function se(t){let l=I.value.find(u=>u.isignseq===t);l&&(n.value.isignseq=l.isignseq,n.value.csign=l.csign)}const g=c([]),P=c([]),Y=c([]),ie=async()=>{T.value=!0;try{const t=await x.post("Accouch/GetAccvouchT3",V.stringify({ids:O.value}));g.value=t.data.Accvouch,n.value.isignseq=t.data.main.isignseq,n.value.csign=t.data.main.csign,n.value.pagecount=t.data.main.pagecount}catch{}finally{T.value=!1}},re=t=>{const{columns:l,data:u}=t,i=[],E=["md","mc"];return l.forEach(($,f)=>{if(f===0){i[f]="合计";return}if(E.includes($.property)){const p=u.map(s=>Number(s[$.property]));p.every(s=>Number.isNaN(s))?i[f]="":i[f]=` ${p.reduce((s,w)=>{const A=Number(w);return Number.isNaN(A)?Number(s):Number(s)+Number(w)},0).toFixed(2)}`}else i[f]=""}),i},ue=t=>{j.value=t.id,D.value=!0},ce=t=>{g.value.forEach((l,u)=>{l.id==j.value&&(g.value[u].projectcode=t.ccode,g.value[u].projectname=t.ccode_name)}),D.value=!1},de=t=>{j.value=t.id,U.value=!0},pe=t=>{g.value.forEach((l,u)=>{l.id==j.value&&(g.value[u].customercode=t.cCusCode,g.value[u].customername=t.cCusName)}),U.value=!1},me=()=>{G()},ge=()=>{H()};async function G(){try{const t=await x.post("/Accouch/GetProject",V.stringify(h.value));P.value=t.data.U8Project}catch{}finally{}}async function H(){try{const t=await x.post("/Accouch/GetCustomer",V.stringify(y.value));Y.value=t.data.U8Customer}catch{}finally{}}const fe=t=>{selectrow.value=t};function z({row:t,column:l,rowIndex:u,columnIndex:i}){return{color:"#000",textAlign:"center"}}return(t,l)=>{const u=d("el-input"),i=d("el-form-item"),E=d("el-date-picker"),$=d("el-option"),f=d("el-select"),p=d("el-button"),s=d("el-table-column"),w=d("el-table"),A=d("FullScreen"),R=d("el-icon"),J=d("el-form"),K=d("el-dialog"),ve=Ce("loading");return B(),L("div",null,[r("table",Ue,[r("tbody",null,[r("tr",null,[r("td",je," 开票流水号： "+he(n.value.serino),1)])])]),r("table",$e,[r("tbody",Ae,[r("tr",Be,[Te,r("td",null,[e(i,{prop:"makername"},{default:o(()=>[e(u,{modelValue:n.value.makername,"onUpdate:modelValue":l[0]||(l[0]=a=>n.value.makername=a)},null,8,["modelValue"])]),_:1})]),Fe,r("td",null,[e(i,{prop:"billdate"},{default:o(()=>[e(E,{modelValue:n.value.billdate,"onUpdate:modelValue":l[1]||(l[1]=a=>n.value.billdate=a),"value-format":"YYYY-MM-DD",type:"date"},null,8,["modelValue"])]),_:1})]),Ie,r("td",null,[e(i,{prop:"isignseq"},{default:o(()=>[e(f,{modelValue:n.value.isignseq,"onUpdate:modelValue":l[2]||(l[2]=a=>n.value.isignseq=a),clearable:"",onChange:se,placeholder:"请选择"},{default:o(()=>[(B(!0),L(xe,null,Ve(I.value,a=>(B(),W($,{key:a.isignseq,label:a.csign,value:a.isignseq},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),ze,r("td",null,[e(i,{prop:"pagecount"},{default:o(()=>[e(u,{modelValue:n.value.pagecount,"onUpdate:modelValue":l[3]||(l[3]=a=>n.value.pagecount=a)},null,8,["modelValue"])]),_:1})])]),r("tr",Ee,[Me,r("td",Oe,[e(i,null,{default:o(()=>[e(p,{type:"primary",onClick:ne},{default:o(()=>[v("生成凭证")]),_:1})]),_:1})])])])]),ye((B(),W(w,{class:"eltable",data:g.value,"summary-method":re,"show-summary":"",stripe:_.value.tableStripe,border:"","highlight-current-row":_.value.tableHighlightCurrentRow,"max-height":"500",style:{width:"100%",color:"#000","margin-top":"10px"},"header-cell-style":z,"default-sort":S.value,onSelectionChange:fe,"row-style":t.changRed},{default:o(()=>[e(s,{prop:"projectcode",align:"center",label:"会计科目编号",width:"120"}),e(s,{prop:"projectname",align:"center",label:"会计科目名称",width:"230"}),e(s,{label:"操作",align:"center",width:"100"},{default:o(a=>[e(p,{type:"primary",size:"small",onClick:M=>ue(a.row)},{default:o(()=>[v("选择科目")]),_:2},1032,["onClick"])]),_:1}),e(s,{prop:"md",label:"借方金额",align:"right",width:"150"}),e(s,{prop:"mc",label:"贷方金额",align:"right",width:"150"}),e(s,{prop:"cdigest",label:"摘要",fit:"","show-overflow-tooltip":"","min-width":"75%"}),e(s,{label:"辅助核算",width:"600"},{default:o(()=>[ke("",!0),e(s,{prop:"customername",label:"客户",fit:"","show-overflow-tooltip":""}),e(s,{align:"center",label:"选择客户",width:"100"},{default:o(a=>[e(p,{type:"primary",size:"small",onClick:M=>de(a.row)},{default:o(()=>[v("选择客户")]),_:2},1032,["onClick"])]),_:1})]),_:1})]),_:1},8,["data","stripe","highlight-current-row","default-sort","row-style"])),[[ve,T.value]]),e(K,{modelValue:D.value,"onUpdate:modelValue":l[8]||(l[8]=a=>D.value=a),title:"选择科目",onOpen:me,fullscreen:q.value,onClose:l[9]||(l[9]=a=>q.value=!1),"align-center":"","destroy-on-close":"",width:"800px",draggable:"","close-on-click-modal":!1},{default:o(()=>[e(R,{onClick:l[4]||(l[4]=a=>q.value=!q.value),style:{position:"absolute",right:"45px",top:"24px",cursor:"pointer","font-size":"14px"}},{default:o(()=>[e(A)]),_:1}),e(J,{inline:!0,model:h.value},{default:o(()=>[e(i,{label:"科目编号",prop:"code",style:{"margin-left":"20px"}},{default:o(()=>[e(u,{modelValue:h.value.code,"onUpdate:modelValue":l[5]||(l[5]=a=>h.value.code=a),clearable:"",placeholder:"请输入会计科目编号"},null,8,["modelValue"])]),_:1}),e(i,{label:"科目名称",prop:"name",style:{"margin-left":"20px"}},{default:o(()=>[e(u,{modelValue:h.value.name,"onUpdate:modelValue":l[6]||(l[6]=a=>h.value.name=a),clearable:"",placeholder:"请输入会计科目名称"},null,8,["modelValue"])]),_:1}),e(i,{style:{"margin-left":"20px"}},{default:o(()=>[e(p,{type:"primary",onClick:l[7]||(l[7]=a=>G())},{default:o(()=>[v("查询")]),_:1})]),_:1})]),_:1},8,["model"]),e(w,{class:"eltable",data:P.value,stripe:_.value.tableStripe,border:"","highlight-current-row":_.value.tableHighlightCurrentRow,"max-height":"500",style:{width:"100%",color:"#000","margin-top":"10px"},"header-cell-style":z,"default-sort":S.value},{default:o(()=>[e(s,{prop:"ccode",align:"center",label:"会计科目编号","min-width":"200"}),e(s,{prop:"ccode_name",align:"center",label:"会计科目名称","min-width":"200"}),e(s,{label:"操作",align:"center"},{default:o(a=>[e(p,{type:"primary",size:"small",onClick:M=>ce(a.row)},{default:o(()=>[v("选择科目")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","stripe","highlight-current-row","default-sort"])]),_:1},8,["modelValue","fullscreen"]),e(K,{modelValue:U.value,"onUpdate:modelValue":l[14]||(l[14]=a=>U.value=a),title:"选择客户",onOpen:ge,fullscreen:N.value,onClose:l[15]||(l[15]=a=>N.value=!1),"align-center":"","destroy-on-close":"",width:"1000px",draggable:"","close-on-click-modal":!1},{default:o(()=>[e(R,{onClick:l[10]||(l[10]=a=>N.value=!N.value),style:{position:"absolute",right:"45px",top:"24px",cursor:"pointer","font-size":"14px"}},{default:o(()=>[e(A)]),_:1}),e(J,{inline:!0,model:y.value},{default:o(()=>[e(i,{label:"客户编号",prop:"code",style:{"margin-left":"20px"}},{default:o(()=>[e(u,{modelValue:y.value.code,"onUpdate:modelValue":l[11]||(l[11]=a=>y.value.code=a),clearable:"",placeholder:"请输入客户编号"},null,8,["modelValue"])]),_:1}),e(i,{label:"客户名称",prop:"name",style:{"margin-left":"20px"}},{default:o(()=>[e(u,{modelValue:y.value.name,"onUpdate:modelValue":l[12]||(l[12]=a=>y.value.name=a),clearable:"",placeholder:"请输入客户名称"},null,8,["modelValue"])]),_:1}),e(i,{style:{"margin-left":"20px"}},{default:o(()=>[e(p,{type:"primary",onClick:l[13]||(l[13]=a=>H())},{default:o(()=>[v("查询")]),_:1})]),_:1})]),_:1},8,["model"]),e(w,{class:"eltable",data:Y.value,stripe:_.value.tableStripe,border:"","highlight-current-row":_.value.tableHighlightCurrentRow,"max-height":"500",style:{width:"100%",color:"#000","margin-top":"10px"},"header-cell-style":z,"default-sort":S.value},{default:o(()=>[e(s,{prop:"cCusCode",align:"center",label:"客户编号","min-width":"200"}),e(s,{prop:"cCusName",align:"center",label:"客户名称","min-width":"200"}),e(s,{label:"操作",align:"center"},{default:o(a=>[e(p,{type:"primary",size:"small",onClick:M=>pe(a.row)},{default:o(()=>[v("选择客户")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","stripe","highlight-current-row","default-sort"])]),_:1},8,["modelValue","fullscreen"])])}}},Ze=be(Pe,[["__scopeId","data-v-bdffa0d6"]]);export{Ze as default};
