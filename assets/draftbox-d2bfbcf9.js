import{ai as g,aT as d,aF as F,c as H,a as f,W as o,bD as u,bF as O,H as A,aX as i,aY as G,o as j,bi as x,U as _,ay as L,b9 as V}from"./_@vue-5ba92de9.js";const W={class:"roadui_page"},X=["onClick"],I={class:"roadui_pagerdiv"},Z={__name:"draftbox",setup(J){const w=g("ajax"),n=g("utils"),D=g("qs"),U=g("index_openmenu"),r=d({}),c=d([]),s=d(!1),h=d(!1),S=d([]);let p=[];const k=d({prop:"sendtime",order:"descending"}),a=d(n.getPager(k.value));F(()=>{v(!1)});const M=t=>{p=t},B=t=>{a.value.size=t,v(!1)},T=t=>{a.value.number=t,v(!1)},Y=t=>{a.value.order=n.getOrder(t),v(!1)},v=t=>{t&&(a.value.number=1),h.value=!0,s.value=!0,r.value.size=a.value.size,r.value.number=a.value.number,r.value.order=a.value.order,r.value.date1=n.length(c.value)>0?c.value[0]:"",r.value.date2=n.length(c.value)>1?c.value[1]:"",w.post("/Mail/GetDraftList",D.stringify(r.value)).then(e=>{S.value=e.data.rows,a.value.total=e.data.total,s.value=!1,h.value=!1}).catch(()=>{s.value=!1})},z=t=>{if(p.length===0){n.msg("请选择要删除的草稿邮件！","error");return}n.confirm("您确定要"+(t==1?"彻底":"")+"删除所选草稿邮件吗？",()=>{s.value=!0,w.post("/Mail/DeleteDraft",D.stringify({ids:n.getArrayValues(p,"id").join(","),type:t})).then(e=>{let m=e.msg;n.length(m)===0&&(m=e.success?"删除成功！":"删除失败！"),n.msg(m,e.success),s.value=!1,e.success&&(p=[],v(!1))}).catch(()=>{s.value=!1})})},P=t=>{const e={title:t.mailSubject,id:"mail_"+t.id,url:"/system/mail/send?id="+t.id+"&source=draftbox",ico:"Edit",openMode:0};U(e)};return(t,e)=>{const m=i("el-input"),y=i("el-form-item"),$=i("el-date-picker"),C=i("el-button"),N=i("el-form"),b=i("el-table-column"),R=i("el-table"),q=i("el-pagination"),E=G("loading");return j(),H("div",W,[f("div",null,[o(N,{inline:!0},{default:u(()=>[o(y,{label:"主题"},{default:u(()=>[o(m,{modelValue:r.value.mailSubject,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value.mailSubject=l),style:{width:"200px"},clearable:""},null,8,["modelValue"])]),_:1}),o(y,{label:"日期"},{default:u(()=>[o($,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=l=>c.value=l),style:{width:"220px"},type:"daterange","value-format":"YYYY-MM-DD","unlink-panels":"","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:x(n).dateShortucts},null,8,["modelValue","shortcuts"])]),_:1}),o(y,null,{default:u(()=>[o(C,{type:"primary",disabled:s.value,onClick:e[2]||(e[2]=l=>v(!0))},{default:u(()=>[_("查询")]),_:1},8,["disabled"]),o(C,{type:"danger",disabled:s.value,onClick:e[3]||(e[3]=l=>z(0))},{default:u(()=>[_("删除")]),_:1},8,["disabled"]),o(C,{type:"danger",disabled:s.value,onClick:e[4]||(e[4]=l=>z(1))},{default:u(()=>[_("彻底删除")]),_:1},8,["disabled"])]),_:1})]),_:1})]),f("div",null,[O((j(),A(R,{data:S.value,stripe:a.value.tableStripe,border:a.value.tableBorder,style:{width:"100%"},"highlight-current-row":a.value.tableHighlightCurrentRow,"default-sort":k.value,onSortChange:Y,onSelectionChange:M},{default:u(()=>[o(b,{type:"selection",width:"45"}),o(b,{prop:"mailSubject",label:"主题",sortable:"custom","show-overflow-tooltip":""},{default:u(l=>[f("a",{class:"roaduia",href:"javascript:;",onClick:K=>P(l.row),style:L(x(n).length(l.row.subjectColor)>0?"color:"+l.row.subjectColor:"")},V(l.row.mailSubject),13,X)]),_:1}),o(b,{prop:"receiveUsers",label:"收件人",width:"300",sortable:"custom"},{default:u(l=>[_(V(l.row.receiveUsers),1)]),_:1}),o(b,{prop:"sendTime",label:"日期",width:"180",sortable:"custom"})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[E,h.value]])]),f("div",I,[o(q,{currentPage:a.value.number,"onUpdate:currentPage":e[5]||(e[5]=l=>a.value.number=l),"page-size":a.value.size,"onUpdate:pageSize":e[6]||(e[6]=l=>a.value.size=l),"page-sizes":a.value.sizes,background:a.value.background,layout:a.value.layout,total:a.value.total,disabled:s.value,onSizeChange:B,onCurrentChange:T},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])])])}}};export{Z as default};
