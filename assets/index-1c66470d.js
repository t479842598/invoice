import{p as ne,_ as Oe}from"./_splitpanes-c98d9122.js";import{ai as R,aT as c,c as z,W as t,bD as o,bi as h,aX as m,aY as Me,o as g,a as r,H as w,b9 as C,U as v,I as V,bF as Ye,F as ue,aV as de}from"./_@vue-5ba92de9.js";const Ae={style:{height:"inherit"}},He={class:"roadui_treenode"},Je=["onClick"],Ke={class:"roadui_pagerdiv"},We=r("span",{style:{"margin-left":"12px"}},"来源",-1),Xe=r("span",{style:{"margin-left":"12px"}},"等级",-1),Qe=r("span",{style:{"margin-left":"12px"}},"栏目",-1),Ze={cellpadding:"0",cellspacing:"0",border:"0",style:{width:"100%"}},el={align:"center",class:"roadui_showdoc_title"},ll={align:"center",class:"roadui_showdoc_title1"},al=r("span",{style:{"margin-right":"12px"}},"栏目",-1),tl=r("span",{style:{"margin-right":"12px"}},"发布时间",-1),ol=r("span",{style:{"margin-right":"12px"}},"发布人",-1),sl={key:0},nl=r("span",{style:{"margin-right":"12px"}},"来源",-1),ul={key:1},dl=r("span",{style:{"margin-right":"12px"}},"等级",-1),il=["innerHTML"],rl={key:0},cl={class:"roadui_showdoc_files"},gl={__name:"index",setup(vl){const k=R("ajax"),s=R("utils"),S=R("qs"),ie=R("index_openmenu"),re=R("config"),ce=R("ElSelectfile"),ve=R("ElCkeditor"),G=R("ElSelectorg"),F=c(""),H=c([]),J=c([]),pe={children:"children",label:"title",isLeaf:"isLeaf"},K=c(null),fe=a=>{_.value.dirId=a.id,F.value=a.title,x(!1)},me=(a,e)=>{if(a.level===0)k.post("/Doc/GetDirTreeJson").then(n=>{H.value=n.data,s.length(n.data)>0&&(J.value.push(n.data[0].id),_.value.dirId=n.data[0].id,F.value=n.data[0].title),x(!1)}).catch(()=>{});else{if(s.length(a.data.children)>0){e(a.data.children);return}k.post("/Doc/GetDirTreeChildsJson?parentid="+a.data.id).then(n=>{e(n.data)}).catch(()=>{})}},I=a=>{k.post("/Doc/GetDirTreeChildsJson?parentid="+a).then(e=>{K.value.updateKeyChildren(a,e.data)}).catch(()=>{})},j=c(!1),q=c(!1),P=c(!1),u=c(!1),W=c([]);let X=[];const _=c({}),T=c([]),Q=c({}),p=c(s.getPager(Q.value)),ge=a=>{p.value.size=a,x(!1)},be=a=>{p.value.number=a,x(!1)},he=a=>{p.value.order=s.getOrder(a),x(!1)},_e=a=>{X=a},x=a=>{a&&(p.value.number=1),P.value=!0,u.value=!0,_.value.size=p.value.size,_.value.number=p.value.number,_.value.order=p.value.order,_.value.date1=s.length(T.value)>0?T.value[0]:"",_.value.date2=s.length(T.value)>1?T.value[1]:"",k.post("/Doc/GetList",S.stringify(_.value)).then(e=>{if(!e.success){let n="";switch(e.code){case 1:n="未找到栏目！";break}s.msg(n,!1);return}W.value=e.data.rows,p.value.total=e.data.total,j.value=e.data.hasEdit,q.value=e.data.hasPublish,u.value=!1,P.value=!1}).catch(()=>{u.value=!1,P.value=!1})},B=c([]),Z=a=>{if(s.length(B.value)===0){const e=[{id:"system_doc_rank",key:"docRank",children:!1,valueField:"value"}];k.post("/Dictionary/GetMultipleOptions",S.stringify({json:JSON.stringify(e)})).then(n=>{B.value=n.data.docRank,le(a)}).catch(()=>{})}else le(a)},$=c(!1),O=c(""),f=c({}),ee=c(null),ye={title:[{required:!0,message:"请输入文档标题",trigger:"blur"}]},ke=a=>{Z(a)},le=a=>{s.length(a)>0?k.post("/Doc/GetDoc?docid="+a).then(e=>{if(e.code==1){s.msg("加载文档数据失败！",!1);return}f.value=e.data,e.data.docRank==-1?f.value.docRank="":f.value.docRank=f.value.docRank+"",O.value="编辑文档",$.value=!0}).catch(()=>{}):(O.value="添加文档",$.value=!0)},De=async a=>{a&&await a.validate(e=>{e&&(u.value=!0,f.value.dirId=_.value.dirId,k.post("/Doc/SaveDoc",S.stringify(f.value)).then(n=>{let i=n.msg;if(s.length(i)===0)switch(n.code){case 0:i="保存成功！";break;case 1:i="文档栏目，标题，内容不能为空！";break;case 2:i="您没有栏目发布文档权限！";break;default:i="保存失败！";break}s.msg(i,n.success),u.value=!1,n.success&&($.value=!1,f.value={},x(!1))}).catch(()=>{u.value=!1}))})},b=c({}),N=c(!1),we=a=>{k.post("/Doc/GetDocShow?docid="+a.id).then(e=>{if(e.code==1){s.msg("加载文档数据失败！",!1);return}if(e.code==2){s.msg("您无权查看该文档！",!1);return}b.value=e.data,N.value=!0}).catch(()=>{})},Ve=a=>{N.value=!1,Z(a)},ae=a=>{const e=s.isDef(a)?a:s.getArrayValues(X,"id").join(",");if(s.length(e)===0){s.msg("请选择要删除的文档！","error");return}s.confirm("您确定要删除文档吗？",()=>{u.value=!0,k.post("/Doc/DeleteDoc",S.stringify({id:e})).then(n=>{let i=n.msg;s.length(i)===0&&(n.success?i="删除成功！":n.code==1?i="未找到文档！":n.code==2?i="没有权限删除文档！":i="删除失败！"),s.msg(i,n.success),u.value=!1,n.success&&(N.value=!1,x(!1))}).catch(()=>{})})},Ce=a=>{s.open("?loadurl="+encodeURIComponent("/system/document/print?docid="+a),1e3,600,"打印文档")},d=c({}),M=c(""),U=c(!1),te=c(null),xe={name:[{required:!0,message:"请输入栏目名称",trigger:"blur"}],manageUsers:[{required:!0,message:"请选择管理人员",trigger:"blur"}],publishUsers:[{required:!0,message:"请选择发布人员",trigger:"blur"}]},Ue=()=>{s.length(_.value.dirId)!==0&&(u.value=!0,k.post("/Doc/GetDir?dirid="+_.value.dirId).then(a=>{if(s.length(a.data)===0){s.msg("请选择要编辑的栏目！",!1),u.value=!1;return}d.value=a.data,d.value.add=!1,M.value="编辑栏目 - "+a.data.name,u.value=!1,U.value=!0}).catch(()=>{u.value=!1}))},Re=()=>{s.length(_.value.dirId)!==0&&(d.value={add:!0,parentId:_.value.dirId},M.value="添加子栏目",U.value=!0)},Se=async a=>{if(d.value.add){ze(a);return}a&&await a.validate(e=>{e&&(u.value=!0,k.post("/Doc/SaveDir",S.stringify(d.value)).then(n=>{let i=n.msg;if(s.length(i)===0)switch(n.code){case 0:i="保存成功！";break;case 1:i="数据验证错误！";break;case 2:i="未找到该栏目！";break;case 3:i="您没有栏目编辑权限！";break;default:i="保存失败！";break}s.msg(i,n.success),u.value=!1,n.success&&(U.value=!1,d.value.parentId<=s.emptyLong?I(d.value.id):I(d.value.parentId),d.value={})}).catch(()=>{u.value=!1}))})},ze=async a=>{a&&await a.validate(e=>{e&&(u.value=!0,k.post("/Doc/SaveAddDir",S.stringify(d.value)).then(n=>{let i=n.msg;if(s.length(i)===0)switch(n.code){case 0:i="保存成功！";break;case 1:i="数据验证错误！";break;case 2:i="您没有添加子栏目权限！";break;default:i="保存失败！";break}s.msg(i,n.success),u.value=!1,n.success&&(U.value=!1,d.value.parentId<=s.emptyLong?I(d.value.id):I(d.value.parentId),d.value={})}).catch(()=>{u.value=!1}))})},Ie=()=>{s.confirm("您确定要删除该栏目吗？",()=>{u.value=!0,k.post("/Doc/DeleteDir",S.stringify({id:_.value.dirId})).then(a=>{let e=a.msg;if(s.length(e)===0)switch(a.code){case 0:e="删除成功！";break;case 1:e="未找到栏目！";break;case 2:e="没有栏目删除权限！";break;case 3:e="该栏目下有文档，不能删除！";break;case 4:e="不能删除根栏目！";break;default:e="删除失败！";break}s.msg(e,a.success),u.value=!1,a.success&&(U.value=!1,d.value.parentId<=s.emptyLong?I(d.value.id):I(d.value.parentId),d.value={})}).catch(()=>{})})};return(a,e)=>{const n=m("document"),i=m("el-icon"),Te=m("folder"),$e=m("el-tree"),L=m("el-input"),D=m("el-form-item"),Ne=m("el-date-picker"),y=m("el-button"),Y=m("el-form"),E=m("el-table-column"),oe=m("el-tag"),Ee=m("el-table"),Le=m("el-pagination"),Fe=m("el-option"),Pe=m("el-select"),A=m("el-dialog"),Ge=m("el-space"),je=m("el-link"),qe=m("el-input-number"),Be=Me("loading");return g(),z("div",Ae,[t(h(Oe),{class:"default-theme",style:{height:"inherit"}},{default:o(()=>[t(h(ne),{size:16,"min-size":"16","max-size":"50",style:{overflow:"auto",background:"#fff"}},{default:o(()=>[t($e,{data:H.value,props:pe,load:me,lazy:"",ref_key:"dirTreeRef",ref:K,"node-key":"id","highlight-current":"","default-expanded-keys":J.value,"expand-on-click-node":!1,style:{height:"inherit","padding-right":"14px"},onNodeClick:fe},{default:o(l=>[r("div",He,[l.node.isLeaf?(g(),w(i,{key:0},{default:o(()=>[t(n)]),_:1})):(g(),w(i,{key:1},{default:o(()=>[t(Te)]),_:1})),r("span",null,C(l.node.label),1)])]),_:1},8,["data","default-expanded-keys"])]),_:1}),t(h(ne),{size:84,style:{background:"#fff",overflow:"auto","padding-left":"5px"}},{default:o(()=>[r("div",null,[t(Y,{inline:!0},{default:o(()=>[t(D,{label:"标题"},{default:o(()=>[t(L,{modelValue:_.value.title,"onUpdate:modelValue":e[0]||(e[0]=l=>_.value.title=l),placeholder:"文档标题",clearable:"",style:{width:"120px"}},null,8,["modelValue"])]),_:1}),t(D,{label:"日期"},{default:o(()=>[t(Ne,{modelValue:T.value,"onUpdate:modelValue":e[1]||(e[1]=l=>T.value=l),style:{width:"200px"},type:"daterange","value-format":"YYYY-MM-DD","unlink-panels":"","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:h(s).dateShortucts},null,8,["modelValue","shortcuts"])]),_:1}),t(D,null,{default:o(()=>[t(y,{type:"primary",disabled:u.value,onClick:e[2]||(e[2]=l=>x(!0))},{default:o(()=>[v("查询")]),_:1},8,["disabled"]),q.value?(g(),w(y,{key:0,type:"primary",disabled:u.value,onClick:e[3]||(e[3]=l=>ke())},{default:o(()=>[v("添加文档")]),_:1},8,["disabled"])):V("",!0),q.value?(g(),w(y,{key:1,type:"danger",disabled:u.value,onClick:e[4]||(e[4]=l=>ae(null))},{default:o(()=>[v("删除")]),_:1},8,["disabled"])):V("",!0),j.value?(g(),w(y,{key:2,type:"primary",disabled:u.value,onClick:e[5]||(e[5]=l=>Ue())},{default:o(()=>[v("编辑栏目")]),_:1},8,["disabled"])):V("",!0),j.value?(g(),w(y,{key:3,type:"primary",disabled:u.value,onClick:e[6]||(e[6]=l=>Re())},{default:o(()=>[v("添加子栏目")]),_:1},8,["disabled"])):V("",!0)]),_:1})]),_:1})]),r("div",null,[Ye((g(),w(Ee,{data:W.value,stripe:p.value.tableStripe,border:p.value.tableBorder,style:{width:"100%"},"highlight-current-row":p.value.tableHighlightCurrentRow,"default-sort":Q.value,onSelectionChange:_e,onSortChange:he},{default:o(()=>[t(E,{type:"selection",width:"45"}),t(E,{prop:"title",label:"标题","show-overflow-tooltip":"",sortable:"custom"},{default:o(l=>[l.row.isRead==0?(g(),w(oe,{key:0,effect:"dark",style:{"margin-right":"8px","vertical-align":"middle"}},{default:o(()=>[v("未读")]),_:1})):V("",!0),r("a",{class:"roaduia",href:"javascript:;",onClick:se=>we(l.row)},C(l.row.title),9,Je)]),_:1}),t(E,{prop:"dirName",label:"栏目",width:"200","show-overflow-tooltip":"",sortable:"custom"}),t(E,{prop:"editUserName",label:"发布人",width:"140",sortable:"custom"}),t(E,{prop:"editTime1",label:"发布时间",width:"150",sortable:"custom"}),t(E,{prop:"docRank",label:"文档等级",width:"130",sortable:"custom"},{default:o(l=>[t(oe,null,{default:o(()=>[v(C(h(s).length(l.row.docRank)>0?l.row.docRank:"普通"),1)]),_:2},1024)]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[Be,P.value]]),r("div",Ke,[t(Le,{currentPage:p.value.number,"onUpdate:currentPage":e[7]||(e[7]=l=>p.value.number=l),"page-size":p.value.size,"onUpdate:pageSize":e[8]||(e[8]=l=>p.value.size=l),"page-sizes":p.value.sizes,background:p.value.background,layout:p.value.layout,total:p.value.total,disabled:u.value,onSizeChange:ge,onCurrentChange:be},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])])])]),_:1})]),_:1}),t(A,{modelValue:$.value,"onUpdate:modelValue":e[17]||(e[17]=l=>$.value=l),title:O.value,"align-center":"","destroy-on-close":"",width:"1200px",draggable:"","close-on-click-modal":!1},{default:o(()=>[t(Y,{model:f.value,ref_key:"ruleFormRef",ref:ee,rules:ye,"label-width":"60px"},{default:o(()=>[t(D,{label:"标题",prop:"title"},{default:o(()=>[t(L,{modelValue:f.value.title,"onUpdate:modelValue":e[9]||(e[9]=l=>f.value.title=l),placeholder:"文档标题"},null,8,["modelValue"])]),_:1}),t(D,{label:"附件",prop:"files"},{default:o(()=>[t(h(ce),{modelValue:f.value.files,"onUpdate:modelValue":e[10]||(e[10]=l=>f.value.files=l),style:{width:"300px"}},null,8,["modelValue"]),We,t(L,{style:{"margin-left":"12px",width:"180px"},modelValue:f.value.source,"onUpdate:modelValue":e[11]||(e[11]=l=>f.value.source=l),placeholder:""},null,8,["modelValue"]),Xe,t(Pe,{style:{"margin-left":"12px",width:"180px"},modelValue:f.value.docRank,"onUpdate:modelValue":e[12]||(e[12]=l=>f.value.docRank=l)},{default:o(()=>[(g(!0),z(ue,null,de(B.value,l=>(g(),w(Fe,{key:l.value,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),Qe,t(L,{style:{"margin-left":"12px",width:"180px"},modelValue:F.value,"onUpdate:modelValue":e[13]||(e[13]=l=>F.value=l),readonly:"",disabled:""},null,8,["modelValue"])]),_:1}),t(D,{label:"内容",prop:"contents"},{default:o(()=>[t(h(ve),{modelValue:f.value.contents,"onUpdate:modelValue":e[14]||(e[14]=l=>f.value.contents=l),height:300},null,8,["modelValue"])]),_:1}),t(D,null,{default:o(()=>[t(y,{disabled:u.value,onClick:e[15]||(e[15]=l=>De(ee.value)),type:"primary"},{default:o(()=>[v("保存")]),_:1},8,["disabled"]),t(y,{disabled:u.value,onClick:e[16]||(e[16]=l=>{f.value={},$.value=!1})},{default:o(()=>[v("关闭")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(A,{modelValue:N.value,"onUpdate:modelValue":e[22]||(e[22]=l=>N.value=l),"show-close":!1,class:"el-dialog__padding","align-center":"","destroy-on-close":"",width:"1200px",draggable:"","close-on-click-modal":!1},{header:o(()=>[r("div",null,[t(y,{type:"info",onClick:e[18]||(e[18]=l=>Ce(b.value.id))},{default:o(()=>[v("打印")]),_:1}),b.value.isPublish?(g(),w(y,{key:0,type:"primary",onClick:e[19]||(e[19]=l=>Ve(b.value.id))},{default:o(()=>[v("编辑")]),_:1})):V("",!0),b.value.isPublish?(g(),w(y,{key:1,type:"danger",onClick:e[20]||(e[20]=l=>ae(b.value.id))},{default:o(()=>[v("删除")]),_:1})):V("",!0),t(y,{onClick:e[21]||(e[21]=l=>{b.value={},N.value=!1})},{default:o(()=>[v("关闭")]),_:1})])]),default:o(()=>[r("div",null,[r("table",Ze,[r("tr",null,[r("td",el,C(b.value.title),1)]),r("tr",null,[r("td",ll,[t(Ge,{size:20},{default:o(()=>[r("span",null,[al,v(C(b.value.dirName),1)]),r("span",null,[tl,v(C(h(s).replaceTime(b.value.editTime)),1)]),r("span",null,[ol,v(C(b.value.editUserName),1)]),h(s).length(b.value.source)>0?(g(),z("span",sl,[nl,v(C(b.value.source),1)])):V("",!0),h(s).length(b.value.docRank)>0?(g(),z("span",ul,[dl,v(C(b.value.docRank),1)])):V("",!0)]),_:1})])]),r("tr",null,[r("td",null,[r("div",{class:"roadui_showdoc_contents",innerHTML:b.value.contents},null,8,il)])]),h(s).length(b.value.files)>0?(g(),z("tr",rl,[r("td",cl,[v(" 附件： "),(g(!0),z(ue,null,de(b.value.files,(l,se)=>(g(),z("span",{style:{"margin-right":"12px"},key:l.id},[t(je,{onClick:pl=>h(s).showFile(h(ie),l,h(re).SERVER_WEBADDRESS)},{default:o(()=>[v(C(++se+"、"+l.name),1)]),_:2},1032,["onClick"])]))),128))])])):V("",!0)])])]),_:1},8,["modelValue"]),t(A,{modelValue:U.value,"onUpdate:modelValue":e[31]||(e[31]=l=>U.value=l),title:M.value,"align-center":"","destroy-on-close":"",width:"700px",draggable:"","close-on-click-modal":!1},{default:o(()=>[t(Y,{model:d.value,ref_key:"dirRuleFormRef",ref:te,rules:xe,"label-width":"80px"},{default:o(()=>[t(D,{label:"栏目名称",prop:"name"},{default:o(()=>[t(L,{modelValue:d.value.name,"onUpdate:modelValue":e[23]||(e[23]=l=>d.value.name=l)},null,8,["modelValue"])]),_:1}),t(D,{label:"管理人员",prop:"manageUsers"},{default:o(()=>[t(h(G),{modelValue:d.value.manageUsers,"onUpdate:modelValue":e[24]||(e[24]=l=>d.value.manageUsers=l),style:{width:"100%"},placeholder:"可以修改栏目和添加下级子栏目"},null,8,["modelValue"])]),_:1}),t(D,{label:"发布人员",prop:"publishUsers"},{default:o(()=>[t(h(G),{modelValue:d.value.publishUsers,"onUpdate:modelValue":e[25]||(e[25]=l=>d.value.publishUsers=l),style:{width:"100%"},placeholder:"可以发布和修改该栏目文档"},null,8,["modelValue"])]),_:1}),t(D,{label:"阅读人员",prop:"readUsers"},{default:o(()=>[t(h(G),{modelValue:d.value.readUsers,"onUpdate:modelValue":e[26]||(e[26]=l=>d.value.readUsers=l),style:{width:"100%"},placeholder:"可以阅读查看该栏目文档，为空表示所有人员都可阅读。"},null,8,["modelValue"])]),_:1}),d.value.add?V("",!0):(g(),w(D,{key:0,label:"排序",prop:"sort"},{default:o(()=>[t(qe,{step:5,min:0,modelValue:d.value.sort,"onUpdate:modelValue":e[27]||(e[27]=l=>d.value.sort=l)},null,8,["modelValue"])]),_:1})),t(D,null,{default:o(()=>[t(y,{disabled:u.value,onClick:e[28]||(e[28]=l=>Se(te.value)),type:"primary"},{default:o(()=>[v("保存")]),_:1},8,["disabled"]),t(y,{disabled:u.value,type:"danger",onClick:e[29]||(e[29]=l=>Ie())},{default:o(()=>[v("删除")]),_:1},8,["disabled"]),t(y,{disabled:u.value,onClick:e[30]||(e[30]=l=>{d.value={},U.value=!1})},{default:o(()=>[v("关闭")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{gl as default};
