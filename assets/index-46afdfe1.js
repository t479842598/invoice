import{ai as V,aT as p,aF as ue,A as L,c as x,a as I,W as l,bD as o,bF as se,H as Y,aX as c,aY as re,o as h,bi as g,I as B,U as _,b9 as R}from"./_@vue-5ba92de9.js";const de={class:"roadui_page"},ne={style:{height:"calc(100% - 60px)",overflow:"auto"}},ie={key:0},pe={key:1},me=I("span",null,"操作",-1),ve={class:"roadui_pagerdiv"},ce={class:"dialog-footer"},be={__name:"index",props:{query:{type:String,default:()=>""}},setup($){const U=V("ajax"),s=V("utils"),S=V("qs"),k=V("ElSelectorg"),j=V("ElSelectflow"),N=$,d=p(!1),C=p(!1),q=p([]),m=p({}),y=p([]),u=p({});let D=[];const E=p({prop:"writetime",order:"descending"}),r=p(s.getPager(E.value)),F=p(null),w=p(!1),T=p(""),z=s.query("addtype",N.query),P={toUserId:[{required:!0,message:"请选择接收人",trigger:"blur"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"blur"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"blur"}]};ue(()=>{b()});const G=L(()=>a=>{switch(a){case 1:return"未开始";case 2:return"委托中";case 3:return"已结束";default:return"未知"}}),A=L(()=>a=>{switch(a){case 1:return"#999999";case 2:return"#52c41a";case 3:return"var(--el-color-primary)";default:return""}}),O=a=>{r.value.size=a,b(!1)},W=a=>{r.value.number=a,b(!1)},X=a=>{r.value.order=s.getOrder(a),b(!1)},J=a=>{D=a},b=a=>{a&&(r.value.number=1),C.value=!0,d.value=!0,m.value.size=r.value.size,m.value.number=r.value.number,m.value.order=r.value.order,m.value.date1=s.length(y.value)>0?y.value[0]:"",m.value.date2=s.length(y.value)>1?y.value[1]:"",U.post("/FlowEntrust/"+(z=="1"?"GetManageList":"GetUserList"),S.stringify(m.value)).then(e=>{q.value=e.data.rows,r.value.total=e.data.total,d.value=!1,C.value=!1}).catch(()=>{d.value=!1,C.value=!1})},M=a=>{if(s.isUndef(a)||s.length(a.id)===0){u.value={},T.value="添加",w.value=!0;return}s.length(a.id)>0&&U.post("/FlowEntrust/Get?entrustid="+a.id).then(e=>{e.success?(u.value=e.data,u.value.userId=e.data.userId>s.emptyLong?"u_"+e.data.userId:"",u.value.toUserId=e.data.toUserId>s.emptyLong?"u_"+e.data.toUserId:"",u.flowId==s.emptyLong?delete u.value.flowId:u.value.flowId=u.value.flowId+"",T.value="编辑",w.value=!0):s.msg("获取数据失败！",!1)}).catch(()=>{})},K=async a=>{a&&await a.validate(e=>{if(e){d.value=!0;const n=u.value.id||"";U.post("/FlowEntrust/Save?entrustid="+n,S.stringify(u.value)).then(f=>{let i=f.msg;s.length(i)===0&&(f.success?i="保存成功！":f.code==1?i="数据验证错误！":i="保存失败！"),s.msg(i,f.success),d.value=!1,f.success&&(w.value=!1,b()),d.value=!1}).catch(()=>{d.value=!1})}})},Q=()=>{if(D.length===0){s.msg("您没有选择要删除的委托！","error");return}s.confirm("您确定要删除所选委托吗？",()=>{d.value=!0,U.post("/FlowEntrust/Delete",S.stringify({ids:s.getArrayValues(D,"id").join(",")})).then(a=>{s.msg(a.success?"删除成功！":"删除失败！",a.success),d.value=!1,a.success&&(D=[],b())}).catch(()=>{d.value=!1})})};return(a,e)=>{const n=c("el-form-item"),f=c("el-date-picker"),i=c("el-button"),H=c("el-form"),v=c("el-table-column"),Z=c("el-tag"),ee=c("el-table"),le=c("el-pagination"),te=c("el-input"),ae=c("el-dialog"),oe=re("loading");return h(),x("div",de,[I("div",null,[l(H,{inline:!0},{default:o(()=>[g(z)==1?(h(),Y(n,{key:0,label:"委托人"},{default:o(()=>[l(g(k),{modelValue:m.value.userId,"onUpdate:modelValue":e[0]||(e[0]=t=>m.value.userId=t),"select-type":"user","multiple-limit":1,style:{width:"170px"},clearable:""},null,8,["modelValue"])]),_:1})):B("",!0),l(n,{label:"接收人"},{default:o(()=>[l(g(k),{modelValue:m.value.toUserId,"onUpdate:modelValue":e[1]||(e[1]=t=>m.value.toUserId=t),"select-type":"user","multiple-limit":1,style:{width:"170px"},clearable:""},null,8,["modelValue"])]),_:1}),l(n,{label:"编辑时间"},{default:o(()=>[l(f,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=t=>y.value=t),style:{width:"220px"},type:"daterange","value-format":"YYYY-MM-DD","unlink-panels":"","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:g(s).dateShortucts},null,8,["modelValue","shortcuts"])]),_:1}),l(n,null,{default:o(()=>[l(i,{type:"primary",disabled:d.value,onClick:e[3]||(e[3]=t=>b(!0))},{default:o(()=>[_("查询")]),_:1},8,["disabled"]),l(i,{type:"primary",disabled:d.value,onClick:e[4]||(e[4]=t=>M(null))},{default:o(()=>[_("添加")]),_:1},8,["disabled"]),l(i,{type:"danger",disabled:d.value,onClick:Q},{default:o(()=>[_("删除")]),_:1},8,["disabled"])]),_:1})]),_:1})]),I("div",ne,[se((h(),Y(ee,{data:q.value,stripe:r.value.tableStripe,border:r.value.tableBorder,style:{width:"100%"},"highlight-current-row":r.value.tableHighlightCurrentRow,onSelectionChange:J,"default-sort":E.value,onSortChange:X},{default:o(()=>[l(v,{type:"selection",width:"42"}),l(v,{prop:"userId",label:"委托人",width:"120"}),l(v,{prop:"toUserId",label:"接收人",width:"120"}),l(v,{prop:"flowId",label:"委托流程",sortable:"custom"},{default:o(t=>[t.row.flowId==g(s).emptyLong?(h(),x("span",ie,"所有流程")):(h(),x("span",pe,R(t.row.flowId),1))]),_:1}),l(v,{prop:"writeTime",label:"编辑时间",width:"145",sortable:"custom"}),l(v,{prop:"startTime",label:"开始时间",width:"145",sortable:"custom"}),l(v,{prop:"endTime",label:"结束时间",width:"145",sortable:"custom"}),l(v,{prop:"note",label:"备注"}),l(v,{prop:"status",label:"状态",width:"90"},{default:o(t=>[l(Z,{color:A.value(t.row.status),effect:"plain",style:{color:"#fff",border:"none"}},{default:o(()=>[_(R(G.value(t.row.status)),1)]),_:2},1032,["color"])]),_:1}),l(v,{width:"90"},{header:o(()=>[me]),default:o(t=>[l(i,{size:"small",disabled:d.value,type:"primary",onClick:fe=>M(t.row)},{default:o(()=>[_("编辑")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[oe,C.value]]),I("div",ve,[l(le,{currentPage:r.value.number,"onUpdate:currentPage":e[5]||(e[5]=t=>r.value.number=t),"page-size":r.value.size,"onUpdate:pageSize":e[6]||(e[6]=t=>r.value.size=t),"page-sizes":r.value.sizes,background:r.value.background,layout:r.value.layout,total:r.value.total,disabled:d.value,onSizeChange:O,onCurrentChange:W},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])])]),l(ae,{modelValue:w.value,"onUpdate:modelValue":e[14]||(e[14]=t=>w.value=t),title:T.value,"align-center":"","destroy-on-close":"",width:"700px",draggable:"","close-on-click-modal":!1},{footer:o(()=>[I("span",ce,[l(i,{disabled:d.value,type:"primary",onClick:e[12]||(e[12]=t=>K(F.value))},{default:o(()=>[_("保存")]),_:1},8,["disabled"]),l(i,{disabled:d.value,onClick:e[13]||(e[13]=t=>w.value=!1)},{default:o(()=>[_("关闭")]),_:1},8,["disabled"])])]),default:o(()=>[l(H,{model:u.value,ref_key:"ruleFormRef",ref:F,rules:P,"label-width":"80px"},{default:o(()=>[g(z)==1?(h(),Y(n,{key:0,label:"委托人",prop:"userId"},{default:o(()=>[l(g(k),{modelValue:u.value.userId,"onUpdate:modelValue":e[7]||(e[7]=t=>u.value.userId=t),"select-type":"user","multiple-limit":1,clearable:""},null,8,["modelValue"])]),_:1})):B("",!0),l(n,{label:"接收人",prop:"toUserId"},{default:o(()=>[l(g(k),{modelValue:u.value.toUserId,"onUpdate:modelValue":e[8]||(e[8]=t=>u.value.toUserId=t),"select-type":"user","multiple-limit":1,clearable:""},null,8,["modelValue"])]),_:1}),l(n,{label:"委托流程",prop:"flowId"},{default:o(()=>[l(g(j),{placeholder:"为空表示所有流程",style:{width:"100%"}})]),_:1}),l(n,{label:"开始时间",prop:"startTime"},{default:o(()=>[l(f,{modelValue:u.value.startTime,"onUpdate:modelValue":e[9]||(e[9]=t=>u.value.startTime=t),"value-format":"YYYY-MM-DD HH:mm",type:"datetime"},null,8,["modelValue"])]),_:1}),l(n,{label:"结束时间",prop:"endTime"},{default:o(()=>[l(f,{modelValue:u.value.endTime,"onUpdate:modelValue":e[10]||(e[10]=t=>u.value.endTime=t),"value-format":"YYYY-MM-DD HH:mm",type:"datetime"},null,8,["modelValue"])]),_:1}),l(n,{label:"备注",prop:"note"},{default:o(()=>[l(te,{modelValue:u.value.note,"onUpdate:modelValue":e[11]||(e[11]=t=>u.value.note=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{be as default};
