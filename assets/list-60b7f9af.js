import{ai as C,aT as p,aF as ue,c as _,bF as L,H as V,bD as o,a as f,W as t,aX as v,aY as se,o as m,U as s,b9 as z,F as j,aV as q,bv as ne,I as J}from"./_@vue-5ba92de9.js";const de=f("span",null,"操作",-1),ie={style:{margin:"15px auto 0 auto","text-align":"center"}},re={style:{"margin-left":"12px"}},pe={style:{"margin-left":"12px"}},ve={style:{"margin-left":"12px"}},me={style:{"margin-left":"12px"}},fe={style:{"margin-left":"12px"}},ge={style:{"margin-left":"12px"}},be={style:{"margin-left":"12px"}},ce={key:0,style:{"margin-left":"12px"}},we={__name:"list",props:{query:{type:String,default:()=>""}},setup(W){const b=C("ajax"),d=C("utils"),F=C("qs"),B=C("program_attr_fields"),X=W,D=d.query("programid",X.query),O=p([]),n=p(!1),x=p(!1);let T=[];const $=p({prop:"sort",order:"ascending"}),h=p(d.getPager($.value)),N=p(B.value),G=p([]),R=p([]);ue(()=>{K()});const Y=u=>{T=u},E=u=>{h.value.order=d.getOrder(u),S(!1)},K=()=>{const u=[{id:"programdesigner_showtype",key:"showType",children:!1,valueField:"value"},{id:"programdesigner_algin",key:"align",children:!1,valueField:"value"}];b.post("/Dictionary/GetMultipleOptions",F.stringify({json:JSON.stringify(u)})).then(e=>{G.value=e.data.showType,R.value=e.data.align,S(!1)}).catch(()=>{})},S=u=>{u&&(h.value.number=1),x.value=!0,n.value=!0,b.post("/Program/GetFieldList?programid="+D).then(e=>{O.value=e.data,n.value=!1,x.value=!1}).catch(()=>{n.value=!1,x.value=!1})},a=p({}),c=p(!1),P=p(""),I=p(null),Q={},M=u=>{N.value.length===0?b.post("/Program/GetFieldOptions?programid="+D).then(e=>{N.value=e.data,B.value=e.data,A(u)}).catch(()=>{}):A(u)},A=u=>{d.isDef(u)?b.post("/Program/GetField?fieldid="+u.id).then(e=>{a.value=e.data,a.value.showType=e.data.showType+"",a.value.isShow=e.data.isShow==1,a.value.isSort=e.data.isSort==1,d.isNumberString(a.value.width)?a.value.width=d.toNumber(a.value.width):delete a.value.width,P.value="编辑 - "+e.data.field,c.value=!0}).catch(()=>{}):(a.value={programId:D,showType:"0",align:"left",sort:d.getArrayMax(O.value,"sort")+5},P.value="添加",c.value=!0)},Z=async u=>{u&&await u.validate(e=>{e&&(n.value=!0,b.post("/Program/SaveField",F.stringify(a.value)).then(i=>{let r=i.msg;if(d.length(r)===0)switch(i.code){case 0:r="保存成功！";break;case 1:r="参数错误！";break;case 2:r="一个应用只能添加一个按钮列！";break;default:r="保存失败！";break}d.msg(r,i.success),n.value=!1,i.success&&(S(!1),c.value=!1,a.value={})}).catch(()=>{n.value=!1}))})},ee=()=>{if(T.length===0){d.msg("您没有选择要删除的列表！",!1);return}d.confirm("您确定要删除所选列表吗？",()=>{n.value=!0,b.post("/Program/DeleteField",F.stringify({ids:d.getArrayValues(T,"id").join(",")})).then(u=>{n.value=!1,d.msg(u.success?"删除成功！":"删除失败！",u.success),T=[],S(!1)}).catch(()=>{n.value=!1})})};return(u,e)=>{const i=v("el-table-column"),r=v("el-button"),le=v("el-table"),y=v("el-option"),k=v("el-select"),g=v("el-form-item"),U=v("el-input"),w=v("el-checkbox"),H=v("el-input-number"),ae=v("el-form"),te=v("el-dialog"),oe=se("loading");return m(),_("div",null,[L((m(),V(le,{data:O.value,stripe:h.value.tableStripe,border:h.value.tableBorder,style:{width:"100%"},"highlight-current-row":h.value.tableHighlightCurrentRow,"default-sort":$.value,onSortChange:E,onSelectionChange:Y},{default:o(()=>[t(i,{type:"selection",width:"45"}),t(i,{prop:"field",label:"字段名称"}),t(i,{prop:"showTitle",label:"显示名称"}),t(i,{prop:"showType",label:"显示方式",width:"150"},{default:o(l=>[s(z(l.row.showTypeTitle),1)]),_:1}),t(i,{prop:"align",label:"对齐方式",width:"110"},{default:o(l=>[s(z(l.row.alignTitle),1)]),_:1}),t(i,{prop:"width",label:"宽度",width:"80"}),t(i,{prop:"sort",label:"排序",width:"80"}),t(i,{width:"80"},{header:o(()=>[de]),default:o(l=>[t(r,{size:"small",disabled:n.value,type:"primary",onClick:ye=>M(l.row)},{default:o(()=>[s("编辑")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[oe,x.value]]),f("div",ie,[t(r,{disabled:n.value,type:"primary",onClick:e[0]||(e[0]=l=>M(null))},{default:o(()=>[s("添加")]),_:1},8,["disabled"]),t(r,{disabled:n.value,type:"danger",onClick:e[1]||(e[1]=l=>ee())},{default:o(()=>[s("删除所选")]),_:1},8,["disabled"])]),t(te,{modelValue:c.value,"onUpdate:modelValue":e[19]||(e[19]=l=>c.value=l),title:P.value,"align-center":"","destroy-on-close":"",width:"650px",draggable:"","close-on-click-modal":!1},{default:o(()=>[t(ae,{model:a.value,ref_key:"ruleFormRef",ref:I,rules:Q,"label-width":"80px"},{default:o(()=>[t(g,{label:"字段",prop:"field"},{default:o(()=>[t(k,{modelValue:a.value.field,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.field=l),clearable:"",filterable:"",style:{width:"100%"}},{default:o(()=>[(m(!0),_(j,null,q(N.value,l=>(m(),V(y,{key:l.value,label:l.title,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"显示名称",prop:"showTitle"},{default:o(()=>[t(U,{modelValue:a.value.showTitle,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.showTitle=l),clearable:""},null,8,["modelValue"])]),_:1}),t(g,{label:"显示方式",prop:"showType"},{default:o(()=>[t(k,{modelValue:a.value.showType,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.showType=l),clearable:"",style:{width:"210px"}},{default:o(()=>[(m(!0),_(j,null,q(G.value,l=>(m(),V(y,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),f("span",re,[t(w,{modelValue:a.value.isShow,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.isShow=l)},{default:o(()=>[s("隐藏")]),_:1},8,["modelValue"])]),f("span",pe,[t(w,{modelValue:a.value.isSort,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.isSort=l)},{default:o(()=>[s("排序")]),_:1},8,["modelValue"])]),f("span",ve,[s(" 冻结列"),t(k,{modelValue:a.value.isDefaultSort,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.isDefaultSort=l),style:{width:"73px","margin-left":"12px"}},{default:o(()=>[t(y,{label:"无",value:0}),t(y,{label:"左",value:1}),t(y,{label:"右",value:2})]),_:1},8,["modelValue"])])]),_:1}),L(t(g,{label:"格式",prop:"showFormat"},{default:o(()=>[t(U,{modelValue:a.value.showFormat,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.showFormat=l),clearable:""},null,8,["modelValue"])]),_:1},512),[[ne,a.value.showType==2||a.value.showType==3]]),t(g,{label:"对齐方式",prop:"align"},{default:o(()=>[t(k,{modelValue:a.value.align,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.align=l),clearable:"",style:{width:"110px"}},{default:o(()=>[(m(!0),_(j,null,q(R.value,l=>(m(),V(y,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),f("span",me,[s(" 列宽度"),t(H,{modelValue:a.value.width,"onUpdate:modelValue":e[10]||(e[10]=l=>a.value.width=l),min:0,style:{width:"130px","margin-left":"12px"},clearable:""},null,8,["modelValue"])]),f("span",fe,[t(w,{modelValue:a.value.subTotal,"onUpdate:modelValue":e[11]||(e[11]=l=>a.value.subTotal=l),"true-label":1,"false-label":0},{default:o(()=>[s("小计")]),_:1},8,["modelValue"])]),f("span",ge,[t(w,{modelValue:a.value.total,"onUpdate:modelValue":e[12]||(e[12]=l=>a.value.total=l),"true-label":1,"false-label":0},{default:o(()=>[s("合计")]),_:1},8,["modelValue"])]),f("span",be,[t(w,{modelValue:a.value.typeConvert,"onUpdate:modelValue":e[13]||(e[13]=l=>a.value.typeConvert=l),"true-label":1,"false-label":0},{default:o(()=>[s("类型转换")]),_:1},8,["modelValue"])])]),_:1}),a.value.showType==10?(m(),V(g,{key:0,label:"自定义",prop:"customString"},{default:o(()=>[t(U,{modelValue:a.value.customString,"onUpdate:modelValue":e[14]||(e[14]=l=>a.value.customString=l),clearable:""},null,8,["modelValue"])]),_:1})):J("",!0),t(g,{label:"显示顺序",prop:"sort"},{default:o(()=>[t(H,{step:5,modelValue:a.value.sort,"onUpdate:modelValue":e[15]||(e[15]=l=>a.value.sort=l),style:{width:"110px"},"controls-position":"right"},null,8,["modelValue"]),a.value.showType==7||a.value.showType==8||a.value.showType==9?(m(),_("span",ce,[s(" 显示样式"),t(U,{modelValue:a.value.showStyle,"onUpdate:modelValue":e[16]||(e[16]=l=>a.value.showStyle=l),placeholder:"css样式",style:{width:"339px","margin-left":"12px"}},null,8,["modelValue"])])):J("",!0)]),_:1}),t(g,null,{default:o(()=>[t(r,{disabled:n.value,onClick:e[17]||(e[17]=l=>Z(I.value)),type:"primary"},{default:o(()=>[s("保存")]),_:1},8,["disabled"]),t(r,{disabled:n.value,onClick:e[18]||(e[18]=l=>c.value=!1)},{default:o(()=>[s("关闭")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{we as default};
