import{ai as M,aT as p,c as P,W as l,bD as t,bi as U,aX as c,aY as je,o as w,a as g,H as A,b9 as j,U as f,bF as te,I as Ee,F as oe,aV as de,bv as Ie}from"./_@vue-5ba92de9.js";import{p as se,_ as Oe}from"./_splitpanes-c98d9122.js";const Re={style:{height:"inherit"}},$e={class:"roadui_treenode"},Fe=g("span",null,"操作",-1),Ge={class:"roadui_pagerdiv"},Ne={style:{"margin-left":"12px"}},Le={class:"dialog-footer"},qe={style:{color:"var(--el-text-color-placeholder)"}},Pe={class:"dialog-footer"},Je=g("span",{class:"dialog-footer"},null,-1),Xe={__name:"index",setup(We){const b=M("ajax"),d=M("utils"),D=M("qs"),J=M("config"),ne=M("ElSelectico"),h=p({}),r=p(!1),W=p([]),H=p([]),ue=o=>{h.value.type=o.id,V(!1)},ie={children:"children",label:"title",isLeaf:"isLeaf"},re=(o,e)=>{if(o.level===0)b.post("/Dictionary/GetTreeJson?root=system_applibrary_type").then(n=>{W.value=n.data,d.length(n.data)>0&&H.value.push(n.data[0].id),V(!1)}).catch(()=>{});else{if(d.length(o.data.children)>0){e(o.data.children);return}b.post("/Dictionary/GetTreeChildsJson?parentid="+o.data.id).then(n=>{e(n.data)}).catch(()=>{})}},R=p(!1),K=p([]);let B=[];const X=p({prop:"title",order:"ascending"}),i=p(d.getPager(X.value)),pe=o=>{B=o},ce=o=>{i.value.size=o,V(!1)},fe=o=>{i.value.number=o,V(!1)},me=o=>{i.value.order=d.getOrder(o),V(!1)},V=o=>{o&&(i.value.number=1),R.value=!0,r.value=!0,h.value.size=i.value.size,h.value.number=i.value.number,h.value.order=i.value.order,b.post("/Applibrary/GetList",D.stringify(h.value)).then(e=>{K.value=e.data.rows,i.value.total=e.data.total,r.value=!1,R.value=!1}).catch(()=>{r.value=!1})},ve=()=>{if(B.length===0){d.msg("请选择要删除的应用！","error");return}d.confirm("您确定要删除所选应用吗？",()=>{r.value=!0,b.post("/Applibrary/Delete",D.stringify({ids:d.getArrayValues(B,"id").join(",")})).then(o=>{let e=o.msg;d.length(e)===0&&(e=o.success?"删除成功！":"删除失败！"),d.msg(e,o.success),r.value=!1,o.success&&(B=[],V(!1))}).catch(()=>{r.value=!1})})},s=p({}),Y=p("添加应用"),z=p(!1),$=p([]),F=p([]),Q=p(null),ge={title:[{required:!0,message:"请输入应用标题",trigger:"blur"}],address:[{required:!0,message:"请输入应用地址",trigger:"blur"}],type1:[{required:!0,message:"请选择应用分类",trigger:"blur"}],openMode:[{required:!0,message:"请选择应用打开方式",trigger:"change"}]},be=()=>{if(d.length($.value)===0||d.length(F.value)==0){const o=[{id:"system_applibrary_openmode",key:"openMode",children:!1,valueField:"value"},{id:"system_applibrary_type",key:"type",children:!0,valueField:"id"}];b.post("/Dictionary/GetMultipleOptions",D.stringify({json:JSON.stringify(o)})).then(e=>{F.value=e.data.openMode,$.value=e.data.type}).catch(()=>{})}},Z=o=>{be(),d.isDef(o)&&d.length(o.id)>0?b.post("/Applibrary/Get?appid="+o.id).then(e=>{if(!e.success){d.msg("获取应用程序数据失败！",e.success);return}s.value=e.data,s.value.openMode=""+e.data.openMode,e.data.width==0&&delete s.value.width,e.data.height==0&&delete s.value.height,Y.value="编辑应用 - "+e.data.title,z.value=!0}).catch(()=>{}):b.post("/Dictionary/GetCascaderTypes?dictid="+(h.value.type||"")+"&root=system_applibrary_type").then(e=>{s.value={id:d.emptyLong,openMode:"0",type1:e.data},z.value=!0}).catch(()=>{})},he=async o=>{o&&await o.validate(e=>{e&&(r.value=!0,s.value.type=s.value.type1[s.value.type1.length-1],delete s.value.type1,d.length(s.value.width)===0&&(s.value.width=0),d.length(s.value.height)===0&&(s.value.height=0),b.post("/Applibrary/Save?appid="+(s.value.id||""),D.stringify(s.value)).then(n=>{r.value=!1;let y=n.msg;d.length(y)===0&&(n.success?y="保存成功！":n.code==1?y="数据验证错误！":y="保存失败！"),d.msg(y,n.success),n.success&&(z.value=!1,V(!1))}).catch(()=>{r.value=!1}))})},T=p(!1),S=p([]),G=p([]),E=p(!1);var I=0;const ye=o=>{d.length(o.id)!==0&&(I=o.id,b.post("/Applibrary/GetButtons?appid="+I).then(e=>{if(!e.success){d.msg("获取应用程序按钮失败！",e.success);return}for(let n=0;n<e.data.rows.length;n++)e.data.rows[n].buttonId==0&&(e.data.rows[n].buttonId="");S.value=e.data.rows,G.value=e.data.buttonOptions,T.value=!0}).catch(()=>{}))},_e=(o,e)=>{const n=d.getArrayObj(G.value,o,"id");e.name=n===null?"":n.name,e.scripts=n===null?"":n.scripts,e.ico=n===null?"":n.ico},Ve=()=>{E.value=!0;const o={total:S.value.length,button:S.value};b.post("/Applibrary/SaveButtons?appid="+I,D.stringify(o)).then(e=>{let n=e.msg;d.length(n)===0&&(n=e.success?"保存成功！":"保存失败！"),d.msg(n,e.success),E.value=!1,e.success&&(T.value=!1)}).catch(()=>{})},we=()=>{S.value.push({key:d.createGuid(!1),applibraryId:I,name:"",scripts:"",ico:"",showType:1,isValidate:1,note:"",address:"",sort:d.getArrayMax(S.value,"sort")+5})},ke=o=>{const e=d.hasKey(o,"id");d.removeArrayObj(S.value,e?o.id:o.key,e?"id":"key")},Ce=()=>{let o=d.getArrayValues(B,"id");if(o.length===0){d.msg("您没有选择要导出的应用！",!1);return}const e=J.SERVER_WEBADDRESS+"/Export/ApplibraryExport?appid="+o.join(",");window.location.href=e},O=p(!1),xe=()=>{O.value=!0},Ue=o=>o.type!=="application/json"?(d.msg("要导入的文件必须是json格式文件!",!1),!1):!0,Se=(o,e)=>{if(e.status==="success"){if(o.code!=0){d.msg("文件上传失败！",!1);return}const y=o.data.id;b.post("/Applibrary/ImportApp",D.stringify({files:y})).then(k=>{let C=k.msg;d.length(C)===0&&(k.success?C="导入成功！":k.code==1?C="要导入的文件不存在！":k.code==2?C="要导入的文件不是有效的json格式文件！":C="导入失败！"),d.msg(C,k.success),k.success&&(O.value=!1,V(!1))}).catch(()=>{})}else e.status==="error"&&d.msg("文件上传失败！",!1)};return(o,e)=>{const n=c("document"),y=c("el-icon"),k=c("folder"),C=c("el-tree"),x=c("el-input"),_=c("el-form-item"),m=c("el-button"),ee=c("el-form"),v=c("el-table-column"),le=c("el-table"),De=c("el-pagination"),ze=c("el-cascader"),Ae=c("el-radio"),Be=c("el-radio-group"),N=c("el-input-number"),L=c("el-dialog"),q=c("el-option"),ae=c("el-select"),Te=c("el-upload"),Me=je("loading");return w(),P("div",Re,[l(U(Oe),{class:"default-theme",style:{height:"inherit"}},{default:t(()=>[l(U(se),{size:16,"min-size":"16","max-size":"50",style:{overflow:"auto",background:"#fff"}},{default:t(()=>[l(C,{data:W.value,props:ie,load:re,lazy:"","node-key":"id","highlight-current":"","default-expanded-keys":H.value,"expand-on-click-node":!1,style:{height:"inherit","padding-right":"14px"},onNodeClick:ue},{default:t(a=>[g("div",$e,[a.node.isLeaf?(w(),A(y,{key:0},{default:t(()=>[l(n)]),_:1})):(w(),A(y,{key:1},{default:t(()=>[l(k)]),_:1})),g("span",null,j(a.node.label),1)])]),_:1},8,["data","default-expanded-keys"])]),_:1}),l(U(se),{size:84,style:{background:"#fff",overflow:"auto","padding-left":"5px"}},{default:t(()=>[g("div",null,[l(ee,{inline:!0},{default:t(()=>[l(_,{label:"标题"},{default:t(()=>[l(x,{modelValue:h.value.title,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value.title=a),placeholder:"应用标题",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),l(_,{label:"地址"},{default:t(()=>[l(x,{modelValue:h.value.address,"onUpdate:modelValue":e[1]||(e[1]=a=>h.value.address=a),placeholder:"应用地址",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),l(_,null,{default:t(()=>[l(m,{type:"primary",disabled:r.value,onClick:e[2]||(e[2]=a=>V(!0))},{default:t(()=>[f("查询")]),_:1},8,["disabled"]),l(m,{type:"primary",disabled:r.value,onClick:e[3]||(e[3]=a=>Z())},{default:t(()=>[f("添加")]),_:1},8,["disabled"]),l(m,{type:"danger",disabled:r.value,onClick:ve},{default:t(()=>[f("删除")]),_:1},8,["disabled"]),l(m,{disabled:r.value,onClick:Ce},{default:t(()=>[f("导出")]),_:1},8,["disabled"]),l(m,{disabled:r.value,onClick:xe},{default:t(()=>[f("导入")]),_:1},8,["disabled"])]),_:1})]),_:1})]),g("div",null,[te((w(),A(le,{data:K.value,stripe:i.value.tableStripe,border:i.value.tableBorder,style:{width:"100%"},"highlight-current-row":i.value.tableHighlightCurrentRow,"default-sort":X.value,onSortChange:me,onSelectionChange:pe},{default:t(()=>[l(v,{type:"selection",width:"45"}),l(v,{prop:"title",label:"标题",width:"220","show-overflow-tooltip":"",sortable:"custom"}),l(v,{prop:"address",label:"地址","show-overflow-tooltip":"",sortable:"custom"}),l(v,{prop:"type",label:"分类",width:"220",sortable:"custom"}),l(v,{width:"150"},{header:t(()=>[Fe]),default:t(a=>[l(m,{size:"small",disabled:r.value,type:"primary",onClick:u=>Z(a.row)},{default:t(()=>[f("编辑")]),_:2},1032,["disabled","onClick"]),l(m,{size:"small",disabled:r.value,type:"info",onClick:u=>ye(a.row)},{default:t(()=>[f("按钮")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[Me,R.value]])]),g("div",Ge,[l(De,{currentPage:i.value.number,"onUpdate:currentPage":e[4]||(e[4]=a=>i.value.number=a),"page-size":i.value.size,"onUpdate:pageSize":e[5]||(e[5]=a=>i.value.size=a),"page-sizes":i.value.sizes,background:i.value.background,layout:i.value.layout,total:i.value.total,disabled:r.value,onSizeChange:ce,onCurrentChange:fe},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])])]),_:1})]),_:1}),l(L,{modelValue:z.value,"onUpdate:modelValue":e[15]||(e[15]=a=>z.value=a),title:Y.value,"align-center":"","destroy-on-close":"",width:"700px",draggable:"","close-on-click-modal":!1},{footer:t(()=>[g("span",Le,[l(m,{disabled:r.value,type:"primary",onClick:e[13]||(e[13]=a=>he(Q.value))},{default:t(()=>[f("保存")]),_:1},8,["disabled"]),l(m,{disabled:r.value,onClick:e[14]||(e[14]=a=>z.value=!1)},{default:t(()=>[f("关闭")]),_:1},8,["disabled"])])]),default:t(()=>[l(ee,{model:s.value,ref_key:"ruleFormRef",ref:Q,rules:ge,"label-width":"80px"},{default:t(()=>[U(d).length(s.value.id)>0&&s.value.id>U(d).emptyLong?(w(),A(_,{key:0,label:"应用id"},{default:t(()=>[f(j(s.value.id),1)]),_:1})):Ee("",!0),l(_,{label:"应用标题",prop:"title"},{default:t(()=>[l(x,{modelValue:s.value.title,"onUpdate:modelValue":e[6]||(e[6]=a=>s.value.title=a),clearable:""},null,8,["modelValue"])]),_:1}),l(_,{label:"应用地址",prop:"address"},{default:t(()=>[l(x,{modelValue:s.value.address,"onUpdate:modelValue":e[7]||(e[7]=a=>s.value.address=a),clearable:""},null,8,["modelValue"])]),_:1}),l(_,{label:"应用分类",prop:"type1"},{default:t(()=>[l(ze,{modelValue:s.value.type1,"onUpdate:modelValue":e[8]||(e[8]=a=>s.value.type1=a),options:$.value,style:{width:"100%"},props:{expandTrigger:"hover"}},null,8,["modelValue","options"])]),_:1}),l(_,{label:"打开方式",prop:"openMode"},{default:t(()=>[l(Be,{modelValue:s.value.openMode,"onUpdate:modelValue":e[9]||(e[9]=a=>s.value.openMode=a)},{default:t(()=>[(w(!0),P(oe,null,de(F.value,a=>(w(),A(Ae,{key:a.value,label:a.value},{default:t(()=>[f(j(a.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),te(l(_,{label:"窗口宽度",prop:"width"},{default:t(()=>[l(N,{modelValue:s.value.width,"onUpdate:modelValue":e[10]||(e[10]=a=>s.value.width=a),style:{width:"150px"},"controls-position":"right"},null,8,["modelValue"]),g("span",Ne,[f(" 窗口高度"),l(N,{modelValue:s.value.height,"onUpdate:modelValue":e[11]||(e[11]=a=>s.value.height=a),style:{width:"150px","margin-left":"12px"},"controls-position":"right"},null,8,["modelValue"])])]),_:1},512),[[Ie,s.value.openMode==1||s.value.openMode==2]]),l(_,{label:"备注",prop:"note"},{default:t(()=>[l(x,{modelValue:s.value.note,"onUpdate:modelValue":e[12]||(e[12]=a=>s.value.note=a),clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(L,{modelValue:T.value,"onUpdate:modelValue":e[17]||(e[17]=a=>T.value=a),title:"编辑应用按钮","align-center":"","destroy-on-close":"",width:"1200px",draggable:"","close-on-click-modal":!1},{footer:t(()=>[g("span",Pe,[l(m,{disabled:E.value,onClick:Ve,type:"primary"},{default:t(()=>[f("保存")]),_:1},8,["disabled"]),l(m,{disabled:E.value,onClick:e[16]||(e[16]=a=>T.value=!1)},{default:t(()=>[f("关闭")]),_:1},8,["disabled"])])]),default:t(()=>[l(le,{data:S.value,stripe:i.value.tableStripe,border:i.value.tableBorder,style:{width:"100%"}},{default:t(()=>[l(v,{prop:"select",label:"选择",width:"150"},{default:t(a=>[l(ae,{modelValue:a.row.buttonId,"onUpdate:modelValue":u=>a.row.buttonId=u,onChange:u=>_e(u,a.row),clearable:""},{default:t(()=>[(w(!0),P(oe,null,de(G.value,u=>(w(),A(q,{key:u.id,label:u.name,value:u.id},{default:t(()=>[g("span",null,[f(j(u.name),1),g("span",qe," - "+j(u.note),1)])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(v,{prop:"name",label:"名称",width:"130"},{default:t(a=>[l(x,{modelValue:a.row.name,"onUpdate:modelValue":u=>a.row.name=u,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(v,{prop:"scripts",label:"脚本"},{default:t(a=>[l(x,{type:"textarea",modelValue:a.row.scripts,"onUpdate:modelValue":u=>a.row.scripts=u,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(v,{prop:"ico",label:"图标",width:"145"},{default:t(a=>[l(U(ne),{modelValue:a.row.ico,"onUpdate:modelValue":u=>a.row.ico=u,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(v,{prop:"showType",label:"类型",width:"130"},{default:t(a=>[l(ae,{modelValue:a.row.showType,"onUpdate:modelValue":u=>a.row.showType=u,style:{width:"100px"},clearable:""},{default:t(()=>[l(q,{value:1,label:"常规按钮"}),l(q,{value:2,label:"列表按钮"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),l(v,{prop:"address",label:"地址"},{default:t(a=>[l(x,{modelValue:a.row.address,"onUpdate:modelValue":u=>a.row.address=u,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(v,{prop:"sort",label:"排序",width:"125"},{default:t(a=>[l(N,{modelValue:a.row.sort,"onUpdate:modelValue":u=>a.row.sort=u,step:5,min:0,style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(v,{width:"80"},{header:t(()=>[l(m,{size:"small",type:"primary",onClick:we},{default:t(()=>[f(" 添加 ")]),_:1})]),default:t(a=>[l(m,{size:"small",type:"primary",onClick:u=>ke(a.row)},{default:t(()=>[f(" 删除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","stripe","border"])]),_:1},8,["modelValue"]),l(L,{modelValue:O.value,"onUpdate:modelValue":e[18]||(e[18]=a=>O.value=a),title:"导入",class:"el-dialog__padding1","align-center":"","destroy-on-close":"",width:"350px",draggable:"","close-on-click-modal":!1},{footer:t(()=>[Je]),default:t(()=>[l(Te,{action:U(J).SERVER_WEBADDRESS+"/Files/SaveFiles","show-file-list":!1,accept:".json",headers:{"nroadflow-token":U(d).getToken()},"with-credentials":"",data:{filetype:".json",uploadtype:0},"on-success":Se,"before-upload":Ue},{default:t(()=>[l(m,{type:"primary"},{default:t(()=>[f("选择文件")]),_:1})]),_:1},8,["action","headers","data"])]),_:1},8,["modelValue"])])}}};export{Xe as default};
