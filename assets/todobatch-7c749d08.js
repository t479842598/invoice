import{ai as y,aT as r,aF as se,c as Y,a as C,W as t,bD as a,bF as de,H as D,aX as u,aY as re,o as k,bi as f,U as p,b9 as T,I as ie,F as me,aV as pe}from"./_@vue-5ba92de9.js";const ce={class:"roadui_page"},ve=["onClick"],fe={class:"roadui_pagerdiv"},be={__name:"todobatch",setup(ge){const x=y("ajax"),s=y("utils"),U=y("qs"),q=y("ElSelectflow"),F=y("index_openmenu"),d=r(!1),V=r(!1),I=r([]),i=r({batch:1}),g=r([]),N=r({prop:"receivetime",order:"descending"}),n=r(s.getPager(N.value));let z=[];const S=r([]),_=r(!1),$=r(null),m=r({comment1:"",handleType:0}),E={comment:[{required:!0,message:"请选输入处理意见",trigger:"blur"}],handleType:[{required:!0,message:"请选择处理类型",trigger:"blur"}]};se(()=>{b(!1)});const G=o=>{z=o},O=o=>{n.value.size=o,b(!1)},H=o=>{n.value.number=o,b(!1)},L=o=>{n.value.order=s.getOrder(o),b(!1)},b=o=>{o&&(n.value.number=1),V.value=!0,d.value=!0,i.value.size=n.value.size,i.value.number=n.value.number,i.value.order=n.value.order,i.value.date1=s.length(g.value)>0?g.value[0]:"",i.value.date2=s.length(g.value)>1?g.value[1]:"",x.post("/Flow/GetTodoList",U.stringify(i.value)).then(l=>{I.value=l.data.rows,n.value.total=l.data.total,d.value=!1,V.value=!1}).catch(()=>{d.value=!1,V.value=!1})},B=o=>{const l={title:o.title,id:"task_"+o.id,url:"/flow/run/index?flowid="+o.flowId+"&stepid="+o.stepId+"&taskid="+o.id+"&groupid="+o.groupId+"&instanceid="+o.instanceId,ico:"Edit",openMode:0};F(l)},A=o=>{const l={id:"task_process_"+s.createGuid(!1),title:o.title,url:"/flow/run/process?flowid="+o.flowId+"&groupid="+o.groupId+"&status=0",openMode:1,width:"1150px",customClass:"el-dialog__padding",center:!1};F(l)},W=()=>{if(S.value.length>0){_.value=!0;return}x.post("/FlowComment/GetUserComments").then(o=>{S.value=o.data,_.value=!0}).catch(()=>{})},X=()=>{if(z.length===0){s.msg("请选择要批量处理的任务！",!1);return}W()},J=async o=>{o&&await o.validate(l=>{l&&(d.value=!0,x.post("/Flow/FlowBatchExecute",U.stringify({tasks:s.getArrayValues(z,"id").join(","),comment:m.value.comment,handleType:m.value.handleType})).then(h=>{h.success?(s.msg("成功批量处理了"+h.data+"个任务！",!0),b(!1),_.value=!1):s.msg("批量处理发生了错误！",!1),d.value=!1}).catch(()=>{d.value=!1}))})};return(o,l)=>{const h=u("el-input"),c=u("el-form-item"),K=u("el-date-picker"),w=u("el-button"),j=u("el-form"),v=u("el-table-column"),M=u("el-tag"),Q=u("el-tooltip"),Z=u("el-space"),ee=u("el-table"),le=u("el-pagination"),te=u("el-option"),ae=u("el-select"),P=u("el-radio"),oe=u("el-radio-group"),ne=u("el-dialog"),ue=re("loading");return k(),Y("div",ce,[C("div",null,[t(j,{inline:!0},{default:a(()=>[t(c,{label:"标题"},{default:a(()=>[t(h,{modelValue:i.value.title,"onUpdate:modelValue":l[0]||(l[0]=e=>i.value.title=e),clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(c,{label:"流程"},{default:a(()=>[t(f(q),{modelValue:i.value.flowId,"onUpdate:modelValue":l[1]||(l[1]=e=>i.value.flowId=e),"auth-type":8},null,8,["modelValue"])]),_:1}),t(c,{label:"接收时间"},{default:a(()=>[t(K,{modelValue:g.value,"onUpdate:modelValue":l[2]||(l[2]=e=>g.value=e),style:{width:"210px"},type:"daterange","value-format":"YYYY-MM-DD","unlink-panels":"","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:f(s).dateShortucts},null,8,["modelValue","shortcuts"])]),_:1}),t(c,null,{default:a(()=>[t(w,{type:"primary",disabled:d.value,onClick:l[3]||(l[3]=e=>b(!0))},{default:a(()=>[p("查询")]),_:1},8,["disabled"]),t(w,{type:"primary",disabled:d.value,onClick:l[4]||(l[4]=e=>X())},{default:a(()=>[p("批量处理")]),_:1},8,["disabled"])]),_:1})]),_:1})]),C("div",null,[de((k(),D(ee,{data:I.value,stripe:n.value.tableStripe,border:n.value.tableBorder,style:{width:"100%"},"highlight-current-row":n.value.tableHighlightCurrentRow,"default-sort":N.value,onSortChange:L,onSelectionChange:G},{default:a(()=>[t(v,{type:"selection",width:"45"}),t(v,{prop:"title",label:"标题",sortable:"custom"},{default:a(e=>[e.row.taskType>0?(k(),D(M,{key:0,effect:"dark",style:{"margin-right":"8px","border-width":"0"},color:f(s).getTaskTypeColor(e.row.taskType)},{default:a(()=>[p(T(f(s).getTaskTypeTitle(e.row.taskType)),1)]),_:2},1032,["color"])):ie("",!0),C("a",{class:"roaduia",href:"javascript:;",onClick:R=>B(e.row)},T(e.row.title),9,ve)]),_:1}),t(v,{prop:"flowName",label:"流程",width:"160",sortable:"custom"}),t(v,{prop:"stepName",label:"步骤",width:"150",sortable:"custom"}),t(v,{prop:"senderName",label:"发送人",width:"100"}),t(v,{prop:"receiveTime",label:"接收时间",width:"150",sortable:"custom"}),t(v,{prop:"status",label:"状态",width:"100",sortable:"custom"},{default:a(e=>[t(Q,{placement:"left"},{content:a(()=>[C("span",null,T(f(s).length(e.row.completeTime)>0?"要求完成时间："+e.row.completeTime:"无要求完成时间"),1)]),default:a(()=>[t(M,{color:f(s).getTaskStatusColor(e.row.status),effect:"dark",style:{"border-width":"0"}},{default:a(()=>[p(T(f(s).getTaskStatusTitle(e.row.status)),1)]),_:2},1032,["color"])]),_:2},1024)]),_:1}),t(v,{width:"138"},{default:a(e=>[t(Z,null,{default:a(()=>[t(w,{type:"primary",size:"small",disabled:d.value,onClick:R=>B(e.row)},{default:a(()=>[p("处理")]),_:2},1032,["disabled","onClick"]),t(w,{type:"info",size:"small",disabled:d.value,onClick:R=>A(e.row)},{default:a(()=>[p("过程")]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[ue,V.value]]),C("div",fe,[t(le,{currentPage:n.value.number,"onUpdate:currentPage":l[5]||(l[5]=e=>n.value.number=e),"page-size":n.value.size,"onUpdate:pageSize":l[6]||(l[6]=e=>n.value.size=e),"page-sizes":n.value.sizes,background:n.value.background,layout:n.value.layout,total:n.value.total,disabled:d.value,onSizeChange:O,onCurrentChange:H},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])])]),t(ne,{modelValue:_.value,"onUpdate:modelValue":l[13]||(l[13]=e=>_.value=e),title:"批量处理","destroy-on-close":"",width:"650px",draggable:"","close-on-click-modal":!1},{default:a(()=>[t(j,{model:m.value,ref_key:"ruleFormRef",ref:$,rules:E,"label-width":"80px"},{default:a(()=>[t(c,{label:"常用意见",prop:"comment1"},{default:a(()=>[t(ae,{modelValue:m.value.comment1,"onUpdate:modelValue":l[7]||(l[7]=e=>m.value.comment1=e),onChange:l[8]||(l[8]=e=>{m.value.comment=e}),style:{width:"100%"}},{default:a(()=>[(k(!0),Y(me,null,pe(S.value,e=>(k(),D(te,{key:e.id,label:e.comment,value:e.comment},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"处理意见",prop:"comment"},{default:a(()=>[t(h,{type:"textarea",modelValue:m.value.comment,"onUpdate:modelValue":l[9]||(l[9]=e=>m.value.comment=e),rows:3,clearable:""},null,8,["modelValue"])]),_:1}),t(c,{label:"处理类型",prop:"handleType"},{default:a(()=>[t(oe,{modelValue:m.value.handleType,"onUpdate:modelValue":l[10]||(l[10]=e=>m.value.handleType=e)},{default:a(()=>[t(P,{label:0},{default:a(()=>[p("通过")]),_:1}),t(P,{label:1},{default:a(()=>[p("退回")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(c,null,{default:a(()=>[t(w,{type:"primary",disabled:d.value,onClick:l[11]||(l[11]=e=>J($.value))},{default:a(()=>[p("确定")]),_:1},8,["disabled"]),t(w,{onClick:l[12]||(l[12]=e=>_.value=!1)},{default:a(()=>[p("取消")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};export{be as default};
