import{p as J,_ as ze}from"./_splitpanes-c98d9122.js";import je from"./sharemy-6b78e729.js";import Ae from"./myshare-46e94ccd.js";import{a as K}from"./_element-plus-8c7ce171.js";import{ai as D,aT as u,b5 as Be,aF as Me,c as F,W as a,bD as s,bi as b,aX as r,o as _,a as i,H as S,aZ as Q,b9 as V,U as m,F as qe,aV as He,I as j}from"./_@vue-5ba92de9.js";import"./__vendor-5e6ac033.js";import"./_@element-plus-ad4c9002.js";import"./_@popperjs-c75af06c.js";const We={style:{height:"inherit"}},Oe={class:"roadui_treenode"},Ye={key:0},Ge={class:"roadui_toolbar"},Je={type:"button"},Ke=i("div",null,[i("span",null,"|")],-1),Qe={style:{margin:"12px 0 8px 0"}},Xe={style:{float:"left"}},Ze={style:{float:"right"}},et=i("div",{style:{clear:"both"}},null,-1),tt=["onClick"],lt={key:1},at={class:"roadui_treenode"},ot={key:0,class:"roadui_note",style:{"margin-left":"3px"}},nt={class:"dialog-footer"},st={class:"dialog-footer"},gt={__name:"index",setup(it){const k=D("ajax"),o=D("utils"),A=D("config"),x=D("qs"),X=D("index_openmenu"),Z=o.getToken(),$=u(o.emptyLong+""),g=u([{title:"我的文件",dir:""}]),L=Be(null),ee=u("");Me(()=>{h(!1)});const te=u(null),le=u([{id:o.emptyLong+"",parentId:"0",title:"我的文件",ico:"Folder",titleEn:"",titleTw:"",isLeaf:!0},{id:"share_my",parentId:"0",title:"分享给我的文件",ico:"Wallet",titleEn:"",titleTw:"",isLeaf:!0},{id:"my_share",parentId:"0",title:"我分享的文件",ico:"FolderChecked",titleEn:"",titleTw:"",isLeaf:!0}]),ae=u([]),B={children:"children",label:"title",isLeaf:"isLeaf"},oe=t=>{t.id===o.emptyLong+""?(g.value=[{title:"我的文件",dir:""}],h(!1)):t.id==="share_my"?L.value=je:t.id==="my_share"&&(L.value=Ae),$.value=t.id},ne=t=>{let e=[];for(let d=0;d<g.value.length&&!(d>t);d++)e.push(g.value[d]);g.value=e,h(!1)},se=t=>{g.value.push({title:t,dir:t}),h(!1)},I=()=>{let t=[];for(let e=0;e<g.value.length;e++)g.value[e].dir!==""&&t.push(g.value[e].dir);return t.join("/")},c=u(!1),v=u(!1),C=u({}),M=u([]);let f=[];const q=u({prop:"name",order:"ascending"}),y=u(o.getPager(q.value)),ie=t=>{f=t},de=t=>{y.value.order=o.getOrder(t),h(!1)},h=t=>{t&&(y.value.number=1),v.value=!0,c.value=!0,C.value.size=y.value.size,C.value.number=y.value.number,C.value.order=y.value.order,C.value.path=I(),k.post("/File/GetUserList",x.stringify(C.value)).then(e=>{M.value=e.data,y.value.total=e.data.length,c.value=!1,v.value=!1}).catch(()=>{c.value=!1})},re=t=>{t.type===0?se(t.name):o.showFile(X,{name:t.name,id:t.id},A.SERVER_WEBADDRESS,!1)},ue=(t,e)=>{const d=e.response;d.code===0?h(!1):d.code===401||d.code===3?o.msg("未找到用户登录信息！",!1):d.code===2&&o.msg("不允许上传的文件类型！",!1)},fe=()=>{o.msg("文件上传失败！",!1)},ce=()=>{K.prompt("请输入文件夹名称","新建文件夹",{inputPattern:/\S/,inputErrorMessage:"文件夹名称不能为空！"}).then(({value:t})=>{c.value=!0,v.value=!0,k.post("/File/CreateFolder",x.stringify({name:t,path:I()})).then(e=>{c.value=!1,v.value=!1,e.code===0?h(!1):e.code===1?o.msg("目录名称为空！",!1):e.code===2?o.msg("权限错误！",!1):e.code===3?o.msg("目录已经存在！",!1):e.code===4&&o.msg(e.msg,!1)}).catch(()=>{c.value=!1,v.value=!1})}).catch(()=>{})},pe=()=>{if(f.length===0){o.msg("请选择要重命名的文件或文件夹！",!1);return}let t=f[0],e=t.type===0?"文件夹":"文件";K.prompt("请输入新的"+e+"名称","重命名",{inputPattern:/\S/,inputValue:t.name,inputErrorMessage:e+"名称不能为空！"}).then(({value:d})=>{c.value=!0,v.value=!0,k.post("/File/Rename",x.stringify({name:d,type:t.type,id:t.id})).then(l=>{c.value=!1,v.value=!1,l.code===0?h(!1):l.code===1?o.msg(e+"为空！",!1):l.code===2?o.msg("名称为空！",!1):l.code===3?o.msg("没有登录！",!1):l.code===4?o.msg("没有权限！",!1):l.code===5&&o.msg(l.msg,!1)}).catch(()=>{c.value=!1,v.value=!1})}).catch(()=>{})},E=u(!1),P=u([]),U=u(null),H=u([]),z=u(null),me=(t,e)=>{if(t.level===0)k.post("/File/GetTreeJson").then(d=>{const l={id:o.emptyLong+"",parentId:"0",title:"我的文件",ico:"Folder",titleEn:"",titleTw:"",isLeaf:!0};d.data.length>0&&(l.children=d.data,H.value.push(l.id)),P.value=[],P.value.push(l)}).catch(()=>{});else{if(o.length(t.data.children)>0){e(t.data.children);return}let d=U.value.getNodePath(t),l=[];for(let p=0;p<d.length;p++)d[p].parentId!="0"&&l.push(d[p].title);k.post("/File/GetTreeChildsJson",x.stringify({id:t.data.id,path:l.join("/")})).then(p=>{e(p.data)}).catch(()=>{})}},ve=t=>{z.value=t},_e=()=>{if(f.length===0){o.msg("请选择要移动的文件或文件夹！",!1);return}E.value=!0},ge=()=>{if(o.isUndef(z.value)){o.msg("请选择要移动到的文件夹！",!1);return}let t=f[0],e=U.value.getNodePath(z.value),d=[];for(let l=0;l<e.length;l++)e[l].parentId!="0"&&d.push(e[l].title);k.post("/File/MoveTo",x.stringify({id:t.id,dir:d.join("/"),type:t.type})).then(l=>{c.value=!1,v.value=!1,l.code===0?(E.value=!1,h(!1)):l.code===1?o.msg("文件或文件夹为空！",!1):l.code===2?o.msg("要移动到的文件或文件夹为空！",!1):l.code===3?o.msg("没有登录！",!1):l.code===4?o.msg("没有权限！",!1):l.code===5&&o.msg(l.msg,!1)}).catch(()=>{c.value=!1,v.value=!1})},he=()=>{if(f.length===0){o.msg("请选择要删除的文件或文件夹！",!1);return}o.confirm("您确定要删除吗？",()=>{let t=[];for(let e=0;e<f.length;e++)t.push({id:f[e].id,type:f[e].type});k.post("/File/Delete1",x.stringify({files:t,length:f.length})).then(e=>{c.value=!1,v.value=!1,e.code===0?h(!1):e.code===1&&o.msg(e.msg,!1)}).catch(()=>{c.value=!1,v.value=!1})})},ye=D("ElSelectorg"),T=u(!1),w=u({}),W=u(null),be={toUserId:[{required:!0,message:"请选择接收人",trigger:"blur"}]},ke=()=>{let t=[];for(let e=0;e<f.length;e++)f[e].type==1?t.push(f[e]):f[e].type==0&&o.msg("文件夹不能分享！",!1);if(t.length===0){o.msg("请选择要分享的文件！",!1);return}T.value=!0},we=async t=>{t&&await t.validate(e=>{if(e){c.value=!0;let d=[];for(let l=0;l<f.length;l++)f[l].type==1&&d.push(f[l].id);w.value.files=d.join("|"),k.post("/File/SaveShare",x.stringify(w.value)).then(l=>{let p=l.msg;o.length(p)===0&&(l.success?p="分享成功！":p="分享失败！"),o.msg(p,l.success),c.value=!1,l.success&&(w.value={},T.value=!1)}).catch(()=>{c.value=!1})}})};return(t,e)=>{const d=r("Folder"),l=r("el-icon"),p=r("el-tree"),xe=r("DocumentAdd"),Ce=r("el-upload"),De=r("FolderAdd"),Fe=r("EditPen"),Se=r("Switch"),Ve=r("Share"),Ee=r("Delete"),Te=r("el-link"),Re=r("ArrowRight"),Ne=r("el-input"),R=r("el-button"),N=r("el-table-column"),$e=r("Document"),Le=r("el-table"),Ie=r("folder"),O=r("el-dialog"),Y=r("el-form-item"),Pe=r("el-date-picker"),Ue=r("el-form");return _(),F("div",We,[a(b(ze),{class:"default-theme",style:{height:"inherit"}},{default:s(()=>[a(b(J),{size:16,"min-size":"16","max-size":"50",style:{overflow:"auto",background:"#fff"}},{default:s(()=>[a(p,{data:le.value,props:B,"node-key":"id",ref_key:"fileTreeRef",ref:te,"highlight-current":"","default-expanded-keys":ae.value,style:{height:"inherit","padding-right":"14px"},"expand-on-click-node":!1,onNodeClick:oe},{default:s(n=>[i("div",Oe,[b(o).length(n.data.ico)>0?(_(),S(Q(n.data.ico),{key:0,class:"roadui_main_tabico"})):(_(),S(l,{key:1},{default:s(()=>[a(d)]),_:1})),i("span",null,V(n.node.label),1)])]),_:1},8,["data","default-expanded-keys"])]),_:1}),a(b(J),{size:84,style:{background:"#fff",overflow:"auto","padding-left":"5px"}},{default:s(()=>[$.value===b(o).emptyLong+""?(_(),F("div",Ye,[i("div",Ge,[i("div",null,[a(Ce,{ref:"uploadRef",style:{display:"inline-flex",margin:"0"},action:b(A).SERVER_WEBADDRESS+"/Files/SaveFiles",headers:{"nroadflow-token":b(Z)},data:{filetype:"",path:I(),uploadtype:2},"with-credentials":"","on-success":ue,"on-error":fe,multiple:"","show-file-list":!1},{default:s(()=>[i("button",Je,[a(l,null,{default:s(()=>[a(xe)]),_:1}),m("上传文件")])]),_:1},8,["action","headers","data"])]),i("div",null,[i("button",{onClick:e[0]||(e[0]=n=>ce()),type:"button"},[a(l,null,{default:s(()=>[a(De)]),_:1}),m("新建文件夹")])]),Ke,i("div",null,[i("button",{onClick:e[1]||(e[1]=n=>pe()),type:"button"},[a(l,null,{default:s(()=>[a(Fe)]),_:1}),m("重命名")])]),i("div",null,[i("button",{onClick:e[2]||(e[2]=n=>_e()),type:"button"},[a(l,null,{default:s(()=>[a(Se)]),_:1}),m("移动")])]),i("div",null,[i("button",{onClick:e[3]||(e[3]=n=>ke()),type:"button"},[a(l,null,{default:s(()=>[a(Ve)]),_:1}),m("分享")])]),i("div",null,[i("button",{onClick:e[4]||(e[4]=n=>he()),type:"button"},[a(l,null,{default:s(()=>[a(Ee)]),_:1}),m("删除")])])]),i("div",null,[i("div",Qe,[i("div",Xe,[(_(!0),F(qe,null,He(g.value,(n,G)=>(_(),F("span",null,[a(Te,{onClick:dt=>ne(G)},{default:s(()=>[m(V(n.title),1)]),_:2},1032,["onClick"]),n!==g.value[g.value.length-1]?(_(),S(l,{key:0,style:{"font-size":"12px",margin:"0 3px","vertical-align":"-3px",color:"var(--el-text-color-regular)"}},{default:s(()=>[a(Re)]),_:1})):j("",!0)]))),256))]),i("div",Ze,[a(Ne,{modelValue:C.value.name,"onUpdate:modelValue":e[5]||(e[5]=n=>C.value.name=n),size:"small",placeholder:"输入关键字搜索",clearable:"",style:{width:"180px"}},null,8,["modelValue"]),a(R,{type:"primary",style:{"margin-left":"12px"},size:"small",onClick:e[6]||(e[6]=n=>h(!0))},{default:s(()=>[m("搜索")]),_:1})]),et]),a(Le,{data:M.value,stripe:y.value.tableStripe,border:y.value.tableBorder,style:{width:"100%"},"highlight-current-row":y.value.tableHighlightCurrentRow,"default-sort":q.value,onSortChange:de,onSelectionChange:ie},{default:s(()=>[a(N,{type:"selection",width:"45"}),a(N,{prop:"name",label:"名称",sortable:"custom"},{default:s(n=>[i("a",{class:"roaduia",href:"javascript:;",onClick:G=>re(n.row)},[n.row.type===0?(_(),S(l,{key:0,class:"roadui_main_tabico",style:{"vertical-align":"middle"}},{default:s(()=>[a(d)]),_:1})):(_(),S(l,{key:1,class:"roadui_main_tabico",style:{"vertical-align":"middle"}},{default:s(()=>[a($e)]),_:1})),m(" "+V(n.row.name),1)],8,tt)]),_:1}),a(N,{prop:"modifyTime",label:"修改日期",width:"150",sortable:"custom"}),a(N,{prop:"type",label:"类型",width:"120",sortable:"custom"},{default:s(n=>[i("span",null,V(n.row.type==0?"文件夹":n.row.extName+"文件"),1)]),_:1}),a(N,{prop:"size",label:"大小",width:"150",sortable:"custom"})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])])])):$.value==="share_my"||$.value==="my_share"?(_(),F("div",lt,[(_(),S(Q(L.value),{query:ee.value},null,8,["query"]))])):j("",!0)]),_:1})]),_:1}),a(O,{modelValue:E.value,"onUpdate:modelValue":e[8]||(e[8]=n=>E.value=n),title:"选择要移动到的文件夹",width:"500px",class:"el-dialog__padding1","align-center":"","destroy-on-close":"",draggable:"","close-on-click-modal":!1},{footer:s(()=>[i("span",nt,[a(R,{type:"primary",onClick:ge},{default:s(()=>[m("确定")]),_:1}),a(R,{onClick:e[7]||(e[7]=n=>{E.value=!1})},{default:s(()=>[m("取消")]),_:1})])]),default:s(()=>[a(p,{data:P.value,props:B,"node-key":"id",load:me,lazy:"",ref_key:"moveTreeRef",ref:U,"highlight-current":"","default-expanded-keys":H.value,style:{"padding-right":"14px",height:"100%",overflow:"auto"},"expand-on-click-node":!1,onNodeClick:ve},{default:s(n=>[i("div",at,[a(l,{class:"roadui_main_tabico"},{default:s(()=>[a(Ie)]),_:1}),i("span",null,V(n.node.label),1),n.data.type===5?(_(),F("span",ot,V(b(o).replaceWildcard("{<partTime>}")),1)):j("",!0)])]),_:1},8,["data","default-expanded-keys"])]),_:1},8,["modelValue"]),a(O,{modelValue:T.value,"onUpdate:modelValue":e[13]||(e[13]=n=>T.value=n),title:"文件分享",width:"600px",class:"el-dialog__padding1","align-center":"","destroy-on-close":"",draggable:"","close-on-click-modal":!1},{footer:s(()=>[i("span",st,[a(R,{type:"primary",onClick:e[11]||(e[11]=n=>we(W.value))},{default:s(()=>[m("确定")]),_:1}),a(R,{onClick:e[12]||(e[12]=n=>{T.value=!1})},{default:s(()=>[m("取消")]),_:1})])]),default:s(()=>[a(Ue,{model:w.value,ref_key:"shareFormRef",ref:W,"label-position":"top",rules:be,"label-width":"80px"},{default:s(()=>[a(Y,{label:"接收人员",prop:"toUserId"},{default:s(()=>[a(b(ye),{modelValue:w.value.toUserId,"onUpdate:modelValue":e[9]||(e[9]=n=>w.value.toUserId=n),clearable:"",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(Y,{label:"过期时间",prop:"expireTime"},{default:s(()=>[a(Pe,{modelValue:w.value.expireTime,"onUpdate:modelValue":e[10]||(e[10]=n=>w.value.expireTime=n),"value-format":"YYYY-MM-DD HH:mm",type:"datetime",placeholder:"为空表示不过期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};export{gt as default};
