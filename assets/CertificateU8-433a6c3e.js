import{_ as _e}from"./index-823f4b27.js";import{E as be,a as he}from"./_element-plus-8c7ce171.js";import{ai as m,aT as c,aF as ye,c as K,a as i,b9 as we,W as e,bD as o,bF as Ce,H as L,A as xe,aX as d,aY as Ve,o as B,F as ke,aV as Se,U as v,I as qe,aP as Ue,aM as Ne}from"./_@vue-5ba92de9.js";import"./__vendor-5e6ac033.js";import"./_@element-plus-ad4c9002.js";import"./_crypto-js-0812dcff.js";import"./_pdfjs-dist-c04561eb.js";import"./_@microsoft-43c4e133.js";import"./_vue-codemirror-50da885a.js";import"./_@popperjs-c75af06c.js";const k=C=>(Ue("data-v-4ce75c2c"),C=C(),Ne(),C),De={border:"0",cellpadding:"1",cellspacing:"1",style:{"border-color":"#eee","border-width":"1px",color:"#000",width:"100%","margin-bottom":"0"},class:"table"},je={align:"left"},$e={border:"0",cellpadding:"1",cellspacing:"1",style:{"border-color":"#eee","border-width":"1px",color:"#000",width:"100%","margin-bottom":"0"},class:"table"},Ae={style:{"padding-left":"25px"}},Be={style:{"margin-top":"10px"}},Fe=k(()=>i("td",{align:"right"}," 制单人： ",-1)),Ie=k(()=>i("td",{align:"right"}," 凭证日期： ",-1)),ze=k(()=>i("td",{align:"right"}," 凭证类别： ",-1)),Ee=k(()=>i("td",{align:"right"}," 单据张数： ",-1)),Me={style:{"margin-top":"10px"}},Oe=k(()=>i("td",{align:"right"},null,-1)),Pe={align:"right"},Ye={__name:"CertificateU8",props:{query:{type:String,default:()=>""},modelValue:{type:Boolean,default:!1},id:{type:String,default:""},serino:{type:String,default:""},billcodes:{type:String,default:""}},emits:["update:id","update:serino","update:billcodes","update:modelValue"],setup(C,{emit:W}){const x=m("ajax"),_=m("utils"),V=m("qs");m("config"),m("index_openmenu"),m("index_removetab");const X=m("index_refreshtab");m("index_dialogshow"),m("index_regcomponent");const Q=m("index_userinfo"),S=c({prop:"",order:"ascending"}),b=c(_.getPager(S.value)),F=c(!1),q=c(!1),U=c(!1),N=c(!1),D=c(!1),j=c(""),Z=W,ee=C;function I(t){return xe({get:()=>ee[t],set:l=>{Z(`update:${t}`,l)}})}const Y=I("id"),le=I("serino"),te=I("billcodes");ye(()=>{se(),ae(),n.value.makername=Q.value.userName,n.value.serino=le.value,n.value.invoiceids=Y.value,n.value.billcodes=te.value});const n=c({serino:"",makername:"",billdate:_.getNowFormatDate(),isignseq:"",pagecount:"",isignseq:"",csign:""}),h=c({code:"",name:"",databasetype:"U8"}),y=c({code:"",name:"",databasetype:"U8"}),z=c([]),ae=async()=>{try{const t=await x.post("Accouch/GetSign",V.stringify({databasetype:"U8"}));t.success&&(z.value=t.data.U8Sign)}catch{}},oe=async()=>{if(n.value.serino==""){_.confirm("请输入开票流水号");return}if(n.value.makername==""){_.confirm("请输入制单人");return}if(n.value.isignseq==""){_.confirm("请选择凭证类别");return}if(n.value.pagecount==""){_.confirm("请输入单据张数");return}try{const t=await x.post("Accouch/CreateU8Vouch",V.stringify({isignseq:n.value.isignseq,pagecount:n.value.pagecount,csign:n.value.csign,billdate:n.value.billdate,invoiceids:n.value.invoiceids,billcodes:n.value.billcodes,accvouchJSON:JSON.stringify(g.value)}));t.success?(be.success(t.msg),X()):he.alert(t.msg,"提示",{confirmButtonText:"OK",type:"error",callback:l=>{}})}catch{}};function ne(t){let l=z.value.find(u=>u.isignseq===t);l&&(n.value.isignseq=l.isignseq,n.value.csign=l.csign)}const g=c([]),G=c([]),H=c([]),se=async()=>{F.value=!0;try{const t=await x.post("Accouch/GetAccvouchU8",V.stringify({ids:Y.value}));g.value=t.data.Accvouch,n.value.isignseq=t.data.main.isignseq,n.value.csign=t.data.main.csign,n.value.pagecount=t.data.main.pagecount}catch{}finally{F.value=!1}},re=t=>{const{columns:l,data:u}=t,r=[],O=["md","mc"];return l.forEach(($,f)=>{if(f===0){r[f]="合计";return}if(O.includes($.property)){const p=u.map(s=>Number(s[$.property]));p.every(s=>Number.isNaN(s))?r[f]="":r[f]=` ${p.reduce((s,w)=>{const A=Number(w);return Number.isNaN(A)?Number(s):Number(s)+Number(w)},0).toFixed(2)}`}else r[f]=""}),r},ie=t=>{j.value=t.id,N.value=!0},ue=t=>{g.value.forEach((l,u)=>{l.id==j.value&&(g.value[u].projectcode=t.ccode,g.value[u].projectname=t.ccode_name)}),N.value=!1},ce=t=>{j.value=t.id,D.value=!0},de=t=>{g.value.forEach((l,u)=>{l.id==j.value&&(g.value[u].customercode=t.cCusCode,g.value[u].customername=t.cCusName)}),D.value=!1},pe=()=>{E()},me=()=>{ge()};async function E(){try{const t=await x.post("/Accouch/GetProject",V.stringify(h.value));G.value=t.data.U8Project}catch{}finally{}}async function ge(){try{const t=await x.post("/Accouch/GetCustomer",V.stringify(y.value));H.value=t.data.U8Customer}catch{}finally{}}const fe=t=>{selectrow.value=t};function M({row:t,column:l,rowIndex:u,columnIndex:r}){return{color:"#000",textAlign:"center"}}return(t,l)=>{const u=d("el-input"),r=d("el-form-item"),O=d("el-date-picker"),$=d("el-option"),f=d("el-select"),p=d("el-button"),s=d("el-table-column"),w=d("el-table"),A=d("FullScreen"),R=d("el-icon"),T=d("el-form"),J=d("el-dialog"),ve=Ve("loading");return B(),K("div",null,[i("table",De,[i("tbody",null,[i("tr",null,[i("td",je," 开票流水号： "+we(n.value.serino),1)])])]),i("table",$e,[i("tbody",Ae,[i("tr",Be,[Fe,i("td",null,[e(r,{prop:"makername"},{default:o(()=>[e(u,{modelValue:n.value.makername,"onUpdate:modelValue":l[0]||(l[0]=a=>n.value.makername=a)},null,8,["modelValue"])]),_:1})]),Ie,i("td",null,[e(r,{prop:"billdate"},{default:o(()=>[e(O,{modelValue:n.value.billdate,"onUpdate:modelValue":l[1]||(l[1]=a=>n.value.billdate=a),"value-format":"YYYY-MM-DD",type:"date"},null,8,["modelValue"])]),_:1})]),ze,i("td",null,[e(r,{prop:"isignseq"},{default:o(()=>[e(f,{modelValue:n.value.isignseq,"onUpdate:modelValue":l[2]||(l[2]=a=>n.value.isignseq=a),clearable:"",onChange:ne,placeholder:"请选择"},{default:o(()=>[(B(!0),K(ke,null,Se(z.value,a=>(B(),L($,{key:a.isignseq,label:a.csign,value:a.isignseq},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),Ee,i("td",null,[e(r,{prop:"pagecount"},{default:o(()=>[e(u,{modelValue:n.value.pagecount,"onUpdate:modelValue":l[3]||(l[3]=a=>n.value.pagecount=a)},null,8,["modelValue"])]),_:1})])]),i("tr",Me,[Oe,i("td",Pe,[e(r,null,{default:o(()=>[e(p,{type:"primary",onClick:oe},{default:o(()=>[v("生成凭证")]),_:1})]),_:1})])])])]),Ce((B(),L(w,{class:"eltable",data:g.value,"summary-method":re,"show-summary":"",stripe:b.value.tableStripe,border:"","highlight-current-row":b.value.tableHighlightCurrentRow,"max-height":"500",style:{width:"100%",color:"#000","margin-top":"10px"},"header-cell-style":M,"default-sort":S.value,onSelectionChange:fe,"row-style":t.changRed},{default:o(()=>[e(s,{prop:"projectcode",align:"center",label:"会计科目编号",width:"120"}),e(s,{prop:"projectname",align:"center",label:"会计科目名称",width:"230"}),e(s,{label:"操作",align:"center",width:"100"},{default:o(a=>[e(p,{type:"primary",size:"small",onClick:P=>ie(a.row)},{default:o(()=>[v("选择科目")]),_:2},1032,["onClick"])]),_:1}),e(s,{prop:"md",label:"借方金额",align:"right",width:"150"}),e(s,{prop:"mc",label:"贷方金额",align:"right",width:"150"}),e(s,{prop:"cdigest",label:"摘要",fit:"","show-overflow-tooltip":"","min-width":"75%"}),e(s,{label:"辅助核算",width:"600"},{default:o(()=>[qe("",!0),e(s,{prop:"customername",label:"客户",fit:"","show-overflow-tooltip":""}),e(s,{align:"center",label:"选择客户",width:"100"},{default:o(a=>[e(p,{type:"primary",size:"small",onClick:P=>ce(a.row)},{default:o(()=>[v("选择客户")]),_:2},1032,["onClick"])]),_:1})]),_:1})]),_:1},8,["data","stripe","highlight-current-row","default-sort","row-style"])),[[ve,F.value]]),e(J,{modelValue:N.value,"onUpdate:modelValue":l[8]||(l[8]=a=>N.value=a),title:"选择科目",onOpen:pe,fullscreen:q.value,onClose:l[9]||(l[9]=a=>q.value=!1),"align-center":"","destroy-on-close":"",width:"800px",draggable:"","close-on-click-modal":!1},{default:o(()=>[e(R,{onClick:l[4]||(l[4]=a=>q.value=!q.value),style:{position:"absolute",right:"45px",top:"24px",cursor:"pointer","font-size":"14px"}},{default:o(()=>[e(A)]),_:1}),e(T,{inline:!0,model:h.value},{default:o(()=>[e(r,{label:"科目编号",prop:"code",style:{"margin-left":"20px"}},{default:o(()=>[e(u,{modelValue:h.value.code,"onUpdate:modelValue":l[5]||(l[5]=a=>h.value.code=a),clearable:"",placeholder:"请输入会计科目编号"},null,8,["modelValue"])]),_:1}),e(r,{label:"科目名称",prop:"name",style:{"margin-left":"20px"}},{default:o(()=>[e(u,{modelValue:h.value.name,"onUpdate:modelValue":l[6]||(l[6]=a=>h.value.name=a),clearable:"",placeholder:"请输入会计科目名称"},null,8,["modelValue"])]),_:1}),e(r,{style:{"margin-left":"20px"}},{default:o(()=>[e(p,{type:"primary",onClick:l[7]||(l[7]=a=>E(!0))},{default:o(()=>[v("查询")]),_:1})]),_:1})]),_:1},8,["model"]),e(w,{class:"eltable",data:G.value,stripe:b.value.tableStripe,border:"","highlight-current-row":b.value.tableHighlightCurrentRow,"max-height":"500",style:{width:"100%",color:"#000","margin-top":"10px"},"header-cell-style":M,"default-sort":S.value},{default:o(()=>[e(s,{prop:"ccode",align:"center",label:"会计科目编号","min-width":"200"}),e(s,{prop:"ccode_name",align:"center",label:"会计科目名称","min-width":"200"}),e(s,{label:"操作",align:"center"},{default:o(a=>[e(p,{type:"primary",size:"small",onClick:P=>ue(a.row)},{default:o(()=>[v("选择科目")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","stripe","highlight-current-row","default-sort"])]),_:1},8,["modelValue","fullscreen"]),e(J,{modelValue:D.value,"onUpdate:modelValue":l[14]||(l[14]=a=>D.value=a),title:"选择客户",onOpen:me,fullscreen:U.value,onClose:l[15]||(l[15]=a=>U.value=!1),"align-center":"","destroy-on-close":"",width:"1000px",draggable:"","close-on-click-modal":!1},{default:o(()=>[e(R,{onClick:l[10]||(l[10]=a=>U.value=!U.value),style:{position:"absolute",right:"45px",top:"24px",cursor:"pointer","font-size":"14px"}},{default:o(()=>[e(A)]),_:1}),e(T,{inline:!0,model:y.value},{default:o(()=>[e(r,{label:"客户编号",prop:"code",style:{"margin-left":"20px"}},{default:o(()=>[e(u,{modelValue:y.value.code,"onUpdate:modelValue":l[11]||(l[11]=a=>y.value.code=a),clearable:"",placeholder:"请输入客户编号"},null,8,["modelValue"])]),_:1}),e(r,{label:"客户名称",prop:"name",style:{"margin-left":"20px"}},{default:o(()=>[e(u,{modelValue:y.value.name,"onUpdate:modelValue":l[12]||(l[12]=a=>y.value.name=a),clearable:"",placeholder:"请输入客户名称"},null,8,["modelValue"])]),_:1}),e(r,{style:{"margin-left":"20px"}},{default:o(()=>[e(p,{type:"primary",onClick:l[13]||(l[13]=a=>E(!0))},{default:o(()=>[v("查询")]),_:1})]),_:1})]),_:1},8,["model"]),e(w,{class:"eltable",data:H.value,stripe:b.value.tableStripe,border:"","highlight-current-row":b.value.tableHighlightCurrentRow,"max-height":"500",style:{width:"100%",color:"#000","margin-top":"10px"},"header-cell-style":M,"default-sort":S.value},{default:o(()=>[e(s,{prop:"cCusCode",align:"center",label:"客户编号","min-width":"200"}),e(s,{prop:"cCusName",align:"center",label:"客户名称","min-width":"200"}),e(s,{label:"操作",align:"center"},{default:o(a=>[e(p,{type:"primary",size:"small",onClick:P=>de(a.row)},{default:o(()=>[v("选择客户")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","stripe","highlight-current-row","default-sort"])]),_:1},8,["modelValue","fullscreen"])])}}},Ze=_e(Ye,[["__scopeId","data-v-4ce75c2c"]]);export{Ze as default};
