import{ai as C,aT as b,aF as X,av as Y,c as B,a as Z,W as h,bD as d,bF as $,H as R,aX as p,aY as J,o as m,U as y,bi as K,aZ as Q,I as ee,b9 as U,F as te,aV as le}from"./_@vue-5ba92de9.js";const ne={class:"roadui_page"},ae={style:{"margin-bottom":"8px"}},se={__name:"setmenu",props:{query:{type:String,default:()=>""}},setup(F){const S=C("ajax"),o=C("utils"),N=C("qs"),q=F,P=C("openPage"),i=b(!1),_=b(!1),k=b([]),g=b(null),z=b(!1);let x=[];const V=o.query("organizeid",q.query),D=o.query("organizetype",q.query),w=o.query("returnurl",q.query);X(()=>{O()});const O=()=>{_.value=!0,S.post("/Menu/GetTableTree?organizeid="+V+"&organizetype="+D).then(e=>{if(!e.success){o.msg("加载数据失败！",!1),_.value=!1;return}k.value=e.data,Y(()=>{A(e.data),_.value=!1})}).catch(()=>{_.value=!1})},E=(e,t)=>{let l=[];I(t,l);const n=e.findIndex(a=>a.id===t.id)>=0;for(let a=0;a<l.length;a++){let c=[];if(j(l[a],c),n){g.value.toggleRowSelection(l[a],!0);for(let s=0;s<c.length;s++){if(l.findIndex(u=>u.id===c[s].id)>=0)continue;const v=e.findIndex(u=>u.id===c[s].id)>=0;g.value.toggleRowSelection(c[s],v)}}else{let s=!1;const v=g.value.getSelectionRows();for(let u=0;u<c.length;u++)if(v.findIndex(f=>f.id===c[u].id)>=0){s=!0;break}s||g.value.toggleRowSelection(l[a],!1)}}},I=(e,t)=>{let l=[];T(e,k.value,l),l.length>0&&(t.push(l[0]),I(l[0],t))},T=(e,t,l)=>{for(let n=0;n<t.length;n++){if(e.parentId===t[n].id){l.push(t[n]);return}t[n].children&&T(e,t[n].children,l)}},j=(e,t)=>{if(e.children)for(let l=0;l<e.children.length;l++)t.push(e.children[l]),j(e.children[l],t)},G=e=>{x=e},A=e=>{for(let t=0;t<e.length;t++)g.value.toggleRowSelection(e[t],e[t].selected),o.length(e[t].children)>0&&A(e[t].children)},M=e=>{for(let t=0;t<e.length;t++)g.value.toggleRowSelection(e[t],z.value),o.length(e[t].children)>0&&M(e[t].children)},H=()=>{let e=[];for(let l=0;l<x.length;l++)e.push({id:x[l].id,buttons:x[l].buttons1.join(",")});i.value=!0;let t={organizeid:V,organizetype:D,count:e.length,menus:e};S.post("/Organize/SaveSetMenu",N.stringify(t)).then(l=>{let n=l.msg;o.length(n)===0&&(n=l.success?"保存成功！":"保存失败！"),o.msg(n,l.success),i.value=!1}).catch(()=>{i.value=!1})},L=()=>{P({type:D},w)},W=()=>{i.value=!0,S.post("/Menu/UpMenuAuth").then(e=>{o.msg(e.success?"更新成功！":"更新失败！",e.success),i.value=!1}).catch(()=>{i.value=!1})};return(e,t)=>{const l=p("el-button"),n=p("el-space"),a=p("el-table-column"),c=p("el-checkbox"),s=p("el-checkbox-group"),v=p("el-table"),u=J("loading");return m(),B("div",ne,[Z("div",ae,[h(n,null,{default:d(()=>[h(l,{disabled:i.value,type:"primary",onClick:H},{default:d(()=>[y("保存")]),_:1},8,["disabled"]),h(l,{disabled:i.value,type:"primary",onClick:W},{default:d(()=>[y("更新菜单权限")]),_:1},8,["disabled"]),h(l,{disabled:i.value,onClick:L},{default:d(()=>[y("返回")]),_:1},8,["disabled"])]),_:1})]),$((m(),R(v,{data:k.value,ref_key:"tableRef",ref:g,style:{width:"100%"},"row-key":"id",onSelect:E,onSelectionChange:G,onSelectAll:t[0]||(t[0]=r=>{z.value=!z.value,M(k.value)}),"tree-props":{children:"children",hasChildren:"hasChildren"}},{default:d(()=>[h(a,{type:"selection",width:"45","reserve-selection":""}),h(a,{prop:"title",label:"菜单名称",width:"320"},{default:d(r=>[K(o).length(r.row.ico)>0?(m(),R(Q(r.row.ico),{key:0,class:"roadui_org_setmenuico"})):ee("",!0),y(" "+U(r.row.title),1)]),_:1}),h(a,{prop:"buttons",label:"按钮"},{default:d(r=>[h(s,{modelValue:r.row.buttons1,"onUpdate:modelValue":f=>r.row.buttons1=f},{default:d(()=>[(m(!0),B(te,null,le(r.row.buttons,f=>(m(),R(c,{key:f.id,label:f.id},{default:d(()=>[y(U(f.name),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])),[[u,_.value]])])}}};export{se as default};
