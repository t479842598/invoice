import{a as H,_ as Pe}from"./index-823f4b27.js";import{d as Fe,ai as g,aT as a,aF as Ee,by as Ae,c as M,bF as J,a as v,W as o,bD as i,H as w,b9 as Y,aX as u,aY as je,o as p,U as _,F as W,aV as X,I as T,bi as K,Y as Q,bv as Le}from"./_@vue-5ba92de9.js";import{cC as Z}from"./__vendor-5e6ac033.js";import{E as h,a as ee}from"./_element-plus-8c7ce171.js";import"./_@element-plus-ad4c9002.js";import"./_crypto-js-0812dcff.js";import"./_pdfjs-dist-c04561eb.js";import"./_@microsoft-43c4e133.js";import"./_vue-codemirror-50da885a.js";import"./_@popperjs-c75af06c.js";const Me={class:"form-container"},Ye={class:"table-container"},$e={class:"table-text"},Oe={border:"0",class:"table",width:"900"},Re={width:"300",align:"center"},qe={width:"300",align:"center"},Ge={width:"300",align:"left"},He={class:"roadui_pagerdiv"},Je=Fe({__name:"Certificatelist",setup(We){const le=Q(()=>H(()=>import("./Certificate-8f45320d.js"),["./Certificate-8f45320d.js","./index-823f4b27.js","./__vendor-5e6ac033.js","./_@vue-5ba92de9.js","./__vendor-693c365c.css","./_@element-plus-ad4c9002.js","./_crypto-js-0812dcff.js","./_element-plus-8c7ce171.js","./_@popperjs-c75af06c.js","./_element-plus-7d03f811.css","./_pdfjs-dist-c04561eb.js","./_@microsoft-43c4e133.js","./_vue-codemirror-50da885a.js","./index-2ccff9e2.css","./Certificate-c656a2ab.css"],import.meta.url)),te=Q(()=>H(()=>import("./CertificateU8-433a6c3e.js"),["./CertificateU8-433a6c3e.js","./index-823f4b27.js","./__vendor-5e6ac033.js","./_@vue-5ba92de9.js","./__vendor-693c365c.css","./_@element-plus-ad4c9002.js","./_crypto-js-0812dcff.js","./_element-plus-8c7ce171.js","./_@popperjs-c75af06c.js","./_element-plus-7d03f811.css","./_pdfjs-dist-c04561eb.js","./_@microsoft-43c4e133.js","./_vue-codemirror-50da885a.js","./index-2ccff9e2.css","./CertificateU8-9aba0809.css"],import.meta.url)),D=g("ajax"),P=g("utils");g("config");const U=g("qs");g("app"),g("index_openmenu"),g("index_removetab"),g("index_refreshtab");const ae=g("index_userinfo"),oe=a({prop:"invoiceDate",order:"ascending"}),s=a(P.getPager(oe.value)),m=a("");localStorage.getItem("sobInfo")!=""&&(m.value=JSON.parse(localStorage.getItem("sobInfo")));const $=a(!1),z=a(!1),N=a(!1),O=a(""),ne=a(),ie=a([]),se=a([{id:"全部",label:"全部"},{id:"未生成",label:"未生成"},{id:"已生成",label:"已生成"}]),re=a(),S=a(!1),I=a(!1),B=a("未生成"),C=a(""),x=a(""),k=a([]),y=a([]),R=a([]),F=a(0),d=a(0),c=a(0),V=a(""),ue=a("生成凭证 "+m.value.erptype);Ee(()=>{f(!1),ge()});const de=a([{prop:"serialNo",label:"开票流水号",align:"center",width:"200"},{prop:"buyerName",label:"客户名称",align:"center",width:"250"},{prop:"invoiceTotalPriceTax",label:"价税合计",align:"right",width:"100"},{prop:"invoiceTotalPrice",label:"无税金额",align:"right",width:"100"},{prop:"invoiceTotalTax",label:"税额",align:"center",width:"110"},{prop:"ino_id",label:"凭证号",align:"center",width:"180"},{prop:"pzdate",label:"凭证日期",align:"center",width:"170"},{prop:"invoiceDate",label:"开票日期",align:"center",width:"180"}]),n=a({serino:"",invoiceno:"",customername:"",invoiceDate:P.getMonth()});Ae(B,(t,e)=>{f(!0)});const E=a([]);async function f(t){z.value=!0;try{t&&(s.value.number=1),n.value.size=s.value.size,n.value.number=s.value.number,n.value.order=s.value.order,n.value.invoiceDate!=null?(n.value.date1=n.value.invoiceDate[0],n.value.date2=n.value.invoiceDate[1]):(n.value.date1="",n.value.date2=""),n.value.type="已开票",n.value.status=B.value;const e=await D.post("/Accouch/GetList?srcorgid="+m.value.id,U.stringify(n.value));if(e.data.rows.length>0){E.value=e.data.rows,F.value=e.data.total,O.value=e.data.rows[0].id,s.value.total=e.data.total,d.value=0,c.value=0;for(let r=0;r<e.data.rows.length;r++)d.value=Number((d.value+Number(e.data.rows[r].invoiceTotalPriceTax)).toFixed(2)),c.value=Number((c.value+Number(e.data.rows[r].invoiceTotalTax)).toFixed(2))}else{E.value=e.data.rows,F.value=e.data.total,O.value="0",s.value.total=e.data.total;for(let r=0;r<e.data.rows.length;r++)d.value=Number((d.value+Number(e.data.rows[r].invoiceTotalPriceTax)).toFixed(2)),c.value=Number((c.value+Number(e.data.rows[r].invoiceTotalTax)).toFixed(2))}}catch{$.value=!1,z.value=!1}finally{z.value=!1}}const ce=t=>{x.value=t.id,C.value=t.serialNo,y.value=t.billcode,S.value=!0},ve=()=>{if(k.value.length==0){h({message:"请选择发票信息",type:"warning",duration:2e3,showClose:!1});return}x.value=k.value,C.value=R.value,S.value=!0},pe=()=>{N.value=!0},me=()=>{Z.debounce(()=>{c.value=0,d.value=0,n.value={serino:"",customername:"",invoiceDate:"",status:"开票完成"},f(!0)},300)()},fe=()=>{Z.debounce(()=>{c.value=0,d.value=0,n.value={serino:"",customername:"",invoiceDate:"",status:"开票完成"}},300)()},ge=async()=>{try{const t=await D.post("user/GetUserInvoiceDepartByUser",U.stringify({userid:ae.value.userId}));t.success&&(ie.value=t.data,t.data.length>0&&(ne.value=t.data[0].id))}catch{}},be=()=>{c.value=0,d.value=0,s.value.number=1,f(!0),N.value=!1},_e=()=>{if(k.value.length==0){h({message:"请选择发票信息",type:"warning",duration:2e3,showClose:!1});return}m.value.erptype=="U8"?V.value="DeleteU8Vouch":m.value.erptype=="T3"&&(V.value="DeleteT3Vouch"),he()},he=()=>{ee.confirm("确认删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{D.post("/Accouch/"+V.value,U.stringify({invoiceids:k.value,billcodes:y.value})).then(t=>{t.success?(h({message:t.msg,type:"success",duration:2e3,showClose:!1}),f(!1)):h({message:t.msg,type:"error",duration:2e3,showClose:!1})}).catch(t=>{h({message:"删除失败",type:"error",duration:2e3,showClose:!1})})}).catch(()=>{})},ye=t=>{m.value.erptype=="U8"?V.value="DeleteU8Vouch":m.value.erptype=="T3"&&(V.value="DeleteT3Vouch"),ee.confirm("确认删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{D.post("/Accouch/"+V.value,U.stringify({invoiceids:t.id,billcodes:t.billcode})).then(e=>{e.success?(h({message:e.msg,type:"success",duration:2e3,showClose:!1}),f(!1)):h({message:e.msg,type:"error",duration:2e3,showClose:!1})}).catch(e=>{h({message:"删除失败",type:"error",duration:2e3,showClose:!1})})}).catch(()=>{})},we=t=>{s.value.size=t,f(!1)},Ce=t=>{c.value=0,d.value=0,s.value.number=t,f(!1)};function xe({row:t,column:e,rowIndex:r,columnIndex:b}){return{color:"#000",textAlign:"center"}}const Ve=t=>{s.value.order=P.getOrder(t),f(!1)},ke=t=>{k.value=t.map(e=>e.id).join(","),y.value=t.map(e=>e.billcode).join(","),R.value=t.map(e=>e.serialNo).join(",")};return(t,e)=>{const r=u("el-button"),b=u("el-form-item"),Te=u("el-option"),De=u("el-select"),q=u("el-form"),A=u("el-table-column"),Ue=u("el-table"),ze=u("el-pagination"),j=u("el-input"),Ne=u("el-date-picker"),G=u("el-dialog"),Se=u("FullScreen"),Ie=u("el-icon"),Be=je("loading");return p(),M("div",null,[J(v("form",{ref_key:"formref",ref:re,action:"",method:"post"},null,512),[[Le,!1]]),v("div",Me,[o(q,{ref:"formbutton",inline:""},{default:i(()=>[o(b,null,{default:i(()=>[o(r,{type:"primary",onClick:e[0]||(e[0]=l=>ve())},{default:i(()=>[_("合并生成")]),_:1}),o(r,{type:"danger",onClick:e[1]||(e[1]=l=>_e())},{default:i(()=>[_("批量删除")]),_:1}),o(r,{type:"primary",onClick:pe,icon:"Search"},{default:i(()=>[_("查询")]),_:1}),o(r,{type:"success",onClick:me,icon:"Refresh"},{default:i(()=>[_("刷新")]),_:1})]),_:1}),o(b,{label:"状态",prop:"status"},{default:i(()=>[o(De,{modelValue:B.value,"onUpdate:modelValue":e[2]||(e[2]=l=>B.value=l),style:{width:"200px"}},{default:i(()=>[(p(!0),M(W,null,X(se.value,l=>(p(),w(Te,{key:l.id,label:l.label,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},512)]),v("div",Ye,[J((p(),w(Ue,{data:E.value,stripe:s.value.tableStripe,border:"","highlight-current-row":s.value.tableHighlightCurrentRow,"max-height":"800",style:{width:"100%",color:"#000"},"header-cell-style":xe,onSortChange:Ve,onSelectionChange:ke},{default:i(()=>[T("",!0),o(A,{type:"selection",width:"55",align:"center"}),(p(!0),M(W,null,X(de.value,(l,L)=>(p(),w(A,{key:L,prop:l.prop,label:l.label,align:l.align,width:l.width},null,8,["prop","label","align","width"]))),128)),o(A,{label:"操作",align:"center",fixed:"right",width:"200"},{default:i(l=>[l.row.ino_id==""||l.row.ino_id==null?(p(),w(r,{key:0,type:"primary",size:"small",onClick:L=>ce(l.row)},{default:i(()=>[_("生成凭证")]),_:2},1032,["onClick"])):T("",!0),l.row.ino_id!=""&&l.row.ino_id!=null?(p(),w(r,{key:1,type:"danger",size:"small",onClick:L=>ye(l.row)},{default:i(()=>[_("删除")]),_:2},1032,["onClick"])):T("",!0)]),_:1})]),_:1},8,["data","stripe","highlight-current-row"])),[[Be,z.value]])]),v("div",$e,[v("table",Oe,[v("tr",null,[v("td",Re," 发票张数："+Y(F.value)+"张 ",1),v("td",qe," 价税合计："+Y(d.value)+"元 ",1),v("td",Ge," 合计税额："+Y(c.value)+"元 ",1)])])]),v("div",He,[o(ze,{currentPage:s.value.number,"onUpdate:currentPage":e[3]||(e[3]=l=>s.value.number=l),"page-size":s.value.size,"onUpdate:pageSize":e[4]||(e[4]=l=>s.value.size=l),"page-sizes":s.value.sizes,background:s.value.background,layout:s.value.layout,total:s.value.total,disabled:$.value,onSizeChange:we,onCurrentChange:Ce},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])]),o(G,{modelValue:N.value,"onUpdate:modelValue":e[9]||(e[9]=l=>N.value=l),title:"查询","align-center":"","destroy-on-close":"",width:"800px",draggable:"","close-on-click-modal":!1},{default:i(()=>[o(q,{inline:!0,model:n.value,class:"inline","label-width":"100px"},{default:i(()=>[o(b,{label:"开票流水号"},{default:i(()=>[o(j,{modelValue:n.value.serino,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.serino=l)},null,8,["modelValue"])]),_:1}),o(b,{label:"发票号"},{default:i(()=>[o(j,{modelValue:n.value.invoiceno,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.invoiceno=l)},null,8,["modelValue"])]),_:1}),o(b,{label:"客户名称"},{default:i(()=>[o(j,{modelValue:n.value.customername,"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.customername=l)},null,8,["modelValue"])]),_:1}),o(b,{label:"开票日期"},{default:i(()=>[o(Ne,{modelValue:n.value.invoiceDate,"onUpdate:modelValue":e[8]||(e[8]=l=>n.value.invoiceDate=l),type:"daterange","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),o(b,{style:{"margin-left":"30px"}},{default:i(()=>[o(r,{type:"primary",onClick:be},{default:i(()=>[_("查询")]),_:1}),o(r,{type:"success",onClick:fe},{default:i(()=>[_("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(G,{modelValue:S.value,"onUpdate:modelValue":e[17]||(e[17]=l=>S.value=l),title:ue.value,fullscreen:I.value,onClose:e[18]||(e[18]=l=>I.value=!1),"align-center":"","destroy-on-close":"",width:"1300px",draggable:"","close-on-click-modal":!1},{default:i(()=>[m.value.erptype=="T3"?(p(),w(K(le),{key:0,id:x.value,"onUpdate:id":e[10]||(e[10]=l=>x.value=l),billcodes:y.value,"onUpdate:billcodes":e[11]||(e[11]=l=>y.value=l),serino:C.value,"onUpdate:serino":e[12]||(e[12]=l=>C.value=l)},null,8,["id","billcodes","serino"])):T("",!0),m.value.erptype=="U8"?(p(),w(K(te),{key:1,id:x.value,"onUpdate:id":e[13]||(e[13]=l=>x.value=l),billcodes:y.value,"onUpdate:billcodes":e[14]||(e[14]=l=>y.value=l),serino:C.value,"onUpdate:serino":e[15]||(e[15]=l=>C.value=l)},null,8,["id","billcodes","serino"])):T("",!0),o(Ie,{onClick:e[16]||(e[16]=l=>I.value=!I.value),style:{position:"absolute",right:"45px",top:"24px",cursor:"pointer","font-size":"14px"}},{default:i(()=>[o(Se)]),_:1})]),_:1},8,["modelValue","title","fullscreen"])])}}});const il=Pe(Je,[["__scopeId","data-v-4f8f5a40"]]);export{il as default};
