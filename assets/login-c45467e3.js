import{ai as _,aT as c,aR as A,aF as X,aK as $,c as B,a as p,b9 as I,bi as f,W as n,bD as d,aX as i,o as g,F as z,aV as P,H as M,I as Q,U as v}from"./_@vue-5ba92de9.js";const Z={class:"login_div"},ee={class:"login_titlediv"},te={class:"login_title"},oe={class:"login_title1"},ae={class:"login_body"},le={class:"login_footer"},ne=["innerHTML"],ie={__name:"login",setup(se){const r=_("config"),a=_("utils"),b=_("ajax"),C=_("qs"),h=c("登录"),m=c(!1),T=c(),k=c(""),S=c([]),N=A({account:[{required:!0,message:"请输入帐号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],validateCode:[{required:!0,message:"请输入验证码",trigger:"blur"}]}),y=c(null),l=A({expireTime:0,force:"0"}),D=async()=>{const e=await b.post("/Home/GetAccount");e.success&&a.length(e.data)>0&&(S.value=e.data)},H=e=>{l.sobItem=e,k.value=e},w=async e=>{e&&await e.validate(t=>{if(t){m.value=!0;const o={expireTime:l.expireTime,force:l.force,account:a.aes(l.account),password:a.aes(l.password),clientId:a.getClientId(),validateCode:l.validateCode,validateCodeId:F.value};q(k.value,o)}})},q=(e,t)=>{b.post("/Home/GetSelectAccount",C.stringify({id:e})).then(o=>{o.success&&(a.length(o.data)>0?(localStorage.setItem("sobInfo",JSON.stringify(o.data[0])),E(t,o.data[0].id)):E(t,""))}).catch(()=>{})},E=async(e,t)=>{try{const o=await b.post("/Home/ValidLogin?srcorgid="+t,C.stringify(e));o.success?(a.setToken(o.data.token),a.setClientId(o.data.clientId),document.onkeydown=null,window.location.href=a.length(r.BASE_URL)===0?"/":r.BASE_URL):G(o)}catch{L()}},G=e=>{if(a.hasKey(e,"data")&&a.length(e.data.loginIp)>0)a.confirm("您的帐号已经在"+e.data.loginIp+"登录，您要强行登录吗？",()=>{l.force="1",w(formEl)});else{const t={1:"帐号或密码不能为空！",2:"帐号或密码错误！",3:a.length(e.msg)===0?"用户被冻结！":"用户所在组织 "+e.msg+" 被冻结！",4:"未找到您的所在组织！",5:"验证码错误！",default:"登录失败"},o=t[e.code]||t.default;a.msg(o,!1),R(),L()}},L=()=>{h.value="登录",m.value=!1},U=e=>{e.keyCode==13&&w(y.value)};X(()=>{D(),window.addEventListener("keydown",U)}),$(()=>{window.removeEventListener("keydown",U,!1)});const F=c(a.createGuid(!1)),x=c(""),R=()=>{x.value=r.SERVER_WEBADDRESS+"/Files/ValidCode?v="+a.createGuid(!1)+"&validatecodeid="+F.value};return(e,t)=>{const o=i("el-input"),u=i("el-form-item"),O=i("el-option"),j=i("el-select"),K=i("el-image"),V=i("el-radio"),W=i("el-radio-group"),Y=i("el-button"),J=i("el-form");return g(),B("div",Z,[p("div",ee,[p("div",te,I(f(r).SYSTEM_NAME),1),p("div",oe,I(f(r).SYSTEM_TITLE),1)]),p("div",ae,[n(J,{ref_key:"ruleFormRef",ref:y,model:l,rules:N,"label-width":"auto"},{default:d(()=>[n(u,{label:"帐号",prop:"account"},{default:d(()=>[n(o,{modelValue:l.account,"onUpdate:modelValue":t[0]||(t[0]=s=>l.account=s),"prefix-icon":"User",clearable:""},null,8,["modelValue"])]),_:1}),n(u,{label:"密码",prop:"password",style:{"padding-top":"10px"}},{default:d(()=>[n(o,{modelValue:l.password,"onUpdate:modelValue":t[1]||(t[1]=s=>l.password=s),"prefix-icon":"Key",type:"password",clearable:""},null,8,["modelValue"])]),_:1}),n(u,{label:"账套",prop:"sobItem",style:{"padding-top":"10px"}},{default:d(()=>[n(j,{modelValue:T.value,"onUpdate:modelValue":t[2]||(t[2]=s=>T.value=s),onChange:H,placeholder:"请选择账套",style:{width:"100%"}},{default:d(()=>[(g(!0),B(z,null,P(S.value,s=>(g(),M(O,{key:s.id,label:s.accountname,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),f(a).length(x.value)>0?(g(),M(u,{key:0,label:"验证码",prop:"validateCode",style:{"padding-top":"10px"}},{default:d(()=>[n(o,{modelValue:l.validateCode,"onUpdate:modelValue":t[3]||(t[3]=s=>l.validateCode=s),style:{width:"135px"},clearable:""},null,8,["modelValue"]),n(K,{onClick:R,src:x.value,style:{"margin-left":"8px"}},null,8,["src"])]),_:1})):Q("",!0),n(u,{label:"记住我",prop:"expireTime",style:{"padding-top":"10px"}},{default:d(()=>[n(W,{modelValue:l.expireTime,"onUpdate:modelValue":t[4]||(t[4]=s=>l.expireTime=s),style:{"margin-left":"14px"}},{default:d(()=>[n(V,{label:0},{default:d(()=>[v("不")]),_:1}),n(V,{label:1},{default:d(()=>[v("一天")]),_:1}),n(V,{label:7},{default:d(()=>[v("一周")]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(u,{style:{"padding-top":"10px"}},{default:d(()=>[n(Y,{type:"primary",loading:m.value,disabled:m.value,"auto-insert-space":"",style:{width:"100%"},onClick:t[5]||(t[5]=s=>w(y.value))},{default:d(()=>[v(I(h.value),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model","rules"])]),p("div",le,[p("span",{innerHTML:f(r).LOGIN_FOOTER},null,8,ne)])])}}};export{ie as default};
