import"./__vendor-5e6ac033.js";import{_ as te}from"./index-823f4b27.js";import{at as V,ai as d,aT as s,aF as le,bm as I,c as f,H as h,bD as l,I as B,a,W as o,bF as ae,aX as p,aY as oe,o as c,b9 as g,U as F,F as T,aV as M,aP as ie,aM as ne}from"./_@vue-5ba92de9.js";import{a as se}from"./_element-plus-8c7ce171.js";import"./_@element-plus-ad4c9002.js";import"./_crypto-js-0812dcff.js";import"./_pdfjs-dist-c04561eb.js";import"./_@microsoft-43c4e133.js";import"./_vue-codemirror-50da885a.js";import"./_@popperjs-c75af06c.js";const A=u=>(ie("data-v-9f81bbdd"),u=u(),ne(),u),re={style:{overflow:"hidden","overflow-y":"scroll","padding-bottom":"10px"}},de={style:{width:"200px"}},ce={border:"1",cellpadding:"1",cellspacing:"1",style:{"line-height":"50px","border-color":"#99938f","border-width":"1px",color:"#6f4946",width:"100%","margin-bottom":"0"},class:"table maintable"},ue={class:"type",colspan:"4",height:"50",style:{"padding-left":"5px","font-weight":"bold"}},pe={colspan:"4",height:"50",class:"type",style:{"padding-left":"5px","font-weight":"bold"}},ge={style:{height:"100px !important"}},be=A(()=>a("td",{width:"26",class:"center vertical-text",style:{"font-weight":"bolder"}},"购买方",-1)),fe={colspan:"3",width:"250",style:{padding:"15px 10px 0px 10px"}},he={class:"black"},me={class:"black"},ve=A(()=>a("td",{width:"26",class:"center vertical-text",style:{"font-weight":"bolder"}},"销售方",-1)),_e={colspan:"3",width:"250",style:{padding:"15px 10px 0px 10px"}},ye={class:"black"},we={class:"black"},xe={__name:"redInvoice",props:V({query:{type:String,default:()=>""},modelValue:{type:Boolean,default:!1},id:{type:String,default:""},blueid:{type:String,default:""}},{id:{},idModifiers:{},blueid:{},blueidModifiers:{},readonly:{},readonlyModifiers:{}}),emits:V(["update:id","update:blueid"],["update:id","update:blueid","update:readonly"]),setup(u,{expose:O,emit:Ne}){const m=d("ajax"),v=d("utils"),_=d("qs");d("config");const S=d("RedShow"),J=d("getTableData");d("postSaleDetail"),d("index_refreshtab");const R=s({prop:"goodsLineNo",order:"ascending"}),k=s(v.getPager(R.value));s(!1);const y=s(!1),P=s([]),w=s("");localStorage.getItem("sobInfo")!=""&&(w.value=JSON.parse(localStorage.getItem("sobInfo")));const j=s([{id:"01",label:"开票有误"},{id:"02",label:"销货退回"},{id:"03",label:"服务中止"},{id:"04",label:"销售折让"}]);le(()=>{E()});const q=I(u,"id"),C=I(u,"blueid"),D=I(u,"readonly"),t=s({id:"",serialNo:"",buyerTaxNo:"",buyerName:"",sellerName:"",sellerTaxNo:"",redInvoiceLabel:"",originInvoiceType:"",originInvoiceTypeName:""}),U=s([{prop:"id",align:"center",show:!1},{prop:"goodsLineNo",label:"序号",align:"center",show:!1,width:"60"},{prop:"goodsCode",label:"商品编号",show:!0,align:"center",width:"200"},{prop:"goodsName",label:"商品名称",show:!0,align:"center",width:"160"},{prop:"goodsSpecification",label:"规格型号",show:!0,align:"center",width:"130"},{prop:"goodsUnit",label:"单位",show:!0,align:"center",width:"100"},{prop:"goodsQuantity",label:"数量",show:!0,align:"center",width:"100"},{prop:"goodsPrice",label:"单价",show:!0,align:"center",width:"110"},{prop:"goodsTotalPrice",label:"价税合计",show:!0,align:"right",width:"110"},{prop:"notaxamount",label:"无税金额",show:!0,align:"right",width:"110"},{prop:"goodsTotalTax",label:"税额",show:!0,align:"center",width:"110"},{prop:"goodsTaxRate",label:"税率/征收率",show:!0,align:"center",minWidth:"120"},{prop:"invoiceLineNature",label:"发票行性质",show:!1,align:"center",width:"200"},{prop:"discountRate",label:"折扣率",show:!1,align:"center",width:"200"},{prop:"discountAmount",label:"折扣额",show:!1,align:"center",width:"200"}]);function W(){}const E=async()=>{y.value=!0;try{const e=await m.post("/Invoice/GetRedInvoice",_.stringify({id:q.value,blueid:C.value}));Array.isArray(e.data.invoicemain)&&e.data.invoicemain.length>0&&(t.value=e.data.invoicemain[0],t.value.sellerName=e.data.invoicemain[0].sellerTaxName,t.value.buyerName=e.data.invoicemain[0].buyerTaxName,t.value.buyerTaxNo=e.data.invoicemain[0].buyerTaxNo,t.value.serialNo=e.data.invoicemain[0].redConfirmSerialNo,x.value=e.data.invoicedetail)}catch{}finally{y.value=!1}};function H(){m.post("/Invoice/SaveRedInvoice?srcorgid="+w.value.id,_.stringify({redinvoiceJSON:JSON.stringify(t.value),invoicedetailsJSON:JSON.stringify(x.value)})).then(e=>{const n=e.success?"success":"error";v.msg(e.msg,n,!1),e.success&&G()}).catch(()=>{})}function $(){se.confirm("是否确认开具？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{H()}).catch(()=>{})}function G(){m.post("/Invoice/AddRedInvoice?srcorgid="+w.value.id,_.stringify({id:t.value.id,blueid:C.value})).then(e=>{const n=e.success?"success":"error";v.msg(e.msg,n,!1),e.success&&(J(),S.value=!1)}).catch(()=>{})}const Q=e=>{P.value=e},x=s([]);function L({row:e,column:n,rowIndex:r,columnIndex:N}){return{color:"#000",textAlign:"center"}}function X({row:e}){if(e.goodsTotalPrice===0)return{backgroundColor:"yellow"}}return O({open:W,headerCellStyle:L}),(e,n)=>{const r=p("el-form-item"),N=p("el-button"),b=p("el-form"),Y=p("el-option"),z=p("el-select"),K=p("el-table-column"),Z=p("el-table"),ee=oe("loading");return c(),f("div",re,[D.value?B("",!0):(c(),h(b,{key:0,inline:"",style:{"padding-left":"5px"}},{default:l(()=>[o(r,{label:"开票流水号:"},{default:l(()=>[a("div",de,g(t.value.serialNo),1)]),_:1}),o(r,{style:{"margin-left":"280px"}},{default:l(()=>[o(N,{type:"primary",onClick:n[0]||(n[0]=i=>$())},{default:l(()=>[F("开具")]),_:1}),o(N,{onClick:n[1]||(n[1]=i=>S.value=!1)},{default:l(()=>[F("关闭")]),_:1})]),_:1})]),_:1})),a("table",ce,[a("tbody",null,[a("tr",null,[a("td",ue,[o(b,{model:t.value,ref:"ruleFormRef",style:{width:"250px !important"}},{default:l(()=>[o(r,{style:{margin:"auto"},label:"红冲原因:",prop:"redInvoiceLabel"},{default:l(()=>[o(z,{modelValue:t.value.redInvoiceLabel,"onUpdate:modelValue":n[2]||(n[2]=i=>t.value.redInvoiceLabel=i),disabled:D.value,style:{width:"200px"}},{default:l(()=>[(c(!0),f(T,null,M(j.value,i=>(c(),h(Y,{key:i.id,label:i.label,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"])]),a("td",pe,[o(b,{model:t.value,ref:"ruleFormRef"},{default:l(()=>[o(r,{style:{margin:"auto"},label:"发票类型:",prop:"originInvoiceTypeName"},{default:l(()=>[a("span",null,g(t.value.originInvoiceTypeName),1)]),_:1})]),_:1},8,["model"])])]),a("tr",ge,[be,a("td",fe,[o(b,{model:t.value,ref:"ruleFormRef","label-width":"100px"},{default:l(()=>[o(r,{label:"名称",prop:"buyerName",style:{position:"relative"}},{default:l(()=>[a("span",he,g(t.value.buyerTaxName),1)]),_:1}),o(r,{label:"纳税人识别号",prop:"buyerTaxNo"},{default:l(()=>[a("span",me,g(t.value.buyerTaxNo),1)]),_:1})]),_:1},8,["model"])]),ve,a("td",_e,[o(b,{model:t.value,ref:"ruleFormRef","label-width":"110px"},{default:l(()=>[o(r,{label:"名称",prop:"sellerid"},{default:l(()=>[a("span",ye,g(t.value.sellerTaxName),1)]),_:1}),o(r,{label:"纳税人识别号",prop:"sellerTaxNo"},{default:l(()=>[a("span",we,g(t.value.sellerTaxNo),1)]),_:1})]),_:1},8,["model"])])])])]),ae((c(),h(Z,{class:"eltable show_table",data:x.value,stripe:k.value.tableStripe,"highlight-current-row":k.value.tableHighlightCurrentRow,style:{width:"100%",color:"#000","margin-bottom":"20px"},"header-cell-style":L,"default-sort":R.value,onSelectionChange:Q,"row-style":X},{default:l(()=>[(c(!0),f(T,null,M(U.value,i=>(c(),f(T,null,[i.show?(c(),h(K,{key:0,prop:i.prop,fit:"","show-overflow-tooltip":"","min-width":i.minWidth,label:i.label,align:i.align,width:i.width},null,8,["prop","min-width","label","align","width"])):B("",!0)],64))),256))]),_:1},8,["data","stripe","highlight-current-row","default-sort"])),[[ee,y.value]])])}}},Fe=te(xe,[["__scopeId","data-v-9f81bbdd"]]);export{Fe as default};
