import{a as ie,_ as ue}from"./index-823f4b27.js";import{d as ce,ai as d,aT as n,aF as de,b5 as pe,c as R,bF as F,a as x,W as o,bD as r,H as me,au as fe,aX as u,aY as ve,aN as ge,o as D,U as p,I as J,F as _e,aV as be,bi as he,Y as we,av as ye,bv as xe}from"./_@vue-5ba92de9.js";import{e as Ce}from"./excel-1d8df660.js";import{cC as ke}from"./__vendor-5e6ac033.js";import{a as Se}from"./_element-plus-8c7ce171.js";import"./_@element-plus-ad4c9002.js";import"./_crypto-js-0812dcff.js";import"./_pdfjs-dist-c04561eb.js";import"./_@microsoft-43c4e133.js";import"./_vue-codemirror-50da885a.js";import"./_@popperjs-c75af06c.js";const Ve={class:"form-container"},Ee={class:"table-container"},ze={class:"roadui_pagerdiv"},De=ce({__name:"CustomerProfile",setup(Ne){const C=we(()=>ie(()=>import("./CustomerProfileEdit-32104d1b.js"),["./CustomerProfileEdit-32104d1b.js","./_@vue-5ba92de9.js","./index-823f4b27.js","./__vendor-5e6ac033.js","./__vendor-693c365c.css","./_@element-plus-ad4c9002.js","./_crypto-js-0812dcff.js","./_element-plus-8c7ce171.js","./_@popperjs-c75af06c.js","./_element-plus-7d03f811.css","./_pdfjs-dist-c04561eb.js","./_@microsoft-43c4e133.js","./_vue-codemirror-50da885a.js","./index-2ccff9e2.css","./CustomerProfileEdit-da07bec2.css"],import.meta.url)),g=d("ajax"),f=d("utils"),H=d("config"),k=n(),_=d("qs");d("index_openmenu"),d("index_removetab");const N=d("index_refreshtab"),S=n("");localStorage.getItem("sobInfo")!=""&&(S.value=JSON.parse(localStorage.getItem("sobInfo")));const b=n(!1),h=n(!1),L=n({prop:"",order:"ascending"}),l=n(f.getPager(L.value)),P=n([]),A=n({}),w=n("");de(()=>{y(!1)});const B=n(document.documentElement.clientHeight-250);window.onresize=function(){B.value=document.documentElement.clientHeight-250};const $=[{prop:"customername",label:"客户名称",width:"300"},{prop:"TaxNo",label:"纳税人识别号",width:"200"},{prop:"Address",label:"地址",width:"260"},{prop:"Phone",label:"电话",width:"180"},{prop:"BankName",label:"开户行",width:"180"},{prop:"Account",label:"银行账号",width:"180"},{prop:"Email",label:"客户邮箱",width:"180"},{prop:"Phone",label:"联系电话",width:"180"}],i=n({customername:"",taxno:""}),y=a=>{a&&(l.value.number=1),h.value=!0,b.value=!0,i.value.size=l.value.size,i.value.number=l.value.number,i.value.order=l.value.order,g.post("/Customer/GetList?srcorgid="+S.value.id,_.stringify(i.value)).then(e=>{P.value=e.data.rows,l.value.total=e.data.total,b.value=!1,h.value=!1}).catch(()=>{b.value=!1,h.value=!1})},V=n(""),I=pe(null),v=n(!1),j=()=>{w.value="",V.value="新增",I.value=C,v.value=!0},q=a=>{w.value=a.id,V.value="修改",I.value=C,v.value=!0};function G(){ye(()=>{M()})}function M(){ke.debounce(()=>{k.value.action=H.SERVER_DEV_APIADDRESS+"/Report/ExportCustomer?"+_.stringify({whereJSON:JSON.stringify(i.value.customername)}),k.value.submit()},300)()}const E=n(),Y=a=>{E.value.clearFiles();const e=a[0];E.value.handleStart(e)},T=n(""),U=n([]),W=async a=>{try{const e=await g.post("/Flow/GetLongId");T.value=e.data,(await Ce(a.raw)).forEach((s,c)=>{U.value.push({id:Number(T.value)+c,customercode:s["统一社会信用代码/纳税人识别号"],customername:s.客户名称,TaxNo:s["统一社会信用代码/纳税人识别号"],Address:s.地址,Phone:s.电话,BankName:s.开户行名称,Account:s.银行账号})}),X(U.value)}catch{}},X=async a=>{try{(await g.post("/Customer/SaveAll?srcorgid="+S.value.id,_.stringify({customerJSON:JSON.stringify(a)}))).success&&(f.msg("导入成功","success",!1),N())}catch{}};function K(a){return a.type!=="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"&&a.type!=="application/vnd.ms-excel"?(f.msg("要导入的文件必须是excel格式文件!",!1),!1):!0}async function Q(a){try{await Se.confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await g.post("/Customer/DeleteAll",_.stringify({id:a.id})),m=e.success?"success":"error";f.msg(e.msg,m,!1),N()}catch(e){e==="cancel"&&f.msg("已取消删除","info",!1)}}const Z=a=>{l.value.size=a,y(!1)},ee=a=>{l.value.number=a,y(!1)};function ae({row:a,column:e,rowIndex:m,columnIndex:s}){return{color:"#000",textAlign:"center"}}return ge("submit_dialogshow",v),(a,e)=>{const m=u("el-input"),s=u("el-form-item"),c=u("el-button"),te=u("el-upload"),oe=u("el-form"),O=u("el-table-column"),le=u("el-table"),ne=u("el-pagination"),re=u("el-dialog"),se=ve("loding");return D(),R("div",null,[F(x("form",{ref_key:"formref",ref:k,action:"",method:"post"},null,512),[[xe,!1]]),x("div",Ve,[o(oe,{inline:!0,model:i.value},{default:r(()=>[o(s,{label:"客户名称"},{default:r(()=>[o(m,{modelValue:i.value.customername,"onUpdate:modelValue":e[0]||(e[0]=t=>i.value.customername=t),style:{width:"230px"},clearable:""},null,8,["modelValue"])]),_:1}),o(s,{label:"纳税人识别号"},{default:r(()=>[o(m,{modelValue:i.value.taxno,"onUpdate:modelValue":e[1]||(e[1]=t=>i.value.taxno=t),style:{width:"230px"},clearable:""},null,8,["modelValue"])]),_:1}),o(s,null,{default:r(()=>[o(c,{type:"primary",onClick:e[2]||(e[2]=t=>y(!0)),icon:"Search"},{default:r(()=>[p("查询")]),_:1}),o(c,{type:"success",onClick:j,icon:"Plus"},{default:r(()=>[p("新增")]),_:1}),o(c,{type:"primary",onClick:G,icon:"Download"},{default:r(()=>[p("导出")]),_:1}),o(te,{ref_key:"upload",ref:E,limit:1,style:{"margin-left":"10px","margin-bottom":"2px"},"on-change":W,"on-exceed":Y,accept:".xlsx,.xls","auto-upload":!1,"before-upload":K,"show-file-list":!1},{trigger:r(()=>[o(c,{icon:"Upload",type:"warning"},{default:r(()=>[p("导入Excel")]),_:1})]),_:1},512)]),_:1}),o(s)]),_:1},8,["model"])]),x("div",Ee,[F((D(),me(le,fe({data:P.value,height:B.value,stripe:l.value.tableStripe,border:"","highlight-current-row":l.value.tableHighlightCurrentRow,style:{width:"100%",color:"#000"},"header-cell-style":ae},a.$attrs,{onCurrentChange:a.tableCurrentChange}),{default:r(()=>[p(" > "),J("",!0),J("",!0),(D(),R(_e,null,be($,(t,z)=>o(O,{fit:"","show-overflow-tooltip":"",key:z,prop:t.prop,label:t.label,align:"center","min-width":t.width},null,8,["prop","label","min-width"])),64)),o(O,{label:"操作",align:"center",width:"140",fixed:"right"},{default:r(t=>[o(c,{size:"small",type:"primary",onClick:z=>q(t.row)},{default:r(()=>[p("修改")]),_:2},1032,["onClick"]),o(c,{size:"small",type:"danger",onClick:z=>Q(t.row)},{default:r(()=>[p("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},16,["data","height","stripe","highlight-current-row","onCurrentChange"])),[[se,h.value]]),x("div",ze,[o(ne,{currentPage:l.value.number,"onUpdate:currentPage":e[3]||(e[3]=t=>l.value.number=t),"page-size":l.value.size,"onUpdate:pageSize":e[4]||(e[4]=t=>l.value.size=t),"page-sizes":l.value.sizes,background:l.value.background,layout:l.value.layout,total:l.value.total,disabled:b.value,onSizeChange:Z,onCurrentChange:ee},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])]),o(re,{modelValue:v.value,"onUpdate:modelValue":e[7]||(e[7]=t=>v.value=t),title:V.value,"align-center":"","destroy-on-close":"",width:"600px",draggable:"","close-on-click-modal":!1},{default:r(()=>[o(he(C),{id:w.value,"onUpdate:id":e[5]||(e[5]=t=>w.value=t),modelValue:A.value,"onUpdate:modelValue":e[6]||(e[6]=t=>A.value=t)},null,8,["id","modelValue"])]),_:1},8,["modelValue","title"])])])}}});const Le=ue(De,[["__scopeId","data-v-57041bab"]]);export{Le as default};
