import{ai as S,aT as r,aF as ee,c as D,a as C,W as t,bD as a,bI as le,bF as P,H as w,aX as m,aY as te,o as p,bi as g,I as F,U as b,b9 as ae,bv as oe}from"./_@vue-5ba92de9.js";const se={class:"roadui_page"},ue={style:{height:"calc(100% - 60px)",overflow:"auto"}},ne={key:0},de={key:1},ie=C("span",null,"操作",-1),re={class:"roadui_pagerdiv"},me={class:"roadui_note",style:{"margin-left":"12px"}},pe={class:"dialog-footer"},fe={__name:"index",props:{query:{type:String,default:()=>""}},setup(R){const V=S("ajax"),s=S("utils"),x=S("qs"),L=S("ElSelectorg"),G=R,n=r(!1),z=r(!1),T=r([]),v=r({});r([]);const d=r({});let k=[];const q=r({prop:"addtype",order:"descending"}),u=r(s.getPager(q.value)),B=r(null),y=r(!1),U=r(""),I=s.query("addtype",G.query),M={comment:[{required:!0,message:"请输入意见",trigger:"blur"}]};ee(()=>{_()});const E=o=>{u.value.size=o,_(!1)},H=o=>{u.value.number=o,_(!1)},O=o=>{u.value.order=s.getOrder(o),_(!1)},A=o=>{k=o},_=o=>{o&&(u.value.number=1),z.value=!0,n.value=!0,v.value.size=u.value.size,v.value.number=u.value.number,v.value.order=u.value.order,V.post("/FlowComment/"+(I=="1"?"GetManageList":"GetUserList"),x.stringify(v.value)).then(e=>{T.value=e.data.rows,u.value.total=e.data.total,n.value=!1,z.value=!1}).catch(()=>{n.value=!1})},$=o=>{if(s.isUndef(o)||s.length(o.id)===0){d.value={id:s.emptyLong,addType:I,userId:"",comment:""},U.value="添加",y.value=!0;return}s.length(o.id)>0&&V.post("/FlowComment/Get?commentid="+o.id).then(e=>{e.success?(d.value=e.data,d.value.userId=e.data.userId>s.emptyLong?"u_"+e.data.userId:"",U.value="编辑",y.value=!0):s.msg("获取数据失败！",!1)}).catch(()=>{})},W=async o=>{o&&await o.validate(e=>{if(e){n.value=!0;const c=d.value.id||"";V.post("/FlowComment/Save?commentid="+c,x.stringify(d.value)).then(f=>{let i=f.msg;s.length(i)===0&&(f.success?i="保存成功！":f.code==1?i="数据验证错误！":i="保存失败！"),s.msg(i,f.success),n.value=!1,f.success&&(y.value=!1,_()),n.value=!1}).catch(()=>{n.value=!1})}})},X=()=>{if(k.length===0){s.msg("您没有选择要删除的意见！",!1);return}s.confirm("您确定要删除所选意见吗？",()=>{n.value=!0,V.post("/FlowComment/Delete",x.stringify({ids:s.getArrayValues(k,"id").join(",")})).then(o=>{s.msg(o.success?"删除成功！":"删除失败！",o.success),n.value=!1,o.success&&(k=[],_())}).catch(()=>{n.value=!1})})};return(o,e)=>{const c=m("el-form-item"),f=m("el-input"),i=m("el-button"),j=m("el-form"),h=m("el-table-column"),N=m("el-tag"),Y=m("el-table"),J=m("el-pagination"),K=m("el-input-number"),Q=m("el-dialog"),Z=te("loading");return p(),D("div",se,[C("div",null,[t(j,{inline:!0,onSubmit:e[4]||(e[4]=le(()=>{},["prevent"]))},{default:a(()=>[g(I)==1?(p(),w(c,{key:0,label:"使用人"},{default:a(()=>[t(g(L),{modelValue:v.value.userId,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value.userId=l),"select-type":"user","multiple-limit":1,style:{width:"170px"},clearable:""},null,8,["modelValue"])]),_:1})):F("",!0),t(c,{label:"意见"},{default:a(()=>[t(f,{modelValue:v.value.comment,"onUpdate:modelValue":e[1]||(e[1]=l=>v.value.comment=l),style:{width:"180px"},clearable:""},null,8,["modelValue"])]),_:1}),t(c,null,{default:a(()=>[t(i,{type:"primary",disabled:n.value,onClick:e[2]||(e[2]=l=>_(!0))},{default:a(()=>[b("查询")]),_:1},8,["disabled"]),t(i,{type:"primary",disabled:n.value,onClick:e[3]||(e[3]=l=>$(null))},{default:a(()=>[b("添加")]),_:1},8,["disabled"]),t(i,{type:"danger",disabled:n.value,onClick:X},{default:a(()=>[b("删除")]),_:1},8,["disabled"])]),_:1})]),_:1})]),C("div",ue,[P((p(),w(Y,{data:T.value,stripe:u.value.tableStripe,border:u.value.tableBorder,style:{width:"100%"},"highlight-current-row":u.value.tableHighlightCurrentRow,onSelectionChange:A,"default-sort":q.value,onSortChange:O},{default:a(()=>[t(h,{type:"selection",width:"42"}),t(h,{prop:"comments",label:"意见"}),t(h,{prop:"userId",label:"使用人",width:"200"},{default:a(l=>[l.row.userId==g(s).emptyLong?(p(),D("span",ne,"所有人员")):(p(),w(N,{key:1},{default:a(()=>[b(ae(l.row.userId),1)]),_:2},1024))]),_:1}),t(h,{prop:"addType",label:"来源",width:"130",sortable:"custom"},{default:a(l=>[l.row.addType==0?(p(),w(N,{key:0},{default:a(()=>[b("用户添加")]),_:1})):(p(),D("span",de,"管理员添加"))]),_:1}),t(h,{prop:"sort",label:"排序",width:"90"}),t(h,{width:"90"},{header:a(()=>[ie]),default:a(l=>[t(i,{size:"small",disabled:n.value,type:"primary",onClick:ve=>$(l.row)},{default:a(()=>[b("编辑")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[Z,z.value]]),C("div",re,[t(J,{currentPage:u.value.number,"onUpdate:currentPage":e[5]||(e[5]=l=>u.value.number=l),"page-size":u.value.size,"onUpdate:pageSize":e[6]||(e[6]=l=>u.value.size=l),"page-sizes":u.value.sizes,background:u.value.background,layout:u.value.layout,total:u.value.total,disabled:n.value,onSizeChange:E,onCurrentChange:H},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])])]),t(Q,{modelValue:y.value,"onUpdate:modelValue":e[12]||(e[12]=l=>y.value=l),title:U.value,"align-center":"","destroy-on-close":"",width:"700px",draggable:"","close-on-click-modal":!1},{footer:a(()=>[C("span",pe,[t(i,{disabled:n.value,type:"primary",onClick:e[10]||(e[10]=l=>W(B.value))},{default:a(()=>[b("保存")]),_:1},8,["disabled"]),t(i,{disabled:n.value,onClick:e[11]||(e[11]=l=>y.value=!1)},{default:a(()=>[b("关闭")]),_:1},8,["disabled"])])]),default:a(()=>[t(j,{model:d.value,ref_key:"ruleFormRef",ref:B,rules:M,"label-width":"80px"},{default:a(()=>[g(I)==1?(p(),w(c,{key:0,label:"使用人",prop:"userId"},{default:a(()=>[t(g(L),{modelValue:d.value.userId,"onUpdate:modelValue":e[7]||(e[7]=l=>d.value.userId=l),disabled:d.value.id!==g(s).emptyLong,"select-type":"user","multiple-limit":1,clearable:""},null,8,["modelValue","disabled"]),P(C("span",me,"编辑时不能修改使用人员",512),[[oe,d.value.id!==g(s).emptyLong]])]),_:1})):F("",!0),t(c,{label:"意见",prop:"comment"},{default:a(()=>[t(f,{modelValue:d.value.comment,"onUpdate:modelValue":e[8]||(e[8]=l=>d.value.comment=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),d.value.id!==g(s).emptyLong?(p(),w(c,{key:1,label:"排序",prop:"sort"},{default:a(()=>[t(K,{modelValue:d.value.sort,"onUpdate:modelValue":e[9]||(e[9]=l=>d.value.sort=l),step:5,min:0},null,8,["modelValue"])]),_:1})):F("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{fe as default};
