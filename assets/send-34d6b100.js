import{ai as u,aT as c,aF as N,av as O,c as W,W as a,bD as s,aX as f,o as $,bi as v,a as _,U as g}from"./_@vue-5ba92de9.js";const A={class:"roadui_page"},G={style:{"margin-left":"12px"}},I={style:{"margin-left":"12px"}},L=_("span",{style:{"margin-right":"12px"}},"颜色",-1),z={__name:"send",props:{query:{type:String,default:()=>""}},setup(h){const x=u("ajax"),p=u("utils"),q=u("qs"),T=u("config"),D=u("ElSelectfile"),F=u("ElCkeditor"),b=u("ElSelectorg"),V=h,k=p.query("id",V.query),m=p.query("source",V.query),C=c(null),y=c(null),S=c(null),U=c(null),j=c(null),d=c(!1),l=c({}),B={receiveUsers:[{required:!0,message:"请选择收件人",trigger:"blur"}],mailSubject:[{required:!0,message:"邮件主题不能为空",trigger:"blur"}]};N(()=>{O(()=>{if(p.length(k)>0){d.value=!0;let i="/Mail/GetSendMail?id="+k+"&source="+m;x.post(i).then(e=>{if(l.value=e.data,m==="inboxreply"||m==="inboxredirect"){let n=(m==="inboxreply"?"回复 - ":"转发 - ")+e.data.mailSubject,o='<p></p><div style="padding:4px 10px;margin-bottom:8px;border:1px solid #d9d9d9;border-radius:4px;">';if(o+='<div style="padding:5px 0;">--------------------------原始邮件--------------------------</div>',o+='<div style="background-color:#f5f5f5;border-radius:4px;padding:8px;margin:5px 0 10px 0;">',o+="<div>发件人："+e.data.sender+" - "+e.data.senderOrg+"</div>",o+="<div>收件人："+e.data.receiver+" - "+e.data.receiverOrg+"</div>",o+="<div>日期："+e.data.receiveTime+"</div>",o+="</div>",o+=e.data.content,e.data.files1.length>0){o+="<div>附件：</div><div>";for(let r=0;r<e.data.files1.length;r++)o+='<span style="margin-right:20px;"><a target="_blank" class="roaduia" href="javascript:;" data-fileid="'+e.data.files1[r].id+`" onclick="javascript:window.open('`+T.SERVER_WEBADDRESS+"/Files/Show?id="+e.data.files1[r].id+`&nroadflow-token='+getRoadFlowLoginToken())">`+(r+1)+". "+e.data.files1[r].name+"</a></span>";o+="</div>"}o+="</div>",l.value.mailSubject=n,l.value.content=o}C.value.initTitle(l.value.files),d.value=!1}).catch(()=>{d.value=!1})}})});const w=async(i,e)=>{i&&await i.validate(n=>{n&&(l.value.type=e,e===1?p.confirm("您确定要发送吗？",R):R())})},R=()=>{d.value=!0,x.post("/Mail/Send",q.stringify(l.value)).then(i=>{let e=i.msg;if(p.length(e)===0)switch(i.code){case 1:e="接收人不能为空！";break;case 2:e="邮件主题不能为空！";break;default:e=(l.value.type===0?"保存":"发送")+(i.success?"成功！":"失败！");break}p.msg(e,i.success),i.success&&(l.value.type===1?(l.value={id:"",receiver:"",carbonCopy:"",secretCopy:""},S.value.initTitle(""),U.value.initTitle(""),j.value.initTitle("")):l.value.id=i.data.id),d.value=!1}).catch(()=>{d.value=!1})};return(i,e)=>{const n=f("el-form-item"),o=f("el-input"),r=f("el-color-picker"),E=f("el-button"),M=f("el-form");return $(),W("div",A,[a(M,{model:l.value,ref_key:"ruleFormRef",ref:y,rules:B,"label-width":"80px"},{default:s(()=>[a(n,{label:"收件人",prop:"receiveUsers"},{default:s(()=>[a(v(b),{ref_key:"receiveUsersRef",ref:S,modelValue:l.value.receiveUsers,"onUpdate:modelValue":e[0]||(e[0]=t=>l.value.receiveUsers=t),style:{width:"100%"},clearable:""},null,8,["modelValue"])]),_:1}),a(n,{label:"抄送",prop:"carbonCopy"},{default:s(()=>[a(v(b),{ref_key:"carbonCopyRef",ref:U,modelValue:l.value.carbonCopy,"onUpdate:modelValue":e[1]||(e[1]=t=>l.value.carbonCopy=t),style:{width:"460px"},clearable:""},null,8,["modelValue"]),_("span",G,[g(" 密送"),a(v(b),{ref_key:"secretCopyRef",ref:j,modelValue:l.value.secretCopy,"onUpdate:modelValue":e[2]||(e[2]=t=>l.value.secretCopy=t),style:{width:"460px","margin-left":"12px"},clearable:""},null,8,["modelValue"])])]),_:1}),a(n,{label:"主题",prop:"mailSubject"},{default:s(()=>[a(o,{modelValue:l.value.mailSubject,"onUpdate:modelValue":e[3]||(e[3]=t=>l.value.mailSubject=t),style:{width:"90%"},clearable:""},null,8,["modelValue"]),_("span",I,[L,a(r,{modelValue:l.value.subjectColor,"onUpdate:modelValue":e[4]||(e[4]=t=>l.value.subjectColor=t)},null,8,["modelValue"])])]),_:1}),a(n,{label:"附件",prop:"files"},{default:s(()=>[a(v(D),{ref_key:"filesRef",ref:C,modelValue:l.value.files,"onUpdate:modelValue":e[5]||(e[5]=t=>l.value.files=t),style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(n,{label:"正文",prop:"content"},{default:s(()=>[a(v(F),{modelValue:l.value.content,"onUpdate:modelValue":e[6]||(e[6]=t=>l.value.content=t),toolbar:1,height:280},null,8,["modelValue"])]),_:1}),a(n,null,{default:s(()=>[a(E,{type:"primary",disabled:d.value,onClick:e[7]||(e[7]=t=>w(y.value,0))},{default:s(()=>[g("存草稿")]),_:1},8,["disabled"]),a(E,{type:"primary",disabled:d.value,onClick:e[8]||(e[8]=t=>w(y.value,1))},{default:s(()=>[g("发送")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])])}}};export{z as default};
