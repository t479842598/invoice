import{D as Ve}from"./_vuedraggable-a473ce37.js";import he from"./sign-893b3743.js";import{ai as k,aT as m,aF as ke,aK as Ue,by as qe,b5 as we,c as A,W as u,bD as o,aN as G,aX as v,o as i,bi as c,H as f,U as d,b9 as F,I as y,a as w,F as K,aV as Q,aZ as xe}from"./_@vue-5ba92de9.js";import"./__vendor-5e6ac033.js";const Ce={style:{display:"flex"}},ze={style:{"margin-left":"12px"}},Se={class:"roadui_draggable_item"},Ie={class:"dialog-footer"},Pe={__name:"user",props:{query:{type:String,default:()=>""}},setup(X){const _=k("ajax"),s=k("utils"),D=m("");localStorage.getItem("sobInfo")!=""&&(D.value=JSON.parse(localStorage.getItem("sobInfo")));const x=k("qs"),Z=k("ElSelectorg"),ee=k("ElUsersign"),B=k("openPage"),C=k("updateTreeNode"),le=k("showType"),V=X,b=s.query("isadd",V.query),M=m(null),z=m([]),t=m({status:0}),ae={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],account:[{required:!0,message:"请输入登录帐号",trigger:"blur"}],invoiceaccount:[{required:!0,message:"请输入开票帐号",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]},r=m(!1),R=m(!1);let U=s.query("userid",V.query),h=s.query("organizeid",V.query),S=s.query("organizetype",V.query);const $=m([]);m([]);const Y=m([]);ke(()=>{te(),E(),document.body.ondrop=function(l){try{l.preventDefault(),l.stopPropagation()}catch{}}}),Ue(()=>{document.body.ondrop=null}),qe(()=>V.query,l=>{U=s.query("userid",l),h=s.query("organizeid",l),S=s.query("organizetype",l),E()});const E=()=>{s.length(U)!==0&&_.post("/User/Get?userid="+U+"&organizetype="+S).then(l=>{if(l.success){z.value=[],$.value=[],t.value=l.data;for(let e=0;e<l.data.accoutlist.length;e++)z.value.push(Number(l.data.accoutlist[e].id));for(let e=0;e<l.data.invoicedepartment.length;e++)$.value.push(Number(l.data.invoicedepartment[e].id))}else s.msg("未找到人员！",!1)}).catch(()=>{})},te=()=>{_.post("user/GetUserAccount?srcorgid="+D.value.id).then(l=>{l.success&&(Y.value=l.data)}).catch(()=>{})},L=()=>{let l=s.query("organizetype",V.query),e=s.query("returnurl",V.query);B({type:l},e)},oe=()=>{const l=t.value.name;s.length(t.value.name)===0||s.length(t.value.account)>0||_.post("/User/GetAccount?srcorgid="+D.value.id,x.stringify({name:l})).then(e=>{e.success&&(t.value.account=e.data)}).catch(()=>{})},ue=async l=>{l&&await l.validate(e=>{e&&(t.value.accountlist=z.value.join(","),t.value.invoicedepartlist=$.value.join(","),r.value=!0,_.post("/User/Save?userid="+U+"&organizeid="+h+"&organizetype="+S+"&srcorgid="+D.value.id,x.stringify(t.value)).then(n=>{r.value=!1;let p=n.msg;s.length(p)===0&&(n.code==1?p="数据验证错误！":n.code==2?p="帐号已经被使用！":p=n.success?"保存成功！":"保存失败！"),s.msg(p,n.success),r.value=!1,n.success&&(b&&L(),C(h))}).catch(()=>{r.value=!1}))})},se=()=>{s.confirm("您确定要删除吗？",()=>{r.value=!0,_.post("/User/Delete",x.stringify({userid:U})).then(l=>{let e=l.msg;s.length(e)===0&&(l.success?e="删除成功！":l.code==1?e="当前人员存在流程任务，不能删除！":e=l.code==-1?"未找到要删除的人员！":"删除失败！"),s.msg(e,l.success),l.success&&C(h),r.value=!1}).catch(()=>{r.value=!1})})},ne=()=>{s.confirm("您确定要初始化密码吗？",()=>{r.value=!0,_.post("/User/InitPassword?userid="+U+"&organizetype="+S).then(l=>{if(l.success)s.alert("密码已初始化为："+l.data.password,"","",!0);else{let e=l.msg;s.length(e)===0&&(e=l.code==-1?"未找到人员！":"初始化密码失败！",s.msg(e,!1))}r.value=!1}).catch(()=>{r.value=!1})})},I=m(!1),T=m([]),re=()=>{_.post("/User/GetSortItems?organizeid="+h).then(l=>{if(l.success){if(l.data.length===1){s.msg("当前组织下只有一个人员，勿需排序！",!1);return}T.value=l.data,I.value=!0}else s.msg("加载人员错误！",!1)}).catch(()=>{})},de=()=>{let l=[];for(let e=0;e<T.value.length;e++)l.push(T.value[e].id);_.post("/User/SaveSort?organizeid="+h,x.stringify({organizeusers:l.join(",")})).then(e=>{let n=e.msg;s.length(n)===0&&(n=e.success?"保存成功！":"保存失败！"),s.msg(n,e.success),e.success&&(I.value=!1,C(h))}).catch(()=>{})},q=m(""),N=m(!1),ie=()=>{if(s.length(q.value)===0){s.msg("请选择要调往的组织！",!1);return}s.confirm("您确定要调动吗？",()=>{r.value=!0,_.post("/User/TransferTo",x.stringify({userid:t.value.id,toorg:q.value,parttime:N.value})).then(l=>{s.msg(l.success?"调动成功！":"调动失败！",l.success),r.value=!1,l.success&&(C(h),C(q.value),q.value="",N.value=!1)}).catch(()=>{r.value=!1})})},ce=()=>{B({type:0},"?organizeid=u_"+t.value.id+"&organizetype="+S+"&returnurl="+encodeURIComponent(V.query))},me=()=>{B({type:-2},"?userid="+t.value.id+"&organizetype=4&returnurl="+encodeURIComponent(V.query))},j=m(!1),pe=we(he),O=m(""),fe=l=>{O.value="?userid="+l.id,j.value=!0};return G("user_info",t),G("user_dialogsignshow",j),G("user_loadformdata",E),(l,e)=>{const n=v("el-form-item"),p=v("el-input"),P=v("el-radio"),W=v("el-radio-group"),H=v("el-checkbox"),ge=v("el-checkbox-group"),ve=v("el-date-picker"),g=v("el-button"),ye=v("el-space"),be=v("el-form"),J=v("el-dialog");return i(),A("div",null,[u(be,{model:t.value,ref_key:"ruleFormRef",ref:M,rules:ae,"label-width":"100px"},{default:o(()=>[c(s).length(t.value.id)>0&&t.value.id!=c(s).emptyLong?(i(),f(n,{key:0,label:"人员id",class:"roadui_formfont"},{default:o(()=>[d(F(t.value.id),1)]),_:1})):y("",!0),u(n,{label:"姓名",prop:"name"},{default:o(()=>[u(p,{modelValue:t.value.name,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.name=a),onBlur:oe,clearable:""},null,8,["modelValue"])]),_:1}),u(n,{label:"登录帐号",prop:"account"},{default:o(()=>[u(p,{modelValue:t.value.account,"onUpdate:modelValue":e[1]||(e[1]=a=>t.value.account=a),clearable:""},null,8,["modelValue"])]),_:1}),u(n,{label:"开票帐号",prop:"invoiceaccount"},{default:o(()=>[u(p,{modelValue:t.value.invoiceaccount,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.invoiceaccount=a),clearable:""},null,8,["modelValue"])]),_:1}),u(n,{label:"性别",prop:"gender"},{default:o(()=>[u(W,{modelValue:t.value.gender,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.gender=a)},{default:o(()=>[u(P,{label:0},{default:o(()=>[d("男")]),_:1}),u(P,{label:1},{default:o(()=>[d("女")]),_:1})]),_:1},8,["modelValue"]),u(n,{label:"状态",prop:"status"},{default:o(()=>[u(W,{modelValue:t.value.status,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.status=a)},{default:o(()=>[u(P,{label:0},{default:o(()=>[d("正常")]),_:1}),u(P,{label:1},{default:o(()=>[d("冻结")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),w("div",Ce,[w("div",null,[u(n,{label:"账套选择",prop:"sobItems"},{default:o(()=>[u(ge,{modelValue:z.value,"onUpdate:modelValue":e[5]||(e[5]=a=>z.value=a),style:{display:"flex","flex-direction":"column"}},{default:o(()=>[(i(!0),A(K,null,Q(Y.value,a=>(i(),f(H,{key:a.id,label:a.id},{default:o(()=>[d(F(a.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})])]),u(n,{label:"手机",prop:"phone"},{default:o(()=>[u(p,{modelValue:t.value.phone,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.phone=a),style:{width:"280px"},clearable:""},null,8,["modelValue"]),u(n,{label:"邮箱",prop:"email"},{default:o(()=>[u(p,{modelValue:t.value.email,"onUpdate:modelValue":e[7]||(e[7]=a=>t.value.email=a),style:{width:"280px"},clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),u(n,{label:"办公电话",prop:"tel"},{default:o(()=>[u(p,{modelValue:t.value.tel,"onUpdate:modelValue":e[8]||(e[8]=a=>t.value.tel=a),style:{width:"280px"},clearable:""},null,8,["modelValue"]),u(n,{label:"生日",prop:"birthDay"},{default:o(()=>[u(ve,{modelValue:t.value.birthDay,"onUpdate:modelValue":e[9]||(e[9]=a=>t.value.birthDay=a),"value-format":"YYYY-MM-DD",type:"date","disabled-date":a=>a.getTime()>Date.now()},null,8,["modelValue","disabled-date"])]),_:1})]),_:1}),u(n,{label:"工号",prop:"jobNumber"},{default:o(()=>[u(p,{modelValue:t.value.jobNumber,"onUpdate:modelValue":e[10]||(e[10]=a=>t.value.jobNumber=a),style:{width:"280px"},clearable:""},null,8,["modelValue"]),u(n,{label:"身份证号",prop:"idCard"},{default:o(()=>[u(p,{modelValue:t.value.idCard,"onUpdate:modelValue":e[11]||(e[11]=a=>t.value.idCard=a),maxlength:18,style:{width:"280px"},clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),R.value?(i(),f(n,{key:1,label:"调动到"},{default:o(()=>[u(c(Z),{modelValue:q.value,"onUpdate:modelValue":e[12]||(e[12]=a=>q.value=a),"select-type":"unit,dept,station",placeholder:"请选择要调往的组织","multiple-limit":1,style:{width:"280px","margin-right":"12px"},clearable:""},null,8,["modelValue"]),u(H,{modelValue:N.value,"onUpdate:modelValue":e[13]||(e[13]=a=>N.value=a),label:"兼任",size:"large",style:{"margin-right":"12px"}},null,8,["modelValue"]),u(g,{type:"primary",disabled:r.value,onClick:ie},{default:o(()=>[d("确定调动")]),_:1},8,["disabled"])]),_:1})):y("",!0),c(b)?y("",!0):(i(),f(n,{key:2,label:"签章"},{default:o(()=>[u(c(ee),{sign:c(s).length(t.value.sign)>0?t.value.sign:t.value.name},null,8,["sign"]),w("span",ze,[u(g,{type:"primary",onClick:e[14]||(e[14]=a=>fe(t.value))},{default:o(()=>[d("设置")]),_:1})])]),_:1})),c(b)?y("",!0):(i(),f(n,{key:3,label:"所在组织"},{default:o(()=>[u(ye,{direction:"vertical",alignment:"left",size:0},{default:o(()=>[(i(!0),A(K,null,Q(t.value.organizes,(a,_e)=>(i(),A("div",{key:_e,class:"roadui_formfont"},F(c(s).replaceWildcard(a)),1))),128))]),_:1})]),_:1})),u(n,{label:""},{default:o(()=>[u(g,{type:"primary",disabled:r.value,onClick:e[15]||(e[15]=a=>ue(M.value))},{default:o(()=>[d("保存")]),_:1},8,["disabled"]),c(b)?(i(),f(g,{key:0,type:"primary",disabled:r.value,onClick:L},{default:o(()=>[d("返回")]),_:1},8,["disabled"])):y("",!0),c(b)?y("",!0):(i(),f(g,{key:1,type:"danger",disabled:r.value,onClick:se},{default:o(()=>[d("删除")]),_:1},8,["disabled"])),c(b)?y("",!0):(i(),f(g,{key:2,type:"warning",disabled:r.value,onClick:e[16]||(e[16]=a=>R.value=!R.value)},{default:o(()=>[d("调动")]),_:1},8,["disabled"])),c(b)?y("",!0):(i(),f(g,{key:3,type:"warning",disabled:r.value,onClick:ne},{default:o(()=>[d("初始密码")]),_:1},8,["disabled"])),!c(b)&&c(le)==0?(i(),f(g,{key:4,type:"info",disabled:r.value,onClick:re},{default:o(()=>[d("排序")]),_:1},8,["disabled"])):y("",!0),c(b)?y("",!0):(i(),f(g,{key:5,type:"primary",disabled:r.value,onClick:ce},{default:o(()=>[d("菜单授权")]),_:1},8,["disabled"])),c(b)?y("",!0):(i(),f(g,{key:6,disabled:r.value,onClick:me},{default:o(()=>[d("查看菜单授权")]),_:1},8,["disabled"]))]),_:1})]),_:1},8,["model"]),u(J,{modelValue:I.value,"onUpdate:modelValue":e[18]||(e[18]=a=>I.value=a),title:"排序","align-center":"","destroy-on-close":"",width:"550px",draggable:"","close-on-click-modal":!1},{footer:o(()=>[w("span",Ie,[u(g,{disabled:r.value,type:"primary",onClick:de},{default:o(()=>[d("保存")]),_:1},8,["disabled"]),u(g,{disabled:r.value,onClick:e[17]||(e[17]=a=>I.value=!1)},{default:o(()=>[d("关闭")]),_:1},8,["disabled"])])]),default:o(()=>[u(c(Ve),{list:T.value,"item-key":"id",animation:200,group:{name:"menu",pull:!0},class:"roadui_draggable_chosen"},{item:o(({element:a})=>[w("div",Se,[w("div",null,F(a.name),1)])]),_:1},8,["list"])]),_:1},8,["modelValue"]),u(J,{modelValue:j.value,"onUpdate:modelValue":e[19]||(e[19]=a=>j.value=a),title:"签章",class:"el-dialog__padding","align-center":"","destroy-on-close":"",width:"500px",draggable:"","close-on-click-modal":!1},{default:o(()=>[(i(),f(xe(pe.value),{query:O.value},null,8,["query"]))]),_:1},8,["modelValue"])])}}};export{Pe as default};
