import{ai as v,aT as c,aF as K,c as Q,a as I,W as l,bD as n,bF as Z,H as k,aX as s,aY as ee,o as _,bi as C,U as g,b9 as U,I as w}from"./_@vue-5ba92de9.js";const le={class:"roadui_page"},te={class:"roadui_pagerdiv"},oe={__name:"completed",props:{query:{type:String,default:()=>""}},setup(F){const x=v("ajax"),r=v("utils"),V=v("qs"),J=v("ElSelectflow"),T=v("index_openmenu"),S=F,N=c("");localStorage.getItem("sobInfo")!=""&&(N.value=JSON.parse(localStorage.getItem("sobInfo")));const y=c(!1),u=c(!1),d=c({status:r.query("status",S.query)||"0"}),b=c([]),D=c([]),q=c({prop:"completedtime",order:"descending"}),o=c(r.getPager(q.value));K(()=>{m(!1)});const M=e=>{o.value.size=e,m(!1)},j=e=>{o.value.number=e,m(!1)},Y=e=>{o.value.order=r.getOrder(e),m(!1)},m=e=>{e&&(o.value.number=1),y.value=!0,u.value=!0,d.value.size=o.value.size,d.value.number=o.value.number,d.value.order=o.value.order,d.value.date1=r.length(b.value)>0?b.value[0]:"",d.value.date2=r.length(b.value)>1?b.value[1]:"",x.post("/Flow/GetCompletedList",V.stringify(d.value)).then(t=>{D.value=t.data.rows,o.value.total=t.data.total,u.value=!1,y.value=!1}).catch(()=>{u.value=!1,y.value=!1})},$=e=>{localStorage.setItem("task",JSON.stringify(e)),localStorage.setItem("tasks",JSON.stringify(e)),localStorage.setItem("formid",JSON.stringify(e.formid)),localStorage.setItem("tasktype",JSON.stringify(e.taskType));const t=!0;let f="/flow/run/index?flowid="+e.flowId+"&stepid="+e.stepId+"&taskid="+e.id+"&groupid="+e.groupId+"&instanceid="+e.instanceId+"&readonly="+t,i=0;r.query("isiframe",S.query)==1&&(f+="&nroadflow-token="+r.query("nroadflow-token",S.query),i=1);const z={title:e.stepName,id:"task_"+e.id,url:f,ico:"FolderChecked",openMode:i,width:1e3,height:620};T(z)},E=e=>{const t={id:"task_urge_"+r.createGuid(!1),title:"任务催办",url:"/flow/run/urge?flowid="+e.flowId+"&stepid="+e.stepId+"&taskid="+e.id+"&groupid="+e.groupId+"&instanceid="+e.instanceId+"&uid=-1&openmode=1",openMode:1,width:"680px"};T(t)},P=e=>{r.confirm("您确定要撤回吗？",()=>{const t={type:"withdraw",flowId:e.flowId,stepId:e.stepId,taskId:e.id,groupId:e.groupId,instanceId:e.instanceId,steps:[],comment:"",attachment:"",sign:0};u.value=!0,x.post("/Flow/FlowExecute?srcorgid="+N.value.id,V.stringify({json:JSON.stringify(t)})).then(f=>{if(f.data.code==0)r.msg("撤回成功！",!0),m(!1);else{const i=f.data.code==5006?"后续任务已处理，不能撤回！":"执行撤回发生了错误！";r.msg(i,!1)}u.value=!1}).catch(()=>{u.value=!1})})};return(e,t)=>{const f=s("el-input"),i=s("el-form-item"),z=s("el-date-picker"),B=s("el-radio-button"),G=s("el-radio-group"),h=s("el-button"),H=s("el-form"),p=s("el-table-column"),R=s("el-tag"),L=s("el-space"),W=s("el-table"),X=s("el-pagination"),A=ee("loading");return _(),Q("div",le,[I("div",null,[l(H,{inline:!0},{default:n(()=>[l(i,{label:"标题"},{default:n(()=>[l(f,{modelValue:d.value.title,"onUpdate:modelValue":t[0]||(t[0]=a=>d.value.title=a),style:{width:"130px"},clearable:""},null,8,["modelValue"])]),_:1}),l(i,{label:"流程"},{default:n(()=>[l(C(J),{modelValue:d.value.flowId,"onUpdate:modelValue":t[1]||(t[1]=a=>d.value.flowId=a),"auth-type":5,style:{width:"160px"}},null,8,["modelValue"])]),_:1}),l(i,{label:"完成时间"},{default:n(()=>[l(z,{modelValue:b.value,"onUpdate:modelValue":t[2]||(t[2]=a=>b.value=a),style:{width:"210px"},type:"daterange","value-format":"YYYY-MM-DD","unlink-panels":"","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:C(r).dateShortucts},null,8,["modelValue","shortcuts"])]),_:1}),l(i,{label:"流程状态"},{default:n(()=>[l(G,{modelValue:d.value.status,"onUpdate:modelValue":t[3]||(t[3]=a=>d.value.status=a),onChange:t[4]||(t[4]=a=>m(!0))},{default:n(()=>[l(B,{label:"0"},{default:n(()=>[g("进行中")]),_:1}),l(B,{label:"1"},{default:n(()=>[g("已结束")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(i,null,{default:n(()=>[l(h,{type:"primary",disabled:u.value,onClick:t[5]||(t[5]=a=>m(!0))},{default:n(()=>[g("查询")]),_:1},8,["disabled"])]),_:1})]),_:1})]),I("div",null,[Z((_(),k(W,{data:D.value,stripe:o.value.tableStripe,border:o.value.tableBorder,"header-cell-style":{background:"#f4f3f9",color:"#000000"},style:{width:"100%",color:"#000000","font-size":"14px"},size:"small","highlight-current-row":o.value.tableHighlightCurrentRow,"default-sort":q.value,onSortChange:Y},{default:n(()=>[l(p,{prop:"formtype",label:"单据类型",width:"150"}),l(p,{prop:"billcode",label:"单据号",width:"150"}),l(p,{prop:"billname",label:"单据名称",width:"250"},{default:n(a=>[a.row.taskType>0?(_(),k(R,{key:0,effect:"dark",style:{"margin-right":"8px","border-width":"0"},color:C(r).getTaskTypeColor(a.row.taskType)},{default:n(()=>[g(U(C(r).getTaskTypeTitle(a.row.taskType)),1)]),_:2},1032,["color"])):w("",!0),I("span",null,U(a.row.billname),1)]),_:1}),w("",!0),l(p,{prop:"senderName",label:"发送人",width:"100"}),l(p,{prop:"username",label:"制单人",width:"100",sortable:"custom"}),w("",!0),l(p,{prop:"billdate",label:"制单日期",width:"150"}),l(p,{prop:"receiveTime",label:"接收时间",width:"150",sortable:"custom"}),l(p,{prop:"completedTime",label:"完成时间",width:"150",sortable:"custom"}),l(p,{prop:"stepName",label:"当前步骤",width:"150",sortable:"custom"}),l(p,{width:"230"},{default:n(a=>[l(L,null,{default:n(()=>[l(h,{type:"primary",size:"small",disabled:u.value,onClick:O=>$(a.row)},{default:n(()=>[g("表单")]),_:2},1032,["disabled","onClick"]),a.row.urge==1?(_(),k(h,{key:0,type:"warning",disabled:u.value,onClick:O=>E(a.row),size:"small"},{default:n(()=>[g("催办")]),_:2},1032,["disabled","onClick"])):w("",!0),a.row.withdraw==1?(_(),k(h,{key:1,type:"danger",disabled:u.value,onClick:O=>P(a.row),size:"small"},{default:n(()=>[g("撤回")]),_:2},1032,["disabled","onClick"])):w("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[A,y.value]]),I("div",te,[l(X,{currentPage:o.value.number,"onUpdate:currentPage":t[6]||(t[6]=a=>o.value.number=a),"page-size":o.value.size,"onUpdate:pageSize":t[7]||(t[7]=a=>o.value.size=a),"page-sizes":o.value.sizes,background:o.value.background,layout:o.value.layout,total:o.value.total,disabled:u.value,onSizeChange:M,onCurrentChange:j},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])])])])}}};export{oe as default};
