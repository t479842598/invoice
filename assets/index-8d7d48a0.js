import{p as A,_ as ne}from"./_splitpanes-c98d9122.js";import{D as de}from"./_vuedraggable-a473ce37.js";import{ai as D,aF as se,aK as ie,aT as m,c as T,W as o,bD as d,bi as c,aX as u,o as y,a as b,H as k,ay as ue,aZ as re,b9 as O,U as v,F as ce,aV as pe,I as fe}from"./_@vue-5ba92de9.js";import"./__vendor-5e6ac033.js";const me={style:{height:"inherit"}},ve={class:"roadui_treenode"},_e={key:0,style:{width:"700px",padding:"0 0 0 20px"}},ye={key:1},ge={style:{"text-align":"center"}},he={class:"roadui_draggable_item"},be={class:"dialog-footer"},Me={__name:"index",setup(ke){const r=D("ajax"),n=D("utils"),C=D("qs"),B=D("ElSelectico");se(()=>{document.body.ondrop=function(l){try{l.preventDefault(),l.stopPropagation()}catch{}}}),ie(()=>{document.body.ondrop=null});const S=m(null),w=m([]),j=m([]),R={children:"children",label:"title",isLeaf:"isLeaf"},$=(l,e)=>{if(l.level===0)r.post("/Menu/GetTree?isall=0").then(i=>{j.value=i.data,n.length(i.data)>0&&w.value.push(i.data[0].id)}).catch(()=>{});else{if(n.length(l.data.children)>0)return e(l.data.children);r.post("/Menu/GetTreeChilds?parentid="+(l.data.id||"")).then(i=>e(i.data)).catch(()=>{})}},N=l=>{r.post("/Menu/GetTreeChilds?parentid="+l).then(e=>{S.value.updateKeyChildren(l,e.data)}).catch(()=>{})},q=l=>{H(l)},s=m(!1),a=m({}),L=m([]),V=m([]),U=m(null),E={title:[{required:!0,message:"请输入菜单名称",trigger:"blur"}]},K=()=>{if(n.length(L.value)>0)return;let l=[{id:"system_applibrary_type",key:"type",children:!0,valueField:"id"}];r.post("/Dictionary/GetMultipleOptions",C.stringify({json:JSON.stringify(l)})).then(e=>{L.value=e.data.type}).catch(()=>{})},z=l=>{n.length(l)>0?r.post("/Applibrary/GetOptions?typeid="+l[l.length-1]).then(e=>{V.value=e.data}).catch(()=>{}):(a.value.applibraryId="",V.value=[])},P=l=>{let e=n.getArrayObj(V.value,l,"id");n.isDef(e)&&(a.value.title=e.label)},H=l=>{r.post("/Menu/Get?menuid="+(l.id||"")).then(e=>{e.success?(a.value=e.data,a.value.applibraryId=e.data.applibraryId==0?"":e.data.applibraryId+"",K(),n.length(e.data.applibraryTypeId)>0&&z(e.data.applibraryTypeId)):n.msg(e.code==-1?"未找到菜单！":"加载数据失败！",e.success)}).catch(()=>{})},J=()=>{a.value={id:a.value.id||"",parentId:a.value.parentId}},F=async(l,e)=>{l&&await l.validate(i=>{i&&n.confirm("您确定要保存"+(e===1?"为下级":"")+"吗？",()=>{s.value=!0,n.length(a.value.applibraryId)===0&&delete a.value.applibraryId,r.post("/Menu/Save?menuid="+(a.value.id||"")+"&savetype="+(e||0),C.stringify(a.value)).then(p=>{let h=p.msg;if(n.length(h)===0&&(p.code==1?h="数据验证错误！":h=p.success?"保存成功！":"保存错误！"),n.msg(h,p.success),s.value=!1,p.success){const I=S.value.getNode(a.value.id),f=n.isDef(I)&&I.isLeaf,M=e===1&&!f?a.value.id:a.value.parentId;N(M),f&&w.value.push(a.value.id)}}).catch(()=>{s.value=!1})})})},W=()=>{if(n.length(a.value.id)===0){n.msg("请选择要删除的菜单！","error");return}n.confirm("此操作将会删除该菜单及其所有下级菜单，您确定要删除吗？",()=>{s.value=!0,r.post("/Menu/Delete",C.stringify({menuid:a.value.id})).then(l=>{let e=l.msg;if(n.length(e)===0&&(e=l.success?"删除成功！":"删除失败！"),n.msg(e,l.success),l.success){const i=a.value.parentId;N(i),a.value={}}s.value=!1}).catch(()=>{s.value=!1})})},G=()=>{s.value=!0,r.post("/Menu/UpMenuAuth").then(l=>{n.msg(l.success?"更新成功！":"更新失败！",l.success),s.value=!1}).catch(()=>{s.value=!1})},g=m(!1),x=m([]),X=()=>{r.post("/Menu/LoadChilds?menuid="+a.value.id).then(l=>{if(!l.success||n.length(l.data)<=1){n.msg(n.length(l.data)===0?"当前菜单没有下级菜单，勿需排序！":"当前菜单只有一个下级菜单，勿需排序！",!1),g.value=!1;return}x.value=l.data,g.value=!0}).catch(()=>{})},Z=()=>{s.value=!0;let l=[];for(let e=0;e<x.value.length;e++)l.push(x.value[e].id);r.post("/Menu/SaveSort?menuid="+a.value.id,C.stringify({menus:l.join(",")})).then(e=>{let i=e.msg;if(n.length(i)===0&&(i=e.success?"保存排序成功！":"保存排序失败！"),n.msg(i,e.success),e.success){g.value=!1;const p=a.value.id;N(p)}s.value=!1}).catch(()=>{s.value=!1})};return(l,e)=>{const i=u("document"),p=u("el-icon"),h=u("folder"),I=u("el-tree"),f=u("el-form-item"),M=u("el-input"),Q=u("el-cascader"),Y=u("el-option"),ee=u("el-select"),le=u("el-color-picker"),_=u("el-button"),ae=u("el-form"),te=u("el-empty"),oe=u("el-dialog");return y(),T("div",me,[o(c(ne),{class:"default-theme",style:{height:"inherit"}},{default:d(()=>[o(c(A),{size:20,"min-size":"20","max-size":"50",style:{overflow:"auto",background:"#fff"}},{default:d(()=>[o(I,{data:j.value,props:R,"node-key":"id",load:$,lazy:"",ref_key:"menuTreeRef",ref:S,"highlight-current":"","default-expanded-keys":w.value,style:{height:"inherit","padding-right":"14px"},"expand-on-click-node":!1,onNodeClick:q},{default:d(t=>[b("div",ve,[c(n).length(t.data.ico)===0&&t.node.isLeaf?(y(),k(p,{key:0,class:"roadui_main_tabico"},{default:d(()=>[o(i)]),_:1})):c(n).length(t.data.ico)===0&&!t.node.isLeaf?(y(),k(p,{key:1,class:"roadui_main_tabico"},{default:d(()=>[o(h)]),_:1})):(y(),k(re(t.data.ico),{key:2,class:"roadui_main_tabico",style:ue(c(n).length(t.data.icoColor)>0?"color:"+t.data.icoColor:"")},null,8,["style"])),b("span",null,O(t.node.label),1)])]),_:1},8,["data","default-expanded-keys"])]),_:1}),o(c(A),{size:80,style:{background:"#fff",overflow:"auto","padding-left":"5px"}},{default:d(()=>[c(n).length(a.value)>0&&a.value.id>c(n).emptyLong?(y(),T("div",_e,[o(ae,{model:a.value,ref_key:"ruleFormRef",ref:U,rules:E,"label-width":"80px"},{default:d(()=>[o(f,{label:"菜单id"},{default:d(()=>[v(O(a.value.id),1)]),_:1}),o(f,{label:"菜单名称",prop:"title"},{default:d(()=>[o(M,{modelValue:a.value.title,"onUpdate:modelValue":e[0]||(e[0]=t=>a.value.title=t),clearable:""},null,8,["modelValue"])]),_:1}),o(f,{label:"关联应用"},{default:d(()=>[o(Q,{modelValue:a.value.applibraryTypeId,"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.applibraryTypeId=t),options:L.value,props:{expandTrigger:"hover"},onChange:z,style:{width:"320px"},clearable:""},null,8,["modelValue","options"]),o(ee,{modelValue:a.value.applibraryId,"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.applibraryId=t),onChange:P,clearable:"",style:{"margin-left":"12px",width:"288px"}},{default:d(()=>[(y(!0),T(ce,null,pe(V.value,t=>(y(),k(Y,{key:t.id,label:t.label,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(f,{label:"菜单图标"},{default:d(()=>[o(c(B),{modelValue:a.value.ico,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.ico=t),clearable:""},null,8,["modelValue"])]),_:1}),o(f,{label:"App图标"},{default:d(()=>[o(M,{modelValue:a.value.appIco,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.appIco=t),placeholder:"填写uniapp中的图标名称",clearable:"",style:{width:"222px"}},null,8,["modelValue"])]),_:1}),o(f,{label:"图标颜色"},{default:d(()=>[o(le,{modelValue:a.value.icoColor,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.icoColor=t)},null,8,["modelValue"])]),_:1}),o(f,{label:""},{default:d(()=>[o(_,{type:"primary",disabled:s.value,onClick:J},{default:d(()=>[v("清空")]),_:1},8,["disabled"]),o(_,{type:"primary",disabled:s.value,onClick:e[6]||(e[6]=t=>F(U.value,0))},{default:d(()=>[v("保存")]),_:1},8,["disabled"]),o(_,{type:"primary",disabled:s.value,onClick:e[7]||(e[7]=t=>F(U.value,1))},{default:d(()=>[v("保存为下级")]),_:1},8,["disabled"]),o(_,{type:"danger",disabled:s.value,onClick:W},{default:d(()=>[v("删除")]),_:1},8,["disabled"]),o(_,{type:"info",disabled:s.value,onClick:X},{default:d(()=>[v("下级排序")]),_:1},8,["disabled"]),a.value.parentId<=c(n).emptyLong?(y(),k(_,{key:0,type:"primary",disabled:s.value,onClick:G},{default:d(()=>[v("更新菜单权限")]),_:1},8,["disabled"])):fe("",!0)]),_:1})]),_:1},8,["model"])])):(y(),T("div",ye,[o(te,{description:"请点击左边菜单进行操作"}),b("div",ge,[o(_,{type:"primary",disabled:s.value,onClick:G},{default:d(()=>[v("更新菜单权限")]),_:1},8,["disabled"])])]))]),_:1})]),_:1}),o(oe,{modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=t=>g.value=t),title:"排序","align-center":"","destroy-on-close":"",width:"550px",draggable:"","close-on-click-modal":!1},{footer:d(()=>[b("span",be,[o(_,{disabled:s.value,type:"primary",onClick:Z},{default:d(()=>[v("保存")]),_:1},8,["disabled"]),o(_,{disabled:s.value,onClick:e[8]||(e[8]=t=>g.value=!1)},{default:d(()=>[v("关闭")]),_:1},8,["disabled"])])]),default:d(()=>[o(c(de),{list:x.value,"item-key":"id",animation:200,group:{name:"menu",pull:!0},class:"roadui_draggable_chosen"},{item:d(({element:t})=>[b("div",he,[b("div",null,O(t.title),1)])]),_:1},8,["list"])]),_:1},8,["modelValue"])])}}};export{Me as default};
