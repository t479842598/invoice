import{ai as S,aT as r,aF as E,c as j,a as V,W as l,bD as a,bI as J,aX as c,aY as K,o as h,U as p,bF as Q,H as R,F as Z,aV as ee,b9 as le}from"./_@vue-5ba92de9.js";const ae={class:"roadui_page"},te={style:{height:"calc(100% - 60px)",overflow:"auto"}},oe=V("span",null,"操作",-1),ne={class:"dialog-footer"},de={__name:"index",setup(se){const v=S("ajax"),s=S("utils"),C=S("qs"),n=r(!1),f=r(!1),w=r([]),D=r({}),u=r({});let _=[];const T=r({prop:"sort",order:"ascending"}),k=r(s.getPager(T.value)),x=r([]),F=r(null),b=r(!1),U=r(""),G={name:[{required:!0,message:"请输入连接名称",trigger:"blur"}],type:[{required:!0,message:"请选择连接类型",trigger:"change"}],url:[{required:!0,message:"请输入连接字符串",trigger:"blur"}]};E(()=>{y()});const L=o=>{_=o},y=()=>{f.value=!0,n.value=!0,v.post("/DbConnection/GetList",C.stringify({findname:D.value.name})).then(o=>{w.value=o.data,n.value=!1,f.value=!1}).catch(()=>{n.value=!1})},q=o=>{x.value.length===0?v.post("/DbConnection/GetDbConnTypeOptions").then(e=>{x.value=e.data,B(o)}).catch(()=>{}):B(o)},B=o=>{if(s.isUndef(o)||s.length(o.id)===0){u.value={id:s.emptyLong,name:"",type:"",url:"",account:"",password:"",sort:s.getArrayMax(w.value,"sort")+5},U.value="添加",b.value=!0;return}s.length(o.id)>0&&v.post("/DbConnection/Get?connid="+o.id).then(e=>{e.success?(u.value=e.data,U.value="编辑 - "+e.data.name,b.value=!0):s.msg("获取数据失败！",!1)}).catch(()=>{})},M=async o=>{o&&await o.validate(e=>{if(e){n.value=!0;const g=u.value.id||"";v.post("/DbConnection/Save?connid="+g,C.stringify(u.value)).then(d=>{let i=d.msg;s.length(i)===0&&(i=d.success?"保存成功！":d.code==1?"数据验证错误！":"保存失败！"),s.msg(i,d.success),n.value=!1,d.success&&(b.value=!1,y()),n.value=!1}).catch(()=>{n.value=!1})}})},N=()=>{if(_.length===0){s.msg("请选择要删除的数据连接！","error");return}s.confirm("您确定要删除所选数据连接吗？",()=>{n.value=!0,v.post("/DbConnection/Delete",C.stringify({ids:s.getArrayValues(_,"id").join(",")})).then(o=>{s.msg(o.success?"删除成功！":"删除失败！",o.success),n.value=!1,o.success&&(_=[],y())}).catch(()=>{n.value=!1})})},z=o=>{f.value=!0,v.post("/DbConnection/TestConn?connid="+o.id).then(e=>{e.success?s.msg("连接数据库成功！",!0):s.msg(s.length(e.msg)===0?"连接数据库失败，请检查数据库服务器是否正常以及连接字符串是否正确！":e.msg,!1),f.value=!1}).catch(()=>{f.value=!1})};return(o,e)=>{const g=c("el-input"),d=c("el-form-item"),i=c("el-button"),$=c("el-form"),m=c("el-table-column"),A=c("el-table"),H=c("el-scrollbar"),I=c("el-radio"),O=c("el-radio-group"),P=c("el-input-number"),W=c("el-dialog"),X=K("loading");return h(),j("div",ae,[V("div",null,[l($,{inline:!0,onSubmit:e[2]||(e[2]=J(()=>{},["prevent"]))},{default:a(()=>[l(d,{label:"名称"},{default:a(()=>[l(g,{modelValue:D.value.name,"onUpdate:modelValue":e[0]||(e[0]=t=>D.value.name=t),placeholder:"连接名称",style:{width:"200px"},clearable:""},null,8,["modelValue"])]),_:1}),l(d,null,{default:a(()=>[l(i,{type:"primary",disabled:n.value,onClick:y},{default:a(()=>[p("查询")]),_:1},8,["disabled"]),l(i,{type:"primary",disabled:n.value,onClick:e[1]||(e[1]=t=>q(null))},{default:a(()=>[p("添加")]),_:1},8,["disabled"]),l(i,{type:"danger",disabled:n.value,onClick:N},{default:a(()=>[p("删除")]),_:1},8,["disabled"])]),_:1})]),_:1})]),V("div",te,[l(H,null,{default:a(()=>[Q((h(),R(A,{data:w.value,stripe:k.value.tableStripe,border:k.value.tableBorder,style:{width:"100%"},"highlight-current-row":k.value.tableHighlightCurrentRow,onSelectionChange:L,"default-sort":T.value},{default:a(()=>[l(m,{type:"selection",width:"45"}),l(m,{prop:"name",label:"连接名称",width:"200",sortable:""}),l(m,{prop:"type",label:"连接类型",width:"150",sortable:""}),l(m,{prop:"url",label:"连接字符串",sortable:""}),l(m,{prop:"note",label:"备注",width:"200",sortable:""}),l(m,{prop:"sort",label:"排序",width:"80",sortable:""}),l(m,{width:"140"},{header:a(()=>[oe]),default:a(t=>[l(i,{size:"small",disabled:n.value,type:"primary",onClick:Y=>q(t.row)},{default:a(()=>[p("编辑")]),_:2},1032,["disabled","onClick"]),l(i,{size:"small",disabled:n.value,type:"primary",onClick:Y=>z(t.row)},{default:a(()=>[p("测试")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[X,f.value]])]),_:1})]),l(W,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=t=>b.value=t),title:U.value,"align-center":"","destroy-on-close":"",width:"700px",draggable:"","close-on-click-modal":!1},{footer:a(()=>[V("span",ne,[l(i,{disabled:n.value,type:"primary",onClick:e[8]||(e[8]=t=>M(F.value))},{default:a(()=>[p("保存")]),_:1},8,["disabled"]),l(i,{disabled:n.value,onClick:e[9]||(e[9]=t=>b.value=!1)},{default:a(()=>[p("关闭")]),_:1},8,["disabled"])])]),default:a(()=>[l($,{model:u.value,ref_key:"ruleFormRef",ref:F,rules:G,"label-width":"100px"},{default:a(()=>[l(d,{label:"连接名称",prop:"name"},{default:a(()=>[l(g,{modelValue:u.value.name,"onUpdate:modelValue":e[3]||(e[3]=t=>u.value.name=t),clearable:""},null,8,["modelValue"])]),_:1}),l(d,{label:"连接类型",prop:"type"},{default:a(()=>[l(O,{modelValue:u.value.type,"onUpdate:modelValue":e[4]||(e[4]=t=>u.value.type=t)},{default:a(()=>[(h(!0),j(Z,null,ee(x.value,t=>(h(),R(I,{key:t.value,label:t.value},{default:a(()=>[p(le(t.title),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"连接字符串",prop:"url"},{default:a(()=>[l(g,{modelValue:u.value.url,"onUpdate:modelValue":e[5]||(e[5]=t=>u.value.url=t),rows:5,type:"textarea",clearable:""},null,8,["modelValue"])]),_:1}),l(d,{label:"备注",prop:"note"},{default:a(()=>[l(g,{modelValue:u.value.note,"onUpdate:modelValue":e[6]||(e[6]=t=>u.value.note=t)},null,8,["modelValue"])]),_:1}),l(d,{label:"排序",prop:"sort"},{default:a(()=>[l(P,{modelValue:u.value.sort,"onUpdate:modelValue":e[7]||(e[7]=t=>u.value.sort=t),step:5,min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{de as default};
