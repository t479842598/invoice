import{ai as x,aT as d,aF as Fe,c as F,a as z,W as a,bD as t,bF as L,H as b,aX as p,aY as ze,o as v,bi as _,U as i,b9 as C,I as P,F as ae,aV as te}from"./_@vue-5ba92de9.js";const Ue={class:"roadui_page"},$e=["onClick"],Me={class:"roadui_pagerdiv"},Ne={key:2},Re={key:0},Ge={key:1},qe={style:{"max-height":"500px",overflow:"auto"}},Oe={__name:"index",props:{query:{type:String,default:()=>""}},setup(oe){const h=x("ajax"),u=x("utils"),k=x("qs"),A=x("ElSelectorg"),ue=x("ElSelectflow"),se=oe,ne=x("index_openmenu"),q=d(!1),r=d(!1),g=d({status:u.query("status",se.query)||"0"}),D=d([]),J=d([]),W=d({prop:"receivetime",order:"descending"}),s=d(u.getPager(W.value)),H=d(!1),Y=d(!1),X=d([]);Fe(()=>{T(!1)});const de=o=>{s.value.size=o,T(!1)},ie=o=>{s.value.number=o,T(!1)},re=o=>{s.value.order=u.getOrder(o),T(!1)},T=o=>{o&&(s.value.number=1),q.value=!0,r.value=!0,g.value.size=s.value.size,g.value.number=s.value.number,g.value.order=s.value.order,g.value.date1=u.length(D.value)>0?D.value[0]:"",g.value.date2=u.length(D.value)>1?D.value[1]:"",h.post("/Flow/GetInstanceManageList",k.stringify(g.value)).then(l=>{J.value=l.data.rows,s.value.total=l.data.total,r.value=!1,q.value=!1}).catch(()=>{r.value=!1,q.value=!1})},ve=o=>{u.confirm("您确定要作废该流程实例吗？",()=>{r.value=!0,h.post("/Flow/InstanceManageDelete",k.stringify({groupid:o.id})).then(l=>{l.success?(u.msg("作废成功！",!0),T(!1)):u.msg("作废流程实例发生了错误！",!1),r.value=!1}).catch(()=>{r.value=!1})})},pe=o=>{H.value=!0,U(o.id)},fe=o=>{const l={title:o.title,id:"task_"+o.taskId,url:"/flow/run/index?flowid="+o.flowId+"&stepid="+o.stepId+"&taskid="+o.taskId+"&groupid="+o.id+"&instanceid="+o.instanceId+"&display=1",ico:"Edit",openMode:0};ne(l)},U=o=>{Y.value=!0,h.post("/Flow/GetInstanceManageTasks",k.stringify({groupid:o})).then(l=>{X.value=l.data,Y.value=!1}).catch(()=>{})},$=d(!1),y=d({}),K=d(null),ge=[{value:0,title:"待处理"},{value:1,title:"处理中"},{value:2,title:"已完成"},{value:3,title:"他人已处理"},{value:4,title:"已退回"},{value:5,title:"他人已退回"},{value:6,title:"已转交"},{value:7,title:"已委托"},{value:8,title:"已阅知"},{value:9,title:"已指派"},{value:10,title:"已跳转"},{value:11,title:"已终止"},{value:12,title:"他人已终止"},{value:13,title:"已暂缓"},{value:14,title:"他人已暂缓"},{value:15,title:"已加签"},{value:16,title:"自动完成"},{value:17,title:"已回复"}],me={status:[{required:!0,message:"请选择状态",trigger:"blur"}]},ce=o=>{y.value.taskId=o.id,y.value.groupId=o.groupId,y.value.status=o.handleType,$.value=!0},be=async o=>{o&&await o.validate(l=>{l&&h.post("/Flow/InstanceManageSaveStatus",k.stringify({taskId:y.value.taskId,status:y.value.status})).then(c=>{c.success?(u.msg("任务状态修改成功！",!0),$.value=!1,c.data=="2"||c.data=="4"?(H.value=!1,T(!1)):U(y.value.groupId)):u.msg("修改流程任务状态发生了错误！",!1)}).catch(()=>{})})},M=d(!1),w=d({}),Q=d(null),_e={receiver:[{required:!0,message:"请选择接收人",trigger:"blur"}]},ye=o=>{w.value.taskId=o.id,w.value.groupId=o.groupId,w.value.receiver="",M.value=!0},we=async o=>{o&&await o.validate(l=>{l&&h.post("/Flow/InstanceManageSaveDesignate",k.stringify({taskId:w.value.taskId,receiver:w.value.receiver})).then(c=>{c.success?(u.msg("指派成功！",!0),M.value=!1,U(w.value.groupId)):u.msg("指派失败！",!1)}).catch(()=>{})})},N=d(!1),R=d({}),Z=d(null),S=d([]),j=d(!1),he={},ke=o=>{R.value.taskId=o.id,R.value.groupId=o.groupId,j.value=!0,N.value=!0,r.value=!0,h.post("/Flow/InstanceManageGetGotoSteps",k.stringify({taskId:o.id})).then(l=>{l.success&&(S.value=l.data,j.value=!1,r.value=!1)}).catch(()=>{})},Te=async o=>{o&&await o.validate(l=>{if(l){let c=[];for(let n=0;n<S.value.length;n++)u.length(S.value[n].members)>0&&c.push({id:S.value[n].id,members:S.value[n].members});if(c.length===0){u.msg("您没有选择要跳转的步骤！",!1);return}h.post("/Flow/InstanceManageSaveGoto",k.stringify({taskId:R.value.taskId,steps:JSON.stringify(c)})).then(n=>{if(n.success)u.msg("跳转成功！",!0),N.value=!1,U(R.value.groupId);else{let I=n.msg;u.length(I)===0&&(n.code==1?I="参数错误！":n.code==2?I="当前任务为空！":I="跳转失败！"),u.msg(I,!1)}}).catch(()=>{})}})},Ve=o=>{u.confirm("您确定要删除该任务吗？",()=>{h.post("/Flow/InstanceManageDeleteTask",k.stringify({taskId:o.id,otherType:o.otherType})).then(l=>{l.success?(u.msg("删除成功！",!0),U(o.groupId)):u.msg("删除流程任务发生了错误！",!1)}).catch(()=>{})})};return(o,l)=>{const c=p("el-input"),n=p("el-form-item"),I=p("el-date-picker"),ee=p("el-radio-button"),Ce=p("el-radio-group"),m=p("el-button"),O=p("el-form"),f=p("el-table-column"),G=p("el-tag"),Ie=p("el-space"),le=p("el-table"),De=p("el-pagination"),B=p("el-dialog"),Se=p("el-option"),xe=p("el-select"),E=ze("loading");return v(),F("div",Ue,[z("div",null,[a(O,{inline:!0},{default:t(()=>[a(n,{label:"标题"},{default:t(()=>[a(c,{modelValue:g.value.title,"onUpdate:modelValue":l[0]||(l[0]=e=>g.value.title=e),style:{width:"130px"},clearable:""},null,8,["modelValue"])]),_:1}),a(n,{label:"流程"},{default:t(()=>[a(_(ue),{modelValue:g.value.flowId,"onUpdate:modelValue":l[1]||(l[1]=e=>g.value.flowId=e),"auth-type":2,style:{width:"160px"}},null,8,["modelValue"])]),_:1}),a(n,{label:"接收时间"},{default:t(()=>[a(I,{modelValue:D.value,"onUpdate:modelValue":l[2]||(l[2]=e=>D.value=e),style:{width:"210px"},type:"daterange","value-format":"YYYY-MM-DD","unlink-panels":"","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:_(u).dateShortucts},null,8,["modelValue","shortcuts"])]),_:1}),a(n,{label:"流程状态"},{default:t(()=>[a(Ce,{modelValue:g.value.status,"onUpdate:modelValue":l[3]||(l[3]=e=>g.value.status=e),onChange:l[4]||(l[4]=e=>T(!0))},{default:t(()=>[a(ee,{label:"0"},{default:t(()=>[i("进行中")]),_:1}),a(ee,{label:"1"},{default:t(()=>[i("已结束")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(n,null,{default:t(()=>[a(m,{type:"primary",disabled:r.value,onClick:l[5]||(l[5]=e=>T(!0))},{default:t(()=>[i("查询")]),_:1},8,["disabled"])]),_:1})]),_:1})]),z("div",null,[L((v(),b(le,{data:J.value,stripe:s.value.tableStripe,border:s.value.tableBorder,style:{width:"100%"},"highlight-current-row":s.value.tableHighlightCurrentRow,"default-sort":W.value,onSortChange:re},{default:t(()=>[a(f,{prop:"title",label:"标题"},{default:t(e=>[z("a",{class:"roaduia",href:"javascript:;",onClick:V=>fe(e.row)},C(e.row.title),9,$e)]),_:1}),a(f,{prop:"flowName",label:"流程",width:"160"}),a(f,{prop:"receiverName",label:"接收人",width:"100"}),a(f,{prop:"receiveTime",label:"接收时间",width:"150",sortable:"custom"}),a(f,{prop:"stepName",label:"当前",width:"150"},{default:t(e=>[g.value.status==0?(v(),b(G,{key:0},{default:t(()=>[i(C(e.row.stepName),1)]),_:2},1024)):(v(),b(G,{key:1},{default:t(()=>[i(C(_(u).getTaskHadleTitle(e.row.handleType)),1)]),_:2},1024))]),_:1}),a(f,{width:"138"},{default:t(e=>[a(Ie,null,{default:t(()=>[a(m,{type:"primary",size:"small",disabled:r.value,onClick:V=>pe(e.row)},{default:t(()=>[i("管理")]),_:2},1032,["disabled","onClick"]),a(m,{type:"danger",disabled:r.value,onClick:V=>ve(e.row),size:"small"},{default:t(()=>[i("作废")]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[E,q.value]]),z("div",Me,[a(De,{currentPage:s.value.number,"onUpdate:currentPage":l[6]||(l[6]=e=>s.value.number=e),"page-size":s.value.size,"onUpdate:pageSize":l[7]||(l[7]=e=>s.value.size=e),"page-sizes":s.value.sizes,background:s.value.background,layout:s.value.layout,total:s.value.total,disabled:r.value,onSizeChange:de,onCurrentChange:ie},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])])]),a(B,{modelValue:H.value,"onUpdate:modelValue":l[8]||(l[8]=e=>H.value=e),title:"实例管理",class:"el-dialog__padding","align-center":"","destroy-on-close":"",width:"1180px",draggable:"","close-on-click-modal":!1},{default:t(()=>[L((v(),b(le,{data:X.value,stripe:s.value.tableStripe,border:s.value.tableBorder,style:{width:"100%"},"highlight-current-row":s.value.tableHighlightCurrentRow},{default:t(()=>[a(f,{prop:"stepName",label:"步骤"}),a(f,{prop:"senderName",label:"发送人"}),a(f,{prop:"receiverName",label:"接收人"}),a(f,{prop:"receiveTime",label:"接收时间",width:"150"}),a(f,{prop:"completedTime",label:"完成时间",width:"150"}),a(f,{prop:"handleType",label:"状态",width:"100"},{default:t(e=>[e.row.handleType==0?(v(),b(G,{key:0,type:"info",effect:"dark"},{default:t(()=>[i(C(_(u).getTaskHadleTitle(e.row.handleType)),1)]),_:2},1024)):e.row.handleType==1?(v(),b(G,{key:1,color:"#E6A23C",effect:"dark",style:{"border-width":"0"}},{default:t(()=>[i(C(_(u).getTaskHadleTitle(e.row.handleType)),1)]),_:2},1024)):(v(),F("span",Ne,C(_(u).getTaskHadleTitle(e.row.handleType)),1))]),_:1}),a(f,{prop:"note",label:"备注"},{default:t(e=>[_(u).length(e.row.note)>0?(v(),F("span",Re,C(o.note),1)):(v(),F("span",Ge,[e.row.taskType>0?(v(),b(G,{key:0,color:_(u).getTaskTypeColor(e.row.taskType),effect:"dark",style:{"border-width":"0"}},{default:t(()=>[i(C(_(u).getTaskTypeTitle(e.row.taskType)),1)]),_:2},1032,["color"])):P("",!0)]))]),_:1}),a(f,{width:"265"},{default:t(e=>[a(m,{onClick:V=>ce(e.row),size:"small",type:"primary"},{default:t(()=>[i("状态")]),_:2},1032,["onClick"]),a(m,{onClick:V=>Ve(e.row),size:"small",type:"danger"},{default:t(()=>[i("删除")]),_:2},1032,["onClick"]),e.row.handleType==0||e.row.handleType==1?(v(),b(m,{key:0,onClick:V=>ye(e.row),size:"small",type:"warning"},{default:t(()=>[i("指派")]),_:2},1032,["onClick"])):P("",!0),e.row.handleType==0||e.row.handleType==1?(v(),b(m,{key:1,onClick:V=>ke(e.row),size:"small",type:"info"},{default:t(()=>[i("跳转")]),_:2},1032,["onClick"])):P("",!0)]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row"])),[[E,Y.value]])]),_:1},8,["modelValue"]),a(B,{modelValue:$.value,"onUpdate:modelValue":l[12]||(l[12]=e=>$.value=e),title:"修改状态","align-center":"","destroy-on-close":"",width:"500px",draggable:"","close-on-click-modal":!1},{default:t(()=>[a(O,{model:y.value,ref_key:"ruleStatusFormRef",ref:K,rules:me,"label-width":"70px"},{default:t(()=>[a(n,{label:"状态",prop:"status"},{default:t(()=>[a(xe,{style:{width:"100%"},modelValue:y.value.status,"onUpdate:modelValue":l[9]||(l[9]=e=>y.value.status=e)},{default:t(()=>[(v(),F(ae,null,te(ge,e=>a(Se,{key:e.value,value:e.value,label:e.title},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:1}),a(n,null,{default:t(()=>[a(m,{type:"primary",disabled:r.value,onClick:l[10]||(l[10]=e=>be(K.value))},{default:t(()=>[i("确定")]),_:1},8,["disabled"]),a(m,{disabled:r.value,onClick:l[11]||(l[11]=e=>$.value=!1)},{default:t(()=>[i("取消")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(B,{modelValue:M.value,"onUpdate:modelValue":l[16]||(l[16]=e=>M.value=e),title:"指派","align-center":"","destroy-on-close":"",width:"500px",draggable:"","close-on-click-modal":!1},{default:t(()=>[a(O,{model:w.value,ref_key:"ruleDesignateFormRef",ref:Q,rules:_e,"label-width":"70px"},{default:t(()=>[a(n,{label:"指派给",prop:"receiver"},{default:t(()=>[a(_(A),{style:{width:"100%"},modelValue:w.value.receiver,"onUpdate:modelValue":l[13]||(l[13]=e=>w.value.receiver=e),placeholder:"选择接收人"},null,8,["modelValue"])]),_:1}),a(n,null,{default:t(()=>[a(m,{type:"primary",disabled:r.value,onClick:l[14]||(l[14]=e=>we(Q.value))},{default:t(()=>[i("确定")]),_:1},8,["disabled"]),a(m,{disabled:r.value,onClick:l[15]||(l[15]=e=>M.value=!1)},{default:t(()=>[i("取消")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(B,{modelValue:N.value,"onUpdate:modelValue":l[19]||(l[19]=e=>N.value=e),title:"跳转","align-center":"","destroy-on-close":"",width:"500px",draggable:"","close-on-click-modal":!1},{footer:t(()=>[z("span",null,[a(m,{type:"primary",disabled:r.value,onClick:l[17]||(l[17]=e=>Te(Z.value))},{default:t(()=>[i("确定")]),_:1},8,["disabled"]),a(m,{disabled:r.value,onClick:l[18]||(l[18]=e=>N.value=!1)},{default:t(()=>[i("取消")]),_:1},8,["disabled"])])]),default:t(()=>[z("div",qe,[L((v(),b(O,{model:R.value,"label-position":"top",ref_key:"ruleGotoFormRef",ref:Z,rules:he,"label-width":"70px"},{default:t(()=>[(v(!0),F(ae,null,te(S.value,e=>(v(),b(n,{key:e.id,label:e.name},{default:t(()=>[a(_(A),{style:{width:"98%"},modelValue:e.members,"onUpdate:modelValue":V=>e.members=V,placeholder:"选择接收人"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),128))]),_:1},8,["model"])),[[E,j.value]])])]),_:1},8,["modelValue"])])}}};export{Oe as default};
