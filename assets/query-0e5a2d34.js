import{ai as k,aT as p,aF as be,c as g,bF as H,H as f,bD as u,a as c,W as t,aX as v,aY as ge,o as r,U as n,b9 as z,F as y,aV as V,I as U,bi as J,bv as fe}from"./_@vue-5ba92de9.js";const ce=c("span",null,"操作",-1),ye={style:{margin:"15px auto 0 auto","text-align":"center"}},Ve={style:{"margin-left":"12px"}},_e={style:{"margin-left":"12px"}},he={key:0,style:{"margin-left":"12px"}},we={style:{"margin-left":"12px"}},xe={style:{"margin-left":"12px"}},Te={style:{"margin-left":"12px"}},ke={style:{"margin-left":"12px"}},Se={style:{"margin-left":"12px"}},De={__name:"query",props:{query:{type:String,default:()=>""}},setup(W){const _=k("ajax"),s=k("utils"),A=k("qs"),I=k("program_attr_fields"),X=k("ElSelectdict"),Y=k("ElSelectorg"),K=W,Q=s.query("programid",K.query),F=p([]),d=p(!1),C=p(!1);let D=[];const M=p({prop:"sort",order:"ascending"}),S=p(s.getPager(M.value)),N=p(I.value),j=p([]),L=p([]),Z=[{value:"0",label:"字符串表达式"},{value:"1",label:"数据字典"},{value:"2",label:"SQL"},{value:"3",label:"URL"}],ee=[{value:"",label:"全部"},{value:"unit",label:"单位"},{value:"dept",label:"部门"},{value:"station",label:"岗位"},{value:"user",label:"人员"},{value:"workgroup",label:"工作组"}],P=[{value:"id",label:"id"},{value:"title",label:"标题"},{value:"code",label:"唯一代码"},{value:"value",label:"值"},{value:"note",label:"备注"},{value:"other",label:"其他"}],R=p([]);be(()=>{s.getConns().then(o=>{R.value=o,te()})});const le=o=>{D=o},ae=o=>{S.value.order=s.getOrder(o),O(!1)},te=()=>{const o=[{id:"programdesigner_inputtype",key:"inputType",children:!1,valueField:"value"},{id:"programdesigner_operators",key:"operators",children:!1,valueField:"value"}];_.post("/Dictionary/GetMultipleOptions",A.stringify({json:JSON.stringify(o)})).then(a=>{j.value=a.data.inputType,L.value=a.data.operators,O(!1)}).catch(()=>{})},O=o=>{o&&(S.value.number=1),C.value=!0,d.value=!0,_.post("/Program/GetQueryList?programid="+Q).then(a=>{F.value=a.data,d.value=!1,C.value=!1}).catch(()=>{d.value=!1,C.value=!1})},l=p({}),h=p(!1),q=p(""),B=p(null),ue={},$=o=>{N.value.length===0?_.post("/Program/GetFieldOptions?programid="+Q).then(a=>{N.value=a.data,I.value=a.data,E(o)}).catch(()=>{}):E(o)},E=o=>{s.isDef(o)?_.post("/Program/GetQuery?queryid="+o.id).then(a=>{l.value=a.data,l.value.inputType=l.value.inputType+"",l.value.datasource=l.value.datasource+"",l.value.isQueryUsers=l.value.isQueryUsers==1,l.value.connId==0&&(l.value.connId=""),l.value.orgMultiple<=0&&delete l.value.orgMultiple,l.value.orgAttribute1=s.length(l.value.orgAttribute)>0?l.value.orgAttribute.split(","):[],q.value="编辑 - "+a.data.field,h.value=!0}).catch(()=>{}):(l.value={programId:Q,inputType:"0",operators:"=",orgAttribute1:[],sort:s.getArrayMax(F.value,"sort")+5},q.value="添加",h.value=!0)},oe=async o=>{o&&await o.validate(a=>{a&&(d.value=!0,l.value.orgAttribute=l.value.orgAttribute1.join(","),_.post("/Program/SaveQuery",A.stringify(l.value)).then(i=>{let b=i.msg;s.length(b)===0&&(b=i.success?"保存成功！":"保存失败！"),s.msg(b,i.success),d.value=!1,i.success&&(O(!1),h.value=!1,l.value={})}).catch(()=>{d.value=!1}))})},re=()=>{if(D.length===0){s.msg("您没有选择要删除的查询！",!1);return}s.confirm("您确定要删除所选查询吗？",()=>{d.value=!0,_.post("/Program/DeleteQuery",A.stringify({ids:s.getArrayValues(D,"id").join(",")})).then(o=>{d.value=!1,s.msg(o.success?"删除成功！":"删除失败！",o.success),D=[],O(!1)}).catch(()=>{})})};return(o,a)=>{const i=v("el-table-column"),b=v("el-button"),ne=v("el-table"),w=v("el-option"),x=v("el-select"),m=v("el-form-item"),T=v("el-input"),se=v("el-radio"),de=v("el-radio-group"),G=v("el-input-number"),ie=v("el-checkbox"),pe=v("el-form"),ve=v("el-dialog"),me=ge("loading");return r(),g("div",null,[H((r(),f(ne,{data:F.value,stripe:S.value.tableStripe,border:S.value.tableBorder,style:{width:"100%"},"highlight-current-row":S.value.tableHighlightCurrentRow,"default-sort":M.value,onSortChange:ae,onSelectionChange:le},{default:u(()=>[t(i,{type:"selection",width:"45"}),t(i,{prop:"field",label:"字段名称"}),t(i,{prop:"showTitle",label:"显示名称"}),t(i,{prop:"operators",label:"操作符",width:"100"}),t(i,{prop:"controlName",label:"控件名称",width:"200","show-overflow-tooltip":""}),t(i,{prop:"inputType",label:"输入类型",width:"100"},{default:u(e=>[n(z(e.row.inputTypeTitle),1)]),_:1}),t(i,{prop:"sort",label:"排序",width:"80"}),t(i,{width:"80"},{header:u(()=>[ce]),default:u(e=>[t(b,{size:"small",disabled:d.value,type:"primary",onClick:Ue=>$(e.row)},{default:u(()=>[n("编辑")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[me,C.value]]),c("div",ye,[t(b,{disabled:d.value,type:"primary",onClick:a[0]||(a[0]=e=>$(null))},{default:u(()=>[n("添加")]),_:1},8,["disabled"]),t(b,{disabled:d.value,type:"danger",onClick:a[1]||(a[1]=e=>re())},{default:u(()=>[n("删除所选")]),_:1},8,["disabled"])]),t(ve,{modelValue:h.value,"onUpdate:modelValue":a[22]||(a[22]=e=>h.value=e),title:q.value,"align-center":"","destroy-on-close":"",width:"750px",draggable:"","close-on-click-modal":!1},{default:u(()=>[t(pe,{model:l.value,ref_key:"ruleFormRef",ref:B,rules:ue,"label-width":"80px"},{default:u(()=>[t(m,{label:"字段",prop:"field"},{default:u(()=>[t(x,{modelValue:l.value.field,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value.field=e),clearable:"",filterable:"",style:{width:"100%"}},{default:u(()=>[(r(!0),g(y,null,V(N.value,e=>(r(),f(w,{key:e.value,label:e.title,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"显示名称",prop:"showTitle"},{default:u(()=>[t(T,{modelValue:l.value.showTitle,"onUpdate:modelValue":a[3]||(a[3]=e=>l.value.showTitle=e),clearable:""},null,8,["modelValue"])]),_:1}),t(m,{label:"默认值",prop:"defaultValue"},{default:u(()=>[t(T,{modelValue:l.value.defaultValue,"onUpdate:modelValue":a[4]||(a[4]=e=>l.value.defaultValue=e),clearable:""},null,8,["modelValue"])]),_:1}),t(m,{label:"操作符",prop:"operators"},{default:u(()=>[t(x,{modelValue:l.value.operators,"onUpdate:modelValue":a[5]||(a[5]=e=>l.value.operators=e),style:{width:"200px"},clearable:""},{default:u(()=>[(r(!0),g(y,null,V(L.value,e=>(r(),f(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),c("span",Ve,[n(" 控件名称"),t(T,{modelValue:l.value.controlName,"onUpdate:modelValue":a[6]||(a[6]=e=>l.value.controlName=e),style:{width:"350px","margin-left":"12px"},clearable:"",placeholder:"不填则随机生成"},null,8,["modelValue"])])]),_:1}),t(m,{label:"输入类型",prop:"inputType"},{default:u(()=>[t(x,{modelValue:l.value.inputType,"onUpdate:modelValue":a[7]||(a[7]=e=>l.value.inputType=e),style:{width:"200px"},clearable:""},{default:u(()=>[(r(!0),g(y,null,V(j.value,e=>(r(),f(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),c("span",_e,[n(" 背景文字"),t(T,{modelValue:l.value.placeholder,"onUpdate:modelValue":a[8]||(a[8]=e=>l.value.placeholder=e),style:{width:"350px","margin-left":"12px"},clearable:""},null,8,["modelValue"])])]),_:1}),l.value.inputType=="5"||l.value.inputType=="7"?(r(),f(m,{key:0,label:"数据来源",prop:"dataSource"},{default:u(()=>[t(de,{modelValue:l.value.datasource,"onUpdate:modelValue":a[9]||(a[9]=e=>l.value.datasource=e),clearable:""},{default:u(()=>[(r(),g(y,null,V(Z,e=>t(se,{key:e.value,label:e.value},{default:u(()=>[n(z(e.label),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"]),l.value.datasource=="2"?(r(),g("span",he,[n(" 数据连接 "),t(x,{modelValue:l.value.connId,"onUpdate:modelValue":a[10]||(a[10]=e=>l.value.connId=e),clearable:"",style:{width:"162px","margin-left":"12px"}},{default:u(()=>[(r(!0),g(y,null,V(R.value,e=>(r(),f(w,{key:e.id,value:e.id,label:e.title},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])):U("",!0)]),_:1})):U("",!0),(l.value.inputType=="5"||l.value.inputType=="7")&&(l.value.datasource=="0"||l.value.datasource=="2"||l.value.datasource=="3")?(r(),f(m,{key:1,label:"来源",prop:"datasourceString"},{default:u(()=>[t(T,{type:"textarea",modelValue:l.value.datasourceString,"onUpdate:modelValue":a[11]||(a[11]=e=>l.value.datasourceString=e),placeholder:"字符串表达式/SQL语句/URL地址",clearable:""},null,8,["modelValue"])]),_:1})):U("",!0),(l.value.inputType=="5"||l.value.inputType=="7")&&l.value.datasource=="1"?(r(),f(m,{key:2,label:"数据字典",prop:"datasourceString"},{default:u(()=>[t(J(X),{modelValue:l.value.datasourceString,"onUpdate:modelValue":a[12]||(a[12]=e=>l.value.datasourceString=e),style:{width:"250px"},clearable:""},null,8,["modelValue"]),c("span",we,[n(" 值字段 "),t(x,{modelValue:l.value.dictValue,"onUpdate:modelValue":a[13]||(a[13]=e=>l.value.dictValue=e),options:P,style:{width:"120px","margin-left":"12px"},clearable:""},{default:u(()=>[(r(),g(y,null,V(P,e=>t(w,{key:e.value,value:e.value,label:e.label},null,8,["value","label"])),64))]),_:1},8,["modelValue"])])]),_:1})):U("",!0),l.value.inputType=="6"?(r(),f(m,{key:3,label:"选择范围",prop:"orgrange"},{default:u(()=>[t(J(Y),{modelValue:l.value.orgrange,"onUpdate:modelValue":a[14]||(a[14]=e=>l.value.orgrange=e),style:{width:"200px"},clearable:""},null,8,["modelValue"]),c("span",xe,[n(" 选择类型 "),t(x,{multiple:"",modelValue:l.value.orgAttribute1,"onUpdate:modelValue":a[15]||(a[15]=e=>l.value.orgAttribute1=e),style:{width:"186px","margin-left":"12px"},clearable:""},{default:u(()=>[(r(),g(y,null,V(ee,e=>t(w,{key:e.value,value:e.value,label:e.label},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),c("span",Te,[n(" 选择个数"),t(G,{style:{width:"79px","margin-left":"12px"},modelValue:l.value.orgMultiple,"onUpdate:modelValue":a[16]||(a[16]=e=>l.value.orgMultiple=e),"controls-position":"right"},null,8,["modelValue"])])]),_:1})):U("",!0),t(m,{label:"显示样式",prop:"showStyle"},{default:u(()=>[t(T,{modelValue:l.value.showStyle,"onUpdate:modelValue":a[17]||(a[17]=e=>l.value.showStyle=e),clearable:"",style:{width:"300px"},placeholder:"控件样式，例：width:200px;"},null,8,["modelValue"]),c("span",ke,[n(" 显示顺序"),t(G,{step:5,modelValue:l.value.sort,"onUpdate:modelValue":a[18]||(a[18]=e=>l.value.sort=e),style:{width:"110px","margin-left":"12px"},"controls-position":"right"},null,8,["modelValue"])]),H(c("span",Se,[t(ie,{modelValue:l.value.isQueryUsers,"onUpdate:modelValue":a[19]||(a[19]=e=>l.value.isQueryUsers=e)},{default:u(()=>[n("查询时转数字id")]),_:1},8,["modelValue"])],512),[[fe,l.value.inputType==6]])]),_:1}),t(m,null,{default:u(()=>[t(b,{disabled:d.value,onClick:a[20]||(a[20]=e=>oe(B.value)),type:"primary"},{default:u(()=>[n("保存")]),_:1},8,["disabled"]),t(b,{disabled:d.value,onClick:a[21]||(a[21]=e=>h.value=!1)},{default:u(()=>[n("关闭")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{De as default};
