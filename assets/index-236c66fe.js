import{ai as C,aT as d,aF as E,A as J,c as q,a as V,W as l,bD as a,bI as K,aX as i,aY as Q,o as y,U as b,bF as Z,H as B,b9 as M,F as ee,aV as le}from"./_@vue-5ba92de9.js";const ae={class:"roadui_page"},te={style:{height:"calc(100% - 60px)",overflow:"auto"}},ue=V("span",null,"操作",-1),oe={class:"dialog-footer"},ie={__name:"index",setup(re){const f=C("ajax"),s=C("utils"),h=C("qs"),u=d(!1),w=d(!1),S=d({}),x=d([]);let _=[];const D=d({prop:"title",order:"ascending"}),k=d(s.getPager(D.value)),N=d([{value:0,label:"不重置"},{value:1,label:"年流水"},{value:2,label:"月流水"},{value:3,label:"日流水"}]);E(()=>{g()});const O=J(()=>o=>{const e=s.getArrayObj(N.value,o,"value");return e===null?"":e.label}),R=o=>{_=o},g=()=>{w.value=!0,u.value=!0,f.post("/SerialNumber/GetList",h.stringify(S.value)).then(o=>{x.value=o.data,u.value=!1,w.value=!1}).catch(()=>{u.value=!1})},c=d(!1),T=d(""),U=d(null),r=d({}),$={title:[{required:!0,message:"请输入标题",trigger:"blur"}],numberSize:[{required:!0,message:"请输入位数",trigger:"blur"}],numberType:[{required:!0,message:"请选择类型",trigger:"blur"}]},A=()=>{if(_.length===0){s.msg("请选择要删除的流水号！","error");return}s.confirm("您确定要删除所选流水号吗？",()=>{u.value=!0,f.post("/SerialNumber/Delete",h.stringify({ids:s.getArrayValues(_,"id").join(",")})).then(o=>{s.msg(o.success?"删除成功！":"删除失败！",o.success),u.value=!1,o.success&&(_=[],g())}).catch(()=>{u.value=!1})})},z=o=>{if(s.isUndef(o)||s.length(o.id)===0){r.value={numberSize:5},T.value="添加",c.value=!0;return}s.length(o.id)>0&&(u.value=!0,f.post("/SerialNumber/Get?numberid="+o.id).then(e=>{if(e.code==1){s.msg("加载数据错误！",!1);return}r.value=e.data,T.value="编辑 - "+e.data.title,c.value=!0,u.value=!1}).catch(()=>{u.value=!1}))},G=async o=>{o&&await o.validate(e=>{if(e){u.value=!0;const v=r.value.id||"";f.post("/SerialNumber/Save?numberid="+v,h.stringify(r.value)).then(n=>{let m=n.msg;s.length(m)===0&&(m=n.success?"保存成功！":n.code==1?"数据验证错误！":"保存失败！"),s.msg(m,n.success),u.value=!1,n.success&&(c.value=!1,g())}).catch(()=>{u.value=!1})}})};return(o,e)=>{const v=i("el-input"),n=i("el-form-item"),m=i("el-button"),F=i("el-form"),p=i("el-table-column"),H=i("el-tag"),I=i("el-table"),L=i("el-scrollbar"),P=i("el-radio"),W=i("el-radio-group"),j=i("el-input-number"),X=i("el-dialog"),Y=Q("loading");return y(),q("div",ae,[V("div",null,[l(F,{inline:!0,onSubmit:e[2]||(e[2]=K(()=>{},["prevent"]))},{default:a(()=>[l(n,{label:"标题"},{default:a(()=>[l(v,{modelValue:S.value.title,"onUpdate:modelValue":e[0]||(e[0]=t=>S.value.title=t),style:{width:"200px"},clearable:""},null,8,["modelValue"])]),_:1}),l(n,null,{default:a(()=>[l(m,{type:"primary",disabled:u.value,onClick:g},{default:a(()=>[b("查询")]),_:1},8,["disabled"]),l(m,{type:"primary",disabled:u.value,onClick:e[1]||(e[1]=t=>z(null))},{default:a(()=>[b("添加")]),_:1},8,["disabled"]),l(m,{type:"danger",disabled:u.value,onClick:A},{default:a(()=>[b("删除")]),_:1},8,["disabled"])]),_:1})]),_:1})]),V("div",te,[l(L,null,{default:a(()=>[Z((y(),B(I,{data:x.value,stripe:k.value.tableStripe,border:k.value.tableBorder,style:{width:"100%"},"highlight-current-row":k.value.tableHighlightCurrentRow,onSelectionChange:R,"default-sort":D.value},{default:a(()=>[l(p,{type:"selection",width:"45"}),l(p,{prop:"title",label:"标题",width:"300",sortable:""}),l(p,{prop:"format",label:"格式",sortable:""}),l(p,{prop:"numberSize",label:"位数",width:"130",sortable:""}),l(p,{prop:"currentNumber",label:"当前值",width:"130",sortable:""}),l(p,{prop:"numberType",label:"类型",width:"205",sortable:""},{default:a(t=>[l(H,null,{default:a(()=>[b(M(O.value(t.row.numberType)),1)]),_:2},1024)]),_:1}),l(p,{width:"80"},{header:a(()=>[ue]),default:a(t=>[l(m,{size:"small",disabled:u.value,type:"primary",onClick:ne=>z(t.row)},{default:a(()=>[b("编辑")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[Y,w.value]])]),_:1})]),l(X,{modelValue:c.value,"onUpdate:modelValue":e[10]||(e[10]=t=>c.value=t),title:T.value,"align-center":"","destroy-on-close":"",width:"620px",draggable:"","close-on-click-modal":!1},{footer:a(()=>[V("span",oe,[l(m,{disabled:u.value,type:"primary",onClick:e[8]||(e[8]=t=>G(U.value))},{default:a(()=>[b("保存")]),_:1},8,["disabled"]),l(m,{disabled:u.value,onClick:e[9]||(e[9]=t=>c.value=!1)},{default:a(()=>[b("关闭")]),_:1},8,["disabled"])])]),default:a(()=>[l(F,{model:r.value,ref_key:"ruleFormRef",ref:U,rules:$,"label-width":"60px"},{default:a(()=>[l(n,{label:"标题",prop:"title"},{default:a(()=>[l(v,{modelValue:r.value.title,"onUpdate:modelValue":e[3]||(e[3]=t=>r.value.title=t),clearable:""},null,8,["modelValue"])]),_:1}),l(n,{label:"类型",prop:"numberType"},{default:a(()=>[l(W,{modelValue:r.value.numberType,"onUpdate:modelValue":e[4]||(e[4]=t=>r.value.numberType=t)},{default:a(()=>[(y(!0),q(ee,null,le(N.value,t=>(y(),B(P,{key:t.value,label:t.value},{default:a(()=>[b(M(t.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"位数",prop:"numberSize"},{default:a(()=>[l(j,{modelValue:r.value.numberSize,"onUpdate:modelValue":e[5]||(e[5]=t=>r.value.numberSize=t),min:1},null,8,["modelValue"])]),_:1}),l(n,{label:"格式",prop:"format"},{default:a(()=>[l(v,{modelValue:r.value.format,"onUpdate:modelValue":e[6]||(e[6]=t=>r.value.format=t),placeholder:"例：road-{DateTime<yyyyMMdd>}-{number}，会用生成的流水号替换{number}。",clearable:""},null,8,["modelValue"])]),_:1}),l(n,{label:"当前值",prop:"currentNumber"},{default:a(()=>[l(j,{modelValue:r.value.currentNumber,"onUpdate:modelValue":e[7]||(e[7]=t=>r.value.currentNumber=t),min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};export{ie as default};
