import{ai as v,aT as r,aF as ea,av as Ja,aK as Ea,by as Ha,b5 as ja,aN as $,c as M,W as c,bD as f,a as m,I as re,bF as x,H as O,aw as La,A as Aa,aX as S,aY as Ba,o as b,U as D,bi as Ga,bv as T,F as ie,aV as we,b9 as V,aZ as Qa,aP as Wa,aM as $a}from"./_@vue-5ba92de9.js";import Ka from"./send-40a38f7b.js";import{_ as za}from"./index-823f4b27.js";import{a as ye}from"./_element-plus-8c7ce171.js";import"./__vendor-5e6ac033.js";import"./_@element-plus-ad4c9002.js";import"./_crypto-js-0812dcff.js";import"./_pdfjs-dist-c04561eb.js";import"./_@microsoft-43c4e133.js";import"./_vue-codemirror-50da885a.js";import"./_@popperjs-c75af06c.js";const ke=A=>(Wa("data-v-a4790d91"),A=A(),$a(),A),Xa={style:{"padding-bottom":"15px"}},Ya={border:"1",cellpadding:"1",cellspacing:"1",style:{"line-height":"50px","border-color":"#99938f","border-width":"1px",color:"#6f4946",width:"100%","margin-bottom":"0"},class:"table"},Za={colspan:"8",height:"50",style:{"padding-left":"5px","font-weight":"bold",color:"#6f4946"}},et={colspan:"8",height:"50",style:{"padding-left":"5px","font-weight":"bold",color:"#6f4946"}},at={style:{height:"100px !important"}},tt=ke(()=>m("td",{width:"26",class:"center vertical-text"},"购买方信息",-1)),lt={colspan:"3",width:"250",style:{padding:"15px 10px 0px 10px"}},ot=ke(()=>m("td",{width:"26",class:"center vertical-text"},"销售方信息",-1)),st={colspan:"3",width:"250",style:{padding:"15px 10px 0px 10px"}},nt={style:{color:"#606266"}},rt=ke(()=>m("td",{width:"26",class:"center vertical-text"},"备注",-1)),it={colspan:"7"},ut={key:0},dt={colspan:"8",style:{padding:"15px 10px 0"}},ct={key:1},ft={__name:"Edit",props:{query:{type:String,default:()=>""},modelValue:{type:Boolean,default:!1},new:{type:Boolean,default:!1},id:{type:String,default:""},buyerTaxNo:{type:String,default:""},flowtaskid:{type:String,default:""}},emits:["update:id","update:buyerTaxNo","update:new","update:flowtaskid"],setup(A,{expose:aa,emit:ta}){const N=v("ajax"),l=v("utils"),J=v("qs");v("config"),v("getTableData"),v("postSaleDetail");const la=v("dialogShow"),_e=v("index_openmenu"),ue=v("index_removetab"),C=v("index_refreshtab"),de=v("index_dialogshow"),xe=v("index_regcomponent"),Te=v("index_userinfo"),Ne=r({prop:"",order:"ascending"}),Ie=r(l.getPager(Ne.value)),Se=r([]),ce=r([]),K=r("01"),fe=r(""),R=r(!1),Ce=r(""),oa=r([{id:"01",label:"全电专用发票"},{id:"02",label:"全电普通发票"}]),sa=ta,g=A;function me(e){return Aa({get:()=>g[e],set:t=>{sa(`update:${e}`,t)}})}const P=me("id"),B=me("new"),Fe=me("flowtaskid"),E=r(),qe=r(l.query("name",g.query));var Re=l.query("formid",g.query);const z=l.length(l.query("programid",g.query))>0?v("programrun_programcomponentref"):r(null),na=F=="1"&&G!="1"?v("indexm_refreshpage"):null,ra=v("index_dialogcomponentId"),ia=v("index_dialogcomponentquery"),w=r(!1),U=r(!1),Ve=r(!1),X=r(""),Y=r(""),ua=l.query("stepid",g.query),da=l.query("taskid",g.query),Oe=l.query("instanceid",g.query),pe=r(null),H=r("");var Re=l.query("formid",g.query),ca=l.query("isminiprogram",g.query),G=l.query("isapp",g.query),Z=l.query("isemail",g.query);const fa=r([]),j=r([]),ma=r([]),h=r({}),p=r({}),pa=r(null),va=r("");l.query("display",g.query);var y=l.query("openmode",g.query)||"0",F=l.query("ismobile",g.query);const k=r({}),ee=r("");localStorage.getItem("sobInfo")!=""&&(ee.value=JSON.parse(localStorage.getItem("sobInfo")));const Q=r(!0),ga=r(null),Pe=r({id:""}),u=r({invoiceTypeCode:K.value,serialNo:"",buyerName:"",buyerTaxNo:"",buyerEmail:"",sellerName:[],sellerid:[],sellerTaxNo:"",remarks:""});ea(()=>{Ja(()=>{Ta()}),Ue()}),Ea(()=>{window.removeEventListener("resize",he,!1)});const ae={buyerName:[{required:!0,message:"请输入购方名称",trigger:"blur"}],buyerTaxNo:[{required:!0,message:"请输入纳税人识别号",trigger:"blur"}]};function ha(){ye.confirm("确定要作废吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{N.post("/Invoice/DeleteAll",J.stringify({id:P.value})).then(e=>{const t=e.success?"success":"error";l.msg(e.msg,t,!1),e.success&&C()}).catch(()=>{})}).catch(()=>{})}const ba=r([{prop:"id",align:"center",show:!1,useTemplate:!1},{prop:"goodsLineNo",label:"序号",align:"center",useTemplate:!1,show:!0,width:"60"},{prop:"goodsCode",label:"商品编号",show:!0,useTemplate:!0,align:"center",width:"200"},{prop:"goodsName",label:"商品名称",show:!0,useTemplate:!0,align:"center",width:"160"},{prop:"goodsSpecification",label:"规格型号",show:!0,useTemplate:!0,align:"center",width:"180"},{prop:"goodsUnit",label:"单位",show:!0,align:"center",useTemplate:!0,width:"100"},{prop:"goodsQuantity",label:"数量",show:!0,align:"center",useTemplate:!0,width:"120"},{prop:"goodsPrice",label:"单价",show:!0,align:"center",useTemplate:!1,width:"120"},{prop:"goodsTotalPrice",label:"价税合计",show:!0,align:"right",useTemplate:!0,width:"120"},{prop:"notaxamount",label:"无税金额",show:!0,align:"right",useTemplate:!0,width:"120"},{prop:"goodsTotalTax",label:"税额",show:!0,useTemplate:!1,align:"center",width:"150"},{prop:"goodsTaxRate",label:"税率",show:!0,align:"center",useTemplate:!0,minWidth:"150%"},{prop:"invoiceLineNature",label:"发票行性质",show:!1,align:"center",useTemplate:!0,width:"200"},{prop:"discountRate",label:"折扣率",show:!1,align:"center",useTemplate:!0,width:"200"},{prop:"discountAmount",label:"折扣额",show:!1,align:"center",useTemplate:!0,width:"200"}]),ve=async()=>{try{const e=await N.post("user/GetUserInvoiceDepartByUser",J.stringify({userid:Te.value.userId}));e.success&&(ce.value=e.data)}catch{}};function Ue(){if(qe.value=="流程"){let e=JSON.parse(localStorage.getItem("task"));Pe.value=JSON.parse(localStorage.getItem("tasks")),fe.value=localStorage.getItem("FristStepId"),R.value=!0,Q.value=!1,e.stepId===localStorage.getItem("FristStepId")?w.value=!1:w.value=!0,Xe(),ge(localStorage.getItem("formid")),ve(),u.value={invoiceTypeCode:K.value,customercode:"",customername:"",serialNo:"",buyerName:"",buyerTaxNo:"",buyerEmail:"",sellerName:[],sellerid:[],sellerTaxNo:"",remarks:""};const t=v("flowrun_form");v("flowrun_step");const o=t.value.formData;r(null),t.value.formRules,ea(()=>{o.formAttrJson={dbConn:l.emptyLong+"",dbTable:"rf_form_test",dbTablePrimaryKey:"id"}})}B.value==!0?(Q.value=B.value,R.value=!1,u.value={invoiceTypeCode:K.value,customercode:"",customername:"",serialNo:"",buyerName:"",buyerTaxNo:"",buyerEmail:"",sellerName:[],sellerid:[],sellerTaxNo:"",remarks:""},Fe.value="0",Ye(),ge(P.value),ve()):B.value==!1&&qe.value!="流程"&&(Q.value=B.value,R.value=!1,u.value={invoiceTypeCode:K.value,customercode:"",customername:"",serialNo:"",buyerName:"",buyerTaxNo:"",buyerEmail:"",sellerName:[],sellerid:[],sellerTaxNo:"",remarks:""},R.value=!1,Ye(),ge(P.value),ve())}function wa(e){let t=ce.value.find(o=>o.id===e);t&&(u.value.sellerName=t.label,u.value.sellerTaxNo=t.taxno)}const I=r([]),ge=async e=>{U.value=!0;try{const t=await N.post("/Invoice/GetInvoiceApply",J.stringify({id:e}));u.value=t.data.invoicemain,P.value=t.data.invoicemain.id,I.value=t.data.invoicedetail}catch{}finally{U.value=!1}};function ya(){N.post("/Flow/GetLongId").then(e=>{Ce.value=e.data;const t={goodsLineNo:I.value.length+1,id:Ce.value,mainid:P.value,goodsCode:"",goodsName:"",goodsSpecification:"",goodsUnit:"",goodsQuantity:"",goodsPrice:"0",goodsTotalPrice:"",goodsTaxRate:"",goodsTotalTax:"",invoiceLineNature:0,discountRate:"0",discountAmount:"0"};I.value.push(t)}).catch(()=>{})}function ka(){const e=Se.value;if(e.length===0){l.msg("请选择要删除的行","warning",!1);return}for(let t=0;t<e.length;t++){const o=I.value.indexOf(e[t]);I.value.splice(o,1)}for(let t=0;t<I.value.length;t++)I.value[t].goodsLineNo=t+1}const _a=e=>{Se.value=e};function Me({row:e,column:t,rowIndex:o,columnIndex:a}){return{color:"#000",textAlign:"center"}}function xa({row:e}){if(e.goodsTotalPrice===0)return{backgroundColor:"yellow"}}Ha(()=>I.value,e=>{let t=0,o=0;const a=r(0);e.forEach(s=>{if(t+=Number(s.goodsTotalPrice),o+=Number(s.goodsTotalTax),s.goodsQuantity==""||s.goodsQuantity==null)s.goodsPrice=0;else{let i=(Number(s.goodsTotalPrice)/Number(s.goodsQuantity)).toFixed(2);s.goodsPrice=isNaN(i)?0:i}const n=1+Number(s.goodsTaxRate);a.value=(Number(s.goodsTotalPrice)/Number(n)).toFixed(2),s.goodsTotalTax=(Number(s.goodsTotalPrice)-a.value).toFixed(2),u.value.invoiceTotalPrice=s.goodsTotalPrice-s.goodsTotalTax})},{deep:!0});const he=()=>{if(l.length(programId)>0){let o=l.query("programmodalheight",g.query);formHeight.value=l.length(o)>0&&o>0?o+"px":"auto";return}let e=F=="1"?105:155;h.value.signType>0&&(h.value.display==0||h.value.display==4)&&(e+=46),isPreview&&(e-=105),index_themeset.value.homeType===1&&(e-=46),formHeight.value=window.document.body.offsetHeight-e+"px"},Ta=()=>{U.value=!0,N.post("/Flow/GetRun"+H.value).then(e=>{if(e.success){if(l.length(e.data.form)>0)switch(e.data.form.type){case 0:initFormData(e.data),regFormComponent(e.data);break;case 1:initFormData(e.data);let o=e.data.form.address.split("?"),a=o[0],s=o.length>1?o[1]:"",n="formrun-"+l.createGuid(!1);xe(n,a),pa.value=n,va.value=s;break}if(fa.value=e.data.buttons,j.value=l.spliceArrayObj([...e.data.buttons],l.emptyLong+"","id"),j.value.length>2){for(var t=3;t<j.value.length;t++)ma.value.push(j.value[t]);j.value=j.value.slice(0,3)}h.value=e.data.step,p.value=e.data.form}else{let o=e.msg;if(l.length(o)===0)switch(e.code){case 1:o="未找到流程运行时！";break;case 2:o="未找到流程步骤运行时！";break;case 3:o="当前任务正由"+e.data+"处理，请等待！";break;case 4:o="您无权查看当前任务！";break;case 5:o="当前流程"+l.getFlowStatusTitle(parseInt(e.data))+"不能发起新的实例！";break;case 6:o="未找到用户登录信息！";break;case 7:o="未找到当前任务！";break}l.alert(o||"加载错误！","","","error",()=>{ue()})}U.value=!1,he(),window.addEventListener("resize",he,!1)}).catch(()=>{})},te=(e,t,o)=>{if(l.length(programId)>0||l.length(Re)>0){switch(l.query("save",g.query).toLowerCase()||"close"){case"close":if(l.isDef(z)&&l.isDef(z.value))z.value.dialogShow=!1,z.value.loadData(!1);else switch(y){case"0":ue();break;case"1":l.isDef(de.value)&&(de.value=!1);break;case"2":case"3":window.close();break}break;case"refresh":switch(y){case"0":C();break;case"2":case"3":var a=window.location.href;window.location.href=a;break}break}return}if(e.code!=0||t==="Copyfor"||t==="Solicitopinion"||t==="AddWrite"&&l.length(o.steps)>0&&o.steps[0].addWriteType==0)return;if(l.isDef(C)&&C("Tab_Home"),l.isDef(C)&&(C("170346575288606"),t==="Withdraw"&&C("170346576223936")),t==="Save"){if(e.nextTasks.length>0){const n=e.nextTasks[0];if(F=="1"||Z=="1"||y=="3"||y=="2")window.setTimeout(function(){const i="/flow/run/index?flowid="+n.flowId+"&stepid="+n.stepId+"&taskid="+n.id+"&groupid="+n.groupId+"&instanceid="+n.instanceId+"&ismobile="+F+"&isapp="+G+"&isemail="+Z+"&openmode="+y;window.location.href="?loadurl="+encodeURIComponent(i)+"&title="+encodeURIComponent(n.title)},100);else{const i="/flow/run/index?flowid="+n.flowId+"&stepid="+n.stepId+"&taskid="+n.id+"&groupid="+n.groupId+"&instanceid="+n.instanceId+"&ismobile="+F+"&isapp="+G+"&isemail="+Z+"&openmode="+y;ze(i)}}return}if(F=="1"){if(ca=="1"){window.setTimeout(function(){var n=window.location.href;window.location.href=n},100);return}if(G=="1"){window.parent.postMessage({msg:"refresh"},"*");return}indexm_openurl(void 0,"/mobile/flow/todo.vue");return}if(Z=="1"||y=="3"||y=="2"){window.setTimeout(function(){var n=window.location.href;window.location.href=n},100);return}if(y=="1"){de.value=!1;return}y=="0"&&ue();let s=Te.value.userId;if(l.length(e.nextTasks)>0){let n=null;for(let i=0;i<e.nextTasks.length;i++)if(e.nextTasks[i].receiverId==s&&e.nextTasks[i].status==0){n=e.nextTasks[i];break}l.isDef(n)&&_e({title:n.title,id:"task_"+n.id,url:"/flow/run/index?flowid="+n.flowId+"&stepid="+n.stepId+"&taskid="+n.id+"&groupid="+n.groupId+"&instanceid="+n.instanceId,ico:"Edit",openMode:y,closable:!0})}},le=(e,t)=>{const o=e.code;let a="";if(o==0){switch(t.toLowerCase()){case"save":a="已保存！";break;case"saveprogram":a="保存成功！";break;case"submit":case"freesubmit":l.length(e.sendMessage)>0?a=e.sendMessage:l.length(e.receiveHandler)>0?a="已发送到："+e.receiveHandler:e.stepPass?e.stepCountersignPass?e.flowCompleted?a="已完成！":a="已发送！":a=e.nextTasks.length==0?"已完成，等待其他步骤处理！":"已发送，等待其他步骤处理！":a=e.nextTasks.length==0?"已完成，等待他人处理！":"已发送，等待他人处理！";break;case"back":l.length(e.backMessage)>0?a=e.backMessage:l.length(e.receiveHandler)>0?a="已退回到："+e.receiveHandler:e.backPass?a="已退回！":a="已退回，等待他人处理！";break;case"known":a="已完成！";break;case"postpone":a="已暂缓！";break;case"end":a="已终止！";break;case"copyfor":a=l.length(e.receiveHandler)>0?"已抄送给："+e.receiveHandler:"已抄送！";break;case"solicitopinion":a=l.length(e.receiveHandler)>0?"已向："+e.receiveHandler+"征求意见！":"已征求意见！";break;case"reply":a="已回复！";break;case"redirect":a=l.length(e.receiveHandler)>0?"已转交给："+e.receiveHandler:"已转交！";break;case"addwrite":a=l.length(e.receiveHandler)>0?"已发送给："+e.receiveHandler+" 加签！":"已加签！";break;case"withdraw":a="已撤回！";break;default:a="处理成功！";break}return a}switch(o){case 1:a="参数错误！";break;case 2:a="流程id错误！";break;case 3:a="未知的处理类型！";break;case 4:a="未找到流程运行时实体！";break;case 5:a="未找到当前步骤运行时实体！";break;case 6:a="您不能处理该任务！";break;case 7:a="当前任务已处理，不能再次处理！";break;case 8:a="处理人为空！";break;case 9:a="当前流程不能发起新的任务！";break;case 10:a="未找到要处理的任务！";break;case 11:a="当前实例组任务为空！";break;case 12:a="保存表单数据时发生了错误！";break;case 1001:a=e.message;break;case 1002:a="发起子流程发生了错误！";break;case 1003:a="子流程对应的任务未完成，不能提交！";break;case 1100:a="未找到要抄送的步骤！";break;case 1101:a="抄送接收人为空！";break;case 1200:a="未找到要征求意见的步骤！";break;case 1201:a="征求意见接收人为空！";break;case 1300:a="未找到要转交的步骤！";break;case 1301:a="转交接收人为空！";break;case 1400:a="未找到要加签的步骤！";break;case 1401:a="加签接收人为空！";break;case 1500:a="不是发起人不能作废流程实例！";break;case 1501:a="作废流程实例发生错误！";break;case 2e3:a="当前步骤设置为不能退回！";break;case 2001:a=e.message;break;case 2002:a="退回没有找到接收人！";break;case 3e3:a="处理流程发生了错误！";break;case 5006:a="任务已处理，不能撤回！";break}return a},De=r(""),Je=r(""),Ee=r("开票申请"),He=r(),je=r(),Na=(e,t)=>{const o={type:e,flowId:X.value,stepId:ua,taskId:da,groupId:Y.value,instanceId:Oe,isMobile:F,steps:t||[],comment:h.value.comment,attachment:h.value.attachment,sign:h.value.sign};if(h.value.archive==1&&(p.value.formData.archiveFormSelectOptions=p.value.formSelectOptions),l.hasKey(p.value.formData,"serialNumber")&&l.length(p.value.formData.serialNumber)>0)for(let a=0;a<p.value.formData.serialNumber.length;a++){let s=p.value.formData.serialNumber[a],n=[];for(let i=0;i<s.serials.length;i++){let _=s.serials[i].data;if(l.length(_)===0)continue;new Function("formData",_)(p.value.formData)||n.push(i)}for(let i=0;i<n.length;i++)s.serials.splice(n[i],1)}N.post("/Flow/FlowExecute?srcorgid="+ee.value.id+H.value,J.stringify({json:JSON.stringify(o),formData:JSON.stringify(p.value.formData),id:P.value,isapply:"1",formtype:Ee.value,billJson:JSON.stringify(je.value)})).then(a=>{if(k.value=a.data.currentTaskModel,k.value.entrustUserId==null&&(k.value.entrustUserId=0),k.value.mainTaskId==null&&(k.value.mainTaskId=0),De.value=a.data.currentTaskModel.stepId,Je.value=a.data.currentTaskModel.id,a.success){const s=a.data;se(),l.length(programId)>0?(l.msg(le(s,e),s.code==0),te(s,e,o)):l.alert(le(s,e),"","",s.code==0,()=>{te(s,e,o)})}else l.msg("执行流程发生了错误！",!1);Ve.value=!1,U.value=!1}).catch(()=>{Ve.value=!1,U.value=!1})},Ia=(e,t)=>{const o={type:e,flowId:X.value,stepId:De.value,taskId:Je.value,groupId:Y.value,instanceId:Oe,isMobile:F,steps:t||[],comment:h.value.comment,attachment:h.value.attachment,sign:h.value.sign};if(h.value.archive==1&&(p.value.formData.archiveFormSelectOptions=p.value.formSelectOptions),l.hasKey(p.value.formData,"serialNumber")&&l.length(p.value.formData.serialNumber)>0)for(let a=0;a<p.value.formData.serialNumber.length;a++){let s=p.value.formData.serialNumber[a],n=[];for(let i=0;i<s.serials.length;i++){let _=s.serials[i].data;if(l.length(_)===0)continue;new Function("formData",_)(p.value.formData)||n.push(i)}for(let i=0;i<n.length;i++)s.serials.splice(n[i],1)}N.post("/Flow/FlowExecute?srcorgid="+ee.value.id+H.value,J.stringify({istj:"0",isapply:"1",formtype:Ee.value,json:JSON.stringify(o),formData:JSON.stringify(p.value.formData),id:P.value})).then(a=>{if(k.value=a.data.currentTaskModel,k.value.entrustUserId==null&&(k.value.entrustUserId=0),k.value.mainTaskId==null&&(k.value.mainTaskId=0),a.success){C();const s=a.data;l.length(programId)>0?(l.msg(le(s,e),s.code==0),te(s,e,o)):l.alert(le(s,e),"","",s.code==0,()=>{te(s,e,o)})}else l.msg("执行流程发生了错误！",!1)}).catch(()=>{})},oe=r(!1),Le=r(""),Ae=r(""),Be=r(""),Ge=r(""),Sa=r(!0),Qe=ja(null),se=()=>{if(h.value.signType>0&&l.length(h.value.comment)===0){l.msg("请填写处理意见！",!1);return}if(h.value.signType>=2&&h.value.sign==0){h.value.signType==3?sign(1):l.msg("请签章！",!1);return}Be.value=H.value,Qe.value=Ka,Le.value="确认接收步骤",Ae.value=F=="1"?"350px":"600px",Ge.value="",Sa.value=!0,oe.value=!0},Ca=e=>{Ia("Submit",e)},Fa=async e=>{e&&await e.validate((t,o)=>{t&&(Ze(),He.value=Object.keys(localStorage),je.value=He.value.filter(a=>a.endsWith("JSON")).reduce((a,s)=>{const n=localStorage.getItem(s),i=JSON.parse(n);return a[s]=i,a},{}),ye.confirm("是否保存并提交下一步流程?","提示",{confirmButtonText:"确定",cancelButtonText:"关闭",type:"warning"}).then(()=>{Na("Save")}).catch(()=>{}))})},qa=async e=>{e&&await e.validate((t,o)=>{t&&We(0)})};function We(e){N.post("/Flow/GetLongId").then(t=>{k.value.Id=t.data,$e(e)}).catch(()=>{})}function $e(e){u.value.customercode=u.value.buyerName,N.post("Invoice/SaveWithFlow?srcorgid="+ee.value.id,J.stringify({isapply:e,invoiceJSON:JSON.stringify(u.value),invoicedetailsJSON:JSON.stringify(I.value),flowtaskjson:JSON.stringify(k.value)})).then(t=>{t.success==!0&&(la.value=!1,C()),t.code==1&&ye.confirm(t.msg,"提示",{confirmButtonText:"确定",type:"warning"})}).catch(t=>{})}const Ke=()=>{Va()},ze=(e,t)=>{if(F=="1")if(G=="1"){let o=window.location.href;window.location.href=o}else na(t,e);else if(y=="2"||y=="3"){let o=window.location.href;window.location.href=o}else if(y=="1"){l.length(e)===0&&(e="/flow/run/index"+(g.query.indexOf("?")===0?"":"?")+g.query);const o="task_"+l.createGuid(!1),a=e.split("?"),s=a[0],n=a.length>1?a[1]:"";xe(o,s),ra.value=o,ia.value=n}else C(t,e)},Xe=()=>{N.post("flow/GetFlowTask?flowtaskid="+Pe.value.id+" &isnew="+Q.value+"&flowname=开票申请").then(e=>{fe.value=e.data.FristStepId,X.value=e.data.taskmodel.flowId,Y.value=e.data.taskmodel.groupId,W.value=e.data.taskmodel,k.value=e.data.taskmodel,H.value="?flowid="+e.data.taskmodel.flowId+"&openmode=0"}).catch(e=>{})},Ye=()=>{N.post("flow/GetFlowTask?flowtaskid="+Fe.value+" &isnew="+Q.value+"&flowname=开票申请").then(e=>{fe.value=e.data.FristStepId,X.value=e.data.taskmodel.flowId,Y.value=e.data.taskmodel.groupId,W.value=e.data.taskmodel,k.value=e.data.taskmodel,H.value="?flowid="+e.data.taskmodel.flowId+"&openmode=0"}).catch(e=>{})},W=r({}),Va=()=>{const e={id:"task_process_"+l.createGuid(!1),title:W.value.title,url:"/flow/run/process?flowid="+W.value.flowId+"&groupid="+W.value.groupId+"&status=0",openMode:1,width:"1150px",customClass:"el-dialog__padding",center:!1};_e(e)},Oa=async()=>{if(p.value.type==0){const e=pe.value.$refs.roadflowFormRef;if(l.isUndef(e)||l.isFunction(pe.value.formValidate)&&!pe.value.formValidate())return;await e.validate(t=>{t?se():l.msg("表单验证错误，请检查表单必填项等信息！",!1)})}else p.value.type==1?await ga.validate(e=>{e?se():l.msg("表单验证错误，请检查表单必填项等信息！",!1)}):se()},Ra=e=>{const{columns:t,data:o}=e,a=[],s=["goodsTotalPrice","goodsTotalTax","notaxamount"];return t.forEach((n,i)=>{if(i===0){a[i]="合计";return}if(s.includes(n.property)){const _=o.map(q=>Number(q[n.property]));_.every(q=>Number.isNaN(q))?a[i]="":a[i]=` ${_.reduce((q,L)=>{const ne=Number(L);return Number.isNaN(ne)?q:q+L},0)}`}else a[i]=""}),a};aa({open:Ue,headerCellStyle:Me,openflow:Ke,refresh:ze,getflowid:Xe,savecontent:Ze,save:We,savetwo:$e});function Ze(){u.value.customercode=u.value.buyerName,localStorage.setItem("invoiceJSON",JSON.stringify(u.value)),localStorage.setItem("invoicedetailsJSON",JSON.stringify(I.value))}return $("flowrun_step",h),$("flowrun_form",u.value),$("flowrun_send",Oa),$("flowrun_sendok",Ca),$("flowrun_dialogshow",oe),(e,t)=>{const o=S("el-button"),a=S("el-form-item"),s=S("el-form"),n=S("el-radio"),i=S("el-radio-group"),_=S("el-input"),q=S("el-option"),L=S("el-select"),ne=S("el-table-column"),Pa=S("el-table"),Ua=S("el-dialog"),Ma=Ba("loading");return b(),M("div",Xa,[c(s,{inline:""},{default:f(()=>[R.value?re("",!0):(b(),O(a,{key:0},{default:f(()=>[c(o,{type:"warning",onClick:t[0]||(t[0]=d=>qa(E.value))},{default:f(()=>[D("暂存")]),_:1}),c(o,{type:"primary",onClick:t[1]||(t[1]=d=>Fa(E.value))},{default:f(()=>[D("提交")]),_:1}),Ga(B)?re("",!0):(b(),O(o,{key:0,type:"danger",onClick:ha},{default:f(()=>[D("作废")]),_:1})),c(o,{type:"success",onClick:Ke},{default:f(()=>[D("查看流程")]),_:1})]),_:1}))]),_:1}),m("table",Ya,[m("tbody",null,[m("tr",null,[m("td",Za,[c(s,{model:u.value,rules:ae,ref_key:"ruleFormRef",ref:E},{default:f(()=>[c(a,{style:{margin:"auto"},label:"发票类型:",prop:"invoiceTypeCode"},{default:f(()=>[x(c(i,{modelValue:u.value.invoiceTypeCode,"onUpdate:modelValue":t[2]||(t[2]=d=>u.value.invoiceTypeCode=d)},{default:f(()=>[(b(!0),M(ie,null,we(oa.value,d=>(b(),O(n,{label:d.id},{default:f(()=>[D(V(d.label),1)]),_:2},1032,["label"]))),256))]),_:1},8,["modelValue"]),[[T,!w.value]]),x(m("span",null,V(u.value.invoiceTypeName),513),[[T,w.value]])]),_:1})]),_:1},8,["model"])])]),m("tr",null,[m("td",et,[c(a,{style:{margin:"auto"},label:"开票流水号:"},{default:f(()=>[m("span",null,V(u.value.serialNo),1)]),_:1})])]),m("tr",at,[tt,m("td",lt,[c(s,{model:u.value,rules:ae,ref_key:"ruleFormRef",ref:E,"label-width":"110px"},{default:f(()=>[c(a,{label:"购方名称",prop:"buyerName"},{default:f(()=>[x(c(_,{modelValue:u.value.buyerName,"onUpdate:modelValue":t[3]||(t[3]=d=>u.value.buyerName=d)},null,8,["modelValue"]),[[T,!w.value]]),x(m("span",null,V(u.value.buyerName),513),[[T,w.value]])]),_:1}),c(a,{label:"纳税人识别号",prop:"buyerTaxNo"},{default:f(()=>[x(c(_,{modelValue:u.value.buyerTaxNo,"onUpdate:modelValue":t[4]||(t[4]=d=>u.value.buyerTaxNo=d)},null,8,["modelValue"]),[[T,!w.value]]),x(m("span",null,V(u.value.buyerTaxNo),513),[[T,w.value]])]),_:1}),c(a,{label:"邮箱",prop:"buyerEmail"},{default:f(()=>[x(c(_,{modelValue:u.value.buyerEmail,"onUpdate:modelValue":t[5]||(t[5]=d=>u.value.buyerEmail=d)},null,8,["modelValue"]),[[T,!w.value]]),x(m("span",null,V(u.value.buyerEmail),513),[[T,w.value]])]),_:1})]),_:1},8,["model"])]),ot,m("td",st,[c(s,{model:u.value,rules:ae,ref_key:"ruleFormRef",ref:E,"label-width":"110px"},{default:f(()=>[c(a,{label:"销售方名称",prop:"sellerid"},{default:f(()=>[x(c(L,{onChange:wa,modelValue:u.value.sellerName,"onUpdate:modelValue":t[6]||(t[6]=d=>u.value.sellerName=d),placeholder:"请选择开票单位",style:{width:"100%"}},{default:f(()=>[(b(!0),M(ie,null,we(ce.value,d=>(b(),O(q,{key:d.id,label:d.label,value:d.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),[[T,!w.value]]),x(m("span",null,V(u.value.sellerName),513),[[T,w.value]])]),_:1}),c(a,{label:"纳税人识别号",prop:"sellerTaxNo"},{default:f(()=>[m("span",nt,V(u.value.sellerTaxNo),1)]),_:1})]),_:1},8,["model"])])]),m("tr",null,[rt,m("td",it,[c(s,{model:u.value,rules:ae,ref_key:"ruleFormRef",ref:E},{default:f(()=>[c(a,{style:{margin:"0px 0px 0px",height:"50px"},prop:"remarks"},{default:f(()=>[x(c(_,{type:"textarea",modelValue:u.value.remarks,"onUpdate:modelValue":t[7]||(t[7]=d=>u.value.remarks=d)},null,8,["modelValue"]),[[T,!w.value]]),x(m("span",null,V(u.value.remarks),513),[[T,w.value]])]),_:1})]),_:1},8,["model"])])]),R.value?re("",!0):(b(),M("tr",ut,[m("td",dt,[c(a,null,{default:f(()=>[c(o,{type:"primary",onClick:ya},{default:f(()=>[D("添加行")]),_:1}),c(o,{type:"danger",onClick:ka},{default:f(()=>[D("删除行")]),_:1})]),_:1})])]))])]),x((b(),O(Pa,{class:"eltable","summary-method":Ra,"show-summary":"",data:I.value,stripe:Ie.value.tableStripe,border:"","highlight-current-row":Ie.value.tableHighlightCurrentRow,"max-height":"300",style:{width:"100%",color:"#000"},"header-cell-style":Me,"default-sort":Ne.value,onSelectionChange:_a,"row-style":xa},{default:f(()=>[c(ne,{type:"selection",width:"55",align:"center"}),(b(!0),M(ie,null,we(ba.value,d=>(b(),M(ie,null,[d.show?(b(),O(ne,{key:0,prop:d.prop,"min-width":d.minWidth,label:d.label,align:d.align,width:d.width},{default:f(be=>[d.useTemplate&&!R.value?(b(),O(_,{key:0,modelValue:be.row[d.prop],"onUpdate:modelValue":Da=>be.row[d.prop]=Da},null,8,["modelValue","onUpdate:modelValue"])):(b(),M("span",ct,V(be.row[d.prop]),1))]),_:2},1032,["prop","min-width","label","align","width"])):re("",!0)],64))),256))]),_:1},8,["data","stripe","highlight-current-row","default-sort"])),[[Ma,U.value]]),c(Ua,{modelValue:oe.value,"onUpdate:modelValue":t[8]||(t[8]=d=>oe.value=d),title:Le.value,class:La(Ge.value),"destroy-on-close":"",width:Ae.value,draggable:"","close-on-click-modal":!1},{default:f(()=>[(b(),O(Qa(Qe.value),{query:Be.value},null,8,["query"]))]),_:1},8,["modelValue","title","class","width"])])}}},Tt=za(ft,[["__scopeId","data-v-a4790d91"]]);export{Tt as default};
