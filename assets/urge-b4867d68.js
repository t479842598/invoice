import{ai as n,aT as g,aF as N,c as T,W as l,bD as t,aX as d,o as _,F as R,aV as $,H as E,U as r,b9 as G}from"./_@vue-5ba92de9.js";const L={__name:"urge",props:{query:{type:String,default:()=>""}},setup(D){const b=n("ajax"),a=n("utils"),F=n("qs"),i=D,m=a.getQuery(i.query),U=a.query("uid",i.query),y=a.query("openmode",i.query),q=a.query("uid",i.query)!="-1"?n("flowrun_dialogshow"):null,w=a.query("uid",i.query)=="-1"?n("index_dialogshow"):null;a.length(m)===0&&n("flowrun_urge"),a.length(m)===0&&n("flowrun_completed");const c=g(!1),x=g(null),o=g({receiver:[],messageType:[0,1,2,4],contents:""}),p=g([]),j={receiver:[{required:!0,message:"请选择接收人",trigger:"blur"}],messageType:[{required:!0,message:"请选择催办方式",trigger:"change"}],contents:[{required:!0,message:"请输入消息内容",trigger:"blur"}]};N(()=>{S()});const S=()=>{c.value=!0,b.post("/Flow/GetUrgeUsers?"+m).then(f=>{o.value.contents=f.data.contents,p.value=f.data.users;for(let e=0;e<p.value.length;e++)o.value.receiver.push(p.value[e].value);c.value=!1}).catch(()=>{c.value=!1})},C=async()=>{await x.value.validate(f=>{if(f){const e={contents:o.value.contents,receiver:o.value.receiver.join(","),messageType:o.value.messageType.join(",")};b.post("/Flow/SaveUrge?"+m,F.stringify(e)).then(u=>{u.success?(a.msg("催办成功！",!0),V()):u.code==1?a.msg("未找到当前用户信息！",!1):u.code==2&&a.msg("未找到流程任务！",!1)}).catch(()=>{})}})},V=()=>{U=="-1"?y=="2"||y=="3"?window.close():a.isDef(w.value)&&(w.value=!1):a.isDef(q.value)&&(q.value=!1)};return(f,e)=>{const u=d("el-checkbox"),k=d("el-checkbox-group"),v=d("el-form-item"),B=d("el-input"),h=d("el-button"),M=d("el-form");return _(),T("div",null,[l(M,{model:o.value,ref_key:"ruleFormRef",ref:x,rules:j,"label-width":"80px"},{default:t(()=>[l(v,{label:"接收人",prop:"receiver"},{default:t(()=>[l(k,{modelValue:o.value.receiver,"onUpdate:modelValue":e[0]||(e[0]=s=>o.value.receiver=s)},{default:t(()=>[(_(!0),T(R,null,$(p.value,s=>(_(),E(u,{label:s.value},{default:t(()=>[r(G(s.label),1)]),_:2},1032,["label"]))),256))]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"催办方式",prop:"messageType"},{default:t(()=>[l(k,{modelValue:o.value.messageType,"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.messageType=s)},{default:t(()=>[l(u,{label:0},{default:t(()=>[r("站内消息")]),_:1}),l(u,{label:1},{default:t(()=>[r("手机短信")]),_:1}),l(u,{label:2},{default:t(()=>[r("企业微信")]),_:1}),l(u,{label:4},{default:t(()=>[r("邮件")]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"消息内容",prop:"contents"},{default:t(()=>[l(B,{type:"textarea",modelValue:o.value.contents,"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.contents=s),rows:4},null,8,["modelValue"])]),_:1}),l(v,null,{default:t(()=>[l(h,{type:"primary",disabled:c.value,onClick:e[3]||(e[3]=s=>C())},{default:t(()=>[r("确定")]),_:1},8,["disabled"]),l(h,{disabled:c.value,onClick:e[4]||(e[4]=s=>V())},{default:t(()=>[r("取消")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])])}}};export{L as default};
