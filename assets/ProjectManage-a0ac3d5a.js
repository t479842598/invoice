import{e as he}from"./excel-1d8df660.js";import{a as ke}from"./_element-plus-8c7ce171.js";import{d as Ve,ai as x,aT as s,aR as Ce,aF as Se,c as b,a as N,W as l,bD as t,bF as X,H as g,au as Ne,aX as v,aY as Y,o as d,F as j,aV as q,U as c,I as K,b9 as w}from"./_@vue-5ba92de9.js";import{_ as Me}from"./index-823f4b27.js";import"./__vendor-5e6ac033.js";import"./_@element-plus-ad4c9002.js";import"./_@popperjs-c75af06c.js";import"./_crypto-js-0812dcff.js";import"./_pdfjs-dist-c04561eb.js";import"./_@microsoft-43c4e133.js";import"./_vue-codemirror-50da885a.js";const Te={class:"form-container"},Ue={class:"table-container"},ze={class:"roadui_pagerdiv"},Fe={style:{color:"#333333","font-weight":"500"}},De={style:{"padding-left":"40px"},"element-loading-text":"加载中..."},Ie={key:1,style:{width:"390px"}},Be={key:1,style:{width:"390px"}},Pe={key:1,style:{width:"390px"}},$e={style:{"margin-left":"10px"}},Oe={key:1,style:{width:"220px"}},je={key:1,style:{width:"140px"}},qe={key:1,style:{width:"220px"}},Ee={style:{flex:"auto","text-align":"left"}},Je=Ve({__name:"ProjectManage",setup(Ae){const h=x("ajax"),k=x("utils");x("config");const M=x("qs");x("index_openmenu"),x("index_removetab");const Q=x("index_refreshtab"),U=s("");localStorage.getItem("sobInfo")!=""&&(U.value=JSON.parse(localStorage.getItem("sobInfo")));const V=s(!1),z=s(!1),Z=s({prop:"",order:"ascending"}),i=s(k.getPager(Z.value)),E=s([]);s({});const B=s(!1),T=s(),F=s(""),p=s(!1),J=s(document.documentElement.clientHeight-250);window.onresize=function(){J.value=document.documentElement.clientHeight-250};const ee=Ce({goodsName:[{required:!0,message:"请输入项目名称",trigger:"blur"}],goodsCode:[{required:!0,message:"商品和服务税收分类编码",trigger:"blur"}],goodsSimpleName:[{required:!0,message:"商品和服务分类简称",trigger:"blur"}],taxrate:[{required:!0,message:"请选择税率/征收率",trigger:"change"}]});Se(()=>{C(!1)});const A=s([{id:"0",label:"0"},{id:"0.01",label:"1%"},{id:"0.03",label:"3%"},{id:"0.06",label:"6%"},{id:"0.09",label:"9%"},{id:"0.13",label:"13%"}]),le=[{prop:"goodsName",label:"项目名称",width:"180",align:"left"},{prop:"taxratename",label:"税率/征收率",width:"120",align:"center"},{prop:"spec",label:"规格型号",width:"160",align:"left"},{prop:"price",label:"单价",width:"120",align:"center"},{prop:"priceTaxMark",label:"含税标志",width:"110",align:"center"},{prop:"goodsCode",label:"商品和服务税收分类编码",width:"180",align:"center"},{prop:"goodsSimpleName",label:"商品和服务分类简称",width:"180",align:"left"},{prop:"unitname",label:"单位",width:"100",align:"center"}],P=s(),ae=o=>{P.value.clearFiles();const e=o[0];P.value.handleStart(e)},H=s(""),L=s([]),te=async o=>{try{const e=await h.post("/Flow/GetLongId");H.value=e.data,(await he(o.raw)).forEach((r,u)=>{L.value.push({id:H.value+u,goodsName:r.项目名称,projectName:r.项目名称,spec:r.规格型号,goodsCode:r.商品和服务税收分类编码,price:r.单价,priceTaxMark:1,taxratename:Number(r["税率/征收率"])*100+"%",taxrate:r["税率/征收率"],unitname:r.单位,preferentialMarkFlag:r.是否使用优惠政策=="是"?1:0,vatSpecialManagement:r.优惠政策类型})}),await oe(L.value)}catch{}},oe=async o=>{try{(await h.post("/invoiceproduct/SaveAll?srcorgid="+U.value.id,M.stringify({productJSON:JSON.stringify(o)}))).success&&(k.msg("导入成功","success",!1),Q())}catch{}};function ne(o){return o.type!=="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"&&o.type!=="application/vnd.ms-excel"?(k.msg("要导入的文件必须是excel格式文件!",!1),!1):!0}const f=s({productname:"",taxrate:""}),n=s({goodsName:"",goodsCode:"",goodsSimpleName:"",taxrate:"",spec:"",price:"",priceTaxMark:"0",unitname:"",preferentialMarkFlag:"0",vatSpecialManagement:"",freeTaxMark:"0"}),C=o=>{o&&(i.value.number=1),z.value=!0,V.value=!0,f.value.size=i.value.size,f.value.number=i.value.number,f.value.order=i.value.order,h.post("/invoiceproduct/GetList?srcorgid="+U.value.id,M.stringify(f.value)).then(e=>{E.value=e.data.rows,i.value.total=e.data.total,V.value=!1,z.value=!1}).catch(()=>{V.value=!1,z.value=!1})},re=async()=>{try{B.value=!0;const o=await h.post("/invoiceproduct/Get",M.stringify({id:F.value}));n.value=o.data.invoice_product,B.value=!1}catch{}},ue=o=>{o.resetFields()},D=s(""),y=s(!1),de=()=>{F.value="",D.value="新增",p.value=!1,y.value=!0},se=o=>{F.value=o.id,D.value="修改",p.value=!1,y.value=!0},ie=o=>{F.value=o.id,D.value="查看",p.value=!0,y.value=!0},pe=async o=>{o&&await o.validate((e,m)=>{e&&h.post("/invoiceproduct/Save?srcorgid="+U.value.id,M.stringify({productJSON:JSON.stringify(n.value)})).then(r=>{const u=r.success?"success":"error";k.msg(r.msg,u,!1),r.success&&(y.value=!1,C(!1))}).catch(()=>{})})},R=o=>{o&&(o.resetFields(),y.value=!1)};async function ce(o){try{await ke.confirm("确定删除该项目吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await h.post("/invoiceproduct/DeleteAll",M.stringify({id:o.id})),m=e.success?"success":"error";k.msg(e.msg,m,!1),e.success&&(f.value.productname="",f.value.taxrate="",C())}catch(e){e==="cancel"&&k.msg("已取消删除","info",!1)}}const ve=o=>{i.value.size=o,C(!1)},me=o=>{i.value.number=o,C(!1)};function ge({row:o,column:e,rowIndex:m,columnIndex:r}){return{color:"#000",textAlign:"center"}}return(o,e)=>{const m=v("el-input"),r=v("el-form-item"),u=v("el-option"),$=v("el-select"),_=v("el-button"),fe=v("el-upload"),G=v("el-form"),W=v("el-table-column"),be=v("el-table"),_e=v("el-pagination"),S=v("el-radio"),O=v("el-radio-group"),ye=v("el-drawer"),xe=Y("loding"),we=Y("loading");return d(),b("div",null,[N("div",Te,[l(G,{inline:!0,model:f.value},{default:t(()=>[l(r,{label:" 项目名称"},{default:t(()=>[l(m,{modelValue:f.value.productname,"onUpdate:modelValue":e[0]||(e[0]=a=>f.value.productname=a)},null,8,["modelValue"])]),_:1}),l(r,{label:"税率/征收率"},{default:t(()=>[l($,{modelValue:f.value.taxrate,"onUpdate:modelValue":e[1]||(e[1]=a=>f.value.taxrate=a),placeholder:""},{default:t(()=>[(d(!0),b(j,null,q(A.value,a=>(d(),g(u,{key:a.id,label:a.label,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(r,null,{default:t(()=>[l(_,{type:"primary",onClick:e[2]||(e[2]=a=>C(!0)),disabled:V.value,icon:"Search"},{default:t(()=>[c("查询")]),_:1},8,["disabled"]),l(_,{type:"primary",onClick:de,icon:"Plus",disabled:V.value},{default:t(()=>[c("新增")]),_:1},8,["disabled"]),l(fe,{ref_key:"upload",ref:P,limit:1,style:{"margin-left":"10px","margin-bottom":"2px"},"on-change":te,"on-exceed":ae,accept:".xlsx,.xls","auto-upload":!1,"before-upload":ne,"show-file-list":!1},{trigger:t(()=>[l(_,{icon:"Upload",type:"warning"},{default:t(()=>[c("导入Excel")]),_:1})]),_:1},512)]),_:1})]),_:1},8,["model"])]),N("div",Ue,[X((d(),g(be,Ne({data:E.value,height:J.value,stripe:i.value.tableStripe,border:"","highlight-current-row":i.value.tableHighlightCurrentRow,style:{width:"100%",color:"#000"},"header-cell-style":ge},o.$attrs,{onCurrentChange:o.tableCurrentChange}),{default:t(()=>[c(" > "),K("",!0),(d(),b(j,null,q(le,(a,I)=>l(W,{key:I,prop:a.prop,label:a.label,align:a.align,"min-width":a.width,fit:"","show-overflow-tooltip":""},null,8,["prop","label","align","min-width"])),64)),l(W,{label:"操作",align:"left",width:"200",fixed:"right"},{default:t(a=>[l(_,{size:"small",type:"success",onClick:I=>ie(a.row)},{default:t(()=>[c("详情")]),_:2},1032,["onClick"]),l(_,{size:"small",type:"primary",onClick:I=>se(a.row)},{default:t(()=>[c("修改")]),_:2},1032,["onClick"]),l(_,{size:"small",type:"danger",onClick:I=>ce(a.row)},{default:t(()=>[c("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},16,["data","height","stripe","highlight-current-row","onCurrentChange"])),[[xe,z.value]]),N("div",ze,[l(_e,{currentPage:i.value.number,"onUpdate:currentPage":e[3]||(e[3]=a=>i.value.number=a),"page-size":i.value.size,"onUpdate:pageSize":e[4]||(e[4]=a=>i.value.size=a),"page-sizes":i.value.sizes,background:i.value.background,layout:i.value.layout,total:i.value.total,disabled:V.value,onSizeChange:ve,onCurrentChange:me},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])]),l(ye,{modelValue:y.value,"onUpdate:modelValue":e[19]||(e[19]=a=>y.value=a),direction:"rtl",onOpened:re,size:"35%",onClosed:e[20]||(e[20]=a=>ue(T.value)),"destroy-on-close":"","close-on-click-modal":"false"},{header:t(()=>[N("h3",Fe,w(D.value),1)]),default:t(()=>[X((d(),b("div",De,[l(G,{model:n.value,ref_key:"ruleFormRef",ref:T,rules:ee,inline:"","label-position":"top","label-width":"100px"},{default:t(()=>[l(r,{prop:"goodsName",label:"项目名称"},{default:t(()=>[p.value?(d(),b("div",Ie,w(n.value.goodsName),1)):(d(),g(m,{key:0,modelValue:n.value.goodsName,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.goodsName=a),clearable:"",style:{width:"390px"},placeholder:"请输入"},null,8,["modelValue"]))]),_:1}),l(r,{prop:"goodsCode",label:"商品和服务税收分类编码"},{default:t(()=>[p.value?(d(),b("div",Be,w(n.value.goodsCode),1)):(d(),g(m,{key:0,modelValue:n.value.goodsCode,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.goodsCode=a),clearable:"",style:{width:"390px"},placeholder:"请输入"},null,8,["modelValue"]))]),_:1}),l(r,{prop:"goodsSimpleName",label:"商品和服务分类简称"},{default:t(()=>[p.value?(d(),b("div",Pe,w(n.value.goodsSimpleName),1)):(d(),g(m,{key:0,modelValue:n.value.goodsSimpleName,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value.goodsSimpleName=a),clearable:"",style:{width:"390px"},placeholder:"请输入"},null,8,["modelValue"]))]),_:1}),l(r,{prop:"preferentialMarkFlag",label:"优惠政策及简易计税"},{default:t(()=>[l(O,{disabled:p.value,modelValue:n.value.preferentialMarkFlag,"onUpdate:modelValue":e[8]||(e[8]=a=>n.value.preferentialMarkFlag=a)},{default:t(()=>[l(S,{label:"1"},{default:t(()=>[c("是")]),_:1}),l(S,{label:"0"},{default:t(()=>[c("否")]),_:1})]),_:1},8,["disabled","modelValue"])]),_:1}),l(r,{label:"优惠政策类型"},{default:t(()=>[l($,{disabled:p.value,modelValue:n.value.vatSpecialManagement,"onUpdate:modelValue":e[9]||(e[9]=a=>n.value.vatSpecialManagement=a),clearable:"",placeholder:"请选择优惠政策类型"},{default:t(()=>[l(u,{label:"不征税",value:"不征税"}),l(u,{label:"免税",value:"免税"}),l(u,{label:"先征后退",value:"先征后退"}),l(u,{label:"100%先征后退",value:"100%先征后退"}),l(u,{label:"50%先征后退",value:"50%先征后退"}),l(u,{label:"简易征收",value:"简易征收"}),l(u,{label:"即征即退30%",value:"即征即退30%"}),l(u,{label:"即征即退50%",value:"即征即退50%"}),l(u,{label:"即征即退70%",value:"即征即退70%"}),l(u,{label:"即征即退100%",value:"即征即退100%"}),l(u,{label:"超税负3%即征即退",value:"超税负3%即征即退"}),l(u,{label:"超税负6%即征即退",value:"超税负6%即征即退"}),l(u,{label:"超税负8%即征即退",value:"超税负8%即征即退"}),l(u,{label:"超税负12%即征即退",value:"超税负12%即征即退"}),l(u,{label:"稀土产品",value:"稀土产品"}),l(u,{label:"按5%简易征收减按1.5%计征",value:"按5%简易征收减按1.5%计征"}),l(u,{label:"按5%简易征收",value:"按5%简易征收"}),l(u,{label:"按3%简易征收",value:"按3%简易征收"})]),_:1},8,["disabled","modelValue"])]),_:1}),l(r,{prop:"freeTaxMark",label:"是否选择普通零税率"},{default:t(()=>[l(O,{disabled:p.value,modelValue:n.value.freeTaxMark,"onUpdate:modelValue":e[10]||(e[10]=a=>n.value.freeTaxMark=a)},{default:t(()=>[l(S,{label:"1"},{default:t(()=>[c("是")]),_:1}),l(S,{label:"0"},{default:t(()=>[c("否")]),_:1})]),_:1},8,["disabled","modelValue"])]),_:1}),l(r,{prop:"taxrate",label:"税率/征收率"},{default:t(()=>[l($,{disabled:p.value,modelValue:n.value.taxrate,"onUpdate:modelValue":e[11]||(e[11]=a=>n.value.taxrate=a),placeholder:"",clearable:""},{default:t(()=>[(d(!0),b(j,null,q(A.value,a=>(d(),g(u,{key:a.id,label:a.label,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue"])]),_:1}),l(r,{prop:"priceTaxMark",label:"是否含税"},{default:t(()=>[l(O,{disabled:p.value,modelValue:n.value.priceTaxMark,"onUpdate:modelValue":e[12]||(e[12]=a=>n.value.priceTaxMark=a)},{default:t(()=>[l(S,{label:"0"},{default:t(()=>[c("不含税")]),_:1}),l(S,{label:"1"},{default:t(()=>[c("含税")]),_:1})]),_:1},8,["disabled","modelValue"])]),_:1}),N("div",$e,[l(r,{prop:"price",label:"单价"},{default:t(()=>[p.value?(d(),b("div",Oe,w(n.value.price),1)):(d(),g(m,{key:0,modelValue:n.value.price,"onUpdate:modelValue":e[13]||(e[13]=a=>n.value.price=a),style:{width:"220px"},clearable:"",placeholder:"请输入"},null,8,["modelValue"]))]),_:1})]),l(r,{prop:"unitname",label:"单位"},{default:t(()=>[p.value?(d(),b("div",je,w(n.value.unitname),1)):(d(),g(m,{key:0,modelValue:n.value.unitname,"onUpdate:modelValue":e[14]||(e[14]=a=>n.value.unitname=a),clearable:"",style:{width:"140px"},placeholder:"请输入"},null,8,["modelValue"]))]),_:1}),l(r,{prop:"spec",label:"规格型号"},{default:t(()=>[p.value?(d(),b("div",qe,w(n.value.unitname),1)):(d(),g(m,{key:0,modelValue:n.value.spec,"onUpdate:modelValue":e[15]||(e[15]=a=>n.value.spec=a),clearable:"",style:{width:"220px"},placeholder:"请输入"},null,8,["modelValue"]))]),_:1})]),_:1},8,["model","rules"])])),[[we,B.value]])]),footer:t(()=>[N("div",Ee,[p.value?K("",!0):(d(),g(_,{key:0,type:"primary",onClick:e[16]||(e[16]=a=>pe(T.value))},{default:t(()=>[c("保存")]),_:1})),p.value?(d(),g(_,{key:2,onClick:e[18]||(e[18]=a=>R(T.value))},{default:t(()=>[c("关闭")]),_:1})):(d(),g(_,{key:1,onClick:e[17]||(e[17]=a=>R(T.value))},{default:t(()=>[c("取消")]),_:1}))])]),_:1},8,["modelValue"])])])}}});const ll=Me(Je,[["__scopeId","data-v-71302e25"]]);export{ll as default};
