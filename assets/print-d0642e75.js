import{bP as T}from"./__vendor-5e6ac033.js";import{ai as u,aT as S,aF as Q,aK as Y,c as f,a as s,W as y,bD as h,bi as d,H as C,I as w,aZ as ee,F,aV as A,aX as v,o as a,U as b,b9 as m}from"./_@vue-5ba92de9.js";const te={class:"roadui_noprint",style:{margin:"10px 0 0 12px"}},ne={key:0},le={key:0,class:"roadui_commenttable"},oe={key:0},re={style:{"margin-right":"15px",display:"inline-block","vertical-align":"middle"}},se={key:1},ie=s("span",{style:{"margin-right":"12px","vertical-align":"middle"}},"附件",-1),ue={__name:"print",props:{query:{type:String,default:()=>""}},setup(V){const R=u("ajax"),t=u("utils"),U=u("index_openmenu"),B=u("app"),L=u("ElSelectdict"),J=u("ElSelectorg"),M=u("ElSelectfile"),P=u("ElCkeditor"),I=u("ElUsersign"),z=u("ElSelectdiv"),G=u("config"),O=V,H=t.query("archiveid",O.query),k=t.query("loadurl"),W=t.query("isflowrun",k)=="1",K=t.query("isflowrun",k)=="1"?t.query("showcomment",k)=="1":!0,D=S(!0);t.query("ismobile",O.query);const x=S([]),E=S({}),N=S(null);Q(()=>{X()}),Y(()=>{q()});const X=()=>{if(W){const c=JSON.parse(window.opener.localStorage.getItem("flow_print_selectOptions")),_=window.opener.localStorage.getItem("flow_print_html"),g=JSON.parse(window.opener.localStorage.getItem("flow_print_formData"));E.value=JSON.parse(window.opener.localStorage.getItem("flow_print_fieldStatus")),x.value=JSON.parse(window.opener.localStorage.getItem("flow_print_comments")),j({formData:g,formSelectOptions:c,html:_});return}R.post("/FlowArchive/GetShow?archiveid="+H).then(c=>{c.success?(x.value=c.data.comments,j(c.data)):t.msg("加载错误！",!1)}).catch(()=>{})},j=c=>{const _={components:{"el-selectdict":L,"el-selectorg":J,"el-selectfile":M,"el-ckeditor":P,"el-usersign":I,"el-selectdiv":z},data(){return{formData:c.formData,formSelectOptions:c.formSelectOptions,formRules:{},formRulesSubtable:{},formLabelPosition:"left",formSign:"",isMobile:c.isMobile=="1",utils:t,roadflowFormRef:S(null),subTablePagers:{},subTableLoading:!1}},computed:{getFieldStatus(){return function(l){if(t.length(l)===0||t.length(E.value)===0)return 1;const n=E.value[l];return(t.isDef(n)?n.status:0)!=2?1:2}},getText(){return function(l){if(t.length(l)===0)return"";const n=this.formData[l];return t.isDef(n)?n:""}},getSubtableDisabled(){return function(){return!0}},getSelectTitle(){return function(l,n){const r=this.formSelectOptions[l];if(t.length(r)===0)return;let e=[],o=t.isArray(n)?n:[n];for(let i=0;i<o.length;i++)for(let p=0;p<r.length;p++)r[p].value==o[i]&&e.push(r[p].label);return e.join("; ")}},getCascaderTitle(){return function(l,n){if(t.isUndef(n))return"";const r=t.getLevelArray(this.formSelectOptions[l],"children");let e=[];for(let o=0;o<n.length;o++){let i=t.getArrayObj(r,n[o],"value");i!=null&&e.push(i.label)}return e.join(" / ")}},getDateTimeTitle(){return function(l,n,r){if(n==="undefined"&&(n=void 0),r==="undefined"&&(r=" - "),t.isArray(l)){let e=l.length>0?l[0]:"",o=l.length>1?l[1]:"";return t.length(n)>0&&(t.length(e)>0&&(e=T(e).format(n)),t.length(o)>0&&(o=T(o).format(n))),e+(r||" - ")+o}else return t.length(n)>0&&t.length(l)>0&&(l=T(l).format(n)),l}},getSwitchTitle(){return function(l,n,r,e){return l===!0||t.isDef(e)&&l===e?r||"开":n||"关"}}},mounted(){},methods:{getSummaries(l){const n=l.columns,r=l.data;let e=[];for(let o=0;o<n.length;o++)if(n[o].className=="1"){let i=0;for(let p=0;p<r.length;p++)i=t.accAdd(i,parseFloat(r[p][n[o].property])||0);e[o]=i}else(o===0||o===1)&&!t.inArray(e,"合计")&&n[o].type!=="index"?e[o]="合计":e[o]="";return e}},template:c.html},g="flow_archive_"+t.createGuid(!1);B.component(g,_),N.value=g},Z=()=>{window.print()},$=()=>{q(),window.close()},q=()=>{window.opener.localStorage.removeItem("flow_print_selectOptions"),window.opener.localStorage.removeItem("flow_print_html"),window.opener.localStorage.removeItem("flow_print_formData"),window.opener.localStorage.removeItem("flow_print_comments"),window.opener.localStorage.removeItem("flow_print_fieldStatus")};return(c,_)=>{const g=v("el-button"),l=v("el-checkbox"),n=v("el-space"),r=v("el-link");return a(),f("div",null,[s("div",te,[y(g,{onClick:Z,type:"primary"},{default:h(()=>[b("打印")]),_:1}),y(g,{onClick:$},{default:h(()=>[b("关闭")]),_:1}),d(K)?(a(),C(l,{key:0,style:{"margin-left":"10px","vertical-align":"middle"},modelValue:D.value,"onUpdate:modelValue":_[0]||(_[0]=e=>D.value=e)},{default:h(()=>[b("打印处理意见")]),_:1},8,["modelValue"])):w("",!0)]),s("div",null,[(a(),C(ee(N.value)))]),D.value?(a(),f("div",ne,[(a(!0),f(F,null,A(x.value,e=>(a(),f("div",{key:e.id},[d(t).length(e.completedTime)>0?(a(),f("table",le,[s("tr",null,[s("td",null,[y(n,{size:20},{default:h(()=>[s("span",null,m(e.receiverName),1),s("span",null,m(e.stepName),1),s("span",null,m(e.receiveTime)+" - 接收",1),s("span",null,m(e.completedTime)+" - "+m(d(t).getTaskHadleTitle(e.handleType)),1)]),_:2},1024)])]),d(t).length(e.comment)>0?(a(),f("tr",oe,[s("td",null,[s("div",null,[s("span",re,m(e.comment),1),e.isSign==1?(a(),C(d(I),{key:0,sign:d(t).length(e.sign)>0?e.sign:e.receiverName},null,8,["sign"])):w("",!0)])])])):w("",!0),d(t).length(e.attachment)>0?(a(),f("tr",se,[s("td",null,[ie,y(n,{size:20},{default:h(()=>[(a(!0),f(F,null,A(e.attachment,(o,i)=>(a(),f("span",{key:o.id},[y(r,{onClick:p=>{d(t).showFile(d(U),o,d(G).SERVER_WEBADDRESS)}},{default:h(()=>[b(m(++i)+"、"+m(o.name),1)]),_:2},1032,["onClick"])]))),128))]),_:2},1024)])])):w("",!0)])):w("",!0)]))),128))])):w("",!0)])}}};export{ue as default};
