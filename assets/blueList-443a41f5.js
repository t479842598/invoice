import{a as Z,_ as El}from"./index-823f4b27.js";import{d as Pl,ai as b,aT as a,by as zl,b5 as Rl,aF as Fl,c as A,bF as Ve,a as c,W as t,bD as n,H as Y,b9 as D,aX as v,aY as Ll,aN as Ce,o as w,U as d,F as ee,aV as le,I as Ol,P as $l,bi as ae,Y as te,av as Ml,bv as Al}from"./_@vue-5ba92de9.js";import{cC as ke}from"./__vendor-5e6ac033.js";import"./_@element-plus-ad4c9002.js";import"./_crypto-js-0812dcff.js";import"./_element-plus-8c7ce171.js";import"./_@popperjs-c75af06c.js";import"./_pdfjs-dist-c04561eb.js";import"./_@microsoft-43c4e133.js";import"./_vue-codemirror-50da885a.js";const Yl={class:"form-container"},Bl={class:"table-container"},jl={style:{display:"flex","align-items":"center"}},Xl=["onClick"],ql={class:"table-text"},Gl={border:"0",class:"table",style:{width:"100%"}},Jl={style:{width:"25%"},align:"center"},Hl={style:{width:"25%"},align:"center"},Wl={style:{width:"25%"},align:"center"},Kl={style:{width:"25%"},align:"left"},Ql={class:"roadui_pagerdiv"},Zl={style:{width:"100%",padding:"20px 0 30px 0",display:"flex","justify-content":"space-around"}},ea=Pl({__name:"blueList",props:{query:{type:String,default:()=>""}},setup(la){const oe=te(()=>Z(()=>import("./viewPage-1585ff08.js"),["./viewPage-1585ff08.js","./NumMoneyToChinese-d97b4b18.js","./__vendor-5e6ac033.js","./_@vue-5ba92de9.js","./__vendor-693c365c.css","./index-823f4b27.js","./_@element-plus-ad4c9002.js","./_crypto-js-0812dcff.js","./_element-plus-8c7ce171.js","./_@popperjs-c75af06c.js","./_element-plus-7d03f811.css","./_pdfjs-dist-c04561eb.js","./_@microsoft-43c4e133.js","./_vue-codemirror-50da885a.js","./index-2ccff9e2.css","./viewPage-e4a7f5be.css"],import.meta.url)),De=te(()=>Z(()=>import("./redInvoice-880e380e.js"),["./redInvoice-880e380e.js","./__vendor-5e6ac033.js","./_@vue-5ba92de9.js","./__vendor-693c365c.css","./index-823f4b27.js","./_@element-plus-ad4c9002.js","./_crypto-js-0812dcff.js","./_element-plus-8c7ce171.js","./_@popperjs-c75af06c.js","./_element-plus-7d03f811.css","./_pdfjs-dist-c04561eb.js","./_@microsoft-43c4e133.js","./_vue-codemirror-50da885a.js","./index-2ccff9e2.css","./redInvoice-7d03c41d.css"],import.meta.url)),Te=te(()=>Z(()=>import("./HandEdit-13869ca0.js"),["./HandEdit-13869ca0.js","./_@vue-5ba92de9.js","./excel-1d8df660.js","./__vendor-5e6ac033.js","./__vendor-693c365c.css","./_element-plus-8c7ce171.js","./_@element-plus-ad4c9002.js","./_@popperjs-c75af06c.js","./_element-plus-7d03f811.css","./index-823f4b27.js","./_crypto-js-0812dcff.js","./_pdfjs-dist-c04561eb.js","./_@microsoft-43c4e133.js","./_vue-codemirror-50da885a.js","./index-2ccff9e2.css","./HandEdit-7d8d49aa.css"],import.meta.url)),V=b("ajax"),p=b("utils"),ne=b("config"),C=b("qs");b("app");const ie=a("copy"),B=a(0),se=a(0),Se=a(0),Ne=b("index_openmenu");b("index_removetab");const Ue=b("index_refreshtab"),Ie=b("index_userinfo");b("submit_dialogshow");const Ee=a({prop:"invoiceDate",order:"descending"}),Pe=a({prop:"goodsLineNo",order:"ascending"}),T=a("");localStorage.getItem("sobInfo")!=""&&(T.value=JSON.parse(localStorage.getItem("sobInfo")));const u=a(p.getPagerMore(Ee.value)),ze=a(p.getPager(Pe.value)),I=a(!1),E=a(!1),P=a(!1),S=a(""),j=a(""),z=a("");a("");const Re=a(),Fe=a([]),Le=a("");a(""),a(!1),a(""),a(),a("");const X=a(),Oe=a(""),ue=a("");a("");const $e=a(""),Me=a(""),Ae=a(""),Ye=a(""),Be=a(""),je=a(""),Xe=a(""),R=a(!1),re=a(""),de=a(""),qe=a(""),Ge=a(""),Je=a(!1),He=a([]),ce=a(!1),We=a("下载文件"),q=a(""),k=a({emailcode:""}),G=a(!1),x=a({no:"",invoiceDate:""});a([]),zl(B,o=>{se.value=Math.floor((B.value+Se.value)/1*100),B.value>0,se.value===100&&setTimeout(()=>{Je.value=!1},800)});const J=a(0),f=a(0),y=a(0),g=a(0),ve=a(""),pe=a(""),Ke=Rl(null),H=a(!1),W=a(!1),F=a(!1),me=a(!1),L=a(!1),fe=a(""),O=a(!1),Qe=a(""),Ze=a(""),el=a(""),ll=a("");function al(){p.NewshowFile(Ne,{name:Qe.value,id:Ze.value},ne.SERVER_WEBADDRESS,!1)}function tl(){let o=document.createElement("a");o.style.display="none",o.href=el.value,document.body.appendChild(o),o.click(),document.body.removeChild(o)}function ol(){let o=document.createElement("a");o.style.display="none",o.href=ll.value,document.body.appendChild(o),o.click(),document.body.removeChild(o)}Fl(()=>{m(!1),_l(),fl()});const nl=a([{prop:"serialNo",label:"开票流水号",align:"center",width:"200",template:!0},{prop:"billcode",label:"单据号",align:"center",width:"200"},{prop:"buyerName",label:"客户名称",align:"left",width:"245"},{prop:"buyerTaxNo",label:"税号",align:"center",width:"250"},{prop:"invoiceNo",label:"发票号",align:"center",width:"220"},{prop:"invoiceDate",label:"开票日期",align:"center",width:"200"},{prop:"invoiceTotalPriceTax",label:"价税合计",align:"right",width:"100"},{prop:"invoiceTotalPrice",label:"无税金额",align:"right",width:"100"},{prop:"invoiceTotalTax",label:"税额",align:"center",width:"110"},{prop:"sellerName",label:"销售方名称",align:"center",width:"245"}]),s=a({serino:"",invoiceno:"",customername:"",invoiceDate:"",status:"开票完成",invoicetype:"",redtype:""}),il=a([{id:"",label:"全部发票类型"},{id:"01",label:"全电专用发票"},{id:"02",label:"全电普通发票"}]),sl=a([{id:"",label:"是否可红冲"},{id:"可红冲",label:"可红冲"},{id:"不可红冲",label:"不可红冲"}]);function ul(){m(!0)}const K=a([]);async function m(o){E.value=!0;try{o&&(u.value.number=1),s.value.size=u.value.size,s.value.number=u.value.number,s.value.order=u.value.order,s.value.invoiceDate==null?(s.value.date1="",s.value.date2=""):(s.value.date1=s.value.invoiceDate[0],s.value.date2=s.value.invoiceDate[1]),s.value.type="已开票";const e=await V.post("/Invoice/GetList?srcorgid="+T.value.id,C.stringify(s.value));if(e.data.total==0?I.value=!0:I.value=!1,e.data.rows.length>0){K.value=e.data.rows,J.value=e.data.total,S.value=e.data.rows[0].id,u.value.total=e.data.total,f.value=0,y.value=0,g.value=0;for(let i=0;i<e.data.rows.length;i++)f.value=Number((f.value+Number(e.data.rows[i].invoiceTotalPriceTax)).toFixed(2)),y.value=Number((y.value+Number(e.data.rows[i].invoiceTotalPrice)).toFixed(2)),g.value=Number((g.value+Number(e.data.rows[i].invoiceTotalTax)).toFixed(2))}else{K.value=e.data.rows,J.value=e.data.total,S.value="0",u.value.total=e.data.total,f.value=0,g.value=0;for(let i=0;i<e.data.rows.length;i++)f.value=Number((f.value+Number(e.data.rows[i].invoiceTotalPriceTax)).toFixed(2)),y.value=Number((y.value+Number(e.data.rows[i].invoiceTotalPrice)).toFixed(2)),g.value=Number((g.value+Number(e.data.rows[i].invoiceTotalTax)).toFixed(2))}}catch{I.value=!1,E.value=!1}finally{E.value=!1}}const rl=o=>{z.value=o,fe.value="复制发票详情",W.value=!0},dl=(o,e,i,r)=>{if(!p.isEmail(o)){p.msg("邮箱格式不正确","error",!1);return}if(k.value.emailcode==""){p.msg("邮箱号码不能为空","error",!1);return}V.post("/Invoice/Send?srcorgid="+T.value.id,C.stringify({receiver:e,sendType:4,email:o,connid:i,id:r,ists:1,title:Ye.value+re.value,contents:"尊敬的客户：<br>给您开具的数电发票下载链接为：<a href="+ue.value+">点击下载</a><br><br><br>购买方名称:"+Ae.value+"<br>发票号码: "+Be.value+"<br>开具日期: "+je.value+"<br>价税合计: ￥"+Xe.value+"<br><br><br><br><hr>"+de.value})).then(_=>{ue.value="",Me.value="";const N=_.code==0?"success":"error";_.code==0&&(R.value=!1,m(!0)),p.notify("",_.msg,N)}).catch(_=>{})};function ge(){R.value=!1,G.value=!1,k.value.emailcode="",x.value.no="",x.value.invoiceDate=""}const be=a(!1),cl=(o,e)=>{j.value=o,q.value="",pe.value="红冲",F.value=!0},vl=(o,e)=>{p.confirm("确定要删除吗？",()=>{V.post("/Invoice/DeleteAll",C.stringify({id:o,type:e})).then(i=>{const r=i.success?"success":"error";p.msg(i.msg,r,!1),i.success&&Ue()}).catch(i=>{})})};function pl(o){m(!0)}const ml=o=>{S.value=o,ze.value.number=1,Ke.value=oe,ve.value="明细查看",H.value=!0},fl=()=>{V.post("Invoice/GetEmailModal?srcorgid="+T.value.id).then(o=>{re.value=o.data.emailmodal.emailtitle,de.value=o.data.emailmodal.emailtext}).catch(o=>{})},gl=()=>{P.value=!0},ye=()=>{ke.debounce(()=>{g.value=0,f.value=0,y.value=0,s.value={serino:"",customername:"",invoiceDate:"",status:"开票完成",redtype:"可红冲"},m(!0)},300)()},bl=()=>{V.post("/Invoice/OpenInvoice?srcorgid="+T.value.id,C.stringify({id:z.value,invoicedepartname:qe.value,taxno:Ge.value})).then(o=>{o.success?(p.msg(o.msg,"success",!1),m(!1)):p.msg(o.msg,"warning",!1)}).catch(o=>{})},yl=o=>{switch(o){case"开票完成":return"success";case"待开票":return"danger";case"已开票待返回电子版":return"warning";default:return"info"}},_l=async()=>{try{const o=await V.post("user/GetUserInvoiceDepartByUser",C.stringify({userid:Ie.value.userId}));o.success&&(Fe.value=o.data,Re.value=o.data[0].id)}catch{}},wl=()=>{g.value=0,f.value=0,y.value=0,u.value.number=1,m(!0),P.value=!1},xl=o=>{u.value.size=o,m(!1)},hl=o=>{g.value=0,f.value=0,y.value=0,u.value.number=o,m(!1)};function Vl({row:o,column:e,rowIndex:i,columnIndex:r}){return{color:"#000",textAlign:"center"}}const Cl=o=>{u.value.order=p.getOrder(o),m(!1)};function kl(){s.value.date1=s.value.invoiceDate[0],s.value.date2=s.value.invoiceDate[1],Ml(()=>{Dl()})}function Dl(){ke.debounce(()=>{X.value.action=ne.SERVER_PRO_APIADDRESS+"/Report/ExportInvoiceMain?"+C.stringify({whereJSON:JSON.stringify(s.value)}),X.value.submit()},300)()}const Tl=o=>{He.value=o};return Ce("RedShow",F),Ce("getTableData",m),(o,e)=>{const i=v("el-button"),r=v("el-form-item"),_=v("el-option"),N=v("el-select"),$=v("el-form"),Q=v("el-table-column"),Sl=v("el-tag"),Nl=v("el-table"),Ul=v("el-pagination"),U=v("el-input"),_e=v("el-date-picker"),h=v("el-dialog"),we=v("FullScreen"),xe=v("el-icon"),Il=Ll("loading");return w(),A("div",null,[Ve(c("form",{ref_key:"formref",ref:X,action:"",method:"post"},null,512),[[Al,!1]]),c("div",Yl,[t($,{ref:"formbutton",inline:""},{default:n(()=>[t(r,null,{default:n(()=>[t(i,{type:"primary",onClick:gl,icon:"Search"},{default:n(()=>[d("查询")]),_:1}),t(i,{type:"success",onClick:ye,icon:"Refresh"},{default:n(()=>[d("刷新")]),_:1}),t(i,{type:"warning",onClick:kl,icon:"Upload"},{default:n(()=>[d("导出")]),_:1})]),_:1}),t(r,{label:"发票类型"},{default:n(()=>[t(N,{modelValue:s.value.invoicetype,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.invoicetype=l),onChange:ul,placeholder:"请选择发票类型",style:{width:"200px"}},{default:n(()=>[(w(!0),A(ee,null,le(il.value,l=>(w(),Y(_,{key:l.id,label:l.label,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(r,{label:""},{default:n(()=>[t(N,{modelValue:s.value.redtype,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.redtype=l),onChange:pl,placeholder:"请选择红冲类型",style:{width:"200px"}},{default:n(()=>[(w(!0),A(ee,null,le(sl.value,l=>(w(),Y(_,{key:l.id,label:l.label,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},512)]),c("div",Bl,[Ve((w(),Y(Nl,{data:K.value,stripe:u.value.tableStripe,border:"","highlight-current-row":u.value.tableHighlightCurrentRow,"max-height":"550",style:{width:"100%",color:"#000"},"header-cell-style":Vl,onSelectionChange:Tl,onSortChange:Cl},{default:n(()=>[Ol("",!0),(w(!0),A(ee,null,le(nl.value,(l,M)=>(w(),Y(Q,{key:M,prop:l.prop,label:l.label,align:l.align,fit:"","show-overflow-tooltip":"",width:l.width},$l({_:2},[l.template?{name:"default",fn:n(he=>[c("div",jl,[c("a",{onClick:aa=>ml(he.row.id),style:{"margin-left":"10px"}},D(he.row.serialNo),9,Xl)])]),key:"0"}:void 0]),1032,["prop","label","align","width"]))),128)),t(Q,{prop:"istatus",label:"开票状态",align:"center",width:"180"},{default:n(l=>[t(Sl,{effect:"light",type:yl(l.row.istatus)},{default:n(()=>[d(D(l.row.istatus),1)]),_:2},1032,["type"])]),_:1}),t(Q,{label:"操作",align:"center",width:"200",fixed:"right"},{default:n(l=>[t(i,{type:"primary",size:"small",onClick:M=>rl(l.row.id)},{default:n(()=>[d("复制")]),_:2},1032,["onClick"]),t(i,{type:"danger",size:"small",onClick:M=>cl(l.row.id,l.row.billcode)},{default:n(()=>[d("红冲")]),_:2},1032,["onClick"]),t(i,{type:"danger",size:"small",onClick:M=>vl(l.row.id,l.row.billcode),plain:""},{default:n(()=>[d("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","stripe","highlight-current-row"])),[[Il,E.value]])]),c("div",ql,[c("table",Gl,[c("tr",null,[c("td",Jl," 发票张数："+D(J.value)+"张 ",1),c("td",Hl," 价税合计："+D(f.value)+"元 ",1),c("td",Wl," 无税金额合计："+D(y.value)+"元 ",1),c("td",Kl," 合计税额："+D(g.value)+"元 ",1)])])]),c("div",Ql,[t(Ul,{currentPage:u.value.number,"onUpdate:currentPage":e[2]||(e[2]=l=>u.value.number=l),"page-size":u.value.size,"onUpdate:pageSize":e[3]||(e[3]=l=>u.value.size=l),"page-sizes":u.value.sizes,background:u.value.background,layout:u.value.layout,total:u.value.total,disabled:I.value,onSizeChange:xl,onCurrentChange:hl},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])]),t(h,{modelValue:P.value,"onUpdate:modelValue":e[8]||(e[8]=l=>P.value=l),title:"查询","align-center":"","destroy-on-close":"",width:"800px",draggable:"","close-on-click-modal":!1},{default:n(()=>[t($,{inline:!0,model:s.value,class:"inline","label-width":"100px"},{default:n(()=>[t(r,{label:"开票流水号"},{default:n(()=>[t(U,{modelValue:s.value.serino,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.serino=l)},null,8,["modelValue"])]),_:1}),t(r,{label:"发票号"},{default:n(()=>[t(U,{modelValue:s.value.invoiceno,"onUpdate:modelValue":e[5]||(e[5]=l=>s.value.invoiceno=l)},null,8,["modelValue"])]),_:1}),t(r,{label:"客户名称"},{default:n(()=>[t(U,{modelValue:s.value.customername,"onUpdate:modelValue":e[6]||(e[6]=l=>s.value.customername=l)},null,8,["modelValue"])]),_:1}),t(r,{label:"开票日期"},{default:n(()=>[t(_e,{modelValue:s.value.invoiceDate,"onUpdate:modelValue":e[7]||(e[7]=l=>s.value.invoiceDate=l),type:"daterange","value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"])]),_:1}),t(r,{style:{"margin-left":"30px"}},{default:n(()=>[t(i,{type:"primary",onClick:wl},{default:n(()=>[d("查询")]),_:1}),t(i,{type:"success",onClick:ye},{default:n(()=>[d("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(h,{modelValue:R.value,"onUpdate:modelValue":e[11]||(e[11]=l=>R.value=l),title:"推送客户邮箱","align-center":"","destroy-on-close":"",width:"500px"},{default:n(()=>[t($,{model:k.value,class:"inline","label-width":"100px"},{default:n(()=>[t(r,{label:"邮箱号码"},{default:n(()=>[t(U,{modelValue:k.value.emailcode,"onUpdate:modelValue":e[9]||(e[9]=l=>k.value.emailcode=l),style:{width:"300px"}},null,8,["modelValue"])]),_:1}),t(r,null,{default:n(()=>[t(i,{type:"primary",onClick:e[10]||(e[10]=l=>dl(k.value.emailcode,$e.value,Le.value,Oe.value))},{default:n(()=>[d("发送")]),_:1}),t(i,{type:"success",onClick:ge},{default:n(()=>[d("取消")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(h,{modelValue:G.value,"onUpdate:modelValue":e[14]||(e[14]=l=>G.value=l),title:"发票号修改","align-center":"","destroy-on-close":"",width:"500px"},{default:n(()=>[t($,{model:x.value,class:"inline","label-width":"100px"},{default:n(()=>[t(r,{label:"发票号"},{default:n(()=>[t(U,{modelValue:x.value.no,"onUpdate:modelValue":e[12]||(e[12]=l=>x.value.no=l),style:{width:"210px"}},null,8,["modelValue"])]),_:1}),t(r,{label:"开票日期"},{default:n(()=>[t(_e,{modelValue:x.value.invoiceDate,"onUpdate:modelValue":e[13]||(e[13]=l=>x.value.invoiceDate=l),type:"date","value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"])]),_:1}),t(r,null,{default:n(()=>[t(i,{type:"primary",onClick:bl},{default:n(()=>[d("保存")]),_:1}),t(i,{type:"success",onClick:ge},{default:n(()=>[d("取消")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(h,{modelValue:H.value,"onUpdate:modelValue":e[16]||(e[16]=l=>H.value=l),fullscreen:me.value,style:{position:"relative"},title:ve.value,"align-center":"","destroy-on-close":"",width:"1200px",onClose:e[17]||(e[17]=l=>me.value=!1),draggable:"","close-on-click-modal":!1},{default:n(()=>[t(ae(oe),{id:S.value,"onUpdate:id":e[15]||(e[15]=l=>S.value=l)},null,8,["id"])]),_:1},8,["modelValue","fullscreen","title"]),t(h,{modelValue:F.value,"onUpdate:modelValue":e[22]||(e[22]=l=>F.value=l),fullscreen:L.value,style:{position:"relative"},title:pe.value,"align-center":"","destroy-on-close":"",width:"1400px",onClose:e[23]||(e[23]=l=>L.value=!1),draggable:"","close-on-click-modal":!1},{default:n(()=>[t(ae(De),{blueid:j.value,"onUpdate:blueid":e[18]||(e[18]=l=>j.value=l),id:q.value,"onUpdate:id":e[19]||(e[19]=l=>q.value=l),readonly:be.value,"onUpdate:readonly":e[20]||(e[20]=l=>be.value=l)},null,8,["blueid","id","readonly"]),t(xe,{onClick:e[21]||(e[21]=l=>L.value=!L.value),style:{position:"absolute",right:"45px",top:"24px",cursor:"pointer","font-size":"14px"}},{default:n(()=>[t(we)]),_:1})]),_:1},8,["modelValue","fullscreen","title"]),t(h,{modelValue:ce.value,"onUpdate:modelValue":e[27]||(e[27]=l=>ce.value=l),style:{position:"relative"},title:We.value,"align-center":"","destroy-on-close":"",width:"600px",draggable:"","close-on-click-modal":!1},{default:n(()=>[c("div",Zl,[t(i,{size:"large",type:"primary",onClick:e[24]||(e[24]=l=>tl()),round:""},{default:n(()=>[d("OFD下载")]),_:1}),t(i,{size:"large",type:"danger",onClick:e[25]||(e[25]=l=>al()),round:""},{default:n(()=>[d("PDF下载")]),_:1}),t(i,{size:"large",type:"success",onClick:e[26]||(e[26]=l=>ol()),round:""},{default:n(()=>[d("XML下载")]),_:1})])]),_:1},8,["modelValue","title"]),t(h,{modelValue:W.value,"onUpdate:modelValue":e[31]||(e[31]=l=>W.value=l),title:fe.value,onClose:e[32]||(e[32]=l=>O.value=!1),style:{position:"relative"},fullscreen:O.value,"align-center":"","destroy-on-close":"",width:"1450px",draggable:"","close-on-click-modal":!1},{default:n(()=>[t(ae(Te),{id:z.value,"onUpdate:id":e[28]||(e[28]=l=>z.value=l),copy:ie.value,"onUpdate:copy":e[29]||(e[29]=l=>ie.value=l)},null,8,["id","copy"]),t(xe,{onClick:e[30]||(e[30]=l=>O.value=!O.value),style:{position:"absolute",right:"45px",top:"24px",cursor:"pointer","font-size":"14px"}},{default:n(()=>[t(we)]),_:1})]),_:1},8,["modelValue","title","fullscreen"])])}}});const pa=El(ea,[["__scopeId","data-v-8fb62757"]]);export{pa as default};
