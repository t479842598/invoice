import{a as Ie,_ as Ue}from"./index-823f4b27.js";import{M as Fe,R as Be}from"./_@element-plus-ad4c9002.js";import{d as Re,ai as c,aT as t,aF as Ee,b5 as Me,bF as re,c as P,W as o,bD as n,a as d,au as Ye,b9 as A,H as O,aX as u,aY as Ae,aP as Oe,aM as $e,aN as $,o as b,U as h,bi as j,I as H,F as L,aV as se,P as je,Y as He}from"./_@vue-5ba92de9.js";import"./__vendor-5e6ac033.js";import"./_crypto-js-0812dcff.js";import"./_element-plus-8c7ce171.js";import"./_@popperjs-c75af06c.js";import"./_pdfjs-dist-c04561eb.js";import"./_@microsoft-43c4e133.js";import"./_vue-codemirror-50da885a.js";const Le=y=>(Oe("data-v-5da06742"),y=y(),$e(),y),qe={class:"table-container"},Ge={class:"table-text"},Je={border:"0",class:"table",width:"900"},Qe={width:"300",align:"center"},We={width:"300",align:"center"},Xe={width:"300",align:"left"},Ke={class:"roadui_pagerdiv"},Ze=Le(()=>d("div",null,[d("h3",{class:"before"},"发票明细")],-1)),ea={class:"table-container"},aa={class:"roadui_pagerdiv"},la=Re({__name:"invoiceapply",setup(y){const I=He(()=>Ie(()=>import("./Edit-28d906bb.js"),["./Edit-28d906bb.js","./_@vue-5ba92de9.js","./send-40a38f7b.js","./index-823f4b27.js","./__vendor-5e6ac033.js","./__vendor-693c365c.css","./_@element-plus-ad4c9002.js","./_crypto-js-0812dcff.js","./_element-plus-8c7ce171.js","./_@popperjs-c75af06c.js","./_element-plus-7d03f811.css","./_pdfjs-dist-c04561eb.js","./_@microsoft-43c4e133.js","./_vue-codemirror-50da885a.js","./index-2ccff9e2.css","./Edit-9cd07f5b.css"],import.meta.url)),q=c("ajax"),U=c("utils");c("config");const G=c("qs");c("index_openmenu"),c("index_removetab"),c("index_refreshtab"),c("index_userinfo"),c("view_dialogshow");const J=t("");localStorage.getItem("sobInfo")!=""&&(J.value=JSON.parse(localStorage.getItem("sobInfo")));const Q=t({prop:"invoiceDate",order:"ascending"}),i=t(U.getPager(Q.value)),ue=t({prop:"goodsCode",order:"ascending"}),s=t(U.getPager(ue.value)),x=t(!1),F=t(!1),C=t(!1),B=t(0),v=t(0),p=t(0),k=t(""),T=t(""),R=t(""),z=t(!1),de=t();t(!1),t(""),t(""),t(""),t(""),t("");const S=t(!1),D=t(!1),V=t(""),r=t({serino:"",customername:"",invoiceDate:"",status:""}),ce=t([]);Ee(async()=>{await f()});const E=t([]),W=t([]);async function f(){try{r.value.size=i.value.size,r.value.number=i.value.number,r.value.order=i.value.order,r.value.data1=r.value.invoiceDate[0],r.value.data2=r.value.invoiceDate[1],r.value.type="";const a=await q.post("/Invoice/GetInvoiceApplyList?srcorgid="+J.value.id,G.stringify(r.value));if(a.data.total==0?(x.value=!0,F.value=!0):(x.value=!1,F.value=!1),a.data.rows.length>0){E.value=a.data.rows,B.value=a.data.total,k.value=a.data.rows[0].id,i.value.total=a.data.total,v.value=0,p.value=0;for(let e=0;e<a.data.rows.length;e++)v.value=Number((v.value+Number(a.data.rows[e].invoiceTotalPriceTax)).toFixed(2)),p.value=Number((p.value+Number(a.data.rows[e].invoiceTotalTax)).toFixed(2));_()}else{E.value=a.data.rows,B.value=a.data.total,k.value="0",i.value.total=a.data.total;for(let e=0;e<a.data.rows.length;e++)v.value=Number((v.value+Number(a.data.rows[e].invoiceTotalPriceTax)).toFixed(2)),p.value=Number((p.value+Number(a.data.rows[e].invoiceTotalTax)).toFixed(2));_()}}catch{x.value=!1}finally{}}const M=t(""),X=Me(null),w=t(!1),ve=t([{prop:"serialNo",label:"开票流水号",align:"center",width:"200"},{prop:"buyerName",label:"客户名称",align:"center",width:"250"},{prop:"buyerTaxNo",label:"税号",align:"center",width:"200"},{prop:"invoiceTotalPriceTax",label:"含税金额",align:"right",width:"110"},{prop:"invoiceTotalTax",label:"税额",align:"center",width:"110"},{label:"操作",align:"center",template:!0}]),pe=t([{prop:"id",align:"center",show:!1},{label:"序号",align:"center",show:!0,width:"60"},{prop:"goodsCode",label:"商品编号",show:!0,align:"center",width:"200"},{prop:"goodsName",label:"商品名称",show:!0,align:"center",width:"160"},{prop:"goodsSpecification",label:"规格型号",show:!0,align:"center",width:"180"},{prop:"goodsUnit",label:"单位",show:!0,align:"center",width:"100"},{prop:"goodsQuantity",label:"数量",show:!0,align:"center",width:"120"},{prop:"goodsPrice",label:"单价",show:!0,align:"center",width:"120"},{prop:"goodsTotalPrice",label:"价税合计",show:!0,align:"right",width:"120"},{prop:"goodsTaxRate",label:"税率/征收率",show:!0,align:"center",width:"200"},{prop:"goodsTotalTax",label:"税额",show:!0,align:"center"}]),ge=async()=>{T.value="0",R.value="",z.value=!0,V.value="0",X.value=I,M.value="新增",w.value=!0},me=a=>{V.value=a.flowtaskid,T.value=a.id,z.value=!1,X.value=I,M.value="修改",w.value=!0},be=(a,e)=>{a!=null&&(k.value=a.id,i.value.number=1,_())},K=t({}),_=async()=>{C.value=!0,K.value={id:k.value,size:s.value.size,number:s.value.number,order:s.value.order};try{const a=await q.post("/Invoice/GetInvoiceDetailMain",G.stringify(K.value));W.value=a.data.rows,s.value.total=a.data.total}catch(a){U.msg(a.message,"error",!1)}finally{C.value=!1}},fe=a=>{ce.value=Array.from(new Set(a.map(e=>e.id)))},_e=a=>{i.value.size=a,f()},he=a=>{i.value.number=a,f()},we=a=>{s.value.size=a,_()},ye=a=>{s.value.number=a,_()},xe=()=>{S.value=!0},Ce=()=>{p.value=0,v.value=0,i.value.number=1,f(),S.value=!1},Z=()=>{p.value=0,v.value=0,r.value={serino:"",customername:"",invoiceDate:"",status:""},f()};function ee({row:a,column:e,rowIndex:m,columnIndex:g}){return{color:"#000",textAlign:"center"}}function ke({row:a}){if(a.goodsTotalPrice===0)return{backgroundColor:"yellow"}}function Te({row:a}){if(a.isedit==1)return{backgroundColor:"#ec5353"}}return $("getTableData",f),$("postSaleDetail",_),$("dialogShow",w),(a,e)=>{const m=u("el-button"),g=u("el-form-item"),ae=u("el-form"),N=u("el-table-column"),le=u("el-table"),te=u("el-pagination"),ze=u("FullScreen"),Se=u("el-icon"),oe=u("el-dialog"),ne=u("el-input"),De=u("el-date-picker"),Y=u("el-option"),Ve=u("el-select"),ie=Ae("loading");return re((b(),P("div",null,[o(ae,{ref:"formbutton",inline:""},{default:n(()=>[o(g,null,{default:n(()=>[o(m,{type:"primary",onClick:ge},{default:n(()=>[h("申请开票")]),_:1})]),_:1}),o(g,null,{default:n(()=>[o(m,{type:"primary",onClick:xe,icon:j(Fe)},{default:n(()=>[h("查询")]),_:1},8,["icon"]),o(m,{type:"success",onClick:Z,icon:j(Be)},{default:n(()=>[h("刷新")]),_:1},8,["icon"])]),_:1})]),_:1},512),d("div",qe,[o(le,Ye({data:E.value,stripe:i.value.tableStripe,border:"","highlight-current-row":i.value.tableHighlightCurrentRow,style:{width:"100%",height:"30vh",color:"#000"},"header-cell-style":ee},a.$attrs,{onCurrentChange:be,onSelectionChange:fe,"row-style":Te}),{default:n(()=>[H("",!0),H("",!0),o(N,{type:"selection",width:"55",align:"center"}),o(N,{type:"index",label:"序号",align:"center",width:"60"}),(b(!0),P(L,null,se(ve.value,(l,Ne)=>(b(),O(N,{key:Ne,prop:l.prop,label:l.label,align:l.align,width:l.width},je({_:2},[l.template?{name:"default",fn:n(Pe=>[o(m,{type:"primary",size:"small",onClick:ta=>me(Pe.row)},{default:n(()=>[h("修改")]),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["prop","label","align","width"]))),128))]),_:1},16,["data","stripe","highlight-current-row"])]),d("div",Ge,[d("table",Je,[d("tr",null,[d("td",Qe," 发票张数："+A(B.value)+"张 ",1),d("td",We," 价税合计："+A(v.value)+"元 ",1),d("td",Xe," 合计税额："+A(p.value)+"元 ",1)])])]),d("div",Ke,[o(te,{currentPage:i.value.number,"onUpdate:currentPage":e[0]||(e[0]=l=>i.value.number=l),"page-size":i.value.size,"onUpdate:pageSize":e[1]||(e[1]=l=>i.value.size=l),"page-sizes":i.value.sizes,background:i.value.background,layout:i.value.layout,total:i.value.total,disabled:x.value,onSizeChange:_e,onCurrentChange:he},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])]),Ze,d("div",ea,[re((b(),O(le,{data:W.value,stripe:s.value.tableStripe,border:"","highlight-current-row":s.value.tableHighlightCurrentRow,style:{width:"100%",height:"30vh",color:"#000"},"header-cell-style":ee,"default-sort":Q.value,"row-style":ke},{default:n(()=>[(b(!0),P(L,null,se(pe.value,l=>(b(),P(L,null,[l.show?(b(),O(N,{key:0,prop:l.prop,label:l.label,align:l.align,width:l.width},null,8,["prop","label","align","width"])):H("",!0)],64))),256))]),_:1},8,["data","stripe","highlight-current-row","default-sort"])),[[ie,C.value]])]),d("div",aa,[o(te,{currentPage:s.value.number,"onUpdate:currentPage":e[2]||(e[2]=l=>s.value.number=l),"page-size":s.value.size,"onUpdate:pageSize":e[3]||(e[3]=l=>s.value.size=l),"page-sizes":s.value.sizes,background:s.value.background,layout:s.value.layout,total:s.value.total,onSizeChange:we,onCurrentChange:ye,disabled:F.value},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])]),o(oe,{modelValue:w.value,"onUpdate:modelValue":e[9]||(e[9]=l=>w.value=l),fullscreen:D.value,style:{"padding-bottom":"10px",position:"relative"},title:M.value,"align-center":"","destroy-on-close":"",width:"1200px",draggable:"","close-on-click-modal":!1,onClose:e[10]||(e[10]=l=>D.value=!1)},{default:n(()=>[o(j(I),{ref_key:"EditRef",ref:de,id:T.value,"onUpdate:id":e[4]||(e[4]=l=>T.value=l),buyerTaxNo:R.value,"onUpdate:buyerTaxNo":e[5]||(e[5]=l=>R.value=l),new:z.value,"onUpdate:new":e[6]||(e[6]=l=>z.value=l),flowtaskid:V.value,"onUpdate:flowtaskid":e[7]||(e[7]=l=>V.value=l)},null,8,["id","buyerTaxNo","new","flowtaskid"]),o(Se,{onClick:e[8]||(e[8]=l=>D.value=!D.value),style:{position:"absolute",right:"45px",top:"24px",cursor:"pointer","font-size":"14px"}},{default:n(()=>[o(ze)]),_:1})]),_:1},8,["modelValue","fullscreen","title"]),o(oe,{modelValue:S.value,"onUpdate:modelValue":e[15]||(e[15]=l=>S.value=l),title:"查询","align-center":"","destroy-on-close":"",width:"800px",draggable:"","close-on-click-modal":!1},{default:n(()=>[o(ae,{inline:!0,model:r.value,class:"inline","label-width":"100px"},{default:n(()=>[o(g,{label:"开票流水号"},{default:n(()=>[o(ne,{modelValue:r.value.serino,"onUpdate:modelValue":e[11]||(e[11]=l=>r.value.serino=l)},null,8,["modelValue"])]),_:1}),o(g,{label:"客户名称"},{default:n(()=>[o(ne,{modelValue:r.value.customername,"onUpdate:modelValue":e[12]||(e[12]=l=>r.value.customername=l)},null,8,["modelValue"])]),_:1}),o(g,{label:"开票日期"},{default:n(()=>[o(De,{modelValue:r.value.invoiceDate,"onUpdate:modelValue":e[13]||(e[13]=l=>r.value.invoiceDate=l),type:"daterange","value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"])]),_:1}),o(g,{label:"开票状态"},{default:n(()=>[o(Ve,{modelValue:r.value.status,"onUpdate:modelValue":e[14]||(e[14]=l=>r.value.status=l),clearable:""},{default:n(()=>[o(Y,{label:"待开票",value:"待开票"}),o(Y,{label:"已开票待返回电子版",value:"已开票待返回电子版"}),o(Y,{label:"开票完成",value:"开票完成"})]),_:1},8,["modelValue"])]),_:1}),o(g,{style:{"margin-left":"30px"}},{default:n(()=>[o(m,{type:"primary",onClick:Ce},{default:n(()=>[h("查询")]),_:1}),o(m,{type:"success",onClick:Z},{default:n(()=>[h("重置")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])),[[ie,C.value]])}}});const ga=Ue(la,[["__scopeId","data-v-5da06742"]]);export{ga as default};
