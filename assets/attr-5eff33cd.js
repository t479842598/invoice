import{ai as b,aT as m,aF as Y,c as T,bF as $,H as q,bD as o,aX as v,aY as K,o as y,W as t,F as L,aV as O,a as i,U as n,bi as _}from"./_@vue-5ba92de9.js";const Z={style:{"margin-left":"12px",color:"var(--el-text-color-regular)"}},ee={style:{"margin-left":"12px",color:"var(--el-text-color-regular)"}},le={style:{"margin-left":"12px",color:"var(--el-text-color-regular)"}},ae={style:{"margin-left":"12px",color:"var(--el-text-color-regular)"}},te={style:{"margin-left":"12px"}},oe={style:{"margin-left":"12px"}},ue={style:{"margin-left":"12px",color:"var(--el-text-color-regular)"}},re={style:{"margin-left":"12px",color:"var(--el-text-color-regular)"}},de={style:{"margin-left":"12px",color:"var(--el-text-color-regular)"}},ne={style:{"margin-left":"12px",color:"var(--el-text-color-regular)"}},ie={style:{"margin-left":"12px",color:"var(--el-text-color-regular)"}},se={__name:"attr",props:{query:{type:String,default:()=>""}},setup(W){const V=b("ajax"),p=b("utils"),I=b("qs"),j=b("program_returnlist"),P=b("program_attr_formid"),k=W,w=p.query("programid",k.query),e=m({width:900}),F=m([]),E=m([]),U=m([]),H=m([]),S=b("ElCodemirror"),R=b("ElSelectfile"),N=m(null),z={name:[{required:!0,message:"请输入应用名称",trigger:"blur"}],type1:[{required:!0,message:"请选择分类",trigger:"change"}],connId:[{required:!0,message:"请选择数据连接",trigger:"change"}],sqlString:[{required:!0,message:"请输入SQL",trigger:"blur"}]},f=m(!1),c=m(!0),C=m(null);Y(()=>{p.getConns().then(u=>{H.value=u,A()})});const A=()=>{const u=[{id:"system_applibrary_formtype",key:"formType",children:!0,valueField:"id"},{id:"system_applibrary_type",key:"type",children:!0,valueField:"id"}];V.post("/Dictionary/GetMultipleOptions",I.stringify({json:JSON.stringify(u)})).then(l=>{E.value=l.data.formType,F.value=l.data.type,G()}).catch(()=>{})},G=()=>{p.length(w)>0?(f.value=!0,V.post("/Program/Get?programid="+w).then(u=>{u.code==1?p.msg("加载数据失败！",u.success):(B(u.data.applibraryTypeId),e.value=u.data,u.data.tableWidth<=0&&delete e.value.tableWidth,u.data.tableHeight<=0&&delete e.value.tableHeight,u.data.width<=0&&(e.value.width=900),u.data.height<=0&&delete e.value.height,u.data.formId<=0&&delete e.value.formId,e.value.tableBorder=e.value.tableBorder==1,e.value.rowNumber=e.value.rowNumber==1,P.value=e.value.formId,C.value.initTitle(e.value.exportTemplate)),f.value=!1,c.value=!1}).catch(()=>{f.value=!1,c.value=!1})):c.value=!1},B=u=>{p.length(u)>0?V.post("/Applibrary/GetOptions?typeid="+u[u.length-1]).then(l=>{U.value=l.data}).catch(()=>{}):(e.AppLibraryId="",U.value=[])},M=async u=>{u&&await u.validate(l=>{if(l){f.value=!0;let s=e.value.sqlString;e.value.sqlString=p.aes(e.value.sqlString),e.value.type=e.value.type1.length>0?e.value.type1[e.value.type1.length-1]:0,V.post("/Program/SaveAttr"+k.query,I.stringify(e.value)).then(g=>{let r=g.msg;p.length(r)===0&&(r=g.success?"保存成功！":"保存失败！"),e.value.sqlString=s,p.msg(r,g.success),f.value=!1,g.success&&p.length(w)===0&&j()}).catch(()=>{f.value=!1})}})};return(u,l)=>{const s=v("el-input"),g=v("el-cascader"),r=v("el-form-item"),d=v("el-option"),x=v("el-select"),h=v("el-input-number"),D=v("el-checkbox"),Q=v("el-button"),J=v("el-form"),X=K("loading");return y(),T("div",null,[$((y(),q(J,{model:e.value,ref_key:"ruleFormRef",ref:N,rules:z,"label-width":"80px"},{default:o(()=>[t(r,{label:"名称",prop:"name"},{default:o(()=>[t(s,{modelValue:e.value.name,"onUpdate:modelValue":l[0]||(l[0]=a=>e.value.name=a),clearable:"",style:{width:"200px"}},null,8,["modelValue"]),t(r,{label:"分类",prop:"type1"},{default:o(()=>[t(g,{modelValue:e.value.type1,"onUpdate:modelValue":l[1]||(l[1]=a=>e.value.type1=a),options:F.value,style:{width:"200px","margin-left":"12px"},props:{expandTrigger:"hover"}},null,8,["modelValue","options"])]),_:1}),t(r,{label:"数据连接",prop:"connId",style:{"margin-left":"20px"}},{default:o(()=>[t(x,{modelValue:e.value.connId,"onUpdate:modelValue":l[2]||(l[2]=a=>e.value.connId=a),clearable:"",style:{width:"190px","margin-left":"12px"}},{default:o(()=>[(y(!0),T(L,null,O(H.value,a=>(y(),q(d,{key:a.id,value:a.id,label:a.title},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(r,{label:"编辑表单"},{default:o(()=>[t(g,{modelValue:e.value.applibraryTypeId,"onUpdate:modelValue":l[3]||(l[3]=a=>e.value.applibraryTypeId=a),options:E.value,placeholder:"选择应用分类",style:{width:"200px"},props:{expandTrigger:"hover"},clearable:"",onChange:B},null,8,["modelValue","options"]),t(x,{modelValue:e.value.formId,"onUpdate:modelValue":l[4]||(l[4]=a=>e.value.formId=a),clearable:"",style:{"margin-left":"12px"}},{default:o(()=>[(y(!0),T(L,null,O(U.value,a=>(y(),q(d,{key:a.id,value:a.id,label:a.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),t(r,{label:"窗口宽度",prop:"width",style:{"margin-left":"12px"}},{default:o(()=>[t(h,{modelValue:e.value.width,"onUpdate:modelValue":l[5]||(l[5]=a=>e.value.width=a),"controls-position":"right",clearable:"",style:{width:"92px"}},null,8,["modelValue"])]),_:1}),t(r,{label:"窗口高度",prop:"height",style:{"margin-left":"12px"}},{default:o(()=>[t(h,{modelValue:e.value.height,"onUpdate:modelValue":l[6]||(l[6]=a=>e.value.height=a),"controls-position":"right",clearable:"",style:{width:"92px"}},null,8,["modelValue"])]),_:1})]),_:1}),t(r,{label:"按钮位置",prop:"buttonLocation"},{default:o(()=>[t(x,{modelValue:e.value.buttonLocation,"onUpdate:modelValue":l[7]||(l[7]=a=>e.value.buttonLocation=a),clearable:"",style:{width:"115px"}},{default:o(()=>[t(d,{value:0,label:"新行"}),t(d,{value:1,label:"查询后面"})]),_:1},8,["modelValue"]),i("span",Z,[n(" 选择列"),t(x,{modelValue:e.value.selectColumn,"onUpdate:modelValue":l[8]||(l[8]=a=>e.value.selectColumn=a),clearable:"",style:{width:"105px","margin-left":"12px"}},{default:o(()=>[t(d,{value:0,label:"无"}),t(d,{value:1,label:"单选"}),t(d,{value:2,label:"多选"})]),_:1},8,["modelValue"])]),i("span",ee,[n(" 分页"),t(x,{modelValue:e.value.isPager,"onUpdate:modelValue":l[9]||(l[9]=a=>e.value.isPager=a),clearable:"",style:{width:"95px","margin-left":"12px"}},{default:o(()=>[t(d,{value:0,label:"不分页"}),t(d,{value:1,label:"分页"})]),_:1},8,["modelValue"])]),i("span",le,[n(" 表格宽度"),t(h,{modelValue:e.value.tableWidth,"onUpdate:modelValue":l[10]||(l[10]=a=>e.value.tableWidth=a),"controls-position":"right",clearable:"",style:{width:"100px","margin-left":"12px"}},null,8,["modelValue"])]),i("span",ae,[n(" 表格高度"),t(h,{modelValue:e.value.tableHeight,"onUpdate:modelValue":l[11]||(l[11]=a=>e.value.tableHeight=a),"controls-position":"right",clearable:"",style:{width:"100px","margin-left":"12px"}},null,8,["modelValue"])])]),_:1}),t(r,{label:"表格大小",prop:"tableSize"},{default:o(()=>[t(x,{modelValue:e.value.tableSize,"onUpdate:modelValue":l[12]||(l[12]=a=>e.value.tableSize=a),clearable:"",style:{width:"115px"}},{default:o(()=>[t(d,{value:"default",label:"default"}),t(d,{value:"large",label:"large"}),t(d,{value:"small",label:"small"})]),_:1},8,["modelValue"]),i("span",te,[t(D,{modelValue:e.value.tableBorder,"onUpdate:modelValue":l[13]||(l[13]=a=>e.value.tableBorder=a)},{default:o(()=>[n("表格边框")]),_:1},8,["modelValue"])]),i("span",oe,[t(D,{modelValue:e.value.rowNumber,"onUpdate:modelValue":l[14]||(l[14]=a=>e.value.rowNumber=a)},{default:o(()=>[n("序号列")]),_:1},8,["modelValue"])]),i("span",ue,[n(" 事件"),t(s,{modelValue:e.value.editEvents,"onUpdate:modelValue":l[15]||(l[15]=a=>e.value.editEvents=a),clearable:"",style:{width:"300px","margin-left":"12px"},placeholder:"添加修改删除数据时执行的方法"},null,8,["modelValue"])]),i("span",re,[n(" 排序"),t(s,{modelValue:e.value.defaultSort,"onUpdate:modelValue":l[16]||(l[16]=a=>e.value.defaultSort=a),placeholder:"初次打开列表时的排序",clearable:"",style:{width:"108px","margin-left":"12px"}},null,8,["modelValue"])])]),_:1}),t(r,{label:"SQL",prop:"sqlString"},{default:o(()=>[t(_(S),{modelValue:e.value.sqlString,"onUpdate:modelValue":l[17]||(l[17]=a=>e.value.sqlString=a),type:"sql",autofocus:!1,height:"130px",width:"99%"},null,8,["modelValue"])]),_:1}),t(r,{label:"列设置",prop:"tableHead"},{default:o(()=>[t(_(S),{modelValue:e.value.tableHead,"onUpdate:modelValue":l[18]||(l[18]=a=>e.value.tableHead=a),type:"html",autofocus:!1,placeholder:"<el-table-column prop='name' label='列名'></el-table-column>",height:"130px",width:"99%"},null,8,["modelValue"])]),_:1}),t(r,{label:"脚本",prop:"clientScript"},{default:o(()=>[t(_(S),{modelValue:e.value.clientScript,"onUpdate:modelValue":l[19]||(l[19]=a=>e.value.clientScript=a),autofocus:!1,placeholder:"mounted中加载数据后执行",height:"200px",width:"99%"},null,8,["modelValue"])]),_:1}),t(r,{label:"导出标题",prop:"editEvents"},{default:o(()=>[t(s,{modelValue:e.value.exportHeaderText,"onUpdate:modelValue":l[20]||(l[20]=a=>e.value.exportHeaderText=a),placeholder:"导出Excel文件的标题",clearable:"",style:{width:"300px"}},null,8,["modelValue"]),i("span",de,[n(" 文件名称"),t(s,{modelValue:e.value.exportFileName,"onUpdate:modelValue":l[21]||(l[21]=a=>e.value.exportFileName=a),placeholder:"导出Excel文件的文件名",clearable:"",style:{width:"200px","margin-left":"12px"}},null,8,["modelValue"])]),i("span",ne,[n(" 模板文件"),t(_(R),{ref_key:"exportTemplateRef",ref:C,modelValue:e.value.exportTemplate,"onUpdate:modelValue":l[22]||(l[22]=a=>e.value.exportTemplate=a),accept:".xls,.xlsx",limit:1,style:{width:"130px","margin-left":"12px"}},null,8,["modelValue"])])]),_:1}),t(r,{label:"导入表",prop:"editEvents"},{default:o(()=>[t(s,{modelValue:e.value.importTable,"onUpdate:modelValue":l[23]||(l[23]=a=>e.value.importTable=a),placeholder:"导入Excel文件对应的数据表名",clearable:"",style:{width:"300px"}},null,8,["modelValue"]),i("span",ie,[n(" 标识列"),t(s,{modelValue:e.value.importTitleField,"onUpdate:modelValue":l[24]||(l[24]=a=>e.value.importTitleField=a),placeholder:"标识单次导入的标识字段",clearable:"",style:{width:"200px","margin-left":"12px"}},null,8,["modelValue"])])]),_:1}),t(r,null,{default:o(()=>[t(Q,{type:"primary",disabled:f.value,onClick:l[25]||(l[25]=a=>M(N.value))},{default:o(()=>[n("保存")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])),[[X,c.value]])])}}};export{se as default};
