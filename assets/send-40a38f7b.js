import{ai as n,aT as F,aF as H,c as y,a as d,F as B,aV as j,W as c,bD as b,aX as k,o as m,U as _,b9 as E,ay as S,bi as f,H as O,I as z}from"./_@vue-5ba92de9.js";const Q={style:{"margin-bottom":"8px"}},$={style:{"margin-bottom":"15px"}},G={style:{"margin-top":"25px","text-align":"center"}},J={__name:"send",props:{query:{type:String,default:()=>""}},setup(T){const V=n("ajax"),o=n("utils"),q=n("qs"),D=n("ElSelectorg"),p=T,l=F([]),v=n("flowrun_step"),C=o.query("freesend",p.query)=="1";n("flowrun_form");const h=n("flowrun_sendok"),Y=n("flowrun_freesendok"),i=n("flowrun_dialogshow"),U=o.getQuery(p.query),g=o.query("ismobile",p.query);H(()=>{M()});const M=()=>{const s="";V.post("/Flow/GetSendSteps?"+U,q.stringify({formData:JSON.stringify(s)})).then(e=>{if(e.success)if(l.value=e.data.steps,l.value.length===0)if(e.data.designNextStepSize==0)h(),i.value=!1;else if(e.data.flowType==4){o.alert("后续步骤均不符合条件！",!1),i.value=!1;return}else e.data.flowType==5&&(h(),i.value=!1);else{let r=!0;for(let a=0;a<l.value.length;a++)if(l.value[a].autoConfirm==0||o.length(l.value[a].members)===0||l.value[a].selectTime==1){r=!1;break}r&&(l.value.map(a=>{a.checked=!0}),w()),v.value.flowType==2?l.value.map(a=>{a.checked=!0}):v.value.flowType==3?l.value.map(a=>{a.checked=!0,a.disabled=!0}):l.value[0].checked=!0}}).catch(()=>{})},N=s=>{if(v.value.flowType==0)for(let e=0;e<l.value.length;e++)l.value[e].id!=s&&(l.value[e].checked=!1)},w=()=>{let s=[];for(let e=0;e<l.value.length;e++)if(l.value[e].checked){if(o.length(l.value[e].members)===0){o.msg(l.value[e].name+"没有选择接收人！",!1);return}if(l.value[e].selectTime==1&&o.length(l.value[e].completeTime)===0){o.msg(l.value[e].name+"没有选择完成时间！",!1);return}s.push({id:l.value[e].id,members:l.value[e].members,completeTime:l.value[e].completeTime})}if(s.length===0){o.msg("您没有选择接收步骤！",!1);return}C?Y(s):h(s),i.value=!1};return(s,e)=>{const r=k("el-checkbox"),a=k("el-date-picker"),x=k("el-button");return m(),y("div",null,[d("div",null,[(m(!0),y(B,null,j(l.value,t=>(m(),y("div",{key:t.id},[d("div",Q,[c(r,{onChange:N,"true-label":t.id,"false-label":"",disabled:t.disabled,modelValue:t.checked,"onUpdate:modelValue":u=>t.checked=u},{default:b(()=>[_(E(t.name),1)]),_:2},1032,["true-label","disabled","modelValue","onUpdate:modelValue"])]),d("div",$,[c(f(D),{style:S((t.selectTime==1?"width:360px;":"width:552px;")+"max-width:98%;margin-right:12px;"),placeholder:"选择接收人","select-type":t.selectType,disabled:t.allowSelect==0,"select-range":t.selectRange,"multiple-limit":t.selectQuantity,"show-search":f(g)!="1",modelValue:t.members,"onUpdate:modelValue":u=>t.members=u},null,8,["style","select-type","disabled","select-range","multiple-limit","show-search","modelValue","onUpdate:modelValue"]),t.selectTime==1?(m(),O(a,{key:0,style:S("width:180px;vertical-align:-2px;"+(f(g)=="1"?"margin-top:10px;":"")),modelValue:t.completeTime,"onUpdate:modelValue":u=>t.completeTime=u,type:"datetime",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm",placeholder:"选择完成时间",editable:f(g)!="1"},null,8,["style","modelValue","onUpdate:modelValue","editable"])):z("",!0)])]))),128))]),d("div",G,[c(x,{type:"primary",onClick:e[0]||(e[0]=t=>w())},{default:b(()=>[_("确定")]),_:1}),c(x,{onClick:e[1]||(e[1]=t=>i.value=!1)},{default:b(()=>[_("取消")]),_:1})])])}}};export{J as default};
