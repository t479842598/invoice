import{ai as k,aT as _,A as B,c as ge,W as s,bD as l,bi as S,aX as u,aY as me,o as f,a as C,H as p,aZ as ve,b9 as U,bI as _e,U as m,I as D,bF as he}from"./_@vue-5ba92de9.js";import{p as P,_ as be}from"./_splitpanes-c98d9122.js";const ye={style:{height:"inherit"}},we={class:"roadui_treenode"},ke=C("span",null,"操作",-1),Ce={class:"roadui_pagerdiv"},xe=C("span",{class:"dialog-footer"},null,-1),Ve={__name:"index",setup(Se){const w=k("ajax"),a=k("utils"),z=k("qs"),F=k("config"),$=k("index_openmenu"),j=k("index_tabs"),G=k("index_changetab"),T=_([]),R=_([]),O={children:"children",label:"title",isLeaf:"isLeaf"},W=e=>{if(d.value.type=e.id,e.id===a.emptyLong+""){d.value.status=1,r(!0);return}d.value.status=0,r(!1)},q=(e,t)=>{if(e.level===0)w.post("/Dictionary/GetTreeJson?root=system_applibrary_flowtype").then(c=>{const b={id:a.emptyLong+"",parentId:"0",title:"已删除流程",ico:"Delete",titleEn:"",titleTw:"",isLeaf:!0};c.data.push(b),T.value=c.data,a.length(c.data)>0&&R.value.push(c.data[0].id),r(!1)}).catch(()=>{});else{if(a.length(e.data.children)>0){t(e.data.children);return}w.post("/Dictionary/GetTreeChildsJson?parentid="+e.data.id).then(c=>{t(c.data)}).catch(()=>{})}},d=_({status:0,type:""}),E=_(!1),o=_(!1),I=_([]);let h=[];const N=_({prop:"createdate",order:"ascending"}),i=_(a.getPager(N.value)),H=B(()=>e=>a.getFlowStatusTitle(e)),J=B(()=>e=>{switch(e){case 0:return"";case 1:return"success";default:return"info"}}),M=e=>{h=e},K=e=>{i.value.size=e,r(!1)},X=e=>{i.value.number=e,r(!1)},Y=e=>{i.value.order=a.getOrder(e),r(!1)},r=e=>{e&&(i.value.number=1),E.value=!0,o.value=!0,d.value.size=i.value.size,d.value.number=i.value.number,d.value.order=i.value.order,w.post("/Flow/GetList",z.stringify(d.value)).then(t=>{I.value=t.data.rows,i.value.total=t.data.total,o.value=!1,E.value=!1}).catch(()=>{o.value=!1})},A=e=>{const t=e===null,c=j.value.findIndex(g=>g.id.indexOf("flowdesign_")>=0);if(c>=0){a.msg("当前有流程正在设计中，请先关闭设计中的流程再打开该流程！",!1),G(j.value[c].id);return}const b={id:"flowdesign_"+(t?a.emptyLong+"":e.id),title:t?"新建流程":"设计流程-"+e.name,ico:"Edit",openMode:0,url:"/flow/design/design?isnew="+(t?"1":"0")+"&typeid="+d.value.type+"&flowid="+(t?"":e.id)};$(b)},Z=()=>{if(h.length===0){a.msg("您没有选择要删除的流程！",!1);return}a.confirm("您确定要删除所选流程吗？",()=>{o.value=!0,w.post("/Flow/DeleteFlow",z.stringify({ids:a.getArrayValues(h,"id").join(",")})).then(e=>{a.msg(e.success?"删除成功！":"删除失败！",e.success),o.value=!1,e.success&&(h=[],r(!1))}).catch(()=>{o.value=!1})})},Q=()=>{if(h.length===0){a.msg("您没有选择要彻底删除的流程！",!1);return}a.confirm("您确定要彻底删除所选流程吗？",()=>{o.value=!0,w.post("/Flow/ThoroughDeleteFlow",z.stringify({ids:a.getArrayValues(h,"id").join(",")})).then(e=>{e.success?(a.msg("彻底删除成功！",!0),r(!1)):(e.code==1?a.msg(e.data+"已有实例任务，不能彻底删除！",!1):a.msg("彻底删除失败！",!1),h=[],r(!1)),o.value=!1}).catch(()=>{o.value=!1})})},ee=e=>{a.confirm("您确定要恢复该流程吗？",()=>{o.value=!0,w.post("/Flow/RecoveryFlow",z.stringify({id:e.id})).then(t=>{t.success?(a.msg("恢复成功！",!0),r(!1)):a.msg("恢复失败！",!1),o.value=!1}).catch(()=>{o.value=!1})})},te=()=>{let e=a.getArrayValues(h,"id");if(e.length===0){a.msg("您没有选择要导出的流程！",!1);return}const t=F.SERVER_WEBADDRESS+"/Export/FlowExport?flowid="+e.join(",");window.location.href=t},V=_(!1),ae=()=>{V.value=!0},le=e=>e.type!=="application/json"?(a.msg("要导入的文件必须是json格式文件!",!1),!1):!0,se=(e,t)=>{if(t.status==="success"){if(e.code!=0){a.msg("文件上传失败！",!1);return}const b=e.data.id;w.post("/Flow/ImportFlow",z.stringify({files:b})).then(g=>{let y=g.msg;a.length(y)===0&&(g.success?y="导入成功！":g.code==1?y="要导入的文件不存在！":g.code==2?y="要导入的文件不是有效的json格式文件！":y="导入失败！"),a.msg(y,g.success),g.success&&(V.value=!1,r(!1))}).catch(()=>{})}else t.status==="error"&&a.msg("文件上传失败！",!1)};return(e,t)=>{const c=u("document"),b=u("el-icon"),g=u("folder"),y=u("el-tree"),oe=u("el-input"),L=u("el-form-item"),v=u("el-button"),ne=u("el-form"),x=u("el-table-column"),ie=u("el-tag"),de=u("el-table"),ue=u("el-pagination"),re=u("el-upload"),ce=u("el-dialog"),fe=me("loading");return f(),ge("div",ye,[s(S(be),{class:"default-theme",style:{height:"inherit"}},{default:l(()=>[s(S(P),{size:16,"min-size":"16","max-size":"50",style:{overflow:"auto",background:"#fff"}},{default:l(()=>[s(y,{data:T.value,props:O,load:q,lazy:"","node-key":"id","highlight-current":"","default-expanded-keys":R.value,"expand-on-click-node":!1,style:{height:"inherit","padding-right":"14px"},onNodeClick:W},{default:l(n=>[C("div",we,[S(a).length(n.data.ico)>0?(f(),p(ve(n.data.ico),{key:0})):n.node.isLeaf?(f(),p(b,{key:1},{default:l(()=>[s(c)]),_:1})):(f(),p(b,{key:2},{default:l(()=>[s(g)]),_:1})),C("span",null,U(n.node.label),1)])]),_:1},8,["data","default-expanded-keys"])]),_:1}),s(S(P),{size:84,style:{background:"#fff",overflow:"auto","padding-left":"5px"}},{default:l(()=>[C("div",null,[s(ne,{inline:!0,onSubmit:t[3]||(t[3]=_e(()=>{},["prevent"]))},{default:l(()=>[s(L,{label:"流程名称"},{default:l(()=>[s(oe,{modelValue:d.value.name,"onUpdate:modelValue":t[0]||(t[0]=n=>d.value.name=n),clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),s(L,null,{default:l(()=>[s(v,{type:"primary",disabled:o.value,onClick:t[1]||(t[1]=n=>r(!0))},{default:l(()=>[m("查询")]),_:1},8,["disabled"]),d.value.status===0?(f(),p(v,{key:0,type:"primary",disabled:o.value,onClick:t[2]||(t[2]=n=>A(null))},{default:l(()=>[m("新建")]),_:1},8,["disabled"])):D("",!0),d.value.status===0?(f(),p(v,{key:1,type:"danger",disabled:o.value,onClick:Z},{default:l(()=>[m("删除")]),_:1},8,["disabled"])):D("",!0),d.value.status===0?(f(),p(v,{key:2,disabled:o.value,onClick:te},{default:l(()=>[m("导出")]),_:1},8,["disabled"])):D("",!0),d.value.status===0?(f(),p(v,{key:3,disabled:o.value,onClick:ae},{default:l(()=>[m("导入")]),_:1},8,["disabled"])):D("",!0),d.value.status===1?(f(),p(v,{key:4,type:"danger",disabled:o.value,onClick:Q},{default:l(()=>[m("彻底删除")]),_:1},8,["disabled"])):D("",!0)]),_:1})]),_:1})]),C("div",null,[he((f(),p(de,{data:I.value,stripe:i.value.tableStripe,border:i.value.tableBorder,style:{width:"100%"},"highlight-current-row":i.value.tableHighlightCurrentRow,"default-sort":N.value,onSortChange:Y,onSelectionChange:M},{default:l(()=>[s(x,{type:"selection",width:"45"}),s(x,{prop:"name",label:"流程名称","show-overflow-tooltip":"",sortable:"custom"}),s(x,{prop:"createDate",label:"创建时间",width:"180",sortable:"custom"}),s(x,{prop:"createUser",label:"创建人",width:"140",sortable:"custom"}),s(x,{prop:"status",label:"状态",width:"100",sortable:"custom"},{default:l(n=>[s(ie,{type:J.value(n.row.status),effect:"dark"},{default:l(()=>[m(U(H.value(n.row.status)),1)]),_:2},1032,["type"])]),_:1}),s(x,{width:"90"},{header:l(()=>[ke]),default:l(n=>[d.value.status===0?(f(),p(v,{key:0,size:"small",disabled:o.value,type:"primary",onClick:pe=>A(n.row)},{default:l(()=>[m("编辑")]),_:2},1032,["disabled","onClick"])):(f(),p(v,{key:1,size:"small",disabled:o.value,type:"primary",onClick:pe=>ee(n.row)},{default:l(()=>[m("恢复")]),_:2},1032,["disabled","onClick"]))]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[fe,E.value]])]),C("div",Ce,[s(ue,{currentPage:i.value.number,"onUpdate:currentPage":t[4]||(t[4]=n=>i.value.number=n),"page-size":i.value.size,"onUpdate:pageSize":t[5]||(t[5]=n=>i.value.size=n),"page-sizes":i.value.sizes,background:i.value.background,layout:i.value.layout,total:i.value.total,disabled:o.value,onSizeChange:K,onCurrentChange:X},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])])]),_:1})]),_:1}),s(ce,{modelValue:V.value,"onUpdate:modelValue":t[6]||(t[6]=n=>V.value=n),title:"导入",class:"el-dialog__padding1","align-center":"","destroy-on-close":"",width:"350px",draggable:"","close-on-click-modal":!1},{footer:l(()=>[xe]),default:l(()=>[s(re,{action:S(F).SERVER_WEBADDRESS+"/Files/SaveFiles","show-file-list":!1,accept:".json",headers:{"nroadflow-token":S(a).getToken()},"with-credentials":"",data:{filetype:".json",uploadtype:0},"on-success":se,"before-upload":le},{default:l(()=>[s(v,{type:"primary"},{default:l(()=>[m("选择文件")]),_:1})]),_:1},8,["action","headers","data"])]),_:1},8,["modelValue"])])}}};export{Ve as default};
