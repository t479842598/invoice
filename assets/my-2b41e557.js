import ce from"./subjectlist-525d0217.js";import me from"./subjectadd-9ca3414b.js";import{ai as D,aT as c,A as O,aF as ve,b5 as pe,c as A,a as x,W as a,bD as t,bF as fe,H as y,aN as I,aX as m,aY as ge,o as g,bi as S,U as v,b9 as L,I as $,aZ as be}from"./_@vue-5ba92de9.js";const _e={class:"roadui_page"},ye={key:0},we={class:"roadui_pagerdiv"},je={__name:"my",setup(he){const k=D("ajax"),d=D("utils"),M=D("qs"),H=D("ElSelectorg"),n=c(!1),z=c(!1),b=c({}),w=c([]),N=c([]),P=c({prop:"addtime",order:"descending"}),i=c(d.getPager(P.value)),W=O(()=>o=>{switch(o){case 0:return"编辑中";case 1:return"已发布";case 2:return"已有结果";case 3:return"已完成";default:return"未知"}}),X=O(()=>o=>{switch(o){case 0:return"info";case 1:return"";case 2:return"warning";case 3:return"success";default:return""}});ve(()=>{_(!1)});const Z=o=>{i.value.size=o,_(!1)},J=o=>{i.value.number=o,_(!1)},K=o=>{i.value.order=d.getOrder(o),_(!1)},_=o=>{o&&(i.value.number=1),z.value=!0,n.value=!0,b.value.size=i.value.size,b.value.number=i.value.number,b.value.order=i.value.order,b.value.date1=d.length(w.value)>0?w.value[0]:"",b.value.date2=d.length(w.value)>1?w.value[1]:"",k.post("/Questionnaire/GetMyList",M.stringify(b.value)).then(e=>{N.value=e.data.rows,i.value.total=e.data.total,n.value=!1,z.value=!1}).catch(()=>{n.value=!1})},h=c(!1),U=c(""),r=c({}),Q=c(null),ee={subject:[{required:!0,message:"主题不能为空",trigger:"blur"}],participants:[{required:!0,message:"参与人员不能为空",trigger:"blur"}]},le=()=>{r.value={status:0},U.value="添加问卷",h.value=!0},ae=o=>{n.value=!0,k.post("/Questionnaire/Get?id="+o.id).then(e=>{if(e.success)r.value=e.data,U.value="编辑问卷",h.value=!0;else{let u=e.msg;d.length(u)===0&&(e.code==1?u="未找到问卷信息！":u="获取问卷信息失败！"),d.msg(u,e.success)}n.value=!1}).catch(()=>{n.value=!1})},te=async o=>{o&&await o.validate(e=>{e&&(n.value=!0,k.post("/Questionnaire/Save?id="+(r.value.id||""),M.stringify(r.value)).then(u=>{n.value=!1;let s=u.msg;d.length(s)===0&&(u.success?s="保存成功！":u.code==1?s="数据验证错误！":s="保存失败！"),d.msg(s,u.success),u.success&&(h.value=!1,_(!1))}).catch(()=>{n.value=!1}))})},ue=o=>{d.confirm("此操作将删除该调查问卷所有数据，并且不可恢复，您确定要删除吗？",()=>{n.value=!0,k.post("/Questionnaire/Delete?id="+o.id).then(e=>{n.value=!1;let u=e.msg;d.length(u)===0&&(e.success?u="删除成功！":e.code==1?u="问卷已经有提交结果，不能删除！":u="删除失败！"),d.msg(u,e.success),e.success&&_(!1)}).catch(()=>{n.value=!1})})},B=(o,e)=>{const u=e==1?"发布":"取消";d.confirm("您确定要"+u+"吗？",()=>{n.value=!0,k.post("/Questionnaire/Publish?id="+o.id+"&status="+e).then(s=>{n.value=!1;let p=s.msg;d.length(p)===0&&(s.success?p=u+"成功！":s.code==1?p="未找到要"+u+"的问卷信息！":s.code==2?p="问卷没有选题，不能发布！":s.code==3?p="问卷已经有提交结果，不能取消！":p=u+"失败！"),d.msg(p,s.success),s.success&&_(!1)}).catch(()=>{n.value=!1})})},C=c(!1),q=c(""),T=pe(null),Y=c(""),R=o=>{T.value=ce,Y.value="?questionnaireid="+o.id,q.value="选题",C.value=!0},oe=(o,e,u)=>{T.value=me,Y.value="?questionnaireid="+o+"&subjectid="+e+"&sort="+u,q.value="选题",C.value=!0};return I("questionnaire_subject",R),I("questionnaire_addsubject",oe),(o,e)=>{const u=m("el-input"),s=m("el-form-item"),p=m("el-date-picker"),f=m("el-button"),F=m("el-form"),V=m("el-table-column"),E=m("el-tag"),se=m("el-space"),ne=m("el-table"),ie=m("el-pagination"),re=m("el-switch"),G=m("el-dialog"),de=ge("loading");return g(),A("div",_e,[x("div",null,[a(F,{inline:!0},{default:t(()=>[a(s,{label:"主题"},{default:t(()=>[a(u,{modelValue:b.value.subject,"onUpdate:modelValue":e[0]||(e[0]=l=>b.value.subject=l),style:{width:"200px"},clearable:""},null,8,["modelValue"])]),_:1}),a(s,{label:"创建时间"},{default:t(()=>[a(p,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=l=>w.value=l),style:{width:"220px"},type:"daterange","value-format":"YYYY-MM-DD","unlink-panels":"","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:S(d).dateShortucts},null,8,["modelValue","shortcuts"])]),_:1}),a(s,null,{default:t(()=>[a(f,{type:"primary",disabled:n.value,onClick:e[2]||(e[2]=l=>_(!0))},{default:t(()=>[v("查询")]),_:1},8,["disabled"]),a(f,{type:"primary",disabled:n.value,onClick:e[3]||(e[3]=l=>le())},{default:t(()=>[v("添加")]),_:1},8,["disabled"])]),_:1})]),_:1})]),x("div",null,[fe((g(),y(ne,{data:N.value,stripe:i.value.tableStripe,border:i.value.tableBorder,style:{width:"100%"},"highlight-current-row":i.value.tableHighlightCurrentRow,"default-sort":P.value,onSortChange:K},{default:t(()=>[a(V,{prop:"subject",label:"主题",sortable:"custom"}),a(V,{prop:"addTime",label:"创建时间",sortable:"custom",width:"150"}),a(V,{prop:"participantsName",label:"参与人员",width:"200"}),a(V,{prop:"endTime",label:"结束时间",sortable:"custom",width:"150"},{default:t(l=>[S(d).length(l.row.endTime)>0?(g(),A("span",ye,L(l.row.endTime),1)):(g(),y(E,{key:1,type:"info"},{default:t(()=>[v("无结束时间")]),_:1}))]),_:1}),a(V,{prop:"status",label:"状态",sortable:"custom",width:"80"},{default:t(l=>[a(E,{effect:"dark",type:X.value(l.row.status)},{default:t(()=>[v(L(W.value(l.row.status)),1)]),_:2},1032,["type"])]),_:1}),a(V,{label:"操作",width:"235"},{default:t(l=>[a(se,null,{default:t(()=>[a(f,{size:"small",type:"primary",onClick:j=>ae(l.row)},{default:t(()=>[v("编辑")]),_:2},1032,["onClick"]),a(f,{size:"small",type:"primary",onClick:j=>R(l.row)},{default:t(()=>[v("选题")]),_:2},1032,["onClick"]),l.row.status==0?(g(),y(f,{key:0,size:"small",type:"success",onClick:j=>B(l.row,1)},{default:t(()=>[v("发布")]),_:2},1032,["onClick"])):l.row.status==1&&l.row.status<2?(g(),y(f,{key:1,size:"small",type:"warning",onClick:j=>B(l.row,0)},{default:t(()=>[v("取消")]),_:2},1032,["onClick"])):$("",!0),l.row.status<1?(g(),y(f,{key:2,size:"small",type:"danger",onClick:j=>ue(l.row)},{default:t(()=>[v("删除")]),_:2},1032,["onClick"])):$("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[de,z.value]]),x("div",we,[a(ie,{currentPage:i.value.number,"onUpdate:currentPage":e[4]||(e[4]=l=>i.value.number=l),"page-size":i.value.size,"onUpdate:pageSize":e[5]||(e[5]=l=>i.value.size=l),"page-sizes":i.value.sizes,background:i.value.background,layout:i.value.layout,total:i.value.total,disabled:n.value,onSizeChange:Z,onCurrentChange:J},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])]),a(G,{modelValue:h.value,"onUpdate:modelValue":e[14]||(e[14]=l=>h.value=l),title:U.value,"destroy-on-close":"",width:"850px",draggable:"","close-on-click-modal":!1},{default:t(()=>[a(F,{model:r.value,ref_key:"ruleFormRef",ref:Q,rules:ee,"label-width":"100px"},{default:t(()=>[a(s,{label:"主题",prop:"subject"},{default:t(()=>[a(u,{modelValue:r.value.subject,"onUpdate:modelValue":e[6]||(e[6]=l=>r.value.subject=l),clearable:""},null,8,["modelValue"])]),_:1}),a(s,{label:"参与人员",prop:"participants"},{default:t(()=>[a(S(H),{modelValue:r.value.participants,"onUpdate:modelValue":e[7]||(e[7]=l=>r.value.participants=l),style:{width:"100%"},clearable:""},null,8,["modelValue"])]),_:1}),a(s,{label:"结果查询人员",prop:"queryUsers"},{default:t(()=>[a(S(H),{modelValue:r.value.queryUsers,"onUpdate:modelValue":e[8]||(e[8]=l=>r.value.queryUsers=l),style:{width:"100%"},clearable:""},null,8,["modelValue"])]),_:1}),a(s,{label:"结束时间",prop:"endTime"},{default:t(()=>[a(p,{modelValue:r.value.endTime,"onUpdate:modelValue":e[9]||(e[9]=l=>r.value.endTime=l),placeholder:"为空表示无结束时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm",type:"datetime"},null,8,["modelValue"])]),_:1}),a(s,{label:"匿名提交",prop:"anonymous"},{default:t(()=>[a(re,{modelValue:r.value.anonymous,"onUpdate:modelValue":e[10]||(e[10]=l=>r.value.anonymous=l)},null,8,["modelValue"])]),_:1}),a(s,{label:"备注说明",prop:"note"},{default:t(()=>[a(u,{modelValue:r.value.note,"onUpdate:modelValue":e[11]||(e[11]=l=>r.value.note=l),clearable:""},null,8,["modelValue"])]),_:1}),a(s,null,{default:t(()=>[r.value.status==0?(g(),y(f,{key:0,disabled:n.value,onClick:e[12]||(e[12]=l=>te(Q.value)),type:"primary"},{default:t(()=>[v("保存")]),_:1},8,["disabled"])):$("",!0),a(f,{disabled:n.value,onClick:e[13]||(e[13]=l=>h.value=!1)},{default:t(()=>[v("关闭")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(G,{modelValue:C.value,"onUpdate:modelValue":e[15]||(e[15]=l=>C.value=l),title:q.value,"destroy-on-close":"",width:"1000px",draggable:"","close-on-click-modal":!1},{default:t(()=>[(g(),y(be(T.value),{query:Y.value},null,8,["query"]))]),_:1},8,["modelValue","title"])])])}}};export{je as default};
