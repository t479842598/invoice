import{ai as w,aT as p,aF as Q,c as Z,a as y,bF as V,bv as q,W as e,bD as t,H as O,aX as s,aY as ee,o as T,bi as b,U as _,b9 as k,I as x}from"./_@vue-5ba92de9.js";import le from"./index-8c83fc26.js";import"./signpassword-4eea2da9.js";import"./send-40a38f7b.js";import"./back-b4b7187d.js";import"./sethandler-b58af52c.js";import"./addwrite-c60b3d20.js";import"./solicitopinions-20dc0a72.js";import"./copyfor-f407cd89.js";import"./redirect-558725cc.js";import"./chart-28c2d9ac.js";import"./flow-show-9c68805e.js";import"./_raphael-a934d412.js";import"./__vendor-5e6ac033.js";import"./process-d4bb3c31.js";import"./urge-b4867d68.js";import"./_jquery-3a83ed9f.js";import"./_element-plus-8c7ce171.js";import"./_@element-plus-ad4c9002.js";import"./_@popperjs-c75af06c.js";const te={class:"roadui_page"},ae={class:"roadui_pagerdiv"},Ve={__name:"todo",props:{query:{type:String,default:()=>""}},setup(J){const M=w("ajax"),u=w("utils"),Y=w("qs"),E=w("ElSelectflow"),P=w("index_openmenu"),R=p("");localStorage.getItem("sobInfo")!=""&&(R.value=JSON.parse(localStorage.getItem("sobInfo")));const v=p(!1),h=p(!1),I=p([]),n=p({formtype:"开票申请"}),m=p([]),z=p({prop:"receivetime",order:"descending"}),r=p(u.getPager(z.value)),D=J;Q(()=>{c(!1)});const j=o=>{r.value.size=o,c(!1)},F=o=>{r.value.number=o,c(!1)},$=o=>{r.value.order=u.getOrder(o),c(!1)},c=o=>{o&&(r.value.number=1),h.value=!0,v.value=!0,n.value.size=r.value.size,n.value.number=r.value.number,n.value.order=r.value.order,n.value.date1=u.length(m.value)>0?m.value[0]:"",n.value.date2=u.length(m.value)>1?m.value[1]:"",M.post("/Flow/GetTodoList",Y.stringify(n.value)).then(a=>{I.value=a.data.rows,r.value.total=a.data.total,v.value=!1,h.value=!1}).catch(()=>{v.value=!1,h.value=!1})},H=o=>{localStorage.setItem("task",JSON.stringify(o)),localStorage.setItem("tasks",JSON.stringify(o)),localStorage.setItem("formid",JSON.stringify(o.formid)),localStorage.setItem("tasktype",JSON.stringify(o.taskType));let a="/flow/run/index?flowid="+o.flowId+"&stepid="+o.stepId+"&taskid="+o.id+"&groupid="+o.groupId+"&instanceid="+o.instanceId,f=0;u.query("isiframe",D.query)==1&&(a+="&nroadflow-token="+u.query("nroadflow-token",D.query),f=1);const i={title:o.stepName,id:"task_"+o.id,url:a,ico:"Edit",openMode:f,width:1500,height:820};P(i)},S=p(!0),G=()=>{S.value=!S.value};function N(){n.value={billname:"",billname:"",formtype:"",flowId:"",username:""},m.value=[],c(!0)}return(o,a)=>{const f=s("el-input"),i=s("el-form-item"),L=s("el-date-picker"),g=s("el-button"),U=s("el-form"),C=s("el-tooltip"),d=s("el-table-column"),B=s("el-tag"),W=s("el-space"),X=s("el-table"),A=s("el-pagination"),K=ee("loading");return T(),Z("div",te,[y("div",null,[V(e(U,{inline:!0},{default:t(()=>[e(i,{label:"单据号",prop:"billcode"},{default:t(()=>[e(f,{modelValue:n.value.billcode,"onUpdate:modelValue":a[0]||(a[0]=l=>n.value.billcode=l),clearable:""},null,8,["modelValue"])]),_:1}),e(i,{label:"单据名称",prop:"billname"},{default:t(()=>[e(f,{modelValue:n.value.billname,"onUpdate:modelValue":a[1]||(a[1]=l=>n.value.billname=l),clearable:""},null,8,["modelValue"])]),_:1}),e(i,{label:"单据类型",prop:"formtype"},{default:t(()=>[e(f,{modelValue:n.value.formtype,"onUpdate:modelValue":a[2]||(a[2]=l=>n.value.formtype=l),clearable:""},null,8,["modelValue"])]),_:1}),e(i,{label:"流程",prop:"flowId"},{default:t(()=>[e(b(E),{modelValue:n.value.flowId,"onUpdate:modelValue":a[3]||(a[3]=l=>n.value.flowId=l),"auth-type":4},null,8,["modelValue"])]),_:1}),e(i,{label:"经办人",prop:"username"},{default:t(()=>[e(f,{modelValue:n.value.username,"onUpdate:modelValue":a[4]||(a[4]=l=>n.value.username=l),clearable:""},null,8,["modelValue"])]),_:1}),e(i,{label:"到达日期"},{default:t(()=>[e(L,{modelValue:m.value,"onUpdate:modelValue":a[5]||(a[5]=l=>m.value=l),type:"daterange","value-format":"YYYY-MM-DD","unlink-panels":"","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:b(u).dateShortucts},null,8,["modelValue","shortcuts"])]),_:1}),e(i,null,{default:t(()=>[e(g,{type:"primary",icon:"Search",disabled:v.value,onClick:a[6]||(a[6]=l=>c(!0))},{default:t(()=>[_("查询")]),_:1},8,["disabled"]),e(g,{icon:"Refresh",style:{"text-align":"right"},onClick:N},{default:t(()=>[_("重置")]),_:1})]),_:1})]),_:1},512),[[q,S.value]]),e(U,null,{default:t(()=>[e(i,{style:{float:"left"}},{default:t(()=>[e(g,{type:"warning",plain:"",icon:"Download",onClick:o.exportexcel},{default:t(()=>[_("导出到excel")]),_:1},8,["onClick"])]),_:1}),e(i,{style:{float:"right"}},{default:t(()=>[e(C,{class:"box-item",effect:"dark",content:"隐藏搜索",placement:"top"},{default:t(()=>[e(g,{icon:"Search",style:{"text-align":"right"},circle:"",onClick:G})]),_:1}),e(C,{class:"box-item",effect:"dark",content:"刷新",placement:"top"},{default:t(()=>[e(g,{icon:"Refresh",style:{"text-align":"right"},circle:"",onClick:N})]),_:1})]),_:1})]),_:1})]),y("div",null,[V((T(),O(X,{data:I.value,stripe:r.value.tableStripe,border:r.value.tableBorder,"header-cell-style":{background:"#f4f3f9",color:"#000000"},style:{width:"100%",color:"#000000","font-size":"14px"},size:"small","highlight-current-row":r.value.tableHighlightCurrentRow,"default-sort":z.value,onSortChange:$},{default:t(()=>[e(d,{prop:"formtype",label:"单据类型",width:"120"}),e(d,{prop:"billcode",label:"单据号","min-width":"200"}),e(d,{prop:"billname",label:"单据名称","min-width":"230"},{default:t(l=>[l.row.taskType>0?(T(),O(B,{key:0,effect:"dark",style:{"margin-right":"8px","border-width":"0"},color:b(u).getTaskTypeColor(l.row.taskType)},{default:t(()=>[_(k(b(u).getTaskTypeTitle(l.row.taskType)),1)]),_:2},1032,["color"])):x("",!0),y("span",null,k(l.row.billname),1)]),_:1}),x("",!0),e(d,{prop:"username",label:"经办人",width:"100",sortable:"custom"}),x("",!0),e(d,{prop:"senderName",label:"发送人",width:"100",sortable:"custom"}),e(d,{prop:"billdate",label:"制单日期",width:"150"}),e(d,{prop:"receiveTime",label:"到达时间",width:"150",sortable:"custom"}),e(d,{prop:"status",label:"状态",width:"100",sortable:"custom"},{default:t(l=>[e(C,{placement:"left"},{content:t(()=>[y("span",null,k(b(u).length(l.row.completeTime)>0?"要求完成时间"+l.row.completeTime:"无要求完成时间"),1)]),default:t(()=>[e(B,{color:b(u).getTaskStatusColor(l.row.status),effect:"dark",style:{"border-width":"0"}},{default:t(()=>[_(k(b(u).getTaskStatusTitle(l.row.status)),1)]),_:2},1032,["color"])]),_:2},1024)]),_:1}),e(d,{prop:"stepName",label:"当前步骤",width:"150",sortable:"custom"}),e(d,{"min-width":"100",align:"center"},{default:t(l=>[e(W,null,{default:t(()=>[e(g,{type:"primary",size:"small",disabled:v.value,onClick:oe=>H(l.row)},{default:t(()=>[_("处理")]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[K,h.value]]),y("div",ae,[e(A,{currentPage:r.value.number,"onUpdate:currentPage":a[7]||(a[7]=l=>r.value.number=l),"page-size":r.value.size,"onUpdate:pageSize":a[8]||(a[8]=l=>r.value.size=l),"page-sizes":r.value.sizes,background:r.value.background,layout:r.value.layout,total:r.value.total,disabled:v.value,onSizeChange:j,onCurrentChange:F},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])])]),V(e(le,{onIndex:c},null,512),[[q,!1]])])}}};export{Ve as default};
