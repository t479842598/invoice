import{ai as z,aT as _,A,aF as Q,c as m,a as e,W as a,bD as o,bF as Z,H as B,aX as i,aY as ee,o as p,F as te,aV as le,bi as b,U as f,b9 as d,I as w}from"./_@vue-5ba92de9.js";const ae={class:"roadui_page"},oe=["onClick"],ne=e("span",null,"操作",-1),se={class:"roadui_pagerdiv"},ue={style:{"max-height":"460px",overflow:"auto",padding:"0"}},de={cellpadding:"0",cellspacing:"1",class:"roadui_infotable"},re=e("th",null,"日志标题",-1),ie={colspan:"3"},ce=e("th",{style:{width:"110px"}},"日志类型",-1),_e=e("th",{style:{width:"110px"}},"发生ip",-1),pe=e("th",null,"发生时间",-1),ve=e("th",null,"操作人员",-1),he=e("th",null,"来源URL",-1),ge={colspan:"3"},me=e("th",null,"操作URL",-1),be={colspan:"3"},fe=e("th",null,"浏览器",-1),ye={colspan:"3"},we={key:0},ke=e("th",null,"日志内容",-1),Ce={colspan:"3"},Ve={key:1},xe=e("th",null,"操作前",-1),ze={colspan:"3"},De={key:2},Te=e("th",null,"操作后",-1),Ue={colspan:"3"},Ne={key:3},Se=e("th",null,"其他内容",-1),Le={colspan:"3"},je={class:"dialog-footer"},Re={__name:"index",setup(Ae){const D=z("ajax"),r=z("utils"),R=z("qs"),c=_({}),v=_([]),h=_(!1),x=_(!1),T=_([]);_([]);const U=_({prop:"writetime",order:"descending"}),n=_(r.getPager(U.value)),N=[{value:"0",title:"登录日志"},{value:"1",title:"系统管理"},{value:"2",title:"流程管理"},{value:"3",title:"流程运行"},{value:"4",title:"表单管理"},{value:"100",title:"其他类型"},{value:"500",title:"系统异常"}],S=A(()=>u=>{const t=r.getArrayObj(N,u,"value");return t==null?u:t.title}),Y=A(()=>u=>{let t="";switch(u){case 0:t="success";break;case 100:t="info";break;case 500:t="danger";break}return t});Q(()=>{y(!1)});const F=u=>{n.value.size=u,y(!1)},O=u=>{n.value.number=u,y(!1)},P=u=>{n.value.order=r.getOrder(u),y(!1)},y=u=>{u&&(n.value.number=1),x.value=!0,h.value=!0,c.value.size=n.value.size,c.value.number=n.value.number,c.value.order=n.value.order,c.value.date1=r.length(v.value)>0?v.value[0]:"",c.value.date2=r.length(v.value)>1?v.value[1]:"",D.post("/Log/GetList",R.stringify(c.value)).then(t=>{T.value=t.data.rows,n.value.total=t.data.total,h.value=!1,x.value=!1}).catch(()=>{h.value=!1})},k=_(!1),s=_({}),L=u=>{r.length(u.id)>0&&D.post("/Log/Get?logid="+u.id).then(t=>{if(t.code==-1){r.msg("未找到日志！",t.success);return}s.value=t.data,k.value=!0}).catch(()=>{})},$=()=>{r.open("?loadurl="+encodeURIComponent("/system/log/print?logid="+s.value.id),1e3,600,"打印日志")};return(u,t)=>{const M=i("el-input"),C=i("el-form-item"),q=i("el-option"),G=i("el-select"),H=i("el-date-picker"),V=i("el-button"),I=i("el-form"),g=i("el-table-column"),j=i("el-tag"),E=i("el-table"),W=i("el-pagination"),X=i("el-dialog"),J=ee("loading");return p(),m("div",ae,[e("div",null,[a(I,{inline:!0},{default:o(()=>[a(C,{label:"标题"},{default:o(()=>[a(M,{modelValue:c.value.title,"onUpdate:modelValue":t[0]||(t[0]=l=>c.value.title=l),style:{width:"200px"},placeholder:"日志标题",clearable:""},null,8,["modelValue"])]),_:1}),a(C,{label:"类型"},{default:o(()=>[a(G,{modelValue:c.value.type,"onUpdate:modelValue":t[1]||(t[1]=l=>c.value.type=l),style:{width:"130px"},clearable:""},{default:o(()=>[(p(),m(te,null,le(N,l=>a(q,{key:l.value,label:l.title,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(C,{label:"日期"},{default:o(()=>[a(H,{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=l=>v.value=l),style:{width:"220px"},type:"daterange","value-format":"YYYY-MM-DD","unlink-panels":"","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:b(r).dateShortucts},null,8,["modelValue","shortcuts"])]),_:1}),a(C,null,{default:o(()=>[a(V,{type:"primary",disabled:h.value,onClick:t[3]||(t[3]=l=>y(!0))},{default:o(()=>[f("查询")]),_:1},8,["disabled"])]),_:1})]),_:1})]),e("div",null,[Z((p(),B(E,{data:T.value,stripe:n.value.tableStripe,border:n.value.tableBorder,style:{width:"100%"},"highlight-current-row":n.value.tableHighlightCurrentRow,"default-sort":U.value,onSortChange:P},{default:o(()=>[a(g,{prop:"title",label:"标题",sortable:"custom","show-overflow-tooltip":""},{default:o(l=>[e("a",{class:"roaduia",href:"javascript:;",onClick:K=>L(l.row)},d(l.row.title),9,oe)]),_:1}),a(g,{prop:"userName",label:"操作人",width:"120",sortable:"custom"},{default:o(l=>[b(r).length(l.row.userName)>0?(p(),B(j,{key:0,type:"info"},{default:o(()=>[f(d(l.row.userName),1)]),_:2},1024)):w("",!0)]),_:1}),a(g,{prop:"type",label:"类型",width:"150",sortable:"custom"},{default:o(l=>[a(j,{type:Y.value(l.row.type)},{default:o(()=>[f(d(S.value(l.row.type+"")),1)]),_:2},1032,["type"])]),_:1}),a(g,{prop:"writeTime",label:"时间",width:"180",sortable:"custom"}),a(g,{prop:"ipAddress",label:"ip",width:"135",sortable:"custom"}),a(g,{width:"100"},{header:o(()=>[ne]),default:o(l=>[a(V,{size:"small",disabled:h.value,type:"primary",onClick:K=>L(l.row)},{default:o(()=>[f("详情")]),_:2},1032,["disabled","onClick"])]),_:1})]),_:1},8,["data","stripe","border","highlight-current-row","default-sort"])),[[J,x.value]])]),e("div",se,[a(W,{currentPage:n.value.number,"onUpdate:currentPage":t[4]||(t[4]=l=>n.value.number=l),"page-size":n.value.size,"onUpdate:pageSize":t[5]||(t[5]=l=>n.value.size=l),"page-sizes":n.value.sizes,background:n.value.background,layout:n.value.layout,total:n.value.total,disabled:h.value,onSizeChange:F,onCurrentChange:O},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])]),a(X,{modelValue:k.value,"onUpdate:modelValue":t[7]||(t[7]=l=>k.value=l),"align-center":"",title:"查看日志详情",width:"1000px",draggable:""},{footer:o(()=>[e("span",je,[a(V,{type:"primary",onClick:t[6]||(t[6]=l=>k.value=!1)},{default:o(()=>[f("关闭")]),_:1}),a(V,{onClick:$},{default:o(()=>[f("打印")]),_:1})])]),default:o(()=>[e("div",ue,[e("table",de,[e("tr",null,[re,e("td",ie,d(s.value.title),1)]),e("tr",null,[ce,e("td",null,d(S.value(s.value.type+"")),1),_e,e("td",null,d(s.value.ipAddress=="::1"?"127.0.0.1":s.value.ipAddress),1)]),e("tr",null,[pe,e("td",null,d(s.value.writeTime),1),ve,e("td",null,d(s.value.userName),1)]),e("tr",null,[he,e("td",ge,d(s.value.referer),1)]),e("tr",null,[me,e("td",be,d(s.value.url),1)]),e("tr",null,[fe,e("td",ye,d(s.value.agent),1)]),b(r).length(s.value.contents)>0?(p(),m("tr",we,[ke,e("td",Ce,d(s.value.contents),1)])):w("",!0),b(r).length(s.value.oldContents)>0?(p(),m("tr",Ve,[xe,e("td",ze,d(s.value.oldContents),1)])):w("",!0),b(r).length(s.value.newContents)>0?(p(),m("tr",De,[Te,e("td",Ue,d(s.value.newContents),1)])):w("",!0),b(r).length(s.value.others)>0?(p(),m("tr",Ne,[Se,e("td",Le,d(s.value.others),1)])):w("",!0)])])]),_:1},8,["modelValue"])])}}};export{Re as default};
