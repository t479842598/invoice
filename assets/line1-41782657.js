import{ai as v,aT as y,aF as ne,H as U,bD as t,aX as m,o as f,W as e,U as _,a as d,c as q,aV as z,bi as N,b9 as Q,F as O}from"./_@vue-5ba92de9.js";const de={cellpadding:"0",cellspacing:"0",border:"0",class:"roadui_fromtable"},ue={colspan:"2",style:{padding:"0"}},ie={class:"roadui_note1"},re=d("th",null,"条件标签",-1),se={style:{"margin-left":"12px"}},me={cellpadding:"0",cellspacing:"0",border:"0",class:"roadui_fromtable"},pe=d("th",{style:{width:"60px"}},"方法",-1),ce=d("tr",null,[d("th"),d("td",{style:{"line-height":"28px"}},[d("div",{class:"roadui_note"},"1、方法格式为：命名空间.类名.方法名。例：RoadFlow.Web.Controllers.TestController.TestLineCondition"),d("div",{class:"roadui_note"},'2、方法返回布尔类型（bool）true或字符串类型（string）"true"、"1"时条件成立，否则条件不成立。')])],-1),_e={cellpadding:"0",cellspacing:"0",border:"0",class:"roadui_fromtable"},be=d("th",{style:{width:"60px"}},"SQL",-1),he=d("tr",null,[d("th"),d("td",{style:{"line-height":"28px"}},[d("div",{class:"roadui_note"},"1、SQL查询有返回结果表示条件成立，否则条件不成立，SQL中可以写通配符。"),d("div",{class:"roadui_note"},"2、为了提高查询性能，SQL应当只返回一行一列数据。")])],-1),ve={__name:"line1",props:{query:{type:String,default:()=>""}},setup(B){const J=v("ajax"),r=v("utils"),M=v("qs"),$=v("ElSelectorg"),C=B,E=v("design_setLineText"),R=y([{value:"=",label:"等于"},{value:"!=",label:"不等于"},{value:">",label:"大于"},{value:">=",label:"大于等于"},{value:"<",label:"小于"},{value:"<=",label:"小于等于"},{value:"like",label:"包含"},{value:"notlike",label:"不包含"},{value:"subtablesum=",label:"子表求和等于"},{value:"subtablesum!=",label:"子表求和不等于"},{value:"subtablesum>",label:"子表求和大于"},{value:"subtablesum>=",label:"子表求和大于等于"},{value:"subtablesum<",label:"子表求和小于"},{value:"subtablesum<=",label:"子表求和小于等于"}]),b=v("flowJson"),s=y({}),g=y([]),j=y([]),T=y([]),L=r.query("lineid",C.query),W=r.query("flowid",C.query),D=r.query("fromstepid",C.query);ne(()=>{if(r.length(L)>0&&r.length(b.value.lines)>0){for(let u=0;u<b.value.lines.length;u++)if(b.value.lines[u].id==L){s.value=b.value.lines[u],r.isArray(s.value.organize)||(s.value.organize=[]),h.value=s.value.organize,r.isArray(s.value.dataConditions)||(s.value.dataConditions=[]),g.value=s.value.dataConditions;break}}G()});const G=()=>{let u="";for(let o=0;o<b.value.steps.length;o++)b.value.steps[o].id==D&&(u=b.value.steps[o].formId);r.getFromFields(W,D,u).then(o=>{for(let n=0;n<o.length;n++)for(let p=0;p<o[n].fields.length;p++)j.value.push({table:o[n].id,tableName:o[n].tableName,type:o[n].type,field:o[n].fields[p].id,fieldType:o[n].fields[p].type,comment:o[n].fields[p].label});H()})},H=()=>{if(r.length(T.value)>0)return;const u=[{id:"system_organize_workrole",key:"workrole",children:!1,valueField:"value"}];J.post("/Dictionary/getMultipleOptions",M.stringify({json:JSON.stringify(u)})).then(o=>{T.value=o.data.workrole}).catch(()=>{})},X=()=>{g.value.push({key:r.createGuid(!1),khleft:"",field:"",fieldType:"",condition:"",value:"",khright:"",tjand:""})},K=u=>{r.removeArrayObj(g.value,u.key,"key")},P=u=>{const o=r.getArrayObj(j.value,u.field,"field");let n="string";r.isDef(o)&&r.length(o.fieldType)>0&&(n=o.fieldType.toLowerCase(),(n==="decimal"||n==="numeric"||n==="int"||n==="bigint"||n==="long"||n==="double"||n==="float"||n==="money"||n==="smallint"||n==="tinyint"||n==="real")&&(n="number")),u.fieldType=n},Y=u=>{E(L,u)},h=y([]),Z=u=>{const o=r.createGuid(!1);let n=0;if(r.isDef(u)){for(let i=0;i<h.value.length;i++)if(h.value[i].key==u.key){n=i;break}}let p={key:o,khleft:"",usertype:"",in1:"",users:"",selectorganize:"",khright:"",tjand:""};n===0?h.value.push(p):h.value.splice(n+1,0,p)},F=u=>{r.removeArrayObj(h.value,u.key,"key")};return(u,o)=>{const n=m("Coin"),p=m("el-icon"),i=m("el-option"),c=m("el-select"),V=m("el-input"),w=m("el-table-column"),k=m("el-button"),A=m("el-table"),I=m("el-radio"),ee=m("el-radio-group"),x=m("el-tab-pane"),le=m("office-building"),ae=m("scale-to-original"),te=m("Search"),oe=m("el-tabs");return f(),U(oe,null,{default:t(()=>[e(x,{name:"0",style:{height:"100%"}},{label:t(()=>[e(p,{class:"roadui_main_tabsvg"},{default:t(()=>[e(n)]),_:1}),_("数据条件 ")]),default:t(()=>[d("table",de,[d("tr",null,[d("td",ue,[e(A,{data:g.value,"row-key":a=>a.key,style:{width:"100%"},height:"308px"},{default:t(()=>[e(w,{label:"数据条件表达式"},{default:t(a=>[e(c,{modelValue:a.row.khleft,"onUpdate:modelValue":l=>a.row.khleft=l,placeholder:" ",clearable:"",style:{width:"55px","margin-right":"12px"}},{default:t(()=>[e(i,{value:"(",label:"("})]),_:2},1032,["modelValue","onUpdate:modelValue"]),e(c,{modelValue:a.row.field,"onUpdate:modelValue":l=>a.row.field=l,placeholder:" ",style:{width:"200px","margin-right":"12px"},filterable:"",clearable:"",onChange:l=>P(a.row)},{default:t(()=>[(f(!0),q(O,null,z(j.value,(l,S)=>(f(),U(i,{key:"f_"+S,value:(l.type=="subtable"?l.table+".":"")+l.field,label:(l.type=="subtable"?l.tableName+"-":"")+l.field+(N(r).length(l.comment)>0?"-"+l.comment:"")},{default:t(()=>[d("span",null,Q((l.type=="subtable"?l.tableName+"-":"")+l.field),1),d("span",ie,Q(N(r).length(l.comment)>0?"-"+l.comment:""),1)]),_:2},1032,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),e(c,{modelValue:a.row.condition,"onUpdate:modelValue":l=>a.row.condition=l,placeholder:" ",style:{width:"155px","margin-right":"12px"},clearable:""},{default:t(()=>[(f(!0),q(O,null,z(R.value,(l,S)=>(f(),U(i,{key:"c_"+S,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),e(V,{modelValue:a.row.value,"onUpdate:modelValue":l=>a.row.value=l,style:{width:"110px","margin-right":"12px"},clearable:""},null,8,["modelValue","onUpdate:modelValue"]),e(c,{modelValue:a.row.khright,"onUpdate:modelValue":l=>a.row.khright=l,placeholder:" ",style:{width:"55px","margin-right":"12px"},clearable:""},{default:t(()=>[e(i,{value:")",label:")"})]),_:2},1032,["modelValue","onUpdate:modelValue"]),e(c,{modelValue:a.row.tjand,"onUpdate:modelValue":l=>a.row.tjand=l,placeholder:" ",style:{width:"75px"},clearable:""},{default:t(()=>[e(i,{value:"and",label:"并且"}),e(i,{value:"or",label:"或者"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),e(w,{width:"75"},{header:t(()=>[e(k,{size:"small",type:"primary",onClick:X},{default:t(()=>[_("添加")]),_:1})]),default:t(a=>[e(k,{size:"small",type:"primary",onClick:l=>K(a.row)},{default:t(()=>[_("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","row-key"])])]),d("tr",null,[re,d("td",null,[e(V,{onChange:Y,modelValue:s.value.text,"onUpdate:modelValue":o[0]||(o[0]=a=>s.value.text=a),style:{width:"300px"},placeholder:"连线上显示的条件标签"},null,8,["modelValue"]),d("span",se,[_(" 判断方式 "),e(ee,{modelValue:s.value.judagType,"onUpdate:modelValue":o[1]||(o[1]=a=>s.value.judagType=a),style:{"vertical-align":"middle","margin-left":"12px"}},{default:t(()=>[e(I,{label:0},{default:t(()=>[_("或者")]),_:1}),e(I,{label:1},{default:t(()=>[_("并且")]),_:1})]),_:1},8,["modelValue"])])])])])]),_:1}),e(x,{name:"1",style:{height:"100%"}},{label:t(()=>[e(p,{class:"roadui_main_tabsvg"},{default:t(()=>[e(le)]),_:1}),_("组织架构 ")]),default:t(()=>[e(A,{data:h.value,"row-key":a=>a.key,style:{width:"100%"},height:"365px"},{default:t(()=>[e(w,{label:"组织架构表达式"},{default:t(a=>[e(c,{modelValue:a.row.khleft,"onUpdate:modelValue":l=>a.row.khleft=l,placeholder:" ",style:{width:"50px"},clearable:""},{default:t(()=>[e(i,{value:"(",label:"("})]),_:2},1032,["modelValue","onUpdate:modelValue"]),e(c,{modelValue:a.row.usertype,"onUpdate:modelValue":l=>a.row.usertype=l,placeholder:" ",style:{width:"85px","margin-left":"12px"},clearable:""},{default:t(()=>[e(i,{value:"0",label:"发送者"}),e(i,{value:"1",label:"发起者"})]),_:2},1032,["modelValue","onUpdate:modelValue"]),e(c,{modelValue:a.row.in1,"onUpdate:modelValue":l=>a.row.in1=l,placeholder:" ",style:{width:"85px","margin-left":"12px"},clearable:""},{default:t(()=>[e(i,{value:"0",label:"属于"}),e(i,{value:"1",label:"不属于"})]),_:2},1032,["modelValue","onUpdate:modelValue"]),e(c,{modelValue:a.row.users,"onUpdate:modelValue":l=>a.row.users=l,placeholder:" ",style:{width:"145px","margin-left":"12px"},clearable:""},{default:t(()=>[e(i,{value:"0",label:"选择组织架构"}),(f(!0),q(O,null,z(T.value,l=>(f(),U(i,{value:l.value,key:l.value,label:l.label},null,8,["value","label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),e(N($),{modelValue:a.row.selectorganize,"onUpdate:modelValue":l=>a.row.selectorganize=l,style:{width:"150px","margin-left":"12px"},placeholder:"选择组织架构"},null,8,["modelValue","onUpdate:modelValue"]),e(c,{modelValue:a.row.khright,"onUpdate:modelValue":l=>a.row.khright=l,placeholder:" ",style:{width:"50px","margin-left":"12px"},clearable:""},{default:t(()=>[e(i,{value:")",label:")"})]),_:2},1032,["modelValue","onUpdate:modelValue"]),e(c,{modelValue:a.row.tjand,"onUpdate:modelValue":l=>a.row.tjand=l,placeholder:" ",style:{width:"73px","margin-left":"12px"},clearable:""},{default:t(()=>[e(i,{value:"and",label:"并且"}),e(i,{value:"or",label:"或者"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),e(w,{width:"75"},{header:t(()=>[e(k,{size:"small",type:"primary",onClick:o[2]||(o[2]=a=>Z(null))},{default:t(()=>[_("添加")]),_:1})]),default:t(a=>[e(k,{size:"small",type:"primary",onClick:l=>F(a.row)},{default:t(()=>[_("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","row-key"])]),_:1}),e(x,{name:"2",style:{height:"100%"}},{label:t(()=>[e(p,{class:"roadui_main_tabsvg"},{default:t(()=>[e(ae)]),_:1}),_("自定义方法 ")]),default:t(()=>[d("table",me,[d("tr",null,[pe,d("td",null,[e(V,{type:"textarea",rows:8,modelValue:s.value.customMethod,"onUpdate:modelValue":o[3]||(o[3]=a=>s.value.customMethod=a),clearable:""},null,8,["modelValue"])])]),ce])]),_:1}),e(x,{name:"3",style:{height:"100%"}},{label:t(()=>[e(p,{class:"roadui_main_tabsvg"},{default:t(()=>[e(te)]),_:1}),_("SQL查询 ")]),default:t(()=>[d("table",_e,[d("tr",null,[be,d("td",null,[e(V,{type:"textarea",rows:8,modelValue:s.value.sql,"onUpdate:modelValue":o[4]||(o[4]=a=>s.value.sql=a),clearable:""},null,8,["modelValue"])])]),he])]),_:1})]),_:1})}}};export{ve as default};
