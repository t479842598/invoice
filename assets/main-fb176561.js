import{ai as c,aT as t,aF as qe,c as C,W as a,bD as i,F as $e,aV as Fe,a as v,b9 as ae,U as T,I as ne,bF as Q,bv as O,aX as m,o as h,aP as Je,aM as Me}from"./_@vue-5ba92de9.js";import{_ as Be}from"./index-823f4b27.js";import"./__vendor-5e6ac033.js";import"./_@element-plus-ad4c9002.js";import"./_crypto-js-0812dcff.js";import"./_element-plus-8c7ce171.js";import"./_@popperjs-c75af06c.js";import"./_pdfjs-dist-c04561eb.js";import"./_@microsoft-43c4e133.js";import"./_vue-codemirror-50da885a.js";const te=g=>(Je("data-v-a65add7b"),g=g(),Me(),g),Ie={style:{"background-color":"#f7f8fa"}},Ee=te(()=>v("span",{class:"custom-title"},"商品明细",-1)),Ze={style:{display:"inline-block"}},De=te(()=>v("span",{style:{color:"#409eff","vertical-align":"middle"}},"点击增加明细行",-1)),je={style:{"min-height":"400rpx","padding-right":"10px",width:"100%"}},ze={style:{"background-color":"#f8f8f8",width:"100%",display:"flex","align-items":"center","justify-content":"space-between"}},Ge={style:{padding:"5px","font-size":"12px"}},Le={style:{width:"50px","padding-left":"5px"}},Qe={style:{"background-color":"#ffffff","margin-top":"5px"}},Oe={key:0,style:{display:"flex","line-height":"10px","margin-top":"-10px","margin-bottom":"50px"}},Re={style:{"background-color":"#f8f8f8","font-size":"12px"}},We={class:"subbtn"},Xe={__name:"main",props:{query:{type:String,default:()=>""}},setup(g,{expose:ue}){const se=c("indexm_openurl");c("indexm_backpage"),c("indexm_refreshpage"),c("indexm_userinfo");const _=t("");localStorage.getItem("sobInfo")!=""&&(_.value=JSON.parse(localStorage.getItem("sobInfo")));const y=c("ajax"),f=c("utils");c("config");const R=c("qs");c("app");const S=g;f.getQuery(S.query),t(f.query("JAZS",S.query));const b=t(!1),U=t(0),P=t(f.query("id",S.query)),N=t(!1),x=t(!1),V=t(!1),w=t(!1),k=t(!1),A=t(""),q=t(""),$=t(""),F=t([]),J=t([]),M=t([]),B=t([]),u=t([]),I=t([]),W=t(""),re=t(null),E=t([]),n=t({invoiceTypeName:"",serialNo:"",sellerName:"",sellerTaxNo:"",buyerName:"",buyerTaxNo:"",buyerEmail:"",invoiceTotalPriceTax:"",remarks:""}),ie=[{name:"差额征税-全额开票"},{name:"差额征税-差额开票"}],de=[{name:"全电专用发票",value:"01"},{name:"全电普通发票",value:"02"}],me=[{name:"销售自己使用过的固定资产"},{name:"住房租赁"}];qe(()=>{Te(U.value,_.value),Ve(),we(),ve()});function ve(){y.post("/invoice_BaseInfo/GetAll",R.stringify({classtype:"invoiceSpecial"})).then(l=>{l.success?(E.value=l.data.main.map(e=>({text:e.name,value:e.code})),F.value=E.value):f.msg(l.msg,"warning",!1)}).catch(l=>{})}const pe=l=>{n.value.JAZS=l.name,k.value=!1},ce=l=>{n.value.taxation=l.name,b.value=!1};function fe(){F.value=E.value.filter(l=>l.text.includes(A.value))}const ge=l=>{n.value.invoiceTypeName=l.name,n.value.invoiceTypeCode=l.value,V.value=!1},ye=({selectedOptions:l})=>{n.value.invoiceSpecialMarkName=l[0].text,n.value.invoiceSpecialMark=l[0].value,w.value=!1},be=({selectedOptions:l})=>{n.value.buyerName=l[0].text,N.value=!1},X=t(""),Ne=({selectedOptions:l,selectedIndexes:e})=>{u.value[X.value].goodsName=l[0].text,x.value=!1},xe=l=>{X.value=l},Ve=()=>{y.post("/invoiceproduct/GetAll?srcorgid="+_.value.id,{}).then(l=>{l.success?(I.value=l.data.product.map(e=>({id:e.id,value:e.goodsName,label:e.goodsName,text:e.goodsName})),M.value=I.value):f.msg(l.msg,"warning",!1)}).catch(l=>{})},we=()=>{y.post("/Customer/GetAllCustomer?srcorgid="+_.value.id,{}).then(l=>{l.success?(B.value=l.data.customer.map(e=>({value:e.buyerName,label:e.buyerName,text:e.buyerName,buyerEmail:e.Email,buyerTaxno:e.buyerTaxno,buyerBankNumber:e.BankAccount,buyerBankName:e.BankName,buyerPhone:e.Phone,buyerAddress:e.buyerAddress})),J.value=B.value):f.msg(l.msg,"warning",!1)}).catch(l=>{})};function ke(){J.value=B.value.filter(l=>l.text.includes(q.value))}function Ce(){M.value=I.value.filter(l=>l.text.includes($.value))}const Te=(l,e)=>{y.post("/Invoice/GetInvoiceApply?srcorgid="+e.id,R.stringify({id:l,type:"手工开票",sellerName:e.accountname,sellerTaxNo:e.taxno,sellerAddress:e.address,sellerPhone:e.phone,sellerBankName:e.openbank,sellerBankNumber:e.bankaccount})).then(p=>{p.success?(n.value=p.data.invoicemain,U.value=p.data.invoicemain.id,u.value=p.data.invoicedetail,n.value.sellerName=e.accountname,n.value.sellerTaxNo=e.taxno):f.msg(p.msg,"warning",!1)}).catch(p=>{})},H=()=>{};function K(){y.post("/Flow/GetLongId",{}).then(l=>{W.value=l.data;const e={goodsLineNo:u.value.length+1,id:W.value,mainid:U.value,goodsCode:"",goodsName:"",goodsQuantity:"",goodsTotalPrice:"",goodsPrice:"",goodsTaxRate:"",notaxamount:"",goodsTotalTax:""};u.value.push(e)})}function he(l){u.value.splice(l,1);for(let e=0;e<u.value.length;e++)u.value[e].goodsLineNo=e+1}function Z(){for(let l of u.value){let e=Number(l.goodsQuantity),p=Number(l.goodsPrice);e&&p&&(l.goodsTotalPrice=(e*p).toFixed(2),l.goodsTotalTax=(l.goodsTotalPrice*(1+l.goodsTaxRate/100)-l.goodsTotalPrice).toFixed(2),l.notaxamount=(l.goodsTotalPrice-l.goodsTotalTax).toFixed(2))}n.value.invoiceTotalPriceTax=u.value.reduce((l,e)=>l+Number(e.goodsTotalPrice),0).toFixed(2)}const Y={id:"index_home",url:"/mobile/home.vue"};function _e(){se(Y.id,Y.url)}function Se(){localStorage.setItem("invoiceJSON",JSON.stringify(n.value)),localStorage.setItem("invoicedetailsJSON",JSON.stringify(u.value))}return ue({savecontent:Se}),(l,e)=>{const p=m("van-nav-bar"),s=m("van-field"),D=m("van-action-sheet"),j=m("van-search"),z=m("van-picker"),G=m("van-popup"),ee=m("van-cell-group"),le=m("van-form"),oe=m("van-icon"),Ue=m("van-cell"),Pe=m("el-button"),Ae=m("el-popconfirm"),L=m("van-button");return h(),C("div",Ie,[a(p,{title:"开票流程申请","left-text":"返回","left-arrow":"",onClickLeft:_e}),a(le,{ref:"formref"},{default:i(()=>[a(ee,null,{default:i(()=>[a(s,{modelValue:n.value.invoiceTypeName,"onUpdate:modelValue":e[0]||(e[0]=o=>n.value.invoiceTypeName=o),"is-link":"",readonly:"",name:"picker",label:"发票类型",placeholder:"选择发票类型",onClick:e[1]||(e[1]=o=>V.value=!0),required:"","show-error":"","show-error-message":"",rules:l.rules},null,8,["modelValue","rules"]),a(D,{show:V.value,"onUpdate:show":e[2]||(e[2]=o=>V.value=o),actions:de,description:"发票类型",onSelect:ge,"cancel-text":"取消",onCancel:e[3]||(e[3]=o=>V.value=!1)},null,8,["show"]),a(s,{modelValue:n.value.invoiceSpecialMarkName,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.invoiceSpecialMarkName=o),"is-link":"",readonly:"",name:"picker",label:"特定业务",placeholder:"选择特定业务类型",onClick:e[5]||(e[5]=o=>w.value=!0)},null,8,["modelValue"]),a(G,{show:w.value,"onUpdate:show":e[8]||(e[8]=o=>w.value=o),position:"bottom"},{default:i(()=>[a(j,{modelValue:A.value,"onUpdate:modelValue":[e[6]||(e[6]=o=>A.value=o),fe],modelModifiers:{trim:!0},placeholder:"特定业务搜索"},null,8,["modelValue"]),a(z,{columns:F.value,onConfirm:ye,onCancel:e[7]||(e[7]=o=>w.value=!1)},null,8,["columns"])]),_:1},8,["show"]),a(s,{modelValue:n.value.taxation,"onUpdate:modelValue":e[9]||(e[9]=o=>n.value.taxation=o),"is-link":"",readonly:"",name:"picker",label:"差额征税",placeholder:"选择差额征税类型",onClick:e[10]||(e[10]=o=>b.value=!0)},null,8,["modelValue"]),a(D,{show:b.value,"onUpdate:show":e[11]||(e[11]=o=>b.value=o),actions:ie,description:"差额征税类型",onSelect:ce,"cancel-text":"取消",onCancel:e[12]||(e[12]=o=>b.value=!1)},null,8,["show"]),a(s,{modelValue:n.value.JAZS,"onUpdate:modelValue":e[13]||(e[13]=o=>n.value.JAZS=o),"is-link":"",readonly:"",name:"picker",label:"减按征税",placeholder:"选择减按征税类型",onClick:e[14]||(e[14]=o=>k.value=!0)},null,8,["modelValue"]),a(D,{show:k.value,"onUpdate:show":e[15]||(e[15]=o=>k.value=o),actions:me,description:"差额征税类型",onSelect:pe,"cancel-text":"取消",onCancel:e[16]||(e[16]=o=>k.value=!1)},null,8,["show"]),a(s,{modelValue:n.value.serialNo,"onUpdate:modelValue":e[17]||(e[17]=o=>n.value.serialNo=o),label:"流水号",readonly:""},null,8,["modelValue"]),a(s,{modelValue:n.value.sellerName,"onUpdate:modelValue":e[18]||(e[18]=o=>n.value.sellerName=o),label:"销方名称",readonly:""},null,8,["modelValue"]),a(s,{modelValue:n.value.sellerTaxNo,"onUpdate:modelValue":e[19]||(e[19]=o=>n.value.sellerTaxNo=o),label:"税号",readonly:""},null,8,["modelValue"]),a(s,{modelValue:n.value.buyerName,"onUpdate:modelValue":e[20]||(e[20]=o=>n.value.buyerName=o),"is-link":"",readonly:"",name:"picker",label:"购方名称",placeholder:"请选择购方名称",onClick:e[21]||(e[21]=o=>N.value=!0),required:"","show-error":"","show-error-message":"",rules:[{required:!0,message:"购方名称不能为空",trigger:"onChange"}]},null,8,["modelValue"]),a(G,{show:N.value,"onUpdate:show":e[24]||(e[24]=o=>N.value=o),position:"bottom"},{default:i(()=>[a(j,{modelValue:q.value,"onUpdate:modelValue":[e[22]||(e[22]=o=>q.value=o),ke],modelModifiers:{trim:!0},placeholder:"购方名称"},null,8,["modelValue"]),a(z,{columns:J.value,onConfirm:be,onCancel:e[23]||(e[23]=o=>N.value=!1)},null,8,["columns"])]),_:1},8,["show"]),a(s,{modelValue:n.value.buyerTaxNo,"onUpdate:modelValue":e[25]||(e[25]=o=>n.value.buyerTaxNo=o),label:"购方税号",required:"","show-error":"","show-error-message":"",rules:[[{required:!0,message:"购方税号"}]]},null,8,["modelValue"]),a(s,{modelValue:n.value.buyerEmail,"onUpdate:modelValue":e[26]||(e[26]=o=>n.value.buyerEmail=o),label:"邮箱"},null,8,["modelValue"]),a(s,{modelValue:n.value.invoiceTotalPriceTax,"onUpdate:modelValue":e[27]||(e[27]=o=>n.value.invoiceTotalPriceTax=o),label:"价税合计",readonly:""},null,8,["modelValue"]),a(s,{modelValue:n.value.remarks,"onUpdate:modelValue":e[28]||(e[28]=o=>n.value.remarks=o),rows:"1",autosize:"",label:"备注",type:"textarea",placeholder:""},null,8,["modelValue"])]),_:1})]),_:1},512),a(Ue,null,{title:i(()=>[Ee,u.value.length==0?(h(),C("div",{key:0,style:{display:"inline-flex",cursor:"pointer"},onClick:K},[v("div",Ze,[a(oe,{name:"plus",color:"#409EFF"})]),De])):ne("",!0)]),"right-icon":i(()=>[]),_:1}),(h(!0),C($e,null,Fe(u.value,(o,d)=>(h(),C("view",{key:d,style:{"border-radius":"5px",width:"100%"}},[v("view",je,[v("view",ze,[v("span",Ge,"商品明细"+ae(d+1),1),v("view",Le,[a(Ae,{title:"确定要删除商品明细"+(d+1)+"吗？",onConfirm:r=>he(d)},{reference:i(()=>[a(Pe,{type:"danger",size:"small",link:""},{default:i(()=>[T("删除 ")]),_:1})]),_:2},1032,["title","onConfirm"])])]),v("view",Qe,[a(le,{ref_for:!0,ref:"detailRef"},{default:i(()=>[a(ee,null,{default:i(()=>[a(s,{modelValue:u.value[d].goodsName,"onUpdate:modelValue":r=>u.value[d].goodsName=r,"is-link":"",readonly:"",name:"picker",label:"商品名称",placeholder:"请选择商品名称",onClick:e[29]||(e[29]=r=>x.value=!0),rules:[{required:!0,message:"商品名称不能为空",trigger:"onChange"}]},null,8,["modelValue","onUpdate:modelValue"]),a(G,{show:x.value,"onUpdate:show":e[32]||(e[32]=r=>x.value=r),position:"bottom"},{default:i(()=>[a(j,{modelValue:$.value,"onUpdate:modelValue":[e[30]||(e[30]=r=>$.value=r),Ce],modelModifiers:{trim:!0},placeholder:"购方名称"},null,8,["modelValue"]),a(z,{columns:M.value,ref_for:!0,ref_key:"pickerref",ref:re,onConfirm:Ne,onChange:r=>xe(d),onCancel:e[31]||(e[31]=r=>x.value=!1)},null,8,["columns","onChange"])]),_:2},1032,["show"]),a(s,{modelValue:u.value[d].goodsQuantity,"onUpdate:modelValue":r=>u.value[d].goodsQuantity=r,modelModifiers:{trim:!0},onChange:Z,type:"number",label:"数量"},null,8,["modelValue","onUpdate:modelValue"]),a(s,{modelValue:u.value[d].goodsPrice,"onUpdate:modelValue":r=>u.value[d].goodsPrice=r,modelModifiers:{trim:!0},onChange:Z,type:"number",label:"单价"},null,8,["modelValue","onUpdate:modelValue"]),a(s,{modelValue:u.value[d].goodsTotalPrice,"onUpdate:modelValue":r=>u.value[d].goodsTotalPrice=r,modelModifiers:{trim:!0},onChange:Z,label:"价税合计",readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1536)])])]))),128)),u.value.length>0?(h(),C("div",Oe,[v("view",Re,[v("span",null,"价税合计(元)："+ae(n.value.invoiceTotalPriceTax),1)]),v("view",{onClick:K,class:"addtitle"},[a(oe,{name:"plus",color:"#409EFF",size:"16"}),T(" 增加商品明细 ")])])):ne("",!0),v("view",We,[Q(a(L,{type:"primary",style:{"border-radius":"0",width:"100vw"},onClick:H},{default:i(()=>[T("保存")]),_:1},512),[[O,P.value==0]]),Q(a(L,{type:"primary",style:{"border-radius":"0",width:"61.8vw"},onClick:H},{default:i(()=>[T("保存")]),_:1},512),[[O,P.value!=0]]),Q(a(L,{type:"danger",style:{"border-radius":"0",width:"38.2vw"},onClick:e[33]||(e[33]=()=>{})},{default:i(()=>[T("删除")]),_:1},512),[[O,P.value!=0]])])])}}},sl=Be(Xe,[["__scopeId","data-v-a65add7b"]]);export{sl as default};
