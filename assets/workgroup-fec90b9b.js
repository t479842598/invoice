import{D as G}from"./_vuedraggable-a473ce37.js";import{ai as f,aT as g,aF as A,aK as H,by as K,c as M,W as s,bD as o,aX as y,o as _,bi as m,H as w,U as i,b9 as N,I as h,a as q}from"./_@vue-5ba92de9.js";import"./__vendor-5e6ac033.js";const O={class:"roadui_draggable_item"},X={class:"dialog-footer"},Z={__name:"workgroup",props:{query:{type:String,default:()=>""}},setup(R){const v=f("ajax"),t=f("utils"),V=f("qs"),T=f("ElSelectorg"),x=f("openPage"),C=f("updateWgTreeNode"),I=g(null),a=g({status:0}),j={name:[{required:!0,message:"请输入名称",trigger:"blur"}]},S=R,u=g(!1);let p=t.query("workgroupid",S.query);const D=g(null);A(()=>{W(),document.body.ondrop=function(l){try{l.preventDefault(),l.stopPropagation()}catch{}}}),H(()=>{document.body.ondrop=null}),K(()=>S.query,l=>{p=t.query("workgroupid",l),W()});const W=()=>{t.length(p)!==0&&v.post("/Workgroup/Get?workgroupid="+p).then(l=>{if(l.code==-1){t.msg("未找到工作组！",l.success),x({type:-1},"");return}a.value=l.data,D.value.initTitle(l.data.members)}).catch(()=>{})},B=()=>{a.value={id:a.value.id}},U=async(l,e)=>{l&&await l.validate(d=>{d&&t.confirm("您确定要保存"+(e===1?"为下级":"")+"吗？",()=>{u.value=!0,v.post("/Workgroup/Save?workgroupid="+(p||"")+"&savetype="+(e||"0"),V.stringify(a.value)).then(c=>{u.value=!1;let n=c.msg;t.length(n)===0&&(n=c.code==1?"数据验证错误！":c.success?"保存成功！":"保存失败！"),t.msg(n,c.success),c.success&&C(e===1?a.value.id:a.value.parentId)}).catch(()=>{u.value=!1})})})},F=()=>{t.confirm("您确定要删除吗？",()=>{u.value=!0,v.post("/Workgroup/Delete",V.stringify({workgroupid:p})).then(l=>{let e=l.msg;t.length(e)===0&&(l.success?e="删除成功！":l.code==1?e="id错误！":l.code==2?e="未找到要删除的工作组！":l.code==3&&(e="不能删除根工作组！")),t.msg(e,l.success),l.success&&C(a.value.parentId),u.value=!1}).catch(()=>{u.value=!1})})},b=g(!1),k=g([]),L=()=>{v.post("/Workgroup/GetSortItems?workgroupid="+p).then(l=>{l.success?(k.value=l.data,b.value=!0):t.msg("加载工作组错误！",!1)}).catch(()=>{})},P=()=>{let l=[];for(let e=0;e<k.value.length;e++)l.push(k.value[e].id);v.post("/Workgroup/SaveSort",V.stringify({workgroups:l.join(",")})).then(e=>{let d=e.msg;t.length(d)===0&&(d=e.success?"保存成功！":"保存失败！"),t.msg(d,e.success),e.success&&(b.value=!1,C(a.value.parentId))}).catch(()=>{})},$=()=>{x({type:0},"?organizeid=w_"+p+"&organizetype=6&returnurl="+encodeURIComponent(S.query))};return(l,e)=>{const d=y("el-form-item"),c=y("el-input"),n=y("el-button"),z=y("el-form"),E=y("el-dialog");return _(),M("div",null,[s(z,{model:a.value,ref_key:"ruleFormRef",ref:I,rules:j,"label-width":"100px"},{default:o(()=>[m(t).length(a.value.id)>0&&a.value.id!=m(t).emptyLong?(_(),w(d,{key:0,label:"工作组id",class:"roadui_formfont"},{default:o(()=>[i(N(a.value.id),1)]),_:1})):h("",!0),s(d,{label:"名称",prop:"name"},{default:o(()=>[s(c,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=r=>a.value.name=r),clearable:""},null,8,["modelValue"])]),_:1}),s(d,{label:"成员",prop:"members"},{default:o(()=>[s(m(T),{modelValue:a.value.members,"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.members=r),ref_key:"orgRef",ref:D,style:{width:"100%"},"select-type":"unit,dept,station,user",clearable:""},null,8,["modelValue"])]),_:1}),s(d,{label:"备注",prop:"note"},{default:o(()=>[s(c,{modelValue:a.value.note,"onUpdate:modelValue":e[2]||(e[2]=r=>a.value.note=r),type:"textarea",rows:3,clearable:""},null,8,["modelValue"])]),_:1}),s(d,{label:""},{default:o(()=>[s(n,{type:"primary",disabled:u.value,onClick:B},{default:o(()=>[i("清空")]),_:1},8,["disabled"]),s(n,{type:"primary",disabled:u.value,onClick:e[3]||(e[3]=r=>U(I.value,0))},{default:o(()=>[i("保存")]),_:1},8,["disabled"]),s(n,{type:"primary",disabled:u.value,onClick:e[4]||(e[4]=r=>U(I.value,1))},{default:o(()=>[i("保存为下级")]),_:1},8,["disabled"]),a.value.parentId>m(t).emptyLong?(_(),w(n,{key:0,type:"danger",disabled:u.value,onClick:F},{default:o(()=>[i("删除")]),_:1},8,["disabled"])):h("",!0),a.value.parentId>m(t).emptyLong?(_(),w(n,{key:1,type:"info",disabled:u.value,onClick:L},{default:o(()=>[i("排序")]),_:1},8,["disabled"])):h("",!0),a.value.parentId>m(t).emptyLong?(_(),w(n,{key:2,type:"primary",disabled:u.value,onClick:$},{default:o(()=>[i("菜单授权")]),_:1},8,["disabled"])):h("",!0)]),_:1})]),_:1},8,["model"]),s(E,{modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=r=>b.value=r),title:"排序","align-center":"","destroy-on-close":"",width:"550px",draggable:"","close-on-click-modal":!1},{footer:o(()=>[q("span",X,[s(n,{disabled:u.value,type:"primary",onClick:P},{default:o(()=>[i("保存")]),_:1},8,["disabled"]),s(n,{disabled:u.value,onClick:e[5]||(e[5]=r=>b.value=!1)},{default:o(()=>[i("关闭")]),_:1},8,["disabled"])])]),default:o(()=>[s(m(G),{list:k.value,"item-key":"id",animation:200,group:{name:"orgsort",pull:!0},class:"roadui_draggable_chosen"},{item:o(({element:r})=>[q("div",O,[q("div",null,N(r.name),1)])]),_:1},8,["list"])]),_:1},8,["modelValue"])])}}};export{Z as default};
