import{a as Q,_ as $e}from"./index-823f4b27.js";import{cC as We}from"./__vendor-5e6ac033.js";import{d as Xe,ai as _,aT as o,aF as Qe,by as Ze,b5 as el,c as T,a as x,W as t,bD as s,bF as ll,H as N,au as al,aX as v,aY as tl,aN as me,o as f,U as V,F as B,aV as Z,I as J,bi as ee,Y as le,aP as ol,aM as sl}from"./_@vue-5ba92de9.js";import"./_@element-plus-ad4c9002.js";import"./_crypto-js-0812dcff.js";import"./_element-plus-8c7ce171.js";import"./_@popperjs-c75af06c.js";import"./_pdfjs-dist-c04561eb.js";import"./_@microsoft-43c4e133.js";import"./_vue-codemirror-50da885a.js";const nl=E=>(ol("data-v-38bccacb"),E=E(),sl(),E),ul={class:"form-container"},rl={class:"table-container"},il={class:"roadui_pagerdiv"},dl={class:"detail-container"},cl=nl(()=>x("h3",{class:"before"},"商品明细",-1)),vl={class:"table-bottom"},fl={class:"roadui_pagerdiv"},pl=Xe({__name:"invoiced",setup(E){const be=le(()=>Q(()=>import("./tasknoflow-2e835abc.js"),["./tasknoflow-2e835abc.js","./index-823f4b27.js","./__vendor-5e6ac033.js","./_@vue-5ba92de9.js","./__vendor-693c365c.css","./_@element-plus-ad4c9002.js","./_crypto-js-0812dcff.js","./_element-plus-8c7ce171.js","./_@popperjs-c75af06c.js","./_element-plus-7d03f811.css","./_pdfjs-dist-c04561eb.js","./_@microsoft-43c4e133.js","./_vue-codemirror-50da885a.js","./index-2ccff9e2.css","./tasknoflow-0d08588d.css"],import.meta.url)),ge=le(()=>Q(()=>import("./Transfer-49f22145.js"),["./Transfer-49f22145.js","./index-823f4b27.js","./__vendor-5e6ac033.js","./_@vue-5ba92de9.js","./__vendor-693c365c.css","./_@element-plus-ad4c9002.js","./_crypto-js-0812dcff.js","./_element-plus-8c7ce171.js","./_@popperjs-c75af06c.js","./_element-plus-7d03f811.css","./_pdfjs-dist-c04561eb.js","./_@microsoft-43c4e133.js","./_vue-codemirror-50da885a.js","./index-2ccff9e2.css","./Transfer-04dcaf60.css"],import.meta.url)),_e=le(()=>Q(()=>import("./Transfer-49f22145.js"),["./Transfer-49f22145.js","./index-823f4b27.js","./__vendor-5e6ac033.js","./_@vue-5ba92de9.js","./__vendor-693c365c.css","./_@element-plus-ad4c9002.js","./_crypto-js-0812dcff.js","./_element-plus-8c7ce171.js","./_@popperjs-c75af06c.js","./_element-plus-7d03f811.css","./_pdfjs-dist-c04561eb.js","./_@microsoft-43c4e133.js","./_vue-codemirror-50da885a.js","./index-2ccff9e2.css","./Transfer-04dcaf60.css"],import.meta.url)),h=_("ajax"),m=_("utils");_("config"),_("index_userinfo");const k=_("qs");_("index_openmenu"),_("index_removetab");const he=_("index_refreshtab"),p=o(!1),ye=o(!1),y=o(!1),D=o(!1),F=o({prop:"日期",order:"ascending"}),ae=o({prop:"商品编号",order:"ascending"}),te=o("");localStorage.getItem("sobInfo")!=""&&(te.value=JSON.parse(localStorage.getItem("sobInfo")));const r=o(m.getPager(F.value)),d=o(m.getPager(ae.value)),we=o([]),M=o(!1),Ce=o(0),Ve=o(0),H=o("");o(!1);const A=o(""),j=o(!1),q=o(!1),oe=o({}),L=o(!1),xe=o("已开票"),S=o({no:""});Qe(()=>{g(!1)});const i=o({单据号:"",客户名称:"",日期:"",制单人:"",发票号:""}),b=o();o("01");const se=o([]);o([{id:"01",label:"全电专用发票"},{id:"02",label:"全电普通发票"}]),Ze(b,(l,e)=>{g(!0)});const w=o([]),C=o([]),K=o(),$=o(),ne=o([]),W=o([]),g=async l=>{try{l&&(r.value.number=1),y.value=!0,D.value=!0,p.value=!0,i.value.size=r.value.size,i.value.number=r.value.number,i.value.order=r.value.order,i.value.connid=b.value;const e=await h.post("/SaleInvoice/GetOpenedSaleMain",k.stringify(i.value));ne.value=e.data.rows,H.value=e.data.rows[0].id,r.value.total=e.data.total,p.value=!1,y.value=!1,D.value=!1,await ke(),R()}catch{p.value=!1,y.value=!1}},ue=o([]),re=o([]),I=o([]),z=o([]),ke=async()=>{try{y.value=!0,D.value=!0;const l=await h.post("/cn_columns/Get",k.stringify({connid:b.value}));w.value=l.data.maincolumns,C.value=l.data.detailcolumns,ue.value=l.data.maincolumns.filter(e=>e.isvisible===!1),I.value=l.data.maincolumns.filter(e=>e.isvisible===!0),K.value=w.value.map(e=>e.label),re.value=l.data.detailcolumns.filter(e=>e.isvisible===!1),z.value=l.data.detailcolumns.filter(e=>e.isvisible===!0),$.value=C.value.map(e=>e.label),K.value=K.value.filter(e=>{const n=w.value.find(u=>u.label===e);return n&&n.isvisible}),$.value=$.value.filter(e=>{const n=C.value.find(u=>u.label===e);return n&&n.isvisible}),y.value=!1,D.value=!1}catch{p.value=!1,y.value=!1}},De=o("");el(null);const X=o(!1),Se=()=>{M.value=!0},Ie=()=>{g(!0),M.value=!1},ze=()=>{We.debounce(()=>{i.value={单据号:"",客户名称:"",日期:""},g(!0)},300)()},Te=()=>{i.value={单据号:"",客户名称:"",日期:""}},ie=()=>{S.value.no="",L.value=!1},Ue=(l,e)=>{S.value.no=l,A.value=e,L.value=!0},Pe=async()=>{try{(await h.post("/SaleInvoice/UpdateInvoiceNo",k.stringify({id:A.value,invoiceno:S.value.no,connid:b.value,type:xe.value}))).success&&(m.msg("保存成功","success",!1),ie(),g(!1))}catch(l){m.msg(l.message,"error",!1)}},Oe=async()=>{try{const l=await h.post("user/GetUserAccountByUser?srcorgid="+te.value.id,k.stringify({userid:oe.value.userId}));l.success&&l.data.length>0&&(b.value=l.data[0].id,se.value=l.data)}catch{}};(()=>{h.post("/Home/GetIndexInfo").then(l=>{l.success&&(oe.value=l.data.userInfo,Oe())}).catch(()=>{})})();const Ne=async()=>{try{(await h.post("/cn_columns/Save",k.stringify({maincolumnsJSON:JSON.stringify(w.value),detailcolumnsJSON:JSON.stringify(C.value)}))).success&&(m.msg("保存成功","success",!1),he())}catch(l){m.msg(l.message,"error",!1)}},Be=l=>{r.value.size=l,g(!1)},Ee=l=>{r.value.number=l,g(!1)},Me=l=>{d.value.size=l,R()},Ae=l=>{d.value.number=l,R()},Le=(l,e)=>{l!=null&&(H.value=l.id,d.value.number=1,R())},de=o({}),R=async()=>{D.value=!0,de.value={saleid:H.value,connid:b.value,size:d.value.size,number:d.value.number,order:d.value.order};try{const l=await h.post("/SaleInvoice/GetSaleDetailMain",k.stringify(de.value));W.value=l.data.rows,d.value.total=l.data.total}catch(l){m.msg(l.message,"error",!1)}finally{D.value=!1}},Re=l=>{we.value=l};function ce({row:l,column:e,rowIndex:n,columnIndex:u}){return{color:"#000",textAlign:"center"}}function Ye(){W.value=[]}const Ge=()=>{j.value=!0},Je=()=>{q.value=!0};function Fe(l){w.value=w.value.map(e=>{const n={...e},u=l.find(c=>c.label===n.label);if(u)n.isvisible=!0,u.label===n.label&&!I.value.some(c=>c.label===n.label)&&I.value.push(n);else{n.isvisible=!1;const c=I.value.findIndex(U=>U.label===n.label);c!==-1&&I.value.splice(c,1)}return n})}function He(l){C.value=C.value.map(e=>{const n={...e},u=l.find(c=>c.label===n.label);if(u)n.isvisible=!0,u.label===n.label&&!z.value.some(c=>c.label===n.label)&&z.value.push(n);else{n.isvisible=!1;const c=z.value.findIndex(U=>U.label===n.label);c!==-1&&z.value.splice(c,1)}return n})}const je=l=>{r.value.order=m.getOrder(l),g(!1)};return me("view_dialogshow",X),me("Savecolum",Ne),(l,e)=>{const n=v("el-button"),u=v("el-form-item"),c=v("el-option"),U=v("el-select"),ve=v("el-popover"),Y=v("el-form"),G=v("el-table-column"),fe=v("el-table"),pe=v("el-pagination"),P=v("el-dialog"),O=v("el-input"),qe=v("el-date-picker"),Ke=tl("loading");return f(),T("div",null,[x("div",ul,[t(Y,{inline:!0},{default:s(()=>[t(u,null,{default:s(()=>[t(n,{type:"primary",disabled:p.value,onClick:Se,icon:"Search"},{default:s(()=>[V("查询")]),_:1},8,["disabled"]),t(n,{type:"success",disabled:p.value,onClick:ze,icon:"Refresh"},{default:s(()=>[V("刷新")]),_:1},8,["disabled"])]),_:1}),t(u,{label:"账套选择",prop:"sobItems"},{default:s(()=>[t(U,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),onChange:Ye,disabled:p.value,placeholder:"请选择账套",style:{width:"200px"}},{default:s(()=>[(f(!0),T(B,null,Z(se.value,a=>(f(),N(c,{key:a.id,label:a.label,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),t(u,{style:{float:"right"}},{default:s(()=>[t(ve,{placement:"top-start",title:"显隐列",width:"150",trigger:"hover",content:"点击打开"},{reference:s(()=>[t(n,{icon:"Tools",style:{"text-align":"right"},circle:"",onClick:Ge})]),_:1})]),_:1})]),_:1})]),x("div",rl,[ll((f(),N(fe,al({data:ne.value,key:Ce.value,stripe:r.value.tableStripe,border:"","highlight-current-row":r.value.tableHighlightCurrentRow,style:{width:"100%",height:"30vh",color:"#000"},"header-cell-style":ce,"default-sort":F.value,onSelectionChange:Re},l.$attrs,{onCurrentChange:Le,onSortChange:je}),{default:s(()=>[J("",!0),t(G,{type:"selection",width:"55",align:"center"}),(f(!0),T(B,null,Z(w.value,a=>(f(),T(B,null,[a.isvisible?(f(),N(G,{key:a.prop,prop:a.label,label:a.label,align:"center","min-width":"210%","default-sort":F.value,sortable:a.sortable,fit:"","show-overflow-tooltip":""},null,8,["prop","label","default-sort","sortable"])):J("",!0)],64))),256)),t(G,{label:"操作",align:"center",width:"120",fixed:"right"},{default:s(a=>[t(n,{type:"primary",size:"small",onClick:bl=>Ue(a.row.发票号,a.row.id)},{default:s(()=>[V("回写发票号")]),_:2},1032,["onClick"])]),_:1})]),_:1},16,["data","stripe","highlight-current-row","default-sort"])),[[Ke,y.value]])]),x("div",il,[t(pe,{currentPage:r.value.number,"onUpdate:currentPage":e[1]||(e[1]=a=>r.value.number=a),"page-size":r.value.size,"onUpdate:pageSize":e[2]||(e[2]=a=>r.value.size=a),"page-sizes":r.value.sizes,background:r.value.background,layout:r.value.layout,total:r.value.total,disabled:p.value,onSizeChange:Be,onCurrentChange:Ee},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])]),x("div",dl,[t(Y,{inline:!0},{default:s(()=>[t(u,null,{default:s(()=>[cl]),_:1}),t(u,{style:{float:"right","margin-top":"10px"}},{default:s(()=>[t(ve,{placement:"top-start",title:"显隐列",width:"150",trigger:"hover",content:"点击打开"},{reference:s(()=>[t(n,{icon:"Tools",style:{"text-align":"right"},circle:"",onClick:Je})]),_:1})]),_:1})]),_:1})]),x("div",vl,[(f(),N(fe,{data:W.value,key:Ve.value,align:"center",stripe:r.value.tableStripe,border:"","highlight-current-row":r.value.tableHighlightCurrentRow,style:{width:"100%",height:"27vh",color:"#000"},"header-cell-style":ce,"default-sort":ae.value},{default:s(()=>[J("",!0),(f(!0),T(B,null,Z(C.value,a=>(f(),T(B,null,[a.isvisible?(f(),N(G,{prop:a.prop,label:a.label,width:a.width,key:a.prop,align:"center"},null,8,["prop","label","width"])):J("",!0)],64))),256))]),_:1},8,["data","stripe","highlight-current-row","default-sort"]))]),x("div",fl,[t(pe,{currentPage:d.value.number,"onUpdate:currentPage":e[3]||(e[3]=a=>d.value.number=a),"page-size":d.value.size,"onUpdate:pageSize":e[4]||(e[4]=a=>d.value.size=a),"page-sizes":d.value.sizes,background:d.value.background,layout:d.value.layout,total:d.value.total,disabled:ye.value,onSizeChange:Me,onCurrentChange:Ae},null,8,["currentPage","page-size","page-sizes","background","layout","total","disabled"])]),t(P,{modelValue:X.value,"onUpdate:modelValue":e[6]||(e[6]=a=>X.value=a),title:De.value,"align-center":"","destroy-on-close":"",width:"1300px",draggable:"","close-on-click-modal":!1},{default:s(()=>[t(ee(be),{id:A.value,"onUpdate:id":e[5]||(e[5]=a=>A.value=a)},null,8,["id"])]),_:1},8,["modelValue","title"]),t(P,{modelValue:M.value,"onUpdate:modelValue":e[12]||(e[12]=a=>M.value=a),title:"查询","align-center":"","destroy-on-close":"",width:"800px",draggable:"","close-on-click-modal":!1},{default:s(()=>[t(Y,{inline:"",model:i.value,class:"inline","label-width":"100px"},{default:s(()=>[t(u,{label:"单据号"},{default:s(()=>[t(O,{modelValue:i.value.单据号,"onUpdate:modelValue":e[7]||(e[7]=a=>i.value.单据号=a)},null,8,["modelValue"])]),_:1}),t(u,{label:"客户名称"},{default:s(()=>[t(O,{modelValue:i.value.客户名称,"onUpdate:modelValue":e[8]||(e[8]=a=>i.value.客户名称=a)},null,8,["modelValue"])]),_:1}),t(u,{label:"发票号"},{default:s(()=>[t(O,{modelValue:i.value.发票号,"onUpdate:modelValue":e[9]||(e[9]=a=>i.value.发票号=a)},null,8,["modelValue"])]),_:1}),t(u,{label:"制单人"},{default:s(()=>[t(O,{modelValue:i.value.制单人,"onUpdate:modelValue":e[10]||(e[10]=a=>i.value.制单人=a)},null,8,["modelValue"])]),_:1}),t(u,{label:"日期"},{default:s(()=>[t(qe,{modelValue:i.value.日期,"onUpdate:modelValue":e[11]||(e[11]=a=>i.value.日期=a),type:"daterange","value-format":"YYYY-MM-DD",clearable:""},null,8,["modelValue"])]),_:1}),t(u,{style:{"margin-left":"50px"}},{default:s(()=>[t(n,{type:"primary",disabled:p.value,onClick:Ie},{default:s(()=>[V("查询")]),_:1},8,["disabled"]),t(n,{type:"success",disabled:p.value,onClick:Te},{default:s(()=>[V("重置")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(P,{modelValue:L.value,"onUpdate:modelValue":e[14]||(e[14]=a=>L.value=a),title:"发票号修改","align-center":"","destroy-on-close":"",width:"500px"},{default:s(()=>[t(Y,{model:S.value,class:"inline","label-width":"100px"},{default:s(()=>[t(u,{label:"发票号"},{default:s(()=>[t(O,{modelValue:S.value.no,"onUpdate:modelValue":e[13]||(e[13]=a=>S.value.no=a),style:{width:"300px"}},null,8,["modelValue"])]),_:1}),t(u,null,{default:s(()=>[t(n,{type:"primary",onClick:Pe},{default:s(()=>[V("保存")]),_:1}),t(n,{type:"success",onClick:ie},{default:s(()=>[V("取消")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(P,{modelValue:j.value,"onUpdate:modelValue":e[15]||(e[15]=a=>j.value=a),title:"显隐列","align-center":"","destroy-on-close":"",width:"800px",draggable:"","close-on-click-modal":!1},{default:s(()=>[t(ee(ge),{class:"box-width",titles:["已隐藏列表","已显示列表"],filterable:!0,filterPlaceholder:"请输入",leftTransferData:ue.value,rightTransferData:I.value,onTransferChange:Fe},null,8,["leftTransferData","rightTransferData"])]),_:1},8,["modelValue"]),t(P,{modelValue:q.value,"onUpdate:modelValue":e[16]||(e[16]=a=>q.value=a),title:"显隐列","align-center":"","destroy-on-close":"",width:"800px",draggable:"","close-on-click-modal":!1},{default:s(()=>[t(ee(_e),{class:"box-width",titles:["已隐藏列表","已显示列表"],filterable:!0,filterPlaceholder:"请输入",leftTransferData:re.value,rightTransferData:z.value,onTransferChange:He},null,8,["leftTransferData","rightTransferData"])]),_:1},8,["modelValue"])])}}});const Sl=$e(pl,[["__scopeId","data-v-38bccacb"]]);export{Sl as default};
